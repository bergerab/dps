version = 4.2

//
// Saved by sw version: 2020.1
// Save timestamp: 21-Jun-2020 @ 10:48:16 AM
//

model "bat_gen_fc_grid" {
    configuration {
        hil_device = "HIL604"
        hil_configuration_id = 1
        simulation_method = exact
        simulation_time_step = auto
        simulation_discret_scaling = 1.0
        dsp_timer_periods = 100e-6, 50e-3
        ss_calc_method = "systematic elimination"
        enb_pole_shift = True
        enb_gds_oversampling = True
        show_modes = False
        device_ao_limit_enable = False
        cpl_stb = True
        enb_dep_sw_detect = False
        code_section = "external memory"
        data_section = "internal memory"
        sys_sp_rate_1 = 0.0001
        sys_sp_rate_2 = 0.0002
        sys_real_type_precision = "default"
        user_real_type_precision = "default"
        sys_cpu_optimization = "no optimization"
        user_cpu_optimization = "medium"
    }

    component Subsystem Root {
        component Subsystem Grid {
            layout = dynamic
            component "core/Three Phase Voltage Source" Vs1 {
            }
            [
                position = 7856, 8144
                size = 62, 256
            ]

            component "core/RL Section" "RL Section1" {
                L_value = "2.7996177881216925e-05"
                R_value = "1.5444546895887732"
                frequency = "60"
                inductance_per_l = "0.0006213711922373339"
                length = "1.609344"
                model_def = "S-U"
                power = "10e3"
                resistance_per_l = "0.621371192237334"
                unit_sys = "metric"
                voltage = "12.47"
            }
            [
                position = 8304, 8144
                size = 256, 56
            ]

            component "core/Three Phase Two Winding Transformer" Tr7 {
                L1 = "0.0034"
                L2 = "5.0817e-6"
                Lm = "5.18e3"
                R1 = "0.0862"
                R2 = "1.2272e-4"
                Rm = "5.18e3"
                Sn = "3e6"
                V1 = "12470"
                V2 = "4160"
                current_vals_SI = "[0.31428898062975824, 130.95374192906596]"
                current_vals_pu = "[0.002400000000001005, 0.9999999999995368]"
                f = "60.0"
                flux_vals_SI = "[32.409397037946476, 41.0519029147322]"
                flux_vals_pu = "[1.2000000000000948, 1.5199999999999776]"
                input = "SI"
                l1 = "0.0283"
                l2 = "0.0283"
                lm = "323.248820151"
                r1 = "0.005"
                r2 = "0.005"
                rm = "42.8722063131"
            }
            [
                position = 8568, 8144
                rotation = down
                scale = -1, -1
                size = 126, 256
            ]

            component Subsystem Ggrid_meas {
                layout = dynamic

                port A {
                    position = left:1
                    kind = pe
                }
                [
                    position = 7880, 7912
                ]

                port b {
                    position = right:2
                    kind = pe
                }
                [
                    position = 8504, 8016
                    rotation = down
                ]

                port C {
                    position = left:3
                    kind = pe
                }
                [
                    position = 7888, 8112
                ]

                port B {
                    position = left:2
                    kind = pe
                }
                [
                    position = 7880, 8008
                ]

                port c {
                    position = right:3
                    kind = pe
                }
                [
                    position = 8504, 8120
                    rotation = down
                ]

                port a {
                    position = right:1
                    kind = pe
                }
                [
                    position = 8504, 7912
                    rotation = down
                ]

                connect A a as Connection1
                connect B b as Connection2
                connect C c as Connection3
            }
            [
                position = 8000, 8144
                size = 56, 232
            ]

            port A {
                position = right:1
                kind = pe
            }
            [
                position = 8792, 8032
                rotation = down
            ]

            port B {
                position = right:2
                kind = pe
            }
            [
                position = 8792, 8128
                rotation = down
            ]

            port C {
                position = right:3
                kind = pe
            }
            [
                position = 8792, 8224
                rotation = down
            ]

            port N {
                position = left:1
                kind = pe
            }
            [
                position = 7776, 8144
            ]

            connect Vs1.n_node N as Connection92
            connect "RL Section1.P1" Tr7.prm_1 as Connection93
            connect "RL Section1.P3" Tr7.prm_2 as Connection94
            connect "RL Section1.P5" Tr7.prm_3 as Connection95
            connect Tr7.sec_1 A as Connection96
            connect Tr7.sec_2 B as Connection97
            [
                breakpoints = 8768, 8128
            ]
            connect Tr7.sec_3 C as Connection98
            connect Vs1.a_node Ggrid_meas.A as Connection99
            connect Vs1.b_node Ggrid_meas.B as Connection100
            connect Vs1.c_node Ggrid_meas.C as Connection101
            connect Ggrid_meas.a "RL Section1.P2" as Connection102
            connect Ggrid_meas.b "RL Section1.P4" as Connection103
            connect Ggrid_meas.c "RL Section1.P6" as Connection104
        }
        [
            position = 7560, 8120
            rotation = right
            scale = -1, 1
            size = 56, 152
        ]

        component Subsystem Microgrid_controller {
            layout = dynamic
            component gen_digital_probe cMode {
            }
            [
                position = 7064, 8040
                rotation = left
            ]

            component gen_bus_join "Bus Join1" {
            }
            [
                position = 8256, 8008
                hide_name = True
            ]

            component gen_bus_join "Bus Join2" {
                inputs = "5"
            }
            [
                position = 8200, 8200
                hide_name = True
            ]

            component gen_digital_probe opMode {
            }
            [
                position = 7064, 7920
                rotation = left
            ]

            component gen_probe Qoff {
            }
            [
                position = 7984, 8840
                rotation = left
            ]

            component gen_logic_op "Logical operator1" {
                inputs = "3"
                operator = "OR"
            }
            [
                position = 7288, 9048
                hide_name = True
            ]

            component gen_gain Gain1 {
                gain = "1/Sb"
            }
            [
                position = 7592, 8624
                hide_name = True
            ]

            component gen_gain Gain2 {
                gain = "Sb"
            }
            [
                position = 7784, 8624
                hide_name = True
            ]

            component sys_signal_switch "Signal switch1" {
                criterion = "ctrl > threshold"
            }
            [
                position = 7504, 8624
                hide_name = True
            ]

            component gen_digital_probe zeroed {
            }
            [
                position = 7376, 7784
                rotation = down
            ]

            component src_constant Constant4 {
                execution_rate = "inherit"
                value = "0"
            }
            [
                position = 7392, 8904
                hide_name = True
            ]

            component sys_signal_switch "Signal switch4" {
                criterion = "ctrl > threshold"
            }
            [
                position = 7880, 8896
                hide_name = True
            ]

            component gen_bus_split "Bus Split1" {
            }
            [
                position = 7136, 8552
                rotation = right
                hide_name = True
            ]

            component gen_c_function SM2 {
                in_terminal_dimensions = "inherit;inherit;inherit;inherit"
                in_terminal_dimensions_str = "dg_on inherit;batt_on inherit;CB inherit;der_opt_in inherit"
                in_terminal_labels = "[(\'dg_on\', True), (\'batt_on\', True), (\'CB\', True), (\'der_opt_in\', True)]"
                in_terminal_properties = "real dg_on;inherit batt_on;inherit CB;inherit der_opt_in;"
                no_feed_inputs = "[\'\']"
                no_feed_outputs = "[\'\']"
                out_terminal_dimensions = "inherit;inherit"
                out_terminal_dimensions_str = "der_opt inherit;force_off inherit"
                out_terminal_labels = "[(\'der_opt\', True), (\'force_off\', True)]"
                out_terminal_properties = "real der_opt;inherit force_off;"
                output_fnc = "/*Begin code section*/
if(dg_on && batt_on){
    der_opt = der_opt_in;
    force_off = 0;
}
else if(dg_on && !batt_on){
    der_opt = 1;
    force_off = 0;
}
else if (!dg_on && batt_on){
    der_opt = 0;
    force_off = 0;
}
else if(!CB){
    der_opt = der_opt_in;
    force_off = 1;
}
else{
    der_opt = der_opt_in;
    force_off = 0;
}
/*End code section*/"
            }
            [
                position = 7576, 8112
                size = 128, 96
            ]

            component gen_gain Gain3 {
                gain = "1/Sb"
            }
            [
                position = 7592, 8880
                hide_name = True
            ]

            component src_constant Constant2 {
                execution_rate = "inherit"
                value = "0"
            }
            [
                position = 7792, 8680
                hide_name = True
            ]

            component gen_gain Gain4 {
                gain = "Sb"
            }
            [
                position = 7784, 8880
                hide_name = True
            ]

            component sys_signal_switch "Signal switch2" {
                criterion = "ctrl > threshold"
            }
            [
                position = 7880, 8640
                hide_name = True
            ]

            component sys_signal_switch "Signal switch3" {
                criterion = "ctrl > threshold"
            }
            [
                position = 7504, 8880
                hide_name = True
            ]

            component gen_c_function SM {
                in_terminal_dimensions = "inherit;inherit;inherit;inherit"
                in_terminal_dimensions_str = "CB inherit;operation inherit;zeroed inherit;ON inherit"
                in_terminal_labels = "False;False;False;False;"
                in_terminal_properties = "real CB;inherit operation;inherit zeroed;inherit ON;"
                init_fnc = "/*Begin code section*/
open_cb = 1;
close_cb = 0;
/*End code section*/"
                no_feed_inputs = "[\'\']"
                no_feed_outputs = "[\'\']"
                out_terminal_dimensions = "inherit;inherit;inherit;inherit"
                out_terminal_dimensions_str = "gridform inherit;zeropower inherit;close_cb inherit;open_cb inherit"
                out_terminal_labels = "False;False;False;False;"
                out_terminal_properties = "real gridform;inherit zeropower;inherit close_cb;inherit open_cb;"
                output_fnc = "/*Begin code section*/
if(CB == 0){
    gridform = 1;
    zeropower = 0;
    if(operation == 0){
        close_cb = 1;
        open_cb = 0;
    }
}
else{
    gridform = 0;
    zeropower = 0;
    if(operation != 0){
        gridform = 0;
        if(ON){
            zeropower = 1;
        }
        else{
            zeropower = 0;
        }
        if(zeroed){
            close_cb = 0;
            open_cb = 1;
            zeropower = 0;
        }
    }
}
/*End code section*/"
            }
            [
                position = 7568, 7760
                size = 128, 80
            ]

            component gen_probe Poff {
            }
            [
                position = 7984, 8576
                rotation = left
            ]

            component gen_c_function is_zero {
                in_terminal_dimensions = "inherit;inherit"
                in_terminal_dimensions_str = "P inherit;Q inherit"
                in_terminal_labels = "False;False;"
                in_terminal_properties = "real P;inherit Q;"
                no_feed_inputs = "[\'\']"
                no_feed_outputs = "[\'\']"
                out_terminal_dimensions = "inherit"
                out_terminal_dimensions_str = "zeroed inherit"
                out_terminal_labels = "False;"
                out_terminal_properties = "real zeroed;"
                output_fnc = "/*Begin code section*/
if((fabs(P)<=p_lim) && (fabs(Q)<=q_lim)){
    zeroed = 1;
}
else{
    zeroed = 0;
}
/*End code section*/"
                parameters = "real p_lim;real q_lim;"
            }
            [
                position = 7256, 8736
                size = 48, 48
            ]

            component src_constant Constant3 {
                execution_rate = "inherit"
                value = "0"
            }
            [
                position = 7792, 8936
                hide_name = True
            ]

            component src_constant Constant1 {
                execution_rate = "inherit"
                value = "0"
            }
            [
                position = 7392, 8648
                hide_name = True
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "Ts"
            }
            [
                position = 7000, 8512
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition2" {
                execution_rate = "Ts"
            }
            [
                position = 7000, 8392
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition4" {
                execution_rate = "Ts"
            }
            [
                position = 7032, 9104
                hide_name = True
                size = 32, 32
            ]

            component Subsystem PI_Q {
                layout = dynamic
                component gen_sum Sum6 {
                    signs = "-+"
                }
                [
                    position = 8320, 8408
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_integrator Integrator1 {
                    init_value = "out0"
                    limit_lower = "-1"
                    limit_upper = "1"
                    show_reset = "either"
                }
                [
                    position = 8216, 8296
                ]

                component gen_gain Ki2 {
                    gain = "Ki2"
                }
                [
                    position = 7856, 8288
                ]

                component gen_gain Kp1 {
                    gain = "Kp1"
                }
                [
                    position = 7856, 8088
                ]

                component gen_gain Kb {
                    gain = "1.0"
                }
                [
                    position = 8216, 8408
                    scale = -1, 1
                ]

                component sys_signal_switch "Signal switch2" {
                    criterion = "ctrl > threshold"
                }
                [
                    position = 7976, 8272
                    hide_name = True
                    scale = 1, -1
                ]

                component gen_limiter Limit1 {
                    lower_limit = "lowLim"
                    upper_limit = "upLim"
                }
                [
                    position = 8408, 8288
                    hide_name = True
                ]

                component gen_gain Ki1 {
                    gain = "Ki1"
                }
                [
                    position = 7856, 8216
                ]

                component gen_gain Kp2 {
                    gain = "Kp2"
                }
                [
                    position = 7856, 8024
                ]

                component sys_signal_switch "Signal switch1" {
                    criterion = "ctrl > threshold"
                }
                [
                    position = 8048, 8040
                    hide_name = True
                ]

                component gen_sum Sum7 {
                }
                [
                    position = 8088, 8280
                    hide_name = True
                ]

                component gen_sum Sum5 {
                }
                [
                    position = 8320, 8288
                    hide_name = True
                ]

                port In {
                    label = "In"
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7696, 8168
                ]

                port Out {
                    label = "Out"
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8472, 8288
                ]

                port reset {
                    position = top:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8136, 8304
                ]

                port changeK {
                    position = top:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8000, 7904
                ]

                tag From1 {
                    value = "changeK"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7912, 8336
                    hide_name = True
                ]

                tag Goto1 {
                    value = "changeK"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8136, 7952
                    hide_name = True
                ]

                junction Junction2 sp
                [
                    position = 8368, 8288
                ]

                junction Junction3 sp
                [
                    position = 8440, 8288
                ]

                junction Junction4 sp
                [
                    position = 7728, 8168
                ]

                junction Junction5 sp
                [
                    position = 7728, 8088
                ]

                junction Junction6 sp
                [
                    position = 7728, 8216
                ]

                junction Junction11 sp
                [
                    position = 8048, 7952
                ]

                connect From1 "Signal switch2.in2" as Connection103
                connect Goto1 Junction11 as Connection102
                connect Junction11 "Signal switch1.in2" as Connection101
                connect Junction2 Limit1.in as Connection45
                connect Junction3 Out as Connection48
                connect Junction4 In as Connection67
                connect Junction5 Junction4 as Connection70
                connect Junction5 Kp2.in as Connection107
                [
                    breakpoints = 7728, 8088; 7728, 8024
                ]
                connect Junction6 Junction4 as Connection76
                connect Junction6 Ki2.in as Connection110
                [
                    breakpoints = 7728, 8216; 7728, 8288
                ]
                connect Kb.in Sum6.out as Connection50
                connect Ki1.in Junction6 as Connection75
                connect Ki1.out "Signal switch2.in1" as Connection112
                connect Ki2.out "Signal switch2.in" as Connection111
                connect Kp1.in Junction5 as Connection69
                connect Kp1.out "Signal switch1.in1" as Connection109
                connect Kp2.out "Signal switch1.in" as Connection108
                connect Limit1.out Junction3 as Connection47
                connect "Signal switch1.out" Sum5.in as Connection92
                connect "Signal switch2.out" Sum7.in as Connection95
                connect Sum5.in1 Integrator1.out as Connection5
                connect Sum5.out Junction2 as Connection44
                connect Sum6.in Junction2 as Connection46
                connect Sum6.in1 Junction3 as Connection49
                connect Sum7.out Integrator1.in as Connection52
                connect Sum7.in1 Kb.out as Connection53
                connect changeK Junction11 as Connection100
                connect reset Integrator1.reset as Connection62

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller with two sets of gains.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">If the input \"changeK\" is high, the gains set number 2 is used.</span></p></body></html>"

                    upLim {
                        label = "Upper limit"
                        widget = edit
                        type = generic
                        default_value = "1"
                        group = "General:1"
                    }

                    lowLim {
                        label = "Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1"
                        group = "General:1"
                    }

                    out0 {
                        label = "Integrator initial output"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "General:1"
                    }

                    Kp1 {
                        label = "Kp"
                        widget = edit
                        type = generic
                        default_value = "0.5"
                        group = "Gains case 1:2"
                    }

                    Ki1 {
                        label = "Ki"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "Gains case 1:2"
                    }

                    Kp2 {
                        label = "Kp"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "Gains case 2:2"
                    }

                    Ki2 {
                        label = "Ki"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "Gains case 2:2"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7688, 8880
                size = 64, 112
            ]

            component "core/Rate Transition" "Rate Transition3" {
                execution_rate = "Ts"
            }
            [
                position = 7024, 8992
                hide_name = True
                size = 32, 32
            ]

            component Subsystem PI_P {
                layout = dynamic
                component gen_sum Sum7 {
                }
                [
                    position = 8088, 8376
                    hide_name = True
                ]

                component gen_gain Kp1 {
                    gain = "Kp1"
                }
                [
                    position = 7880, 8256
                ]

                component gen_limiter Limit1 {
                    lower_limit = "lowLim"
                    upper_limit = "upLim"
                }
                [
                    position = 8408, 8384
                    hide_name = True
                ]

                component sys_signal_switch "Signal switch2" {
                    criterion = "ctrl > threshold"
                }
                [
                    position = 7976, 8368
                    hide_name = True
                    scale = 1, -1
                ]

                component sys_signal_switch "Signal switch1" {
                    criterion = "ctrl > threshold"
                }
                [
                    position = 8064, 8208
                    hide_name = True
                ]

                component gen_gain Ki2 {
                    gain = "Ki2"
                }
                [
                    position = 7856, 8384
                ]

                component gen_gain Kb {
                    gain = "1.0"
                }
                [
                    position = 8216, 8504
                    scale = -1, 1
                ]

                component gen_integrator Integrator1 {
                    init_value = "out0"
                    limit_lower = "-1"
                    limit_upper = "1"
                    show_reset = "either"
                }
                [
                    position = 8216, 8392
                ]

                component gen_sum Sum6 {
                    signs = "-+"
                }
                [
                    position = 8320, 8504
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_gain Kp2 {
                    gain = "Kp2"
                }
                [
                    position = 7880, 8192
                ]

                component gen_sum Sum5 {
                }
                [
                    position = 8320, 8384
                    hide_name = True
                ]

                component gen_gain Ki1 {
                    gain = "Ki1"
                }
                [
                    position = 7856, 8328
                ]

                port In {
                    label = "In"
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7696, 8280
                ]

                port Out {
                    label = "Out"
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8472, 8384
                ]

                port reset {
                    position = top:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8136, 8400
                ]

                port changeK {
                    position = top:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8016, 8096
                ]

                tag From1 {
                    value = "changeK"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7912, 8432
                    hide_name = True
                ]

                tag Goto1 {
                    value = "changeK"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8152, 8144
                    hide_name = True
                ]

                junction Junction2 sp
                [
                    position = 8368, 8384
                ]

                junction Junction3 sp
                [
                    position = 8440, 8384
                ]

                junction Junction4 sp
                [
                    position = 7728, 8280
                ]

                junction Junction11 sp
                [
                    position = 8064, 8144
                ]

                junction Junction12 sp
                [
                    position = 7728, 8256
                ]

                junction Junction13 sp
                [
                    position = 7728, 8328
                ]

                connect From1 "Signal switch2.in2" as Connection103
                connect Goto1 Junction11 as Connection102
                connect Junction11 "Signal switch1.in2" as Connection101
                connect Junction12 Kp2.in as Connection112
                [
                    breakpoints = 7728, 8192
                ]
                connect Junction13 Ki1.in as Connection116
                [
                    breakpoints = 7728, 8328
                ]
                connect Junction2 Limit1.in as Connection45
                connect Junction3 Out as Connection48
                connect Junction4 In as Connection67
                connect Junction4 Junction12 as Connection111
                connect Junction4 Junction13 as Connection115
                connect Kb.in Sum6.out as Connection50
                connect Ki1.out "Signal switch2.in1" as Connection106
                connect Ki2.in Junction13 as Connection117
                connect Ki2.out "Signal switch2.in" as Connection105
                connect Kp1.in Junction12 as Connection113
                connect Kp1.out "Signal switch1.in1" as Connection109
                connect Kp2.out "Signal switch1.in" as Connection108
                connect Limit1.out Junction3 as Connection47
                connect "Signal switch1.out" Sum5.in as Connection92
                connect "Signal switch2.out" Sum7.in as Connection95
                connect Sum5.in1 Integrator1.out as Connection5
                connect Sum5.out Junction2 as Connection44
                connect Sum6.in Junction2 as Connection46
                connect Sum6.in1 Junction3 as Connection49
                connect Sum7.out Integrator1.in as Connection52
                connect Sum7.in1 Kb.out as Connection53
                connect changeK Junction11 as Connection100
                connect reset Integrator1.reset as Connection62

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller with two sets of gains.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">If the input \"changeK\" is high, the gains set number 2 is used.</span></p></body></html>"

                    upLim {
                        label = "Upper limit"
                        widget = edit
                        type = generic
                        default_value = "1"
                        group = "General:1"
                    }

                    lowLim {
                        label = "Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1"
                        group = "General:1"
                    }

                    out0 {
                        label = "Integrator initial output"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "General:1"
                    }

                    Kp1 {
                        label = "Kp"
                        widget = edit
                        type = generic
                        default_value = "0.5"
                        group = "Gains case 1:2"
                    }

                    Ki1 {
                        label = "Ki"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "Gains case 1:2"
                    }

                    Kp2 {
                        label = "Kp"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "Gains case 2:2"
                    }

                    Ki2 {
                        label = "Ki"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "Gains case 2:2"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7704, 8624
                size = 64, 112
            ]

            component "core/Rate Transition" "Rate Transition5" {
                execution_rate = "Ts"
            }
            [
                position = 7048, 9224
                hide_name = True
                size = 32, 32
            ]

            component gen_c_function SM3 {
                in_terminal_dimensions = "inherit;inherit;inherit;inherit"
                in_terminal_dimensions_str = "dg800kW_on inherit;batt_on inherit;CB inherit;der_opt_in inherit"
                in_terminal_labels = "[(\'dg800kW_on\', True), (\'batt_on\', True), (\'CB\', True), (\'der_opt_in\', True)]"
                in_terminal_properties = "real dg800kW_on;inherit batt_on;inherit CB;inherit der_opt_in;"
                no_feed_inputs = "[\'\']"
                no_feed_outputs = "[\'\']"
                out_terminal_dimensions = "inherit;inherit"
                out_terminal_dimensions_str = "der_opt inherit;force_off inherit"
                out_terminal_labels = "[(\'der_opt\', True), (\'force_off\', True)]"
                out_terminal_properties = "real der_opt;inherit force_off;"
                output_fnc = "/*Begin code section*/
if(dg800kW_on && batt_on){
    der_opt = der_opt_in;
    force_off = 0;
}
else if(dg800kW_on && !batt_on){
    der_opt = 1;
    force_off = 0;
}
else if (!dg800kW_on && batt_on){
    der_opt = 0;
    force_off = 0;
}
else if(!CB){
    der_opt = der_opt_in;
    force_off = 1;
}
else{
    der_opt = der_opt_in;
    force_off = 0;
}
/*End code section*/"
            }
            [
                position = 7544, 8392
                size = 128, 80
            ]

            component gen_bus_join "Bus Join3" {
                inputs = "5"
            }
            [
                position = 8640, 8512
                hide_name = True
            ]

            port control_option {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6928, 8088
            ]

            port operation_mode {
                position = left:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6928, 7984
            ]

            port PCC_control {
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8376, 8008
            ]

            port DER_control {
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8376, 8200
            ]

            port power_meas {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6928, 8512
            ]

            port CB_status {
                position = left:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6928, 8392
            ]

            port fromESS {
                position = left:5
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6920, 8992
            ]

            port fromDG {
                position = left:6
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6928, 9104
            ]

            port fromDG800kW {
                position = left:6
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6944, 9224
            ]

            port DER_control_800 {
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8816, 8512
            ]

            tag From20 {
                value = "c_option"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7464, 8200
                rotation = left
                hide_name = True
            ]

            tag From24 {
                value = "force_off"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8136, 8288
                rotation = left
                hide_name = True
            ]

            tag From15 {
                value = "Q_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8104, 8288
                rotation = left
                hide_name = True
            ]

            tag Goto15 {
                value = "dg_on"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7136, 9104
                hide_name = True
            ]

            tag Goto14 {
                value = "batt_on"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7128, 8992
                hide_name = True
            ]

            tag Goto4 {
                value = "CB"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7096, 8392
                hide_name = True
            ]

            tag From9 {
                value = "isZero"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7424, 7848
                rotation = left
                hide_name = True
            ]

            tag Goto5 {
                value = "operation"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7136, 7984
                hide_name = True
            ]

            tag From10 {
                value = "close_cb"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8144, 7976
                hide_name = True
            ]

            tag From23 {
                value = "batt_on"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7424, 8000
                rotation = right
                hide_name = True
            ]

            tag From14 {
                value = "P_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8072, 8288
                rotation = left
                hide_name = True
            ]

            tag From19 {
                value = "ON"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7464, 7848
                rotation = left
                hide_name = True
            ]

            tag Goto8 {
                value = "P_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8080, 8640
                hide_name = True
            ]

            tag From22 {
                value = "dg_on"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7464, 8000
                rotation = right
                hide_name = True
            ]

            tag From7 {
                value = "CB"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7464, 7664
                rotation = right
                hide_name = True
            ]

            tag Goto2 {
                value = "activate"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7720, 7664
                rotation = left
                hide_name = True
            ]

            tag From2 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7808, 8568
                hide_name = True
            ]

            tag From8 {
                value = "operation"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7424, 7664
                rotation = right
                hide_name = True
            ]

            tag Goto9 {
                value = "Q_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8080, 8896
                hide_name = True
            ]

            tag From4 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7808, 8824
                hide_name = True
            ]

            tag Goto13 {
                value = "ON"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7368, 9048
                hide_name = True
            ]

            tag From12 {
                value = "der_opt"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8136, 8112
                rotation = right
                hide_name = True
            ]

            tag From5 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7448, 8824
                hide_name = True
            ]

            tag From17 {
                value = "der_opt_800"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7616, 8504
                hide_name = True
            ]

            tag From6 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7456, 8568
                hide_name = True
            ]

            tag Goto16 {
                value = "der_opt"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7776, 8080
                hide_name = True
            ]

            tag Goto12 {
                value = "open_cb"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7672, 7848
                rotation = right
                hide_name = True
            ]

            tag From16 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7608, 8792
                hide_name = True
            ]

            tag From11 {
                value = "open_cb"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8144, 8016
                hide_name = True
            ]

            tag Goto7 {
                value = "isZero"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7344, 8736
                hide_name = True
            ]

            tag From18 {
                value = "der_opt_800"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7608, 8760
                hide_name = True
            ]

            tag Goto11 {
                value = "close_cb"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7720, 7848
                rotation = right
                hide_name = True
            ]

            tag Goto6 {
                value = "c_option"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7136, 8088
                hide_name = True
            ]

            tag From13 {
                value = "gridform"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8104, 8112
                rotation = right
                hide_name = True
            ]

            tag Goto17 {
                value = "force_off"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7776, 8144
                hide_name = True
            ]

            tag From1 {
                value = "activate"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7616, 8536
                hide_name = True
            ]

            tag From21 {
                value = "CB"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7424, 8200
                rotation = left
                hide_name = True
            ]

            tag Goto10 {
                value = "gridform"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7672, 7664
                rotation = left
                hide_name = True
            ]

            tag Goto18 {
                value = "dg800kW_on"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7384, 9216
                hide_name = True
            ]

            tag From26 {
                value = "dg800kW_on"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7456, 8480
                rotation = left
                hide_name = True
            ]

            tag From27 {
                value = "batt_on"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7464, 8280
                rotation = right
                hide_name = True
            ]

            tag From28 {
                value = "CB"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7424, 8280
                rotation = left
                hide_name = True
                scale = 1, -1
            ]

            tag From29 {
                value = "c_option"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7424, 8480
                rotation = left
                hide_name = True
            ]

            tag From30 {
                value = "der_opt_800"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8576, 8424
                rotation = right
                hide_name = True
            ]

            tag From31 {
                value = "gridform"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8544, 8424
                rotation = right
                hide_name = True
            ]

            tag From32 {
                value = "P_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8512, 8600
                rotation = left
                hide_name = True
            ]

            tag From33 {
                value = "force_off_800"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8576, 8600
                rotation = left
                hide_name = True
            ]

            tag From34 {
                value = "Q_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8544, 8600
                rotation = left
                hide_name = True
            ]

            tag Goto19 {
                value = "force_off_800"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7704, 8424
                hide_name = True
            ]

            tag Goto20 {
                value = "der_opt_800"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7704, 8360
                hide_name = True
            ]

            junction Junction1 sp
            [
                position = 7200, 8608
            ]

            junction Junction2 sp
            [
                position = 7200, 8864
            ]

            junction Junction3 sp
            [
                position = 7984, 8640
            ]

            junction Junction4 sp
            [
                position = 7984, 8896
            ]

            junction Junction6 sp
            [
                position = 7064, 7984
            ]

            junction Junction7 sp
            [
                position = 7064, 8088
            ]

            junction Junction8 sp
            [
                position = 7424, 7784
            ]

            junction Junction9 sp
            [
                position = 7056, 8992
            ]

            junction Junction10 sp
            [
                position = 7072, 9104
            ]

            junction Junction11 sp
            [
                position = 7224, 9224
            ]

            comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">DER_control:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - DER option</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - grid form</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2 - active power ref</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3 - reactive power ref </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">4 - force off</p></body></html> ENDCOMMENT 
            [
                position = 8304, 8256
            ]

            comment Comment3 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">operation_mode:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">if zero:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    grid tie</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">else:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    island</p></body></html> ENDCOMMENT 
            [
                position = 6864, 7840
            ]

            comment Comment4 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">control_option:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">if zero:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    battery inverter forms the grid</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">else:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    diesel genset forms the grid</p></body></html> ENDCOMMENT 
            [
                position = 6824, 8136
            ]

            comment Comment2 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">PCC_control</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - close command</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - open command</p></body></html> ENDCOMMENT 
            [
                position = 8304, 7904
            ]

            comment Comment5 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">power_meas:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - active power</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - reactive power</p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html> ENDCOMMENT 
            [
                position = 6800, 8568
            ]

            comment Comment6 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">DER_control:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - DER option</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - grid form</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2 - active power ref</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3 - reactive power ref </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">4 - force off</p></body></html> ENDCOMMENT 
            [
                position = 8744, 8568
            ]

            connect "Bus Join1.out" PCC_control as Connection65
            connect "Bus Split1.out" Junction1 as Connection36
            connect "Bus Split1.out1" Junction2 as Connection39
            connect "Bus Split1.in" "Rate Transition1.out" as Connection15
            connect Constant1.out "Signal switch1.in1" as Connection10
            connect Constant2.out "Signal switch2.in1" as Connection13
            connect Constant3.out "Signal switch4.in1" as Connection21
            connect Constant4.out "Signal switch3.in1" as Connection22
            connect DER_control "Bus Join2.out" as Connection70
            connect From10 "Bus Join1.in" as Connection63
            connect From11 "Bus Join1.in1" as Connection64
            connect From12 "Bus Join2.in" as Connection66
            connect From13 "Bus Join2.in1" as Connection67
            connect From14 "Bus Join2.in2" as Connection68
            connect From15 "Bus Join2.in3" as Connection69
            connect From16 PI_Q.reset as Connection83
            connect From17 PI_P.changeK as Connection89
            connect From18 PI_Q.changeK as Connection90
            connect From2 "Signal switch2.in2" as Connection9
            connect From20 SM2.der_opt_in as Connection107
            connect From21 SM2.CB as Connection108
            connect From22 SM2.dg_on as Connection109
            connect From24 "Bus Join2.in4" as Connection112
            connect From4 "Signal switch4.in2" as Connection17
            connect From5 "Signal switch3.in2" as Connection25
            connect From6 "Signal switch1.in2" as Connection28
            connect From7 SM.CB as Connection32
            connect From8 SM.operation as Connection35
            connect From9 Junction8 as Connection98
            connect Goto10 SM.gridform as Connection60
            connect Goto11 SM.close_cb as Connection61
            connect Goto12 SM.open_cb as Connection62
            connect Goto13 "Logical operator1.out" as Connection95
            connect Goto14 Junction9 as Connection103
            connect Goto2 SM.zeropower as Connection29
            connect Goto4 "Rate Transition2.out" as Connection30
            connect Goto5 Junction6 as Connection74
            connect Goto6 Junction7 as Connection77
            connect Goto7 is_zero.zeroed as Connection42
            connect Goto8 Junction3 as Connection56
            connect Goto9 Junction4 as Connection59
            connect Junction1 "Signal switch1.in" as Connection37
            connect Junction2 "Signal switch3.in" as Connection40
            connect Junction3 "Signal switch2.out" as Connection55
            connect Junction4 "Signal switch4.out" as Connection58
            connect Junction6 operation_mode as Connection75
            connect Junction7 control_option as Connection78
            connect Junction8 zeroed.in as Connection99
            connect Junction9 "Rate Transition3.out" as Connection102
            connect "Logical operator1.in" Junction9 as Connection101
            connect PI_P.reset From1 as Connection88
            connect PI_P.In Gain1.out as Connection87
            connect PI_P.Out Gain2.in as Connection86
            connect PI_Q.In Gain3.out as Connection84
            connect PI_Q.Out Gain4.in as Connection85
            connect Poff.in Junction3 as Connection54
            connect Qoff.in Junction4 as Connection57
            connect "Rate Transition1.in" power_meas as Connection14
            connect "Rate Transition2.in" CB_status as Connection31
            connect "Rate Transition3.in" fromESS as Connection91
            connect "Rate Transition4.in" fromDG as Connection92
            connect SM.ON From19 as Connection96
            connect SM.zeroed Junction8 as Connection100
            connect SM2.batt_on From23 as Connection110
            connect "Signal switch1.out" Gain1.in as Connection4
            connect "Signal switch2.in" Gain2.out as Connection5
            connect "Signal switch3.out" Gain3.in as Connection18
            connect "Signal switch4.in" Gain4.out as Connection19
            connect cMode.in Junction7 as Connection79
            connect is_zero.P Junction1 as Connection38
            connect is_zero.Q Junction2 as Connection41
            connect opMode.in Junction6 as Connection76
            connect "Rate Transition5.in" fromDG800kW as Connection114
            connect From27 SM3.batt_on as Connection120
            connect From28 SM3.CB as Connection121
            connect From29 SM3.der_opt_in as Connection122
            connect From26 SM3.dg800kW_on as Connection129
            connect "Rate Transition4.out" Junction10 as Connection144
            connect Junction10 Goto15 as Connection145
            [
                breakpoints = 7064, 9104
            ]
            connect "Logical operator1.in1" Junction10 as Connection146
            connect Goto18 Junction11 as Connection147
            [
                breakpoints = 7344, 9216; 7256, 9224
            ]
            connect Junction11 "Rate Transition5.out" as Connection148
            connect "Logical operator1.in2" Junction11 as Connection149
            connect From32 "Bus Join3.in2" as Connection156
            connect From31 "Bus Join3.in1" as Connection157
            connect From33 "Bus Join3.in4" as Connection158
            connect DER_control_800 "Bus Join3.out" as Connection159
            connect From30 "Bus Join3.in" as Connection160
            connect From34 "Bus Join3.in3" as Connection161
            connect SM2.der_opt Goto16 as Connection162
            connect SM2.force_off Goto17 as Connection163
            connect SM3.der_opt Goto20 as Connection164
            connect SM3.force_off Goto19 as Connection165

            Sb = "860e3"

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power Management System</p></body></html>"

                Sb {
                    label = "Microgrid nominal power"
                    widget = edit
                    type = generic
                    default_value = "4.5e6"
                    unit = "VA"
                    group = "General"
                }

                p_lim {
                    label = "Allowed active power to intentionally island"
                    widget = edit
                    type = generic
                    default_value = "1000"
                    unit = "W"
                    group = "General"
                }

                q_lim {
                    label = "Allowed reactive power to intentionally island"
                    widget = edit
                    type = generic
                    default_value = "1000"
                    unit = "VAr"
                    group = "General"
                }

                Ts {
                    label = "Execution rate"
                    widget = edit
                    type = generic
                    default_value = "Ts2"
                    unit = "s"
                    group = "General"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 7264, 8536
            size = 152, 232
        ]

        component src_scada_input c_option {
            execution_rate = "Ts2"
            max = "1"
            min = "0"
            unit = ""
        }
        [
            position = 7088, 8424
            rotation = right
        ]

        component Subsystem ESS {
            layout = dynamic
            component src_scada_input On {
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 8056, 7984
            ]

            component gen_probe Out {
            }
            [
                position = 8376, 8176
                rotation = left
            ]

            component src_scada_input Pref {
                execution_rate = "Ts"
                max = "10e6"
                min = "-10e6"
                unit = ""
            }
            [
                position = 7344, 8104
            ]

            component src_scada_input f_ref {
                def_value = "60.0"
                execution_rate = "Ts"
                unit = ""
            }
            [
                position = 7344, 8040
            ]

            component gen_bus_join "Bus Join2" {
                inputs = "6"
            }
            [
                position = 8152, 8240
                rotation = right
                hide_name = True
            ]

            component src_scada_input mode {
                execution_rate = "Ts"
                max = "2"
                min = "0"
                unit = ""
            }
            [
                position = 7400, 8256
            ]

            component src_scada_input Vref {
                def_value = "480"
                execution_rate = "Ts"
                unit = ""
            }
            [
                position = 7344, 7976
            ]

            component src_scada_input Qref {
                execution_rate = "Ts"
                max = "10e6"
                min = "-10e6"
                unit = ""
            }
            [
                position = 7344, 8168
            ]

            component gen_terminator Termination1 {
            }
            [
                position = 7520, 8256
            ]

            component Subsystem split {
                layout = dynamic
                component gen_terminator T4 {
                }
                [
                    position = 8504, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T8 {
                }
                [
                    position = 8424, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T5 {
                }
                [
                    position = 8552, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T9 {
                }
                [
                    position = 8464, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_logic_op "Logical operator1" {
                }
                [
                    position = 8264, 8040
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T10 {
                }
                [
                    position = 8504, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T6 {
                }
                [
                    position = 8336, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T11 {
                }
                [
                    position = 8264, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T2 {
                }
                [
                    position = 8456, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T3 {
                }
                [
                    position = 8408, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_bus_split "Bus Split1" {
                    outputs = "14"
                }
                [
                    position = 8192, 8192
                    hide_name = True
                ]

                component gen_terminator T1 {
                }
                [
                    position = 8360, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T7 {
                }
                [
                    position = 8384, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T {
                }
                [
                    position = 8312, 8352
                    rotation = right
                    hide_name = True
                ]

                port ON {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8264, 7968
                    rotation = left
                ]

                port In {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8120, 8192
                ]

                connect "Bus Split1.in" In as Connection1
                connect "Bus Split1.out1" "Logical operator1.in1" as Connection11
                connect "Bus Split1.out5" T9.in as Connection16
                connect "Logical operator1.in" "Bus Split1.out" as Connection10
                connect ON "Logical operator1.out" as Connection12
                connect T.in "Bus Split1.out12" as Connection4
                connect T1.in "Bus Split1.out11" as Connection5
                connect T10.in "Bus Split1.out6" as Connection17
                connect T11.in "Bus Split1.out13" as Connection18
                connect T2.in "Bus Split1.out9" as Connection7
                connect T3.in "Bus Split1.out10" as Connection6
                connect T4.in "Bus Split1.out8" as Connection8
                connect T5.in "Bus Split1.out7" as Connection9
                connect T6.in "Bus Split1.out2" as Connection13
                connect T7.in "Bus Split1.out3" as Connection14
                connect T8.in "Bus Split1.out4" as Connection15
            }
            [
                position = 8456, 8232
                size = 48, 48
            ]

            component "core/Battery" "Battery 1" {
                Kdisc_I = "20.0"
                Ke_exp = "103.0"
                Ke_full = "116.0"
                Kq_exp = "85.0"
                Kq_nom = "93.5"
                R_series = "0.005833333333333339"
                battery_type = "Lithium-Ion"
                capacity = "1.5e3"
                execution_rate = "Ts"
                initial_soc = "19"
                nominal_voltage = "350.0"
                sig_output = "True"
            }
            [
                position = 7888, 8424
                rotation = right
                size = 64, 48
            ]

            component Subsystem Interface {
                layout = dynamic
                component gen_c_function SM {
                    in_terminal_dimensions = "inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit"
                    in_terminal_dimensions_str = "DERoption inherit;formGrid inherit;Ppms inherit;Qpms inherit;dw inherit;dV inherit;wref inherit;Vref inherit;Pref inherit;Qref inherit"
                    in_terminal_labels = "False;False;False;False;False;False;False;False;False;False;"
                    in_terminal_properties = "inherit DERoption;inherit formGrid;inherit Ppms;inherit Qpms;inherit dw;inherit dV;inherit wref;inherit Vref;inherit Pref;inherit Qref;"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit;inherit;inherit;inherit;inherit"
                    out_terminal_dimensions_str = "gridForm inherit;V inherit;w inherit;P inherit;Q inherit"
                    out_terminal_labels = "False;False;False;False;False;"
                    out_terminal_properties = "inherit gridForm;inherit V;inherit w;inherit P;inherit Q;"
                    output_fnc = "/*Begin code section*/
if(DERoption == 0){
    if(formGrid > 0){
        gridForm = 0;
        V = Vref + dV;
        w = wref + dw;
        P = 0;
        Q = 0;
    }
    else{
        gridForm = 1;
        V = Vref;
        w = wref;
        P = Pref + Ppms;
        Q = Qref + Qpms;
    }
}
else{
    gridForm = 1;
    V = Vref;
    w = wref;
    P = Pref + Ppms;
    Q = Qref + Qpms;
}
/*End code section*/"
                }
                [
                    position = 8256, 8232
                    size = 48, 176
                ]

                component gen_bus_split "Bus Split2" {
                }
                [
                    position = 7928, 8328
                    hide_name = True
                ]

                component gen_bus_split "Bus Split1" {
                    outputs = "5"
                }
                [
                    position = 7992, 8040
                    rotation = right
                    hide_name = True
                ]

                component gen_gain Gain5 {
                    gain = "Vb"
                }
                [
                    position = 8008, 8280
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 7904, 8104
                    rotation = down
                    hide_name = True
                ]

                component gen_gain Gain4 {
                    gain = "fb"
                }
                [
                    position = 7968, 8256
                    rotation = left
                    hide_name = True
                ]

                component "core/Rate Transition" "Rate Transition1" {
                    execution_rate = "Ts"
                }
                [
                    position = 7920, 7984
                    hide_name = True
                    size = 32, 32
                ]

                port fromPMS {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7856, 7984
                ]

                port fromPCC {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7848, 8328
                ]

                port P {
                    position = right:4
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8264
                ]

                port Pref {
                    position = left:5
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8176, 8400
                    rotation = left
                ]

                port Qref {
                    position = left:7
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8200, 8368
                    rotation = left
                ]

                port V_ref {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8048
                ]

                port wref {
                    position = left:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8112, 8464
                    rotation = left
                ]

                port Vref {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8144, 8432
                    rotation = left
                ]

                port opMode {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 7960
                ]

                port Q {
                    position = right:7
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8344
                ]

                port f_ref {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8536, 8152
                ]

                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Outputs are in SI</p></body></html> ENDCOMMENT 
                [
                    position = 8600, 8136
                ]

                comment Comment2 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Inputs are in SI</p></body></html> ENDCOMMENT 
                [
                    position = 8160, 8024
                ]

                connect "Bus Split1.out" SM.DERoption as Connection993
                connect "Bus Split1.out2" SM.Ppms as Connection995
                connect "Bus Split2.out1" Gain5.in as Connection982
                connect "Bus Split2.in" fromPCC as Connection892
                connect Gain4.in "Bus Split2.out" as Connection981
                connect Gain5.out SM.dV as Connection983
                connect Qref SM.Qref as Connection953
                connect "Rate Transition1.out" "Bus Split1.in" as Connection992
                connect "Rate Transition1.in" fromPMS as Connection893
                connect SM.Qpms "Bus Split1.out3" as Connection996
                connect SM.formGrid "Bus Split1.out1" as Connection994
                connect SM.dw Gain4.out as Connection980
                connect SM.Pref Pref as Connection954
                connect SM.Vref Vref as Connection955
                connect SM.wref wref as Connection956
                connect Termination1.in "Bus Split1.out4" as Connection997
                connect SM.gridForm opMode as Connection998
                [
                    breakpoints = 8320, 7960
                ]
                connect V_ref SM.V as Connection999
                [
                    breakpoints = 8368, 8048
                ]
                connect f_ref SM.w as Connection1000
                [
                    breakpoints = 8400, 8152
                ]
                connect SM.P P as Connection1001
                [
                    breakpoints = 8480, 8264
                ]
                connect SM.Q Q as Connection1002
                [
                    breakpoints = 8480, 8344
                ]

                Vb = "208"

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Interface for PMS and Battery inverter</p></body></html>"

                    Vb {
                        label = "Battery inverter nominal voltage"
                        widget = edit
                        type = generic
                        default_value = "480.0"
                        unit = "V"
                        group = "General"
                    }

                    fb {
                        label = "Battery inverter nominal frequency"
                        widget = edit
                        type = generic
                        default_value = "60.0"
                        unit = "Hz"
                        group = "General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "Ts"
                        unit = "s"
                        group = "General"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7504, 8008
                size = 128, 368
            ]

            component Subsystem "Battery inverter" {
                layout = static
                component pas_capacitor Cfa {
                    capacitance = "1/(np.square(OutputFilterFc*2*np.pi)*L)"
                }
                [
                    position = 8624, 8048
                    rotation = right
                ]

                component pas_resistor Rfb {
                    resistance = "Resr"
                }
                [
                    position = 8696, 7952
                    rotation = left
                    scale = -1, 1
                ]

                component pas_inductor Lb {
                    inductance = "L"
                }
                [
                    position = 8336, 7768
                    scale = -1, -1
                ]

                component pas_resistor Rdc {
                    resistance = "50e-9"
                }
                [
                    position = 7560, 7672
                ]

                component pas_inductor Lc {
                    inductance = "L"
                }
                [
                    position = 8336, 7864
                    scale = -1, -1
                ]

                component pas_inductor La {
                    inductance = "L"
                }
                [
                    position = 8336, 7672
                    scale = -1, -1
                ]

                component pas_capacitor Cdc {
                    capacitance = "20e-3"
                }
                [
                    position = 7624, 7768
                    rotation = right
                ]

                component pas_capacitor Cfb {
                    capacitance = "1/(np.square(OutputFilterFc*2*np.pi)*L)"
                }
                [
                    position = 8696, 8048
                    rotation = right
                ]

                component pas_capacitor Cfc {
                    capacitance = "1/(np.square(OutputFilterFc*2*np.pi)*L)"
                }
                [
                    position = 8768, 8048
                    rotation = right
                ]

                component pas_resistor Rfa {
                    resistance = "Resr"
                }
                [
                    position = 8624, 7952
                    rotation = left
                    scale = -1, 1
                ]

                component pas_resistor Rfc {
                    resistance = "Resr"
                }
                [
                    position = 8768, 7952
                    rotation = left
                    scale = -1, 1
                ]

                component pas_resistor Ra {
                    resistance = "R"
                }
                [
                    position = 8232, 7672
                ]

                component pas_resistor Rb {
                    resistance = "R"
                }
                [
                    position = 8232, 7768
                ]

                component pas_resistor Rc {
                    resistance = "R"
                }
                [
                    position = 8232, 7864
                ]

                component "core/Voltage Measurement" VDC {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7704, 7768
                    rotation = right
                    size = 64, 32
                ]

                component Subsystem "Converter meas" {
                    layout = dynamic
                    component pas_resistor R4 {
                        resistance = "1e3"
                    }
                    [
                        position = 7536, 8272
                        rotation = right
                        hide_name = True
                    ]

                    component pas_resistor R5 {
                        resistance = "1e3"
                    }
                    [
                        position = 7576, 8272
                        rotation = right
                        hide_name = True
                    ]

                    component pas_resistor R6 {
                        resistance = "1e3"
                    }
                    [
                        position = 7616, 8272
                        rotation = right
                        hide_name = True
                    ]

                    component "core/Voltage Measurement" Va {
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 7712, 8200
                        rotation = right
                        size = 64, 32
                    ]

                    component "core/Voltage Measurement" Vb {
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 7760, 8288
                        rotation = right
                        size = 64, 32
                    ]

                    component "core/Voltage Measurement" Vc {
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 7800, 8352
                        rotation = right
                        size = 64, 32
                    ]

                    port A {
                        label = "A"
                        position = left:1
                        kind = pe
                    }
                    [
                        position = 7488, 7952
                    ]

                    port B {
                        label = "B"
                        position = left:2
                        kind = pe
                    }
                    [
                        position = 7488, 8048
                    ]

                    port C {
                        label = "C"
                        position = left:3
                        kind = pe
                    }
                    [
                        position = 7488, 8144
                    ]

                    port VA {
                        position = bottom:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7864, 8200
                        rotation = down
                        scale = -1, 1
                    ]

                    port a {
                        label = "a"
                        position = right:1
                        kind = pe
                    }
                    [
                        position = 7992, 7952
                        rotation = down
                    ]

                    port VB {
                        position = bottom:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7864, 8280
                        rotation = down
                        scale = -1, 1
                    ]

                    port b {
                        label = "b"
                        position = right:2
                        kind = pe
                    }
                    [
                        position = 7992, 8048
                        rotation = down
                    ]

                    port VC {
                        position = bottom:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7864, 8352
                        rotation = down
                        scale = -1, 1
                    ]

                    port c {
                        label = "c"
                        position = right:3
                        kind = pe
                    }
                    [
                        position = 7992, 8144
                        rotation = down
                    ]

                    junction Junction189 pe
                    [
                        position = 7576, 8400
                    ]

                    junction Junction198 pe
                    [
                        position = 7536, 7952
                    ]

                    junction Junction199 pe
                    [
                        position = 7576, 8048
                    ]

                    junction Junction200 pe
                    [
                        position = 7616, 8144
                    ]

                    junction Junction201 pe
                    [
                        position = 7712, 7952
                    ]

                    junction Junction202 pe
                    [
                        position = 7760, 8048
                    ]

                    junction Junction203 pe
                    [
                        position = 7800, 8144
                    ]

                    junction Junction204 pe
                    [
                        position = 7616, 8400
                    ]

                    junction Junction205 pe
                    [
                        position = 7760, 8400
                    ]

                    junction Junction206 pe
                    [
                        position = 7712, 8400
                    ]

                    connect A Junction198 as Connection2681
                    connect B Junction199 as Connection2684
                    connect C Junction200 as Connection2687
                    connect Junction189 R4.n_node as Connection2647
                    connect Junction200 R6.p_node as Connection2686
                    connect R4.p_node Junction198 as Connection2679
                    connect R5.n_node Junction189 as Connection2632
                    connect R5.p_node Junction199 as Connection2682
                    connect Junction198 Junction201 as Connection2712
                    [
                        breakpoints = 7536, 7952; 7680, 7952
                    ]
                    connect Junction201 a as Connection2713
                    connect Va.p_node Junction201 as Connection2714
                    connect Junction199 Junction202 as Connection2715
                    [
                        breakpoints = 7576, 8048; 7728, 8048
                    ]
                    connect Junction202 b as Connection2716
                    connect Vb.p_node Junction202 as Connection2717
                    connect Junction200 Junction203 as Connection2718
                    [
                        breakpoints = 7616, 8144; 7776, 8144
                    ]
                    connect Junction203 c as Connection2719
                    connect Vc.p_node Junction203 as Connection2720
                    connect Va.out VA as Connection2721
                    connect Vb.out VB as Connection2722
                    connect Vc.out VC as Connection2723
                    connect Junction189 Junction204 as Connection2724
                    [
                        breakpoints = 7576, 8400
                    ]
                    connect Junction204 R6.n_node as Connection2725
                    [
                        breakpoints = 7616, 8400
                    ]
                    connect Vc.n_node Junction205 as Connection2727
                    connect Vb.n_node Junction205 as Connection2729
                    connect Junction205 Junction206 as Connection2730
                    connect Junction206 Junction204 as Connection2731
                    connect Va.n_node Junction206 as Connection2732
                }
                [
                    position = 8904, 7768
                    rotation = down
                    scale = -1, -1
                    size = 96, 240
                ]

                component Subsystem Output {
                    layout = dynamic
                    component gen_bus_join "Bus Join1" {
                        inputs = "14"
                    }
                    [
                        position = 8192, 8192
                        rotation = left
                        hide_name = True
                    ]

                    port Inv_On {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7936, 8336
                    ]

                    port Ic {
                        position = left:9
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7872, 8560
                    ]

                    port Va {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7872, 8376
                    ]

                    port Vb {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7936, 8400
                    ]

                    port Vc {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7872, 8440
                    ]

                    port Ia {
                        position = left:7
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7872, 8496
                    ]

                    port Out1 {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8192, 8120
                        rotation = left
                    ]

                    port Ib {
                        position = left:8
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7936, 8520
                    ]

                    port Connected {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7872, 8312
                    ]

                    tag From30 {
                        value = "P"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7944, 8608
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From29 {
                        value = "Vt"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7944, 8472
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From32 {
                        value = "pf"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7944, 8680
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From34 {
                        value = "f"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7944, 8584
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From33 {
                        value = "S"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7944, 8656
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From31 {
                        value = "Q"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7944, 8632
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto1 {
                        value = "Bat_Power"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8384, 8336
                    ]

                    junction Junction1 sp
                    [
                        position = 8248, 8336
                    ]

                    connect From34 "Bus Join1.in9" as Connection15
                    connect Ia "Bus Join1.in6" as Connection26
                    connect Ic "Bus Join1.in8" as Connection28
                    connect "Bus Join1.in5" From29 as Connection25
                    connect Va "Bus Join1.in2" as Connection22
                    connect Vc "Bus Join1.in4" as Connection24
                    connect "Bus Join1.in11" From31 as Connection17
                    connect "Bus Join1.in13" From32 as Connection19
                    connect "Bus Join1.in7" Ib as Connection27
                    connect "Bus Join1.in1" Inv_On as Connection21
                    connect "Bus Join1.out" Out1 as Connection13
                    connect "Bus Join1.in3" Vb as Connection23
                    connect Connected "Bus Join1.in" as Connection20
                    connect From33 "Bus Join1.in12" as Connection18
                    connect "Bus Join1.in10" Junction1 as Connection29
                    connect Junction1 From30 as Connection30
                    connect Goto1 Junction1 as Connection31
                }
                [
                    position = 8976, 7208
                    rotation = left
                    size = 72, 144
                ]

                component "core/Triple Pole Single Throw Contactor" S1 {
                    ctrl_src = "Model"
                }
                [
                    position = 9216, 7768
                    size = 64, 256
                ]

                component Subsystem "Grid meas" {
                    layout = dynamic
                    component pas_resistor R5 {
                        resistance = "1e6"
                    }
                    [
                        position = 7576, 8272
                        rotation = right
                        hide_name = True
                    ]

                    component pas_resistor R4 {
                        resistance = "1e6"
                    }
                    [
                        position = 7536, 8272
                        rotation = right
                        hide_name = True
                    ]

                    component "core/Voltage Measurement" Va {
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 7680, 8208
                        rotation = right
                        size = 64, 32
                    ]

                    component "core/Voltage Measurement" Vb {
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 7728, 8280
                        rotation = right
                        size = 64, 32
                    ]

                    component "core/Voltage Measurement" Vc {
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 7776, 8352
                        rotation = right
                        size = 64, 32
                    ]

                    component pas_resistor R6 {
                        resistance = "1e6"
                    }
                    [
                        position = 7616, 8272
                        rotation = right
                        hide_name = True
                    ]

                    port VA {
                        position = bottom:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7864, 8208
                        rotation = down
                        scale = -1, 1
                    ]

                    port a {
                        label = "a"
                        position = right:1
                        kind = pe
                    }
                    [
                        position = 7864, 7952
                        rotation = down
                    ]

                    port VB {
                        position = bottom:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7864, 8280
                        rotation = down
                        scale = -1, 1
                    ]

                    port b {
                        label = "b"
                        position = right:2
                        kind = pe
                    }
                    [
                        position = 7864, 8048
                        rotation = down
                    ]

                    port VC {
                        position = bottom:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7864, 8352
                        rotation = down
                        scale = -1, 1
                    ]

                    port c {
                        label = "c"
                        position = right:3
                        kind = pe
                    }
                    [
                        position = 7864, 8144
                        rotation = down
                    ]

                    port A {
                        label = "A"
                        position = left:1
                        kind = pe
                    }
                    [
                        position = 7488, 7952
                    ]

                    port B {
                        label = "B"
                        position = left:2
                        kind = pe
                    }
                    [
                        position = 7488, 8048
                    ]

                    port C {
                        label = "C"
                        position = left:3
                        kind = pe
                    }
                    [
                        position = 7488, 8144
                    ]

                    junction Junction198 pe
                    [
                        position = 7536, 7952
                    ]

                    junction Junction199 pe
                    [
                        position = 7576, 8048
                    ]

                    junction Junction200 pe
                    [
                        position = 7616, 8144
                    ]

                    junction Junction201 pe
                    [
                        position = 7680, 7952
                    ]

                    junction Junction202 pe
                    [
                        position = 7728, 8048
                    ]

                    junction Junction203 pe
                    [
                        position = 7776, 8144
                    ]

                    junction Junction183 pe
                    [
                        position = 7728, 8400
                    ]

                    junction Junction189 pe
                    [
                        position = 7576, 8400
                    ]

                    junction Junction190 pe
                    [
                        position = 7616, 8400
                    ]

                    junction Junction191 pe
                    [
                        position = 7680, 8400
                    ]

                    connect Junction199 Junction202 as Connection2700
                    connect a Junction201 as Connection2699
                    connect Junction200 R6.p_node as Connection2686
                    connect b Junction202 as Connection2702
                    connect Junction201 Junction198 as Connection2698
                    connect c Junction203 as Connection2705
                    connect Junction202 Vb.p_node as Connection2701
                    connect Junction203 Junction200 as Connection2704
                    connect R4.p_node Junction198 as Connection2679
                    connect R5.n_node Junction189 as Connection2632
                    connect R5.p_node Junction199 as Connection2682
                    connect R6.n_node Junction190 as Connection2650
                    connect VA Va.out as Connection2673
                    connect A Junction198 as Connection2681
                    connect B Junction199 as Connection2684
                    connect C Junction200 as Connection2687
                    connect VB Vb.out as Connection2674
                    connect Junction183 Junction191 as Connection2652
                    connect VC Vc.out as Connection2675
                    connect Junction183 Vc.n_node as Connection2649
                    connect Junction189 R4.n_node as Connection2647
                    connect Va.p_node Junction201 as Connection2697
                    connect Junction190 Junction189 as Connection2651
                    connect Vb.n_node Junction183 as Connection2606
                    connect Junction190 Junction191 as Connection2654
                    connect Vc.p_node Junction203 as Connection2703
                    connect Junction191 Va.n_node as Connection2653
                }
                [
                    position = 9352, 7768
                    rotation = down
                    scale = -1, -1
                    size = 96, 240
                ]

                component "core/Three Phase Inverter" "Three Phase Inverter1" {
                    carrier_freq = "fsw"
                    ctrl_src = "Internal modulator"
                    d_time = "0.5e-6"
                }
                [
                    position = 7968, 7768
                    size = 127, 256
                ]

                component Subsystem Control_Inputs {
                    layout = dynamic
                    component gen_limiter Limit1 {
                        lower_limit = "0"
                        upper_limit = "1"
                    }
                    [
                        position = 8264, 8176
                        hide_name = True
                    ]

                    component gen_round Round1 {
                        round_fn = "round"
                    }
                    [
                        position = 8304, 8200
                        hide_name = True
                    ]

                    component gen_limiter Limit2 {
                        lower_limit = "0"
                        upper_limit = "1"
                    }
                    [
                        position = 8216, 8200
                        hide_name = True
                    ]

                    component gen_round Round2 {
                        round_fn = "round"
                    }
                    [
                        position = 8344, 8176
                        hide_name = True
                    ]

                    component gen_bus_split "Bus Split2" {
                        outputs = "6"
                    }
                    [
                        position = 8144, 8120
                        rotation = right
                        hide_name = True
                    ]

                    port Inputs {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8144, 8048
                        rotation = right
                    ]

                    tag Goto21 {
                        value = "Pref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8424, 8272
                        hide_name = True
                        size = 58, 20
                    ]

                    tag Goto91 {
                        value = "On"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8424, 8176
                        hide_name = True
                        size = 58, 20
                    ]

                    tag Goto89 {
                        value = "Vref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8424, 8248
                        hide_name = True
                        size = 58, 20
                    ]

                    tag Goto22 {
                        value = "Qref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8424, 8296
                        hide_name = True
                        size = 58, 20
                    ]

                    tag Goto92 {
                        value = "mode"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8424, 8200
                        hide_name = True
                        size = 58, 20
                    ]

                    tag Goto90 {
                        value = "f_ref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8424, 8224
                        hide_name = True
                        size = 58, 20
                    ]

                    connect Goto21 "Bus Split2.out4" as Connection6
                    connect Inputs "Bus Split2.in" as Connection1
                    connect Limit1.out Round2.in as Connection13
                    connect Limit2.in "Bus Split2.out1" as Connection15
                    connect Round1.out Goto92 as Connection8
                    connect Round1.in Limit2.out as Connection14
                    connect Round2.out Goto91 as Connection11
                    connect "Bus Split2.out5" Goto22 as Connection7
                    connect "Bus Split2.out3" Goto89 as Connection5
                    connect "Bus Split2.out2" Goto90 as Connection4
                    connect "Bus Split2.out" Limit1.in as Connection12
                }
                [
                    position = 7768, 7200
                    size = 48, 48
                ]

                component "core/Current Measurement" Ia_out {
                    addr = "14"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 9056, 7672
                    size = 64, 32
                ]

                component "core/Current Measurement" Ib_out {
                    addr = "15"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 9056, 7768
                    size = 64, 32
                ]

                component "core/Current Measurement" Ic_out {
                    addr = "16"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 9056, 7864
                    size = 64, 32
                ]

                component Subsystem Control {
                    layout = dynamic
                    component Subsystem Change_CtrlMode {
                        layout = dynamic
                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8192, 8232
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8192, 8096
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch3" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8192, 8368
                            hide_name = True
                        ]

                        port mq_Vmode {
                            position = left:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8056, 8208
                        ]

                        port wt_Vmode {
                            position = left:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8056, 8336
                        ]

                        port Vmode {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8192, 7968
                            rotation = right
                        ]

                        port md {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8256, 8096
                        ]

                        port mq {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8256, 8232
                        ]

                        port md_Imode {
                            position = left:10
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8000, 8112
                        ]

                        port md_Vmode {
                            position = left:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8056, 8056
                        ]

                        port wt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8256, 8368
                        ]

                        port mq_Imode {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8000, 8248
                        ]

                        port wt_Imode {
                            position = left:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8000, 8384
                        ]

                        tag From20 {
                            value = "Vmode"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8128, 8168
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto17 {
                            value = "Vmode"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8272, 8032
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From21 {
                            value = "Vmode"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8128, 8304
                            hide_name = True
                            size = 60, 20
                        ]

                        junction Junction1 sp
                        [
                            position = 8192, 8032
                        ]

                        connect "Signal switch3.out" wt as Connection4
                        connect Vmode Junction1 as Connection29
                        connect md_Imode "Signal switch1.in1" as Connection19
                        connect md_Vmode "Signal switch1.in" as Connection18
                        connect mq_Imode "Signal switch2.in1" as Connection21
                        connect mq_Vmode "Signal switch2.in" as Connection20
                        connect wt_Imode "Signal switch3.in1" as Connection23
                        connect wt_Vmode "Signal switch3.in" as Connection22
                        connect From20 "Signal switch2.in2" as Connection16
                        connect From21 "Signal switch3.in2" as Connection17
                        connect Junction1 Goto17 as Connection28
                        connect "Signal switch1.in2" Junction1 as Connection27
                        connect "Signal switch1.out" md as Connection2
                        connect "Signal switch2.out" mq as Connection7
                    }
                    [
                        position = 8632, 8552
                        size = 104, 208
                    ]

                    component Subsystem ABCtoDQ {
                        layout = dynamic
                        component "core/abc to dq" "abc to dq1" {
                        }
                        [
                            position = 8256, 8176
                            size = 48, 80
                        ]

                        component gen_terminator Termination1 {
                        }
                        [
                            position = 8344, 8248
                            rotation = right
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                        }
                        [
                            position = 8336, 8120
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain2 {
                            gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                        }
                        [
                            position = 8384, 8120
                            rotation = left
                            hide_name = True
                        ]

                        port C {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8136, 8288
                            rotation = left
                        ]

                        port d {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8336, 8016
                            rotation = left
                        ]

                        port B {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8136, 8056
                            rotation = right
                        ]

                        port wt {
                            position = left:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8192, 8288
                            rotation = left
                        ]

                        port q {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8384, 8016
                            rotation = left
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8200, 8056
                            rotation = right
                        ]

                        connect "abc to dq1.q_axis" Gain2.in as Connection2342
                        connect "abc to dq1.zero_axis" Termination1.in as Connection2343
                        connect "abc to dq1.vc" C as Connection2339
                        connect q Gain2.out as Connection2344
                        [
                            position = 0, 0
                        ]
                        connect wt "abc to dq1.wt" as Connection2340
                        connect "abc to dq1.va" A as Connection2337
                        connect "abc to dq1.d_axis" Gain1.in as Connection2341
                        connect d Gain1.out as Connection2345
                        [
                            position = 0, 0
                        ]
                        connect B "abc to dq1.vb" as Connection2338
                    }
                    [
                        position = 7624, 8904
                        size = 72, 192
                    ]

                    component Subsystem PLL_pu {
                        layout = dynamic
                        component gen_gain Gain7 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8400, 8248
                            hide_name = True
                        ]

                        component gen_gain Gain6 {
                            gain = "1.0/fn"
                        }
                        [
                            position = 8400, 8120
                            hide_name = True
                        ]

                        component gen_gain Gain4 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8208, 8016
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain5 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8240, 8064
                            rotation = left
                            hide_name = True
                        ]

                        component "core/Three phase PLL" PLL {
                            enable_pk = "True"
                            enable_sin = "False"
                            enable_zero = "False"
                            initial_pid_output = "2*np.pi*fn"
                            low_lim = "0"
                            rate_high = "5*fn"
                            rate_low = "-5*fn"
                            up_lim = "1.4*2*np.pi*fn"
                        }
                        [
                            position = 8144, 8144
                            size = 64, 128
                        ]

                        port C {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8240
                        ]

                        port d {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8304, 7976
                        ]

                        port Vt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8464, 8248
                        ]

                        port q {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8304, 8024
                        ]

                        port f {
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8464, 8120
                        ]

                        port wt {
                            position = right:5
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8304, 8160
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8048
                        ]

                        port B {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8144
                        ]

                        tag Goto2 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8328, 8096
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto1 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8328, 8264
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction1 sp
                        [
                            position = 8264, 8248
                        ]

                        junction Junction2 sp
                        [
                            position = 8280, 8120
                        ]

                        connect Junction1 PLL.peak as Connection2327
                        connect Gain7.in Junction1 as Connection2328
                        connect Goto2 Junction2 as Connection2329
                        connect Junction2 Gain6.in as Connection2330
                        connect PLL.freq Junction2 as Connection2331
                        connect Gain4.out d as Connection2283
                        connect wt PLL.theta as Connection2332
                        connect Vt Gain7.out as Connection2309
                        connect f Gain6.out as Connection2286
                        connect q Gain5.out as Connection2284
                        connect PLL.vb B as Connection2313
                        connect PLL.va A as Connection2314
                        connect PLL.vc C as Connection2315
                        connect Gain4.in PLL.d_axis as Connection2316
                        connect Gain5.in PLL.q_axis as Connection2317
                        connect Goto1 Junction1 as Connection2326
                    }
                    [
                        position = 7624, 8632
                        size = 72, 168
                    ]

                    component gen_probe Q {
                    }
                    [
                        position = 8848, 8840
                        rotation = down
                        scale = -1, 1
                    ]

                    component Subsystem duty_cycle {
                        layout = dynamic
                        component gen_limiter Limit3 {
                            lower_limit = "-1.1546"
                            upper_limit = "1.1546"
                        }
                        [
                            position = 7512, 7992
                            hide_name = True
                        ]

                        component "core/dq to abc" "dq to abc1" {
                            execution_rate = "inherit"
                        }
                        [
                            position = 7608, 8096
                            rotation = right
                            size = 48, 80
                        ]

                        component Subsystem ZSM {
                            layout = dynamic
                            component gen_product Product1 {
                            }
                            [
                                position = 7848, 8256
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8264
                                hide_name = True
                            ]

                            component gen_minmax "Min Max1" {
                                inputs = "3"
                            }
                            [
                                position = 7584, 8160
                                hide_name = True
                            ]

                            component src_constant Constant2 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7656, 8288
                                hide_name = True
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "0"
                                upper_limit = "1"
                            }
                            [
                                position = 7408, 8080
                                hide_name = True
                            ]

                            component src_constant Constant1 {
                                execution_rate = "inherit"
                                value = "k"
                            }
                            [
                                position = 7336, 8080
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8096
                                hide_name = True
                            ]

                            component src_constant Constant4 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7816, 8072
                                hide_name = True
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 7848, 8152
                                hide_name = True
                            ]

                            component gen_sum Sum8 {
                                signs = "-+"
                            }
                            [
                                position = 7896, 8064
                                hide_name = True
                            ]

                            component gen_minmax "Min Max2" {
                                inputs = "3"
                                operation = "max"
                            }
                            [
                                position = 7584, 8256
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "--+"
                            }
                            [
                                position = 7984, 8152
                                hide_name = True
                            ]

                            component gen_probe Z0 {
                            }
                            [
                                position = 8048, 8088
                                rotation = left
                            ]

                            component src_constant Constant3 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7672, 8128
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8264
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8120
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8176
                                hide_name = True
                            ]

                            port Dz_A {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_B {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8176
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_C {
                                position = left:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8264
                                rotation = down
                                scale = -1, 1
                            ]

                            port Da {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port Db {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8208
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dc {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8272
                                rotation = down
                                scale = -1, 1
                            ]

                            tag From5 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From8 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8288
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From7 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8256
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From2 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7736, 8208
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto2 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From6 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8200
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto4 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8304
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From3 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8120
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From4 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8088
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7488, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto3 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8240
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7648, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto5 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 8120, 8152
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From9 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7792, 8024
                                hide_name = True
                                size = 0, 0
                            ]

                            junction Junction260 sp
                            [
                                position = 8048, 8152
                            ]

                            junction Junction254 sp
                            [
                                position = 7480, 8144
                            ]

                            junction Junction255 sp
                            [
                                position = 7496, 8208
                            ]

                            junction Junction256 sp
                            [
                                position = 7512, 8272
                            ]

                            junction Junction257 sp
                            [
                                position = 7344, 8144
                            ]

                            junction Junction258 sp
                            [
                                position = 7344, 8208
                            ]

                            junction Junction259 sp
                            [
                                position = 7344, 8272
                            ]

                            connect Junction259 Junction256 as Connection1481
                            connect Junction260 Sum3.out as Connection1485
                            connect Constant1.out Limit1.in as Connection1425
                            connect "Min Max1.in" Junction254 as Connection1465
                            connect Constant2.out Sum1.in1 as Connection1427
                            connect "Min Max2.in1" Junction255 as Connection1468
                            connect Constant3.out Sum2.in1 as Connection1434
                            connect "Min Max2.in2" Junction256 as Connection1471
                            connect Da Junction257 as Connection1474
                            connect Product1.in1 Sum1.out as Connection1428
                            connect Product1.out Sum3.in2 as Connection1451
                            connect Db Junction258 as Connection1477
                            connect Product2.in1 "Min Max1.out" as Connection1430
                            connect Dc Junction259 as Connection1480
                            connect Product2.out Sum3.in1 as Connection1450
                            connect Sum1.in "Min Max2.out" as Connection1426
                            connect From1 Sum2.in as Connection1440
                            connect Sum2.out Product2.in as Connection1435
                            connect From2 Product1.in as Connection1441
                            connect Sum5.out Dz_A as Connection1447
                            connect From3 Sum5.in1 as Connection1446
                            connect Sum6.out Dz_B as Connection1490
                            connect From4 Sum5.in as Connection1487
                            connect Sum7.out Dz_C as Connection1491
                            connect Z0.in Junction260 as Connection1484
                            connect From5 Sum6.in as Connection1489
                            connect From9 Sum8.in as Connection1496
                            connect From6 Sum6.in1 as Connection1488
                            connect Constant4.out Sum8.in1 as Connection1495
                            connect From7 Sum7.in as Connection1493
                            connect Sum8.out Sum3.in as Connection1497
                            connect From8 Sum7.in1 as Connection1492
                            connect Goto1 Limit1.out as Connection1439
                            connect Goto2 Junction257 as Connection1476
                            connect Goto3 Junction258 as Connection1479
                            connect Goto4 Junction259 as Connection1482
                            connect Goto5 Junction260 as Connection1486
                            connect Junction254 "Min Max2.in" as Connection1466
                            connect Junction255 "Min Max1.in1" as Connection1469
                            connect Junction256 "Min Max1.in2" as Connection1472
                            connect Junction257 Junction254 as Connection1475
                            connect Junction258 Junction255 as Connection1478

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">This block implements a zero sequence modulator (ZSM).</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">To change the ZSM type, user can adjust the coefficient k. This coefficient is a real number between 0 and 1.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 0, the modulation type is bottom clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1/2, the modulation type is midpoint clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1, the modulation type is top clamp.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                                k {
                                    label = "Modulation type coefficent k"
                                    widget = edit
                                    type = generic
                                    default_value = "0.5"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 7776, 8216
                            scale = -1, 1
                            size = 88, 184
                        ]

                        component gen_limiter Limit2 {
                            lower_limit = "mod_lowLim"
                            upper_limit = "mod_upLim"
                        }
                        [
                            position = 7512, 7944
                            hide_name = True
                        ]

                        component src_constant o_ref {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 7560, 8016
                            hide_name = True
                        ]

                        port m_a {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7936, 8144
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_b {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7936, 8216
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_c {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7936, 8288
                            rotation = down
                            scale = -1, 1
                        ]

                        port wt {
                            position = right:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7448, 8040
                        ]

                        port mq {
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7448, 7992
                        ]

                        port md {
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7448, 7944
                        ]

                        connect o_ref.out "dq to abc1.zero_input" as Connection2332
                        connect "dq to abc1.wt" wt as Connection2333
                        connect md Limit2.in as Connection31
                        connect mq Limit3.in as Connection33
                        connect "dq to abc1.d_input" Limit2.out as Connection2343
                        [
                            breakpoints = 7560, 7944
                        ]
                        connect "dq to abc1.q_input" Limit3.out as Connection2344
                        [
                            breakpoints = 7600, 7992
                        ]
                        connect "dq to abc1.phase_a" ZSM.Da as Connection2345
                        [
                            breakpoints = 7680, 8144
                        ]
                        connect "dq to abc1.phase_b" ZSM.Db as Connection2346
                        [
                            breakpoints = 7680, 8216
                        ]
                        connect "dq to abc1.phase_c" ZSM.Dc as Connection2347
                        [
                            breakpoints = 7680, 8288
                        ]
                        connect ZSM.Dz_A m_a as Connection2348
                        [
                            breakpoints = 7856, 8144
                        ]
                        connect m_b ZSM.Dz_B as Connection2349
                        [
                            breakpoints = 7856, 8216
                        ]
                        connect m_c ZSM.Dz_C as Connection2350
                        [
                            breakpoints = 7856, 8288
                        ]
                    }
                    [
                        position = 8776, 8552
                        scale = -1, 1
                        size = 80, 200
                    ]

                    component Subsystem Imode_control {
                        layout = dynamic
                        component Subsystem "Dq current controller" {
                            layout = dynamic
                            component gen_gain Gain7 {
                                gain = "L*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 7056, 8344
                                hide_name = True
                            ]

                            component gen_sum Sum9 {
                            }
                            [
                                position = 7440, 8096
                                hide_name = True
                                scale = 1, -1
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 7072, 8104
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 7128, 8352
                                hide_name = True
                            ]

                            component gen_product Product5 {
                                signs = "*/"
                            }
                            [
                                position = 7568, 8088
                                hide_name = True
                                scale = 1, -1
                            ]

                            component gen_sum Sum10 {
                                signs = "+-"
                            }
                            [
                                position = 7232, 7976
                                hide_name = True
                            ]

                            component Subsystem PI_d {
                                layout = dynamic
                                component gen_integrator Integrator1 {
                                    init_value = "out0"
                                    limit_lower = "-1"
                                    limit_upper = "1"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8232
                                ]

                                component gen_gain Ki {
                                    gain = "Ki"
                                }
                                [
                                    position = 7984, 8216
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8088, 8224
                                    hide_name = True
                                ]

                                component gen_gain Kb {
                                    gain = "1.0"
                                }
                                [
                                    position = 8216, 8312
                                    scale = -1, 1
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8320, 8312
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_gain Kp {
                                    gain = "Kp"
                                }
                                [
                                    position = 8136, 8128
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8320, 8224
                                    hide_name = True
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "lowLim"
                                    upper_limit = "upLim"
                                }
                                [
                                    position = 8408, 8224
                                    hide_name = True
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8472, 8224
                                ]

                                port reset {
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8136, 8256
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7888, 8168
                                ]

                                junction Junction2 sp
                                [
                                    position = 8368, 8224
                                ]

                                junction Junction3 sp
                                [
                                    position = 8440, 8224
                                ]

                                junction Junction4 sp
                                [
                                    position = 7920, 8168
                                ]

                                connect Ki.in Junction4 as Connection66
                                connect Ki.out Sum7.in as Connection63
                                connect Kp.in Junction4 as Connection68
                                connect Kp.out Sum5.in as Connection65
                                connect Limit1.out Junction3 as Connection47
                                connect Sum5.in1 Integrator1.out as Connection5
                                connect Sum5.out Junction2 as Connection44
                                connect Sum6.in Junction2 as Connection46
                                connect Sum6.in1 Junction3 as Connection49
                                connect Junction2 Limit1.in as Connection45
                                connect Sum7.out Integrator1.in as Connection52
                                connect Junction3 Out as Connection48
                                connect Sum7.in1 Kb.out as Connection53
                                connect Junction4 In as Connection67
                                connect reset Integrator1.reset as Connection62
                                connect Kb.in Sum6.out as Connection50

                                Ki = "ImodeId_Ki"
                                Kp = "ImodeId_Kp"
                                lowLim = "-1e5"
                                out0 = "0.0"
                                upLim = "1e5"

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller</span></p></body></html>"

                                    Kp {
                                        label = "Kp"
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        group = "General"
                                    }

                                    Ki {
                                        label = "Ki"
                                        widget = edit
                                        type = generic
                                        default_value = "5.0"
                                        group = "General"
                                    }

                                    upLim {
                                        label = "Upper limit"
                                        widget = edit
                                        type = generic
                                        default_value = "100.0"
                                        group = "General"
                                    }

                                    lowLim {
                                        label = "Lower limit"
                                        widget = edit
                                        type = generic
                                        default_value = "0.0"
                                        group = "General"
                                    }

                                    out0 {
                                        label = "Integrator initial output"
                                        widget = edit
                                        type = generic
                                        default_value = "fnom"
                                        group = "General"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                        
                                    ENDCODE
                                }
                            }
                            [
                                position = 7184, 8104
                                size = 64, 48
                            ]

                            component gen_sum Sum12 {
                            }
                            [
                                position = 7440, 8224
                                hide_name = True
                                scale = 1, -1
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 7072, 8216
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 6904, 7744
                                rotation = right
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "0.5"
                            }
                            [
                                position = 6904, 7800
                                rotation = right
                                hide_name = True
                            ]

                            component gen_gain Gain11 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7656, 8232
                                hide_name = True
                            ]

                            component gen_gain Gain4 {
                                gain = "L*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 7056, 7992
                                hide_name = True
                            ]

                            component gen_sum Sum13 {
                            }
                            [
                                position = 7232, 8344
                                hide_name = True
                                scale = 1, -1
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 7128, 7984
                                hide_name = True
                            ]

                            component gen_product Product7 {
                                signs = "*/"
                            }
                            [
                                position = 7568, 8232
                                hide_name = True
                            ]

                            component Subsystem damper {
                                layout = dynamic
                                component gen_gain Iq_damp {
                                    gain = "Imode_damp"
                                }
                                [
                                    position = 8120, 8224
                                    rotation = down
                                    scale = -1, -1
                                ]

                                component gen_sum Sum8 {
                                }
                                [
                                    position = 8240, 8088
                                    hide_name = True
                                ]

                                component gen_gain Id_damp {
                                    gain = "Imode_damp"
                                }
                                [
                                    position = 8120, 8144
                                ]

                                component gen_sum Sum9 {
                                }
                                [
                                    position = 8240, 8280
                                    hide_name = True
                                ]

                                port "md out" {
                                    position = left:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8328, 8088
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port "mq in" {
                                    position = right:13
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8080, 8288
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port iq {
                                    position = right:12
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8000, 8224
                                ]

                                port "md in" {
                                    position = right:10
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8072, 8080
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port "mq out" {
                                    position = left:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8328, 8280
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port id {
                                    position = right:11
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8000, 8144
                                ]

                                connect Iq_damp.out Sum9.in as Connection112
                                connect "md out" Sum8.out as Connection107
                                connect Id_damp.in id as Connection109
                                connect Iq_damp.in iq as Connection111
                                connect Id_damp.out Sum8.in1 as Connection110
                                connect "mq in" Sum9.in1 as Connection104
                                connect "md in" Sum8.in as Connection103
                                connect "mq out" Sum9.out as Connection108
                            }
                            [
                                position = 7816, 8160
                                scale = -1, 1
                                size = 80, 184
                            ]

                            component gen_gain Gain10 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7656, 8088
                                hide_name = True
                            ]

                            component Subsystem PI_q {
                                layout = dynamic
                                component gen_limiter Limit1 {
                                    lower_limit = "lowLim"
                                    upper_limit = "upLim"
                                }
                                [
                                    position = 8408, 8224
                                    hide_name = True
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8320, 8224
                                    hide_name = True
                                ]

                                component gen_gain Kp {
                                    gain = "Kp"
                                }
                                [
                                    position = 8128, 8136
                                ]

                                component gen_integrator Integrator1 {
                                    init_value = "out0"
                                    limit_lower = "-1"
                                    limit_upper = "1"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8232
                                ]

                                component gen_gain Kb {
                                    gain = "1.0"
                                }
                                [
                                    position = 8216, 8312
                                    scale = -1, 1
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8320, 8312
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_gain Ki {
                                    gain = "Ki"
                                }
                                [
                                    position = 7976, 8216
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8088, 8224
                                    hide_name = True
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7888, 8168
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8472, 8224
                                ]

                                port reset {
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8136, 8256
                                ]

                                junction Junction2 sp
                                [
                                    position = 8368, 8224
                                ]

                                junction Junction3 sp
                                [
                                    position = 8440, 8224
                                ]

                                junction Junction4 sp
                                [
                                    position = 7920, 8168
                                ]

                                connect reset Integrator1.reset as Connection62
                                connect Junction4 In as Connection66
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction4 as Connection65
                                connect Ki.out Sum7.in as Connection68
                                connect Kp.in Junction4 as Connection67
                                connect Kp.out Sum5.in as Connection63
                                connect Limit1.out Junction3 as Connection47
                                connect Sum5.in1 Integrator1.out as Connection5
                                connect Sum5.out Junction2 as Connection44
                                connect Sum6.in Junction2 as Connection46
                                connect Sum6.in1 Junction3 as Connection49
                                connect Junction2 Limit1.in as Connection45
                                connect Sum7.out Integrator1.in as Connection52
                                connect Junction3 Out as Connection48
                                connect Sum7.in1 Kb.out as Connection53

                                Ki = "ImodeIq_Ki"
                                Kp = "ImodeIq_Kp"
                                lowLim = "-1e5"
                                out0 = "0.0"
                                upLim = "1e5"

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller</span></p></body></html>"

                                    Kp {
                                        label = "Kp"
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        group = "General"
                                    }

                                    Ki {
                                        label = "Ki"
                                        widget = edit
                                        type = generic
                                        default_value = "5.0"
                                        group = "General"
                                    }

                                    upLim {
                                        label = "Upper limit"
                                        widget = edit
                                        type = generic
                                        default_value = "100.0"
                                        group = "General"
                                    }

                                    lowLim {
                                        label = "Lower limit"
                                        widget = edit
                                        type = generic
                                        default_value = "0.0"
                                        group = "General"
                                    }

                                    out0 {
                                        label = "Integrator initial output"
                                        widget = edit
                                        type = generic
                                        default_value = "fnom"
                                        group = "General"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                        
                                    ENDCODE
                                }
                            }
                            [
                                position = 7328, 8216
                                size = 64, 48
                            ]

                            port m_q {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7912, 8232
                                rotation = down
                                scale = -1, 1
                            ]

                            port f {
                                position = right:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6792, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7176, 7912
                                rotation = right
                                scale = -1, 1
                            ]

                            port Vq {
                                position = top:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7176, 8288
                                rotation = right
                                scale = -1, 1
                            ]

                            port Vdc {
                                position = top:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6904, 7680
                                rotation = right
                                scale = -1, 1
                            ]

                            port reset {
                                position = top:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6984, 7680
                                rotation = right
                                scale = -1, 1
                            ]

                            port Id {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6792, 8112
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6984, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port Iq_ref {
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6984, 8208
                                rotation = down
                                scale = -1, 1
                            ]

                            port Iq {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6792, 8224
                                rotation = down
                                scale = -1, 1
                            ]

                            port m_d {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7912, 8088
                                rotation = down
                                scale = -1, 1
                            ]

                            tag Goto17 {
                                value = "id"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6904, 8088
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From131 {
                                value = "id"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6968, 8344
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From142 {
                                value = "half_Vdc"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7472, 8280
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From137 {
                                value = "half_Vdc"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7480, 8024
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From135 {
                                value = "f"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6968, 8384
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto19 {
                                value = "f"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6880, 8288
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From134 {
                                value = "iq"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7704, 8184
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From141 {
                                value = "f"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6968, 7952
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From132 {
                                value = "iq"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6968, 7992
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From139 {
                                value = "reset"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7112, 8048
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto21 {
                                value = "reset"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6984, 7752
                                rotation = right
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From133 {
                                value = "id"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7704, 8136
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto20 {
                                value = "half_Vdc"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6904, 7872
                                rotation = right
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From140 {
                                value = "reset"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7256, 8176
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto18 {
                                value = "iq"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6904, 8200
                                hide_name = True
                                size = 60, 20
                            ]

                            junction Junction173 sp
                            [
                                position = 6856, 8112
                            ]

                            junction Junction174 sp
                            [
                                position = 6856, 8224
                            ]

                            connect From142 Product7.in1 as Connection1870
                            connect Gain10.out "damper.md in" as Connection1860
                            connect Gain11.out "damper.mq in" as Connection1862
                            connect Goto17 Junction173 as Connection1807
                            connect Goto18 Junction174 as Connection1810
                            connect Goto20 Gain5.out as Connection1826
                            connect Goto21 reset as Connection1830
                            connect Id Junction173 as Connection1805
                            connect Iq Junction174 as Connection1808
                            connect Junction174 Sum2.in as Connection1811
                            connect Limit3.out Gain5.in as Connection1874
                            connect PI_d.In Sum1.out as Connection1834
                            connect PI_q.Out Sum12.in1 as Connection1837
                            connect PI_q.In Sum2.out as Connection1838
                            connect Product1.in1 Gain4.out as Connection177
                            connect Product5.out Gain10.in as Connection1868
                            connect Product5.in Sum9.out as Connection1869
                            connect Product6.in Gain7.out as Connection204
                            connect Product7.out Gain11.in as Connection1871
                            connect Product7.in Sum12.out as Connection1872
                            connect Sum1.in1 Id_ref as Connection276
                            connect Sum1.in Junction173 as Connection1813
                            connect Sum10.in1 Product1.out as Connection176
                            connect Sum10.out Sum9.in1 as Connection1867
                            connect Sum13.in Product6.out as Connection229
                            connect Sum13.out Sum12.in as Connection1866
                            connect Sum2.in1 Iq_ref as Connection277
                            connect Sum9.in PI_d.Out as Connection1875
                            [
                                position = 0, 0
                                breakpoints = 7264, 8104
                            ]
                            connect Vd Sum10.in as Connection297
                            connect Vdc Limit3.in as Connection1873
                            connect Vq Sum13.in1 as Connection298
                            connect "damper.mq out" m_q as Connection1876
                            [
                                position = 0, 0
                            ]
                            connect f Goto19 as Connection1822
                            connect m_d "damper.md out" as Connection1877
                            [
                                position = 0, 0
                            ]
                            connect From131 Gain7.in as Connection1814
                            connect From132 Gain4.in as Connection1812
                            connect From133 damper.id as Connection1819
                            connect From134 damper.iq as Connection1820
                            connect From135 Product6.in1 as Connection1823
                            connect From137 Product5.in1 as Connection1827
                            connect From139 PI_d.reset as Connection1835
                            connect From140 PI_q.reset as Connection1839
                            connect From141 Product1.in as Connection1833
                        }
                        [
                            position = 7904, 8192
                            scale = -1, 1
                            size = 136, 232
                        ]

                        component src_constant Constant1 {
                            execution_rate = "inherit"
                        }
                        [
                            position = 7144, 7968
                            hide_name = True
                        ]

                        component "core/Edge Detection" "Edge Detection2" {
                        }
                        [
                            position = 7696, 7960
                            hide_name = True
                            size = 32, 32
                        ]

                        component Subsystem Current_ref {
                            layout = dynamic
                            component gen_product Product6 {
                            }
                            [
                                position = 7496, 8208
                                hide_name = True
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 7496, 8136
                                hide_name = True
                            ]

                            component gen_product Product2 {
                                signs = "*/"
                            }
                            [
                                position = 7720, 8152
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "+-"
                            }
                            [
                                position = 7600, 8056
                                hide_name = True
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 7464, 8280
                                hide_name = True
                            ]

                            component gen_product Product4 {
                            }
                            [
                                position = 7496, 8064
                                hide_name = True
                            ]

                            component gen_sum Sum4 {
                            }
                            [
                                position = 7600, 8144
                                hide_name = True
                            ]

                            component Subsystem squared_Vt {
                                layout = dynamic
                                component gen_sum Sum3 {
                                }
                                [
                                    position = 7960, 8168
                                    hide_name = True
                                ]

                                component gen_product Product2 {
                                }
                                [
                                    position = 7872, 8208
                                    hide_name = True
                                ]

                                component gen_product Product1 {
                                }
                                [
                                    position = 7872, 8136
                                    hide_name = True
                                ]

                                port Vt_p2 {
                                    label = "Vt^2"
                                    position = left:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8032, 8168
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Vq {
                                    position = right:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7760, 8200
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Vd {
                                    position = right:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7760, 8128
                                    rotation = down
                                    scale = -1, 1
                                ]

                                junction Junction136 sp
                                [
                                    position = 7808, 8128
                                ]

                                junction Junction137 sp
                                [
                                    position = 7808, 8200
                                ]

                                connect Product2.in Junction137 as Connection6
                                connect Sum3.out Vt_p2 as Connection7
                                connect Junction136 Vd as Connection1
                                connect Product2.in1 Junction137 as Connection5
                                connect Sum3.in Product1.out as Connection8
                                connect Junction137 Vq as Connection3
                                connect Sum3.in1 Product2.out as Connection9
                                connect Product1.in1 Junction136 as Connection4
                                connect Junction136 Product1.in as Connection2
                            }
                            [
                                position = 7352, 8280
                                scale = -1, 1
                                size = 48, 56
                            ]

                            component gen_product Product1 {
                                signs = "*/"
                            }
                            [
                                position = 7720, 8064
                                hide_name = True
                            ]

                            component gen_product Product3 {
                            }
                            [
                                position = 7496, 7992
                                hide_name = True
                            ]

                            port Vq {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7200, 7984
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7200, 8056
                                rotation = down
                                scale = -1, 1
                            ]

                            port P_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7200, 8128
                                rotation = down
                                scale = -1, 1
                            ]

                            port Q_ref {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7200, 8200
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_ref {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7856, 8152
                                rotation = down
                                scale = -1, 1
                            ]

                            port Iq_ref {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7856, 8064
                                rotation = down
                                scale = -1, 1
                            ]

                            junction Junction142 sp
                            [
                                position = 7336, 8056
                            ]

                            junction Junction143 sp
                            [
                                position = 7352, 7984
                            ]

                            junction Junction150 sp
                            [
                                position = 7304, 7984
                            ]

                            junction Junction151 sp
                            [
                                position = 7288, 8056
                            ]

                            junction Junction152 sp
                            [
                                position = 7656, 8160
                            ]

                            junction Junction139 sp
                            [
                                position = 7400, 8128
                            ]

                            junction Junction141 sp
                            [
                                position = 7392, 8200
                            ]

                            connect Junction151 Vd as Connection59
                            connect Product6.in1 Junction143 as Connection36
                            connect Junction152 Product2.in1 as Connection76
                            connect Product6.out Sum4.in1 as Connection37
                            connect Limit3.out Junction152 as Connection77
                            connect squared_Vt.Vq Junction150 as Connection57
                            connect Limit3.in squared_Vt.Vt_p2 as Connection74
                            connect squared_Vt.Vd Junction151 as Connection60
                            connect Product1.in1 Junction152 as Connection75
                            connect Product1.in Sum3.out as Connection23
                            connect Product2.out Id_ref as Connection79
                            connect Product2.in Sum4.out as Connection26
                            connect Product3.in1 Junction139 as Connection27
                            connect Iq_ref Product1.out as Connection78
                            connect Product3.out Sum3.in as Connection28
                            connect Junction139 P_ref as Connection53
                            connect Product4.in1 Junction141 as Connection29
                            connect Junction141 Q_ref as Connection11
                            connect Product4.in Junction142 as Connection30
                            connect Product4.out Sum3.in1 as Connection31
                            connect Junction142 Junction151 as Connection58
                            connect Product5.in Junction139 as Connection32
                            connect Junction143 Junction150 as Connection55
                            connect Product5.in1 Junction142 as Connection33
                            connect Junction143 Product3.in as Connection13
                            connect Junction150 Vq as Connection56
                            connect Product5.out Sum4.in as Connection34
                            connect Product6.in Junction141 as Connection35
                        }
                        [
                            position = 7544, 8168
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component gen_logic_op "Logical operator1" {
                            operator = "OR"
                        }
                        [
                            position = 7800, 7912
                            hide_name = True
                        ]

                        component Subsystem "Island detection (modified SFS)" {
                            layout = dynamic
                            component gen_gain Gain6 {
                                gain = "fn*np.pi/2"
                            }
                            [
                                position = 8320, 8168
                                hide_name = True
                            ]

                            component src_constant Constant6 {
                                execution_rate = "Ts"
                                value = "1.0"
                            }
                            [
                                position = 8048, 8216
                                hide_name = True
                            ]

                            component gen_product Product1 {
                                signs = "**"
                            }
                            [
                                position = 8248, 8168
                                hide_name = True
                            ]

                            component gen_sum Sum11 {
                                signs = "+-"
                            }
                            [
                                position = 8136, 8160
                                hide_name = True
                            ]

                            component src_constant Constant7 {
                                execution_rate = "Ts"
                                value = "k"
                            }
                            [
                                position = 8128, 8224
                                hide_name = True
                            ]

                            port "phase shift" {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8384, 8168
                            ]

                            port "inv freq" {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8152
                            ]

                            connect Gain6.in Product1.out as Connection2227
                            connect Gain6.out "phase shift" as Connection2229
                            connect Sum11.out Product1.in as Connection2228
                            connect Constant6.out Sum11.in1 as Connection2223
                            connect Sum11.in "inv freq" as Connection2230
                            connect Constant7.out Product1.in1 as Connection2226
                        }
                        [
                            position = 7768, 8472
                            size = 168, 56
                        ]

                        component gen_sum Sum12 {
                            signs = "++"
                        }
                        [
                            position = 7928, 8408
                            hide_name = True
                        ]

                        component Subsystem Limit_PQref {
                            layout = dynamic
                            component gen_rate_limiter "S rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8336
                            ]

                            component tm_delay "Unit Delay1" {
                            }
                            [
                                position = 8200, 8192
                                hide_name = True
                            ]

                            component gen_rate_limiter "P rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8192
                            ]

                            component Subsystem priority_PQlim {
                                layout = dynamic
                                component gen_c_function "PQ limiting with priority" {
                                    global_variables = "real signQ;real signP;real Sref;"
                                    in_terminal_dimensions = "inherit;inherit;inherit"
                                    in_terminal_dimensions_str = "Pref inherit;Qref inherit;Smax inherit"
                                    in_terminal_labels = "False;False;False;"
                                    in_terminal_properties = "inherit Pref;inherit Qref;inherit Smax;"
                                    init_fnc = "/*Begin code section*/
Sref = 0;
/*End code section*/"
                                    no_feed_inputs = "[\'\']"
                                    no_feed_outputs = "[\'\']"
                                    out_terminal_dimensions = "inherit;inherit;inherit"
                                    out_terminal_dimensions_str = "P inherit;Q inherit;S inherit"
                                    out_terminal_labels = "False;False;False;"
                                    out_terminal_properties = "inherit P;inherit Q;inherit S;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
Sref = sqrt(Pref*Pref+Qref*Qref);

if (Qref>=0) signQ = 1;
else signQ = -1;
if (Pref>=0) signP = 1;
else signP = -1;

if (Sref <= Smax) {
    S = Sref;
    P = Pref;
    Q = Qref;
} else {
    S = Smax;
    if (type==1) {
        // P priority
        if (fabs(Pref) > Smax) {
            P = signP*Smax;
            Q = 0;
        } else {
            P = Pref;
            Q = signQ*sqrt(Smax*Smax - Pref*Pref);
        }
    } else if (type == 2) {
        // Q priority
        if (fabs(Qref) > Smax) {
            Q = signQ*Smax;
            P = 0;
        } else {
            Q = Qref;
            P = signP*sqrt(Smax*Smax-Qref*Qref);
        }
    } else {
        // Preserve Power Factor
        P = (Pref/Sref)*Smax;
        Q = (Qref/Sref)*Smax;
    }
}
/*End code section*/"
                                    parameters = "real type;"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8272
                                    rotation = right
                                ]

                                port Smax {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8272
                                    rotation = left
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8368, 8192
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8032, 8192
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8128
                                    rotation = right
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8128
                                    rotation = left
                                ]

                                connect "PQ limiting with priority.Pref" Pref as Connection2
                                connect "PQ limiting with priority.Smax" Smax as Connection1
                                connect "PQ limiting with priority.Q" Q as Connection6
                                connect "PQ limiting with priority.Qref" Qref as Connection3
                                connect "PQ limiting with priority.P" P as Connection5
                                connect "PQ limiting with priority.S" S as Connection4
                            }
                            [
                                position = 7872, 8264
                                size = 56, 184
                            ]

                            component tm_delay "Unit Delay2" {
                            }
                            [
                                position = 8200, 8336
                                hide_name = True
                            ]

                            component Subsystem limS_overPQ {
                                layout = dynamic
                                component gen_c_function "S limiting over PQ" {
                                    global_variables = "real S_PQref;"
                                    in_terminal_dimensions = "inherit;inherit;inherit"
                                    in_terminal_dimensions_str = "Pref inherit;Qref inherit;Sref inherit"
                                    in_terminal_labels = "False;False;False;"
                                    in_terminal_properties = "inherit Pref;inherit Qref;inherit Sref;"
                                    init_fnc = "/*Begin code section*/
S_PQref = 0;
/*End code section*/"
                                    no_feed_inputs = "[\'\']"
                                    no_feed_outputs = "[\'\']"
                                    out_terminal_dimensions = "inherit;inherit"
                                    out_terminal_dimensions_str = "P inherit;Q inherit"
                                    out_terminal_labels = "False;False;"
                                    out_terminal_properties = "inherit P;inherit Q;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
S_PQref = sqrt(Pref*Pref+Qref*Qref);

if (S_PQref > Sref) {
    P = (Pref/S_PQref)*Sref;
    Q = (Qref/S_PQref)*Sref;
} else {
    P = Pref;
    Q = Qref;
}
/*End code section*/"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port Sref {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8272
                                    rotation = left
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8272
                                    rotation = right
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8040, 8192
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8112
                                    rotation = right
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8120
                                    rotation = left
                                ]

                                connect "S limiting over PQ.Sref" Sref as Connection4
                                connect "S limiting over PQ.Pref" Pref as Connection5
                                connect "S limiting over PQ.Q" Q as Connection2
                                connect "S limiting over PQ.Qref" Qref as Connection1
                                connect "S limiting over PQ.P" P as Connection3
                            }
                            [
                                position = 8096, 8264
                                size = 56, 184
                            ]

                            component gen_rate_limiter "Q rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8264
                            ]

                            port Pref {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8192
                            ]

                            port Qref {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8264
                            ]

                            port Smax {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8336
                            ]

                            port Qlim {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8336
                            ]

                            port Plim {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8192
                            ]

                            connect Qref priority_PQlim.Qref as Connection156
                            connect "S rate limit.out" limS_overPQ.Sref as Connection165
                            connect "S rate limit.in" priority_PQlim.S as Connection157
                            connect Smax priority_PQlim.Smax as Connection154
                            connect "Unit Delay1.in" limS_overPQ.P as Connection164
                            connect "Unit Delay2.out" Qlim as Connection160
                            connect "Unit Delay2.in" limS_overPQ.Q as Connection163
                            connect "P rate limit.out" limS_overPQ.Pref as Connection166
                            connect "P rate limit.in" priority_PQlim.P as Connection158
                            connect Plim "Unit Delay1.out" as Connection161
                            connect Pref priority_PQlim.Pref as Connection155
                            connect "Q rate limit.out" limS_overPQ.Qref as Connection162
                            connect "Q rate limit.in" priority_PQlim.Q as Connection159

                            type = "1.0"

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Generate Power reference respecting limits defined by maximum apparent power and type of priority.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Choose type parameter to define the behaviour of the block on saturation: Type=0 preserves power factor, Type=1 prioritizes Active Power, Type=2 prioritizes reactive power.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Limited power outputs \"Plim\" and \"Qlim\" have one sample delay and can be used for higher level controller anti-windup purposes.</span></p></body></html>"

                                type {
                                    label = "Priority type"
                                    widget = edit
                                    type = generic
                                    default_value = "2.0"
                                }

                                ratemax {
                                    label = "Max power rate"
                                    widget = edit
                                    type = generic
                                    default_value = "powerRate"
                                    unit = "pu/s"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 7248, 8040
                            rotation = right
                            size = 64, 96
                        ]

                        component gen_gain Gain2 {
                            gain = "1.0/Sn"
                        }
                        [
                            position = 7200, 7904
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/Sn"
                        }
                        [
                            position = 7200, 7864
                            hide_name = True
                        ]

                        component "core/Edge Detection" "Edge Detection1" {
                        }
                        [
                            position = 7696, 7904
                            hide_name = True
                            size = 32, 32
                        ]

                        port Id {
                            position = right:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7696, 8144
                            rotation = down
                            scale = -1, 1
                        ]

                        port mq {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8040, 8288
                            rotation = down
                            scale = -1, 1
                        ]

                        port Iq {
                            position = right:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7696, 8192
                            rotation = down
                            scale = -1, 1
                        ]

                        port On {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7632, 7960
                            rotation = down
                            scale = -1, 1
                        ]

                        port f {
                            position = right:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7696, 8288
                            rotation = down
                            scale = -1, 1
                        ]

                        port Vmode {
                            position = top:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7632, 7904
                            rotation = down
                            scale = -1, 1
                        ]

                        port Vdc {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7888, 7952
                            rotation = left
                            scale = 1, -1
                        ]

                        port wt_ess {
                            position = right:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7744, 8400
                            rotation = down
                            scale = -1, 1
                        ]

                        port Vq {
                            position = right:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7336, 8192
                            rotation = down
                            scale = -1, 1
                        ]

                        port Vd {
                            position = right:10
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7336, 8240
                            rotation = down
                            scale = -1, 1
                        ]

                        port wt {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8040, 8408
                            rotation = down
                            scale = -1, 1
                        ]

                        port md {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8040, 8096
                            rotation = down
                            scale = -1, 1
                        ]

                        tag Goto19 {
                            value = "Vd_ess"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7432, 8216
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From166 {
                            value = "f_ess"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7592, 8472
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From168 {
                            value = "Qref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7112, 7904
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto20 {
                            value = "Vq_ess"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7432, 8168
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From151 {
                            value = "Vq_ess"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7920, 8000
                            rotation = right
                            hide_name = True
                            size = 58, 20
                        ]

                        tag Goto18 {
                            value = "f_ess"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7792, 8264
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From152 {
                            value = "Vd_ess"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7952, 8000
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From167 {
                            value = "Pref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7112, 7864
                            hide_name = True
                            size = 60, 20
                        ]

                        junction Junction2 sp
                        [
                            position = 7376, 8192
                        ]

                        junction Junction3 sp
                        [
                            position = 7376, 8240
                        ]

                        junction Junction1 sp
                        [
                            position = 7736, 8288
                        ]

                        connect Sum12.in1 "Island detection (modified SFS).phase shift" as Connection2231
                        connect Goto20 Junction2 as Connection2310
                        connect Sum12.out wt as Connection2291
                        connect "Edge Detection1.Out1" "Logical operator1.in" as Connection2510
                        connect "Edge Detection1.In1" Vmode as Connection2513
                        connect Vd Junction3 as Connection2311
                        connect "Edge Detection2.Out1" "Logical operator1.in1" as Connection2512
                        connect Vdc "Dq current controller.Vdc" as Connection2432
                        connect Junction1 f as Connection2298
                        connect "Edge Detection2.In1" On as Connection2514
                        connect Junction2 Vq as Connection2309
                        connect md "Dq current controller.m_d" as Connection2295
                        connect Goto19 Junction3 as Connection2313
                        connect From151 "Dq current controller.Vq" as Connection1839
                        connect Junction3 Current_ref.Vd as Connection2312
                        connect mq "Dq current controller.m_q" as Connection2296
                        connect From152 "Dq current controller.Vd" as Connection1840
                        connect wt_ess Sum12.in as Connection2434
                        connect Constant1.out Limit_PQref.Smax as Connection2566
                        connect From166 "Island detection (modified SFS).inv freq" as Connection2232
                        connect Current_ref.Vq Junction2 as Connection2308
                        connect From168 Gain2.in as Connection2542
                        connect Gain1.in From167 as Connection2541
                        connect Limit_PQref.Pref Gain1.out as Connection2568
                        [
                            position = 0, 0
                        ]
                        connect "Dq current controller.Id" Id as Connection2287
                        connect Gain2.out Limit_PQref.Qref as Connection2567
                        [
                            position = 0, 0
                        ]
                        connect "Dq current controller.Iq" Iq as Connection2290
                        connect Goto18 Junction1 as Connection2299
                        connect "Dq current controller.f" Junction1 as Connection2297
                        connect "Logical operator1.out" "Dq current controller.reset" as Connection2515
                        connect "Dq current controller.Id_ref" Current_ref.Id_ref as Connection2569
                        [
                            breakpoints = 7616, 8096
                        ]
                        connect Current_ref.Iq_ref "Dq current controller.Iq_ref" as Connection2570
                        [
                            breakpoints = 7616, 8240
                        ]
                        connect Limit_PQref.Qlim Current_ref.Q_ref as Connection2571
                        [
                            breakpoints = 7424, 8144
                        ]
                        connect Limit_PQref.Plim Current_ref.P_ref as Connection2572
                        [
                            breakpoints = 7464, 8096
                        ]
                    }
                    [
                        position = 8216, 8384
                        scale = -1, 1
                        size = 120, 200
                    ]

                    component gen_probe S {
                    }
                    [
                        position = 8848, 8904
                        rotation = down
                        scale = -1, 1
                    ]

                    component gen_probe P {
                    }
                    [
                        position = 8848, 8776
                        rotation = down
                        scale = -1, 1
                    ]

                    component gen_probe pf {
                    }
                    [
                        position = 8848, 8968
                        rotation = down
                        scale = -1, 1
                    ]

                    component gen_gain Gain1 {
                        gain = "1.0/Vn_dc"
                    }
                    [
                        position = 8256, 8184
                        rotation = right
                        hide_name = True
                    ]

                    component Subsystem Power_Meas {
                        layout = dynamic
                        component Subsystem Power_Meas_DQ {
                            layout = dynamic
                            component gen_z_domain_transfer LPF_Q {
                                a_coeff = "[1.0/(2*np.pi*fc_Q),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 8264, 8272
                            ]

                            component gen_sum Sum2 {
                                signs = "+-"
                            }
                            [
                                position = 8128, 8272
                                hide_name = True
                            ]

                            component gen_c_function S_and_pf {
                                in_terminal_dimensions = "inherit;inherit"
                                in_terminal_dimensions_str = "P inherit;Q inherit"
                                in_terminal_labels = "False;False;"
                                in_terminal_properties = "real P;inherit Q;"
                                init_fnc = "/*Begin code section*/
P = 0;
Q = 0;
S = 0;
pf = 0;
/*End code section*/"
                                no_feed_inputs = "[u\'\']"
                                no_feed_outputs = "[u\'\']"
                                out_terminal_dimensions = "inherit;inherit"
                                out_terminal_dimensions_str = "S inherit;pf inherit"
                                out_terminal_labels = "False;False;"
                                out_terminal_properties = "inherit S;inherit pf;"
                                output_fnc = "/*Begin code section*/
S = sqrt(P*P+Q*Q);
if(S>0){
    pf = P/S;
}
else{
    pf = 0;
}
/*End code section*/"
                            }
                            [
                                position = 8448, 8192
                                size = 48, 48
                            ]

                            component gen_z_domain_transfer LPF_P {
                                a_coeff = "[1.0/(2*np.pi*fc_P),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 8264, 8112
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 8024, 8152
                                hide_name = True
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 8024, 8064
                                hide_name = True
                            ]

                            component gen_product Product4 {
                            }
                            [
                                position = 8024, 8232
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                            }
                            [
                                position = 8128, 8112
                                hide_name = True
                            ]

                            component gen_product Product3 {
                            }
                            [
                                position = 8024, 8320
                                hide_name = True
                            ]

                            port S {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8520, 8144
                            ]

                            port Vd {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7808, 8056
                            ]

                            port pf {
                                position = right:4
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8520, 8240
                            ]

                            port Vq {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7808, 8144
                            ]

                            port Id {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7808, 8240
                            ]

                            port Iq {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7808, 8328
                            ]

                            port Q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8368, 8272
                            ]

                            port P {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8368, 8112
                            ]

                            junction Junction3 sp
                            [
                                position = 7944, 8144
                            ]

                            junction Junction4 sp
                            [
                                position = 7960, 8056
                            ]

                            junction Junction5 sp
                            [
                                position = 8320, 8112
                            ]

                            junction Junction6 sp
                            [
                                position = 8320, 8272
                            ]

                            junction Junction1 sp
                            [
                                position = 7920, 8240
                            ]

                            junction Junction2 sp
                            [
                                position = 7928, 8328
                            ]

                            comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = Vd*Id+Vq*Iq;</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Q = Vq*Id-Vd*Iq;</p></body></html> ENDCOMMENT 
                            [
                                position = 7960, 7968
                            ]

                            connect Junction5 P as Connection55
                            connect Junction6 LPF_Q.out as Connection47
                            connect Junction6 Q as Connection56
                            connect Product1.in1 Junction1 as Connection25
                            connect Product2.in1 Junction2 as Connection28
                            connect Product3.in Junction4 as Connection36
                            connect Product4.in Junction3 as Connection33
                            connect S_and_pf.P Junction5 as Connection45
                            connect Junction1 Id as Connection49
                            connect S_and_pf.Q Junction6 as Connection48
                            connect Junction1 Product4.in1 as Connection24
                            connect S_and_pf.S S as Connection51
                            connect Junction2 Iq as Connection52
                            connect S_and_pf.pf pf as Connection54
                            connect Junction2 Product3.in1 as Connection27
                            connect Sum1.out LPF_P.in as Connection59
                            connect Junction3 Product2.in as Connection32
                            connect Sum1.in Product1.out as Connection29
                            connect Junction3 Vq as Connection53
                            connect Sum1.in1 Product2.out as Connection30
                            connect Junction4 Product1.in as Connection35
                            connect Sum2.out LPF_Q.in as Connection58
                            connect Junction4 Vd as Connection50
                            connect Sum2.in1 Product3.out as Connection38
                            connect Sum2.in Product4.out as Connection37
                            connect Junction5 LPF_P.out as Connection44

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power measurement in DQ frame with inputs and outputs in per unit.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Zero component is not considered in the power calculation, thus this measurement is not suitable for unbalanced systems.</p></body></html>"

                                fc_P {
                                    label = "Active power low pass filter cut-off freq."
                                    widget = edit
                                    type = generic
                                    default_value = "1.0"
                                    unit = "Hz"
                                }

                                fc_Q {
                                    label = "Reactive power low pass filter cut-off freq."
                                    widget = edit
                                    type = generic
                                    default_value = "1.0"
                                    unit = "Hz"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 8184, 8208
                            size = 72, 144
                        ]

                        component gen_gain Gain1 {
                            gain = "Sn"
                        }
                        [
                            position = 8272, 8112
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain2 {
                            gain = "Sn"
                        }
                        [
                            position = 8336, 8112
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain3 {
                            gain = "Sn"
                        }
                        [
                            position = 8336, 8256
                            rotation = right
                            hide_name = True
                        ]

                        port Id {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8040, 8320
                            rotation = left
                        ]

                        port Iq {
                            position = left:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8096, 8320
                            rotation = left
                        ]

                        port P {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8272, 8048
                            rotation = left
                        ]

                        port Q {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8336, 8048
                            rotation = left
                        ]

                        port S {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8336, 8320
                            rotation = right
                        ]

                        port Vd {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8096, 8112
                            rotation = right
                        ]

                        port pf {
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8272, 8320
                            rotation = right
                        ]

                        port Vq {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8040, 8112
                            rotation = right
                        ]

                        connect Gain2.out Q as Connection12
                        connect Gain3.out S as Connection14
                        connect P Gain1.out as Connection18
                        connect Power_Meas_DQ.S Gain3.in as Connection13
                        connect Power_Meas_DQ.Id Id as Connection3
                        connect Power_Meas_DQ.Iq Iq as Connection4
                        connect Power_Meas_DQ.Vd Vd as Connection1
                        connect Power_Meas_DQ.Vq Vq as Connection2
                        connect Power_Meas_DQ.pf pf as Connection8
                        connect Gain1.in Power_Meas_DQ.P as Connection25
                        connect Power_Meas_DQ.Q Gain2.in as Connection26
                    }
                    [
                        position = 8680, 8872
                        size = 80, 232
                    ]

                    component Subsystem Vmode_control {
                        layout = dynamic
                        component gen_logic_op "Logical operator1" {
                            operator = "OR"
                        }
                        [
                            position = 7312, 7912
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 6808, 8048
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/Vn"
                        }
                        [
                            position = 6728, 8032
                            hide_name = True
                        ]

                        component Subsystem internal_frequency {
                            layout = dynamic
                            component Subsystem "Angle generator" {
                                layout = dynamic
                                component gen_gain Gain1 {
                                    gain = "2*np.pi"
                                }
                                [
                                    position = 8008, 8080
                                    hide_name = True
                                ]

                                component gen_c_function int_n_wrap {
                                    global_variables = "real out;"
                                    in_terminal_dimensions = "inherit"
                                    in_terminal_dimensions_str = "in inherit"
                                    in_terminal_labels = "False;"
                                    init_fnc = "/*Begin code section*/
out = 0;
in = 0;
/*End code section*/"
                                    no_feed_inputs = "[u\'\']"
                                    no_feed_outputs = "[u\'\']"
                                    out_terminal_dimensions = "inherit"
                                    out_terminal_dimensions_str = "output inherit"
                                    out_terminal_labels = "False;"
                                    out_terminal_properties = "inherit output;"
                                    output_fnc = "/*Begin code section*/
output = out+0.0;
/*End code section*/"
                                    update_fnc = "/*Begin code section*/
out += execution_rate*in;
if(in>=0.0){
    if(out >= 6.283185307179586)
    {
        out -= 6.283185307179586;
    }
}
else{
        if(out <= -6.283185307179586)
    {
        out += 6.283185307179586;
    }
}
/*End code section*/"
                                }
                                [
                                    position = 8088, 8080
                                    size = 0, 0
                                ]

                                port f {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7944, 8080
                                ]

                                port wt {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8168, 8080
                                ]

                                connect Gain1.in f as Connection4
                                connect int_n_wrap.in Gain1.out as Connection3
                                connect wt int_n_wrap.output as Connection2
                            }
                            [
                                position = 8288, 8216
                                size = 48, 48
                            ]

                            component gen_sum Sum1 {
                                signs = "++"
                            }
                            [
                                position = 8112, 8216
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "fn"
                            }
                            [
                                position = 8192, 8216
                                hide_name = True
                            ]

                            port f_ref {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8032, 8160
                            ]

                            port df_sync {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8032, 8224
                            ]

                            port inner_wt {
                                label = "wt"
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8360, 8216
                            ]

                            connect f_ref Sum1.in as Connection1147
                            connect "Angle generator.f" Gain1.out as Connection1138
                            connect Sum1.in1 df_sync as Connection1121
                            connect Sum1.out Gain1.in as Connection1151
                            [
                                breakpoints = 8160, 8216
                            ]
                            connect "Angle generator.wt" inner_wt as Connection1152
                            [
                                breakpoints = 8328, 8216
                            ]
                        }
                        [
                            position = 6912, 8392
                            size = 88, 104
                        ]

                        component Subsystem Current_ref {
                            layout = dynamic
                            component gen_sum Sum4 {
                                signs = "+-"
                            }
                            [
                                position = 7848, 8096
                                hide_name = True
                            ]

                            component Subsystem PI {
                                layout = dynamic
                                component gen_integrator Integrator1 {
                                    init_value = "out0"
                                    limit_lower = "-1"
                                    limit_upper = "1"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8232
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "lowLim"
                                    upper_limit = "upLim"
                                }
                                [
                                    position = 8408, 8224
                                    hide_name = True
                                ]

                                component gen_gain Ki {
                                    gain = "Ki"
                                }
                                [
                                    position = 7976, 8216
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8320, 8224
                                    hide_name = True
                                ]

                                component gen_gain Kp {
                                    gain = "Kp"
                                }
                                [
                                    position = 8128, 8128
                                ]

                                component gen_gain Kb {
                                    gain = "1.0"
                                }
                                [
                                    position = 8216, 8312
                                    scale = -1, 1
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8320, 8312
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8088, 8224
                                    hide_name = True
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7888, 8168
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8472, 8224
                                ]

                                port reset {
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8136, 8256
                                ]

                                junction Junction3 sp
                                [
                                    position = 8440, 8224
                                ]

                                junction Junction4 sp
                                [
                                    position = 7920, 8168
                                ]

                                junction Junction2 sp
                                [
                                    position = 8368, 8224
                                ]

                                connect Sum5.out Junction2 as Connection44
                                connect Sum6.in Junction2 as Connection46
                                connect Sum6.in1 Junction3 as Connection49
                                connect Sum7.out Integrator1.in as Connection52
                                connect Junction2 Limit1.in as Connection45
                                connect Sum7.in1 Kb.out as Connection53
                                connect Junction3 Out as Connection48
                                connect reset Integrator1.reset as Connection62
                                connect Junction4 In as Connection67
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction4 as Connection68
                                connect Ki.out Sum7.in as Connection64
                                connect Kp.in Junction4 as Connection66
                                connect Kp.out Sum5.in as Connection63
                                connect Limit1.out Junction3 as Connection47
                                connect Sum5.in1 Integrator1.out as Connection5

                                Ki = "VmodeIdRef_Ki"
                                Kp = "VmodeIdRef_Kp"
                                lowLim = "-1.00"
                                out0 = "(((Vn*OutputFilterFc)**2.0*2*np.pi*L)/(Sn*fn))/(Resr**2.0+((2.0*np.pi*L*OutputFilterFc**2.0)/fn)**2.0)"
                                upLim = "1.00"

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller</span></p></body></html>"

                                    Kp {
                                        label = "Kp"
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        group = "General"
                                    }

                                    Ki {
                                        label = "Ki"
                                        widget = edit
                                        type = generic
                                        default_value = "5.0"
                                        group = "General"
                                    }

                                    upLim {
                                        label = "Upper limit"
                                        widget = edit
                                        type = generic
                                        default_value = "100.0"
                                        group = "General"
                                    }

                                    lowLim {
                                        label = "Lower limit"
                                        widget = edit
                                        type = generic
                                        default_value = "0.0"
                                        group = "General"
                                    }

                                    out0 {
                                        label = "Integrator initial output"
                                        widget = edit
                                        type = generic
                                        default_value = "fnom"
                                        group = "General"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                        
                                    ENDCODE
                                }
                            }
                            [
                                position = 7960, 8096
                                size = 64, 48
                            ]

                            port enable {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7920, 8048
                                rotation = down
                                scale = -1, 1
                            ]

                            port vd {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7768, 8136
                                rotation = down
                                scale = -1, 1
                            ]

                            port "vt ref" {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7768, 8088
                                rotation = down
                                scale = -1, 1
                            ]

                            port "id ref" {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8064, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            connect Sum4.in1 vd as Connection1663
                            connect PI.reset enable as Connection1669
                            connect Sum4.in "vt ref" as Connection1667
                            connect PI.Out "id ref" as Connection1670
                            connect PI.In Sum4.out as Connection1668
                        }
                        [
                            position = 7128, 8128
                            scale = -1, 1
                            size = 88, 96
                        ]

                        component gen_sum Sum3 {
                        }
                        [
                            position = 6968, 8096
                            hide_name = True
                        ]

                        component src_constant Constant1 {
                            execution_rate = "Ts"
                            value = "0.0"
                        }
                        [
                            position = 6704, 8088
                            hide_name = True
                        ]

                        component Subsystem "Inner dq current controller" {
                            layout = dynamic
                            component gen_gain Gain5 {
                                gain = "Vmode_ovMod"
                            }
                            [
                                position = 7240, 7392
                                rotation = right
                                hide_name = True
                            ]

                            component gen_gain Gain10 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7776, 7560
                                hide_name = True
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 7240, 7336
                                rotation = right
                                hide_name = True
                            ]

                            component src_constant Constant1 {
                                execution_rate = "Ts"
                                value = "0"
                            }
                            [
                                position = 7816, 7632
                                hide_name = True
                            ]

                            component gen_product Product11 {
                                signs = "*/"
                            }
                            [
                                position = 7696, 7560
                                hide_name = True
                            ]

                            component Subsystem PI_d {
                                layout = dynamic
                                component gen_gain Ki {
                                    gain = "Ki"
                                }
                                [
                                    position = 7984, 8216
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8320, 8232
                                    hide_name = True
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8320, 8352
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_gain Kb {
                                    gain = "1.0"
                                }
                                [
                                    position = 8216, 8352
                                    scale = -1, 1
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8088, 8224
                                    hide_name = True
                                ]

                                component gen_integrator Integrator1 {
                                    init_value = "out0"
                                    limit_lower = "-1"
                                    limit_upper = "1"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8240
                                ]

                                component gen_gain Kp {
                                    gain = "Kp"
                                }
                                [
                                    position = 8136, 8128
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "lowLim"
                                    upper_limit = "upLim"
                                }
                                [
                                    position = 8408, 8232
                                    hide_name = True
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8472, 8232
                                ]

                                port reset {
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8136, 8240
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7888, 8168
                                ]

                                junction Junction2 sp
                                [
                                    position = 8368, 8232
                                ]

                                junction Junction3 sp
                                [
                                    position = 8440, 8232
                                ]

                                junction Junction4 sp
                                [
                                    position = 7920, 8168
                                ]

                                connect Ki.in Junction4 as Connection66
                                connect Kp.in Junction4 as Connection68
                                connect Kp.out Sum5.in as Connection63
                                connect Limit1.out Junction3 as Connection47
                                connect Sum5.in1 Integrator1.out as Connection5
                                connect Sum5.out Junction2 as Connection44
                                connect Sum6.in Junction2 as Connection46
                                connect Sum6.in1 Junction3 as Connection49
                                connect Sum7.out Integrator1.in as Connection52
                                connect Sum7.in1 Kb.out as Connection53
                                connect Junction2 Limit1.in as Connection45
                                connect Sum7.in Ki.out as Connection64
                                connect Junction3 Out as Connection48
                                connect Junction4 In as Connection67
                                connect reset Integrator1.reset as Connection62
                                connect Kb.in Sum6.out as Connection50

                                Ki = "VmodeId_Ki"
                                Kp = "VmodeId_Kp"
                                lowLim = "-10.0"
                                out0 = "0.0"
                                upLim = "10.0"

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller</span></p></body></html>"

                                    Kp {
                                        label = "Kp"
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        group = "General"
                                    }

                                    Ki {
                                        label = "Ki"
                                        widget = edit
                                        type = generic
                                        default_value = "5.0"
                                        group = "General"
                                    }

                                    upLim {
                                        label = "Upper limit"
                                        widget = edit
                                        type = generic
                                        default_value = "100.0"
                                        group = "General"
                                    }

                                    lowLim {
                                        label = "Lower limit"
                                        widget = edit
                                        type = generic
                                        default_value = "0.0"
                                        group = "General"
                                    }

                                    out0 {
                                        label = "Integrator initial output"
                                        widget = edit
                                        type = generic
                                        default_value = "fnom"
                                        group = "General"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                        
                                    ENDCODE
                                }
                            }
                            [
                                position = 7464, 7552
                                size = 64, 48
                            ]

                            component gen_sum Sum15 {
                                signs = "-+"
                            }
                            [
                                position = 7312, 7552
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            port m_q {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7896, 7632
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vdc {
                                position = top:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7240, 7280
                                rotation = right
                                scale = -1, 1
                            ]

                            port f {
                                position = right:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7160, 7664
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7160, 7544
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7160, 7600
                                rotation = down
                                scale = -1, 1
                            ]

                            port m_d {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7896, 7560
                                rotation = down
                                scale = -1, 1
                            ]

                            port reset {
                                position = top:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7320, 7280
                                rotation = right
                                scale = -1, 1
                            ]

                            tag Goto19 {
                                value = "f"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7280, 7664
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From139 {
                                value = "reset"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7368, 7496
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto21 {
                                value = "reset"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7320, 7352
                                rotation = right
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto17 {
                                value = "id"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7272, 7600
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From137 {
                                value = "overMod"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7584, 7576
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto20 {
                                value = "overMod"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7240, 7472
                                rotation = right
                                hide_name = True
                                size = 60, 20
                            ]

                            junction Junction173 sp
                            [
                                position = 7208, 7600
                            ]

                            connect Goto17 Junction173 as Connection1807
                            connect m_d Gain10.out as Connection1914
                            [
                                position = 0, 0
                            ]
                            connect Goto20 Gain5.out as Connection1826
                            connect Goto21 reset as Connection1830
                            connect Id Junction173 as Connection1805
                            connect Limit3.out Gain5.in as Connection1911
                            connect PI_d.reset From139 as Connection1899
                            connect PI_d.Out Product11.in as Connection1913
                            [
                                position = 0, 0
                                breakpoints = 7592, 7552
                            ]
                            connect PI_d.In Sum15.out as Connection1851
                            connect Product11.out Gain10.in as Connection1874
                            connect Sum15.in1 Id_ref as Connection276
                            connect Constant1.out m_q as Connection1849
                            connect Sum15.in Junction173 as Connection1813
                            connect Vdc Limit3.in as Connection1910
                            connect From137 Product11.in1 as Connection1827
                            connect f Goto19 as Connection1822
                        }
                        [
                            position = 7408, 8200
                            scale = -1, 1
                            size = 128, 192
                        ]

                        component gen_rate_limiter "Rate Limiter2" {
                            falling_limit = "f_fall"
                            rising_limit = "f_rise"
                        }
                        [
                            position = 6816, 8360
                            hide_name = True
                        ]

                        component gen_gain Gain2 {
                            gain = "1.0/fn"
                        }
                        [
                            position = 6744, 8360
                            hide_name = True
                        ]

                        component "core/Edge Detection" "Edge Detection2" {
                        }
                        [
                            position = 7240, 7944
                            hide_name = True
                            size = 32, 32
                        ]

                        component gen_rate_limiter "Rate Limiter1" {
                            falling_limit = "V_fall"
                            rising_limit = "V_rise"
                        }
                        [
                            position = 6888, 8048
                            hide_name = True
                        ]

                        component "core/Edge Detection" "Edge Detection1" {
                        }
                        [
                            position = 7208, 7904
                            hide_name = True
                            size = 32, 32
                        ]

                        port md {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7528, 8120
                            rotation = down
                            scale = -1, 1
                        ]

                        port Vd {
                            position = right:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 6992, 8160
                            scale = 1, -1
                        ]

                        port mq {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7528, 8280
                            rotation = down
                            scale = -1, 1
                        ]

                        port Id {
                            position = right:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7256, 8200
                            rotation = down
                            scale = -1, 1
                        ]

                        port wt {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7024, 8392
                            scale = 1, -1
                        ]

                        port On {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 6752, 7976
                            rotation = down
                            scale = -1, 1
                        ]

                        port Vmode {
                            position = top:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7144, 7904
                            rotation = down
                            scale = -1, 1
                        ]

                        port dV_match {
                            position = right:10
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 6880, 8104
                            scale = 1, -1
                        ]

                        port Vdc {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7456, 8056
                            rotation = right
                            scale = -1, 1
                        ]

                        port df_sync {
                            position = right:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 6792, 8424
                            scale = 1, -1
                        ]

                        port f {
                            position = right:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7256, 8272
                            rotation = down
                            scale = -1, 1
                        ]

                        tag Goto17 {
                            value = "vmode"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7448, 7912
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From167 {
                            value = "Vref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 6648, 8032
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From96 {
                            value = "vmode"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7128, 8016
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From169 {
                            value = "On"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7160, 7944
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From168 {
                            value = "f_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 6664, 8360
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto19 {
                            value = "On"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 6872, 7976
                            hide_name = True
                            size = 60, 20
                        ]

                        junction Junction274 sp
                        [
                            position = 6808, 7976
                        ]

                        junction Junction282 sp
                        [
                            position = 7360, 7912
                        ]

                        connect Gain1.out "Signal switch1.in" as Connection2417
                        connect "Signal switch1.out" "Rate Limiter1.in" as Connection2418
                        connect Gain2.out "Rate Limiter2.in" as Connection2412
                        connect Goto19 Junction274 as Connection2427
                        connect Sum3.in "Rate Limiter1.out" as Connection2503
                        connect Sum3.in1 dV_match as Connection2307
                        connect Id "Inner dq current controller.Id" as Connection2494
                        connect Vd Current_ref.vd as Connection2489
                        connect "Signal switch1.in1" Constant1.out as Connection2467
                        connect Vmode "Edge Detection1.In1" as Connection2509
                        connect "Inner dq current controller.reset" Junction282 as Connection2515
                        connect "Inner dq current controller.Vdc" Vdc as Connection2491
                        connect df_sync internal_frequency.df_sync as Connection2507
                        connect Junction274 "Signal switch1.in2" as Connection2426
                        connect f "Inner dq current controller.f" as Connection2490
                        connect md "Inner dq current controller.m_d" as Connection2480
                        connect "Edge Detection1.Out1" "Logical operator1.in" as Connection2510
                        connect "Edge Detection2.Out1" "Logical operator1.in1" as Connection2512
                        connect Junction282 Goto17 as Connection2514
                        connect mq "Inner dq current controller.m_q" as Connection2481
                        connect From167 Gain1.in as Connection2409
                        connect wt internal_frequency.inner_wt as Connection2396
                        connect "Logical operator1.out" Junction282 as Connection2513
                        connect From168 Gain2.in as Connection2411
                        connect On Junction274 as Connection2425
                        connect From169 "Edge Detection2.In1" as Connection2511
                        connect "Rate Limiter2.out" internal_frequency.f_ref as Connection2405
                        connect From96 Current_ref.enable as Connection2371
                        connect "Current_ref.id ref" "Inner dq current controller.Id_ref" as Connection2516
                        [
                            breakpoints = 7208, 8128
                        ]
                        connect "Current_ref.vt ref" Sum3.out as Connection2517
                        [
                            breakpoints = 7040, 8096
                        ]
                    }
                    [
                        position = 8208, 8720
                        scale = -1, 1
                        size = 120, 168
                    ]

                    component Subsystem Inv_Cab_SM {
                        layout = dynamic
                        component Subsystem read_mode {
                            layout = dynamic
                            component gen_digital_probe StandBy {
                            }
                            [
                                position = 8240, 8024
                                rotation = left
                            ]

                            component gen_digital_probe "Grid following" {
                            }
                            [
                                position = 8240, 8168
                                rotation = right
                            ]

                            component gen_digital_probe "Grid forming" {
                            }
                            [
                                position = 8328, 8088
                            ]

                            component gen_digital_probe on {
                            }
                            [
                                position = 7992, 8040
                            ]

                            component gen_c_function verify_mode {
                                in_terminal_dimensions = "inherit"
                                in_terminal_dimensions_str = "control_mode inherit"
                                in_terminal_labels = "False;"
                                in_terminal_properties = "real control_mode;"
                                no_feed_inputs = "[\'\']"
                                no_feed_outputs = "[\'\']"
                                out_terminal_dimensions = "inherit;inherit;inherit"
                                out_terminal_dimensions_str = "stand_by inherit;grid_forming inherit;grid_following inherit"
                                out_terminal_labels = "False;False;False;"
                                out_terminal_properties = "real stand_by;inherit grid_forming;inherit grid_following;"
                                output_fnc = "/*Begin code section*/
if(control_mode == 0){
    stand_by = 1;
    grid_forming = 0;
    grid_following = 0;
}
else{
    if(control_mode == 1){
        stand_by = 0;
        grid_forming = 1;
        grid_following = 0;
    }
    else{
        stand_by = 0;
        grid_forming = 0;
        grid_following = 1;
    }
}
/*End code section*/"
                            }
                            [
                                position = 8160, 8088
                                size = 0, 0
                            ]

                            port Mode {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8104, 8000
                                rotation = right
                            ]

                            port On {
                                position = top:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8000
                                rotation = right
                            ]

                            connect Mode verify_mode.control_mode as Connection1954
                            connect StandBy.in verify_mode.stand_by as Connection1955
                            connect on.in On as Connection1953
                            connect "Grid following.in" verify_mode.grid_following as Connection1957
                            connect "Grid forming.in" verify_mode.grid_forming as Connection1956
                        }
                        [
                            position = 8256, 8112
                            rotation = down
                            size = 48, 48
                        ]

                        component gen_digital_probe CB_status {
                        }
                        [
                            position = 8408, 8312
                            rotation = right
                        ]

                        component gen_c_function Inv_Cab_SM {
                            global_variables = "real lock1;real lock2;real from_grid_follow;"
                            in_terminal_dimensions = "inherit;inherit;inherit;inherit;inherit;inherit"
                            in_terminal_dimensions_str = "On inherit;mode inherit;grid_locked inherit;v_match inherit;live_grid inherit;on_nominal inherit"
                            in_terminal_labels = "False;False;False;False;False;False;"
                            in_terminal_properties = "inherit On;inherit mode;inherit grid_locked;inherit v_match;inherit live_grid;inherit on_nominal;"
                            init_fnc = "/*Begin code section*/
lock1 = 0;
lock2 = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit;inherit;inherit;inherit"
                            out_terminal_dimensions_str = "control_mode inherit;Vmode inherit;synch inherit;contactor inherit"
                            out_terminal_labels = "False;False;False;False;"
                            out_terminal_properties = "real control_mode;inherit Vmode;inherit synch;inherit contactor;"
                            output_fnc = "/*Begin code section*/
if(On == 0){ //all off
    contactor = 0;
    synch = 0;
    Vmode = 1;
    lock1 = 0;
    lock2 = 0;
    control_mode = 0;
    from_grid_follow = 0;
}
else{
    if((mode == 0) && (lock1 == 0)){ //voltage mode
        lock2 = 0;
        if((on_nominal) || (from_grid_follow)){
            Vmode = 1;
            contactor = 1;
            synch = 0;
            lock1 = 1;
            control_mode = 1;
            from_grid_follow = 0;
        }
        else{
            Vmode = 1;
            contactor = 0;
            synch = 0;
            control_mode = 0;
        }
    }
    else{
        if((mode == 1) && (lock2 ==0)){ //current mode
            lock1 = 0;
            if((on_nominal) &&  (live_grid == 1)){
                synch = 1;
                if((grid_locked == 1) && (v_match == 1)){
                    Vmode = 0;
                    contactor = 1;
                    synch = 0;
                    lock2 = 1;
                    control_mode = 2;
                    from_grid_follow = 1;
                }
                else{
                    Vmode = 1;
                    contactor = 0;
                    control_mode = 0;
                }
            }
            else{
                Vmode = 1;
                contactor = 0;
                synch = 0;
                control_mode = 0;
            }
        }
    }
}
/*End code section*/"
                        }
                        [
                            position = 8176, 8240
                            size = 144, 112
                        ]

                        component gen_digital_probe synch {
                        }
                        [
                            position = 8528, 8200
                            rotation = left
                        ]

                        component gen_digital_probe V_mode {
                        }
                        [
                            position = 8408, 8168
                            rotation = right
                            scale = -1, -1
                        ]

                        port live_grid {
                            position = left:5
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7952, 8336
                            rotation = right
                            scale = -1, -1
                        ]

                        port mode {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7896, 8064
                            rotation = right
                        ]

                        port on_nominal {
                            position = left:6
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7992, 8368
                            rotation = right
                            scale = -1, -1
                        ]

                        port grid_locked {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7888, 8272
                            rotation = right
                            scale = -1, -1
                        ]

                        port Synch {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8608, 8256
                        ]

                        port CB {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8464, 8344
                            rotation = right
                        ]

                        port Vmode {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8464, 8160
                            rotation = left
                        ]

                        port V_match {
                            position = left:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7920, 8304
                            rotation = right
                            scale = -1, -1
                        ]

                        port On {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7952, 8064
                            rotation = right
                        ]

                        junction Junction7 sp
                        [
                            position = 8408, 8224
                        ]

                        junction Junction8 sp
                        [
                            position = 8528, 8256
                        ]

                        junction Junction9 sp
                        [
                            position = 8408, 8272
                        ]

                        junction Junction10 sp
                        [
                            position = 8072, 8200
                        ]

                        comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Modes:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 = voltage mode/grid forming</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 = current mode/grid following           </p></body></html> ENDCOMMENT 
                        [
                            position = 8032, 8360
                        ]

                        connect Junction9 CB_status.in as Connection1760
                        connect On Junction10 as Connection1775
                        connect Synch Junction8 as Connection1756
                        connect V_match Inv_Cab_SM.v_match as Connection1715
                        connect Vmode Junction7 as Connection1753
                        connect Junction8 synch.in as Connection1757
                        connect grid_locked Inv_Cab_SM.grid_locked as Connection1714
                        connect CB Junction9 as Connection1759
                        connect live_grid Inv_Cab_SM.live_grid as Connection1725
                        connect Inv_Cab_SM.On Junction10 as Connection1773
                        connect mode Inv_Cab_SM.mode as Connection1776
                        connect Inv_Cab_SM.Vmode Junction7 as Connection1755
                        connect on_nominal Inv_Cab_SM.on_nominal as Connection1746
                        connect Inv_Cab_SM.synch Junction8 as Connection1758
                        connect read_mode.Mode Inv_Cab_SM.control_mode as Connection1767
                        connect Inv_Cab_SM.contactor Junction9 as Connection1761
                        connect Junction10 read_mode.On as Connection1774
                        [
                            position = 0, 0
                        ]
                        connect Junction7 V_mode.in as Connection1754
                    }
                    [
                        position = 7720, 8344
                        size = 104, 224
                    ]

                    component Subsystem Synch {
                        layout = dynamic
                        component Subsystem f_match {
                            layout = dynamic
                            component gen_sum Sum1 {
                                signs = "+-"
                            }
                            [
                                position = 7912, 8192
                                hide_name = True
                            ]

                            component gen_delay Delay1 {
                                del_length = "10"
                            }
                            [
                                position = 8704, 8264
                                hide_name = True
                            ]

                            component gen_abs Abs3 {
                            }
                            [
                                position = 8160, 8192
                                hide_name = True
                            ]

                            component gen_gain Freq_diff {
                                gain = "f_diff/100.0"
                            }
                            [
                                position = 8120, 8304
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                            }
                            [
                                position = 8192, 8312
                                hide_name = True
                            ]

                            component gen_comparator Comparator1 {
                            }
                            [
                                position = 8280, 8256
                                hide_name = True
                                scale = 1, -1
                            ]

                            component Subsystem PI {
                                layout = dynamic
                                component gen_limiter Limit1 {
                                    lower_limit = "lowLim"
                                    upper_limit = "upLim"
                                }
                                [
                                    position = 8408, 8232
                                    hide_name = True
                                ]

                                component gen_gain Kp {
                                    gain = "Kp"
                                }
                                [
                                    position = 8152, 8136
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8320, 8232
                                    hide_name = True
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8088, 8232
                                    hide_name = True
                                ]

                                component gen_gain Ki {
                                    gain = "Ki"
                                }
                                [
                                    position = 8000, 8224
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8320, 8368
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_gain Kb {
                                    gain = "1.0"
                                }
                                [
                                    position = 8216, 8368
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator1 {
                                    init_value = "out0"
                                    limit_lower = "-1"
                                    limit_upper = "1"
                                    show_reset = "rising"
                                }
                                [
                                    position = 8216, 8240
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7888, 8168
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8472, 8232
                                ]

                                port reset {
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8136, 8248
                                ]

                                junction Junction2 sp
                                [
                                    position = 8368, 8232
                                ]

                                junction Junction3 sp
                                [
                                    position = 8440, 8232
                                ]

                                junction Junction4 sp
                                [
                                    position = 7920, 8168
                                ]

                                connect Sum6.in Junction2 as Connection46
                                connect Sum6.in1 Junction3 as Connection49
                                connect Sum7.out Integrator1.in as Connection52
                                connect Sum7.in1 Kb.out as Connection53
                                connect Junction2 Limit1.in as Connection45
                                connect Sum7.in Ki.out as Connection64
                                connect Junction3 Out as Connection48
                                connect reset Integrator1.reset as Connection62
                                connect Junction4 In as Connection67
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction4 as Connection66
                                connect Kp.in Junction4 as Connection68
                                connect Sum5.in1 Integrator1.out as Connection5
                                connect Kp.out Sum5.in as Connection63
                                connect Limit1.out Junction3 as Connection47
                                connect Sum5.out Junction2 as Connection44

                                Ki = "fmatch_Ki"
                                Kp = "fmatch_Kp"
                                lowLim = "[-0.166*1e5]"
                                out0 = "0.0"
                                upLim = "[0.166*1e5]"

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller</span></p></body></html>"

                                    Kp {
                                        label = "Kp"
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        group = "General"
                                    }

                                    Ki {
                                        label = "Ki"
                                        widget = edit
                                        type = generic
                                        default_value = "5.0"
                                        group = "General"
                                    }

                                    upLim {
                                        label = "Upper limit"
                                        widget = edit
                                        type = generic
                                        default_value = "100.0"
                                        group = "General"
                                    }

                                    lowLim {
                                        label = "Lower limit"
                                        widget = edit
                                        type = generic
                                        default_value = "0.0"
                                        group = "General"
                                    }

                                    out0 {
                                        label = "Integrator initial output"
                                        widget = edit
                                        type = generic
                                        default_value = "fnom"
                                        group = "General"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                        
                                    ENDCODE
                                }
                            }
                            [
                                position = 8368, 8112
                                size = 64, 64
                            ]

                            component src_constant Constant1 {
                                execution_rate = "Ts"
                                value = "1.0"
                            }
                            [
                                position = 8056, 8304
                                hide_name = True
                            ]

                            component gen_probe f_diff {
                            }
                            [
                                position = 8064, 8256
                                rotation = right
                            ]

                            component gen_logic_op "Logical operator1" {
                                operator = "NOT"
                            }
                            [
                                position = 8376, 8312
                                hide_name = True
                            ]

                            component "core/Counter" Counter1 {
                                execution_rate = "Ts"
                            }
                            [
                                position = 8464, 8264
                                hide_name = True
                                size = 48, 48
                            ]

                            component sys_signal_switch "Signal switch2" {
                                criterion = "ctrl > threshold"
                                threshold = "0.0"
                            }
                            [
                                position = 8272, 8112
                                hide_name = True
                            ]

                            component Subsystem "low pass" {
                                layout = dynamic
                                component tm_delay "Unit Delay3" {
                                }
                                [
                                    position = 8336, 8128
                                    rotation = right
                                    hide_name = True
                                ]

                                component gen_sum Sum1 {
                                }
                                [
                                    position = 8232, 8064
                                    hide_name = True
                                ]

                                component gen_gain a2 {
                                    gain = "a[1]"
                                }
                                [
                                    position = 8280, 8336
                                    scale = -1, 1
                                ]

                                component gen_gain b2 {
                                    gain = "b[2]"
                                }
                                [
                                    position = 8112, 8336
                                ]

                                component gen_gain b1 {
                                    gain = "b[1]"
                                }
                                [
                                    position = 8120, 8184
                                ]

                                component tm_delay "Unit Delay1" {
                                }
                                [
                                    position = 8048, 8120
                                    rotation = right
                                    hide_name = True
                                ]

                                component gen_gain a1 {
                                    gain = "a[0]"
                                }
                                [
                                    position = 8280, 8184
                                    scale = -1, 1
                                ]

                                component gen_sum Sum2 {
                                    signs = "++-"
                                }
                                [
                                    position = 8192, 8152
                                    rotation = left
                                    hide_name = True
                                ]

                                component tm_delay "Unit Delay4" {
                                }
                                [
                                    position = 8336, 8264
                                    rotation = right
                                    hide_name = True
                                ]

                                component gen_gain b0 {
                                    gain = "b[0]"
                                }
                                [
                                    position = 8120, 8056
                                ]

                                component tm_delay "Unit Delay2" {
                                }
                                [
                                    position = 8048, 8264
                                    rotation = right
                                    hide_name = True
                                ]

                                component gen_sum Sum3 {
                                    signs = "+-"
                                }
                                [
                                    position = 8192, 8296
                                    rotation = left
                                    hide_name = True
                                ]

                                port In {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8000, 8080
                                ]

                                port Out {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8384, 8064
                                ]

                                junction Junction1 sp
                                [
                                    position = 8048, 8080
                                ]

                                junction Junction2 sp
                                [
                                    position = 8336, 8176
                                ]

                                junction Junction3 sp
                                [
                                    position = 8048, 8184
                                ]

                                junction Junction4 sp
                                [
                                    position = 8336, 8064
                                ]

                                connect Junction3 "Unit Delay2.in" as Connection625
                                connect b0.in Junction1 as Connection633
                                connect Junction4 Out as Connection642
                                connect b1.in Junction3 as Connection635
                                connect Junction4 "Unit Delay3.in" as Connection630
                                connect b2.out Sum3.in as Connection636
                                connect Sum1.out Junction4 as Connection629
                                connect Sum1.in b0.out as Connection632
                                connect b2.in "Unit Delay2.out" as Connection637
                                connect Sum2.out Sum1.in1 as Connection617
                                connect Sum2.in2 a1.out as Connection640
                                connect Sum2.in b1.out as Connection634
                                connect Sum3.out Sum2.in1 as Connection620
                                connect "Unit Delay1.out" Junction3 as Connection624
                                connect "Unit Delay3.out" Junction2 as Connection621
                                connect a1.in Junction2 as Connection641
                                connect Junction1 In as Connection643
                                connect a2.out Sum3.in1 as Connection638
                                connect Junction1 "Unit Delay1.in" as Connection615
                                connect Junction2 "Unit Delay4.in" as Connection622
                                connect a2.in "Unit Delay4.out" as Connection639

                                a = "alowpass"
                                b = "blowpass"

                                mask {
                                    description = "Digital biquad filter
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Direct form 1"

                                    b {
                                        label = "b"
                                        widget = edit
                                        type = generic
                                        default_value = "bnotch"
                                    }

                                    a {
                                        label = "a"
                                        widget = edit
                                        type = generic
                                        default_value = "anotch"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                        
                                    ENDCODE
                                }
                            }
                            [
                                position = 8008, 8192
                                size = 48, 48
                            ]

                            component src_constant Constant3 {
                                execution_rate = "Ts"
                                value = "0.0"
                            }
                            [
                                position = 8208, 8128
                                hide_name = True
                                scale = 1, -1
                            ]

                            component gen_gain Freq_diff1 {
                                gain = "0.02"
                            }
                            [
                                position = 8216, 8376
                                hide_name = True
                                scale = -1, 1
                            ]

                            component tm_delay "Unit Delay1" {
                            }
                            [
                                position = 8296, 8376
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_c_function c_function {
                                in_terminal_dimensions = "inherit"
                                in_terminal_dimensions_str = "counter inherit"
                                in_terminal_labels = "False;"
                                in_terminal_properties = "real counter;"
                                no_feed_inputs = "[\'\']"
                                no_feed_outputs = "[\'\']"
                                out_terminal_dimensions = "inherit"
                                out_terminal_dimensions_str = "out inherit"
                                out_terminal_labels = "False;"
                                output_fnc = "/*Begin code section*/
if(counter>=0.1/execution_rate){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                            }
                            [
                                position = 8552, 8264
                                size = 48, 48
                            ]

                            port sync {
                                label = "sync"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8224, 8032
                                scale = 1, -1
                            ]

                            port "freq lock" {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8792, 8264
                            ]

                            port delta_f {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8528, 8112
                            ]

                            port f_Util {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7776, 8184
                            ]

                            port f_Inv {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7816, 8232
                            ]

                            junction Junction2 sp
                            [
                                position = 8328, 8256
                            ]

                            junction Junction32 sp
                            [
                                position = 8120, 8192
                            ]

                            junction Junction51 sp
                            [
                                position = 8272, 8032
                            ]

                            junction Junction52 sp
                            [
                                position = 8064, 8192
                            ]

                            junction Junction53 sp
                            [
                                position = 8640, 8264
                            ]

                            connect Freq_diff.out Sum2.in as Connection181
                            connect "Unit Delay1.out" Freq_diff1.in as Connection180
                            connect Freq_diff1.out Sum2.in1 as Connection183
                            connect c_function.counter Counter1.out as Connection788
                            connect Junction32 Junction52 as Connection784
                            connect c_function.out Junction53 as Connection791
                            connect Junction32 "Signal switch2.in" as Connection782
                            [
                                position = 0, 0
                            ]
                            connect f_diff.in Junction52 as Connection786
                            connect Junction52 "low pass.Out" as Connection785
                            connect "low pass.In" Sum1.out as Connection781
                            connect Junction53 "Unit Delay1.in" as Connection790
                            connect sync Junction51 as Connection775
                            connect "Logical operator1.out" Counter1.reset as Connection88
                            connect "Logical operator1.in" Junction2 as Connection65
                            connect Delay1.out "freq lock" as Connection774
                            connect PI.reset Junction51 as Connection777
                            connect PI.In "Signal switch2.out" as Connection746
                            connect Abs3.in Junction32 as Connection694
                            connect PI.Out delta_f as Connection783
                            [
                                position = 0, 0
                            ]
                            connect Comparator1.in2 Abs3.out as Connection778
                            connect Comparator1.out Junction2 as Connection670
                            connect "Signal switch2.in2" Junction51 as Connection780
                            connect Constant1.out Freq_diff.in as Connection14
                            connect Sum1.in1 f_Inv as Connection60
                            connect Constant3.out "Signal switch2.in1" as Connection651
                            connect Counter1.en Junction2 as Connection674
                            connect Sum1.in f_Util as Connection57
                            connect Delay1.in Junction53 as Connection789
                            connect Sum2.out Comparator1.in1 as Connection182
                        }
                        [
                            position = 7864, 8440
                            size = 136, 88
                        ]

                        component Subsystem Vmatch {
                            layout = dynamic
                            component gen_logic_op "Logical operator1" {
                                operator = "NOT"
                            }
                            [
                                position = 8104, 8384
                                hide_name = True
                            ]

                            component Subsystem PI {
                                layout = dynamic
                                component gen_gain Kp {
                                    gain = "Kp"
                                }
                                [
                                    position = 8136, 8128
                                ]

                                component gen_integrator Integrator1 {
                                    init_value = "out0"
                                    limit_lower = "-1"
                                    limit_upper = "1"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8232
                                ]

                                component gen_gain Kb {
                                    gain = "1.0"
                                }
                                [
                                    position = 8216, 8312
                                    scale = -1, 1
                                ]

                                component gen_gain Ki {
                                    gain = "Ki"
                                }
                                [
                                    position = 7984, 8216
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8088, 8224
                                    hide_name = True
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8320, 8224
                                    hide_name = True
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "lowLim"
                                    upper_limit = "upLim"
                                }
                                [
                                    position = 8408, 8224
                                    hide_name = True
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8320, 8312
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7888, 8168
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8472, 8224
                                ]

                                port reset {
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8136, 8256
                                ]

                                junction Junction2 sp
                                [
                                    position = 8368, 8224
                                ]

                                junction Junction3 sp
                                [
                                    position = 8440, 8224
                                ]

                                junction Junction4 sp
                                [
                                    position = 7920, 8168
                                ]

                                connect Junction2 Limit1.in as Connection45
                                connect Sum7.in Ki.out as Connection64
                                connect Junction3 Out as Connection48
                                connect reset Integrator1.reset as Connection62
                                connect Junction4 In as Connection67
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction4 as Connection66
                                connect Kp.in Junction4 as Connection68
                                connect Kp.out Sum5.in as Connection63
                                connect Limit1.out Junction3 as Connection47
                                connect Sum5.in1 Integrator1.out as Connection5
                                connect Sum5.out Junction2 as Connection44
                                connect Sum6.in Junction2 as Connection46
                                connect Sum7.out Integrator1.in as Connection52
                                connect Sum6.in1 Junction3 as Connection49
                                connect Sum7.in1 Kb.out as Connection53

                                Ki = "Vmatch_Ki"
                                Kp = "Vmatch_Kp"
                                lowLim = "[-0.147*1e5]"
                                out0 = "0.0"
                                upLim = "[0.147*1e5]"

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller</span></p></body></html>"

                                    Kp {
                                        label = "Kp"
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        group = "General"
                                    }

                                    Ki {
                                        label = "Ki"
                                        widget = edit
                                        type = generic
                                        default_value = "5.0"
                                        group = "General"
                                    }

                                    upLim {
                                        label = "Upper limit"
                                        widget = edit
                                        type = generic
                                        default_value = "100.0"
                                        group = "General"
                                    }

                                    lowLim {
                                        label = "Lower limit"
                                        widget = edit
                                        type = generic
                                        default_value = "0.0"
                                        group = "General"
                                    }

                                    out0 {
                                        label = "Integrator initial output"
                                        widget = edit
                                        type = generic
                                        default_value = "fnom"
                                        group = "General"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                        
                                    ENDCODE
                                }
                            }
                            [
                                position = 8088, 8160
                                size = 64, 48
                            ]

                            component tm_delay "Unit Delay4" {
                            }
                            [
                                position = 8360, 8376
                                hide_name = True
                            ]

                            component tm_delay "Unit Delay3" {
                            }
                            [
                                position = 8008, 8408
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_abs Abs2 {
                            }
                            [
                                position = 7856, 8272
                                rotation = right
                                hide_name = True
                            ]

                            component gen_gain Phase_diff {
                                gain = "V_diff/100.0"
                            }
                            [
                                position = 7784, 8344
                                hide_name = True
                            ]

                            component src_constant Constant2 {
                                execution_rate = "Ts"
                                value = "1.0"
                            }
                            [
                                position = 7720, 8344
                                hide_name = True
                            ]

                            component "core/Counter" Counter1 {
                                execution_rate = "Ts"
                            }
                            [
                                position = 8192, 8376
                                hide_name = True
                                size = 48, 48
                            ]

                            component gen_sum Sum2 {
                            }
                            [
                                position = 7864, 8352
                                hide_name = True
                            ]

                            component tm_delay "Unit Delay5" {
                            }
                            [
                                position = 8248, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum10 {
                                signs = "+-"
                            }
                            [
                                position = 7792, 8144
                                hide_name = True
                            ]

                            component sys_signal_switch "Signal switch2" {
                                criterion = "ctrl > threshold"
                                threshold = "0.0"
                            }
                            [
                                position = 7976, 8160
                                hide_name = True
                            ]

                            component src_constant Constant3 {
                                execution_rate = "Ts"
                                value = "0.0"
                            }
                            [
                                position = 7912, 8176
                                hide_name = True
                                scale = 1, -1
                            ]

                            component gen_c_function c_function {
                                in_terminal_dimensions = "inherit"
                                in_terminal_dimensions_str = "counter inherit"
                                in_terminal_labels = "False;"
                                in_terminal_properties = "real counter;"
                                no_feed_inputs = "[\'\']"
                                no_feed_outputs = "[\'\']"
                                out_terminal_dimensions = "inherit"
                                out_terminal_dimensions_str = "out inherit"
                                out_terminal_labels = "False;"
                                output_fnc = "/*Begin code section*/
if(counter>=0.1/execution_rate){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                            }
                            [
                                position = 8280, 8376
                                size = 48, 48
                            ]

                            component gen_gain Phase_diff1 {
                                gain = "0.01*V_diff/100.0"
                            }
                            [
                                position = 7928, 8408
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_comparator Comparator2 {
                            }
                            [
                                position = 8008, 8320
                                hide_name = True
                                scale = 1, -1
                            ]

                            port Vt_Inv {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7648, 8152
                            ]

                            port V_match {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8424, 8376
                            ]

                            port Sync_Ess {
                                position = top:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7920, 8088
                            ]

                            port delta_V {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8424, 8160
                            ]

                            port Vt_Util {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7568, 8136
                            ]

                            junction Junction43 sp
                            [
                                position = 8056, 8320
                            ]

                            junction Junction51 sp
                            [
                                position = 8040, 8320
                            ]

                            junction Junction295 sp
                            [
                                position = 7976, 8088
                            ]

                            junction Junction298 sp
                            [
                                position = 7856, 8144
                            ]

                            connect "Unit Delay3.in" Junction51 as Connection541
                            connect Junction51 Junction43 as Connection540
                            connect "Unit Delay3.out" Phase_diff1.in as Connection544
                            connect "Logical operator1.out" Counter1.reset as Connection88
                            connect "Unit Delay4.out" V_match as Connection845
                            connect "Logical operator1.in" Junction43 as Connection453
                            connect PI.reset Junction295 as Connection1989
                            connect Vt_Util Sum10.in as Connection2001
                            [
                                position = 0, 0
                                breakpoints = 7624, 8136
                            ]
                            connect PI.Out "Unit Delay5.in" as Connection1999
                            [
                                position = 0, 0
                            ]
                            connect c_function.counter Counter1.out as Connection2002
                            connect Phase_diff.out Sum2.in as Connection542
                            connect c_function.out "Unit Delay4.in" as Connection2003
                            connect delta_V "Unit Delay5.out" as Connection1992
                            connect Phase_diff1.out Sum2.in1 as Connection545
                            connect "Signal switch2.in2" Junction295 as Connection1984
                            connect Abs2.in Junction298 as Connection1997
                            connect "Signal switch2.out" PI.In as Connection1998
                            [
                                position = 0, 0
                            ]
                            connect Comparator2.in2 Abs2.out as Connection12
                            connect Sum10.out Junction298 as Connection1995
                            connect Sync_Ess Junction295 as Connection1982
                            connect Comparator2.out Junction51 as Connection539
                            connect Sum10.in1 Vt_Inv as Connection2000
                            [
                                position = 0, 0
                                breakpoints = 7736, 8152
                            ]
                            connect Constant2.out Phase_diff.in as Connection15
                            connect Constant3.out "Signal switch2.in1" as Connection651
                            connect Junction298 "Signal switch2.in" as Connection1996
                            connect Sum2.out Comparator2.in1 as Connection543
                            connect Junction43 Counter1.en as Connection454
                        }
                        [
                            position = 8152, 8232
                            size = 120, 104
                        ]

                        component gen_digital_probe on_nominal {
                        }
                        [
                            position = 8248, 8784
                            rotation = left
                        ]

                        component Subsystem Check_nominal_conditions {
                            layout = dynamic
                            component gen_digital_probe V_out_nom {
                            }
                            [
                                position = 8352, 8280
                            ]

                            component gen_abs Abs2 {
                            }
                            [
                                position = 8104, 8272
                                hide_name = True
                            ]

                            component gen_digital_probe f_out_nom {
                            }
                            [
                                position = 8344, 8128
                            ]

                            component gen_abs Abs1 {
                            }
                            [
                                position = 8064, 8120
                                hide_name = True
                            ]

                            component src_constant "+-1,5 hz" {
                                execution_rate = "Ts"
                                value = "10.0/fn"
                            }
                            [
                                position = 8120, 8144
                                hide_name = True
                            ]

                            component gen_c_function wait_to_change {
                                global_variables = "real wait_time;real counter;"
                                in_terminal_dimensions = "inherit;inherit"
                                in_terminal_dimensions_str = "in inherit;reset inherit"
                                in_terminal_labels = "False;False;"
                                in_terminal_properties = "inherit in;inherit reset;"
                                init_fnc = "/*Begin code section*/
out = 0;
counter = 0;
wait_time = 0.01;
/*End code section*/"
                                no_feed_inputs = "[u\'\']"
                                no_feed_outputs = "[u\'\']"
                                out_terminal_dimensions = "inherit"
                                out_terminal_dimensions_str = "out inherit"
                                out_terminal_labels = "False;"
                                output_fnc = "/*Begin code section*/
if(in <= 0){
    counter = 0;
    out = 0;
}
else{
    if(counter >= wait_time){
        out = 1;
    }
    else{
        out = 0;
        counter += execution_rate*in;
    }
}

if(reset == 1){
    counter = 0;
    out = 0;
}
/*End code section*/"
                            }
                            [
                                position = 8600, 8216
                                size = 48, 48
                            ]

                            component gen_comparator Comparator1 {
                            }
                            [
                                position = 8192, 8128
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "+-"
                            }
                            [
                                position = 8024, 8272
                                hide_name = True
                            ]

                            component "core/Edge Detection" "Edge Detection1" {
                            }
                            [
                                position = 8520, 8240
                                hide_name = True
                                size = 32, 32
                            ]

                            component gen_logic_op "Logical operator1" {
                                operator = "OR"
                            }
                            [
                                position = 8320, 8208
                                hide_name = True
                            ]

                            component gen_sum Sum4 {
                                signs = "+-"
                            }
                            [
                                position = 7984, 8120
                                hide_name = True
                            ]

                            component gen_comparator Comparator2 {
                            }
                            [
                                position = 8200, 8280
                                hide_name = True
                            ]

                            component gen_abs Abs3 {
                            }
                            [
                                position = 7888, 8112
                                hide_name = True
                            ]

                            component src_constant "+-10%" {
                                execution_rate = "Ts"
                                value = "0.1"
                            }
                            [
                                position = 8112, 8320
                                hide_name = True
                            ]

                            component gen_logic_op "Logical operator15" {
                                operator = "NOT"
                            }
                            [
                                position = 8424, 8208
                                hide_name = True
                            ]

                            component src_constant "nominal frequency" {
                                execution_rate = "Ts"
                                value = "1.0"
                            }
                            [
                                position = 7888, 8152
                                hide_name = True
                            ]

                            component src_constant "nominal voltage" {
                                execution_rate = "Ts"
                                value = "1.0"
                            }
                            [
                                position = 7944, 8304
                                hide_name = True
                            ]

                            port freq {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7792, 8112
                            ]

                            port Vt {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7792, 8264
                            ]

                            port on_nominal {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8688, 8216
                            ]

                            junction Junction1507 sp
                            [
                                position = 8256, 8128
                            ]

                            junction Junction1508 sp
                            [
                                position = 8256, 8280
                            ]

                            junction Junction1509 sp
                            [
                                position = 8480, 8208
                            ]

                            connect Comparator2.out Junction1508 as Connection552
                            connect "Edge Detection1.Out1" wait_to_change.reset as Connection831
                            connect Junction1507 "Logical operator1.in" as Connection550
                            connect Junction1508 "Logical operator1.in1" as Connection553
                            connect Junction1509 "Edge Detection1.In1" as Connection838
                            connect "Logical operator15.out" Junction1509 as Connection844
                            [
                                position = 0, 0
                            ]
                            connect wait_to_change.out on_nominal as Connection840
                            connect "Logical operator15.in" "Logical operator1.out" as Connection836
                            connect "+-1,5 hz.out" Comparator1.in2 as Connection540
                            connect Sum5.out Abs2.in as Connection541
                            connect "+-10%.out" Comparator2.in2 as Connection544
                            connect Sum5.in Vt as Connection825
                            connect Abs1.out Comparator1.in1 as Connection539
                            connect Abs1.in Sum4.out as Connection828
                            connect V_out_nom.in Junction1508 as Connection554
                            connect Comparator1.out Junction1507 as Connection549
                            connect Abs2.out Comparator2.in1 as Connection543
                            connect f_out_nom.in Junction1507 as Connection551
                            connect Abs3.out Sum4.in as Connection574
                            connect "nominal frequency.out" Sum4.in1 as Connection534
                            connect "nominal voltage.out" Sum5.in1 as Connection542
                            connect Abs3.in freq as Connection827
                            connect wait_to_change.in Junction1509 as Connection837
                        }
                        [
                            position = 8136, 8832
                            size = 104, 64
                        ]

                        component gen_digital_probe phase_lock {
                        }
                        [
                            position = 8256, 8512
                            rotation = left
                        ]

                        component gen_probe dfsynch {
                        }
                        [
                            position = 8256, 8360
                            rotation = left
                        ]

                        component gen_digital_probe freq_lock {
                        }
                        [
                            position = 7952, 8344
                            rotation = left
                        ]

                        component Subsystem phase_match {
                            layout = dynamic
                            component src_constant Constant4 {
                                execution_rate = "Ts"
                                value = "0"
                            }
                            [
                                position = 8536, 8240
                                hide_name = True
                            ]

                            component Subsystem PI {
                                layout = dynamic
                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8088, 8224
                                    hide_name = True
                                ]

                                component gen_integrator Integrator1 {
                                    init_value = "out0"
                                    limit_lower = "-1"
                                    limit_upper = "1"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8232
                                ]

                                component gen_gain Ki {
                                    gain = "Ki"
                                }
                                [
                                    position = 7992, 8216
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "lowLim"
                                    upper_limit = "upLim"
                                }
                                [
                                    position = 8408, 8224
                                    hide_name = True
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8320, 8224
                                    hide_name = True
                                ]

                                component gen_gain Kb {
                                    gain = "1.0"
                                }
                                [
                                    position = 8216, 8312
                                    scale = -1, 1
                                ]

                                component gen_gain Kp {
                                    gain = "Kp"
                                }
                                [
                                    position = 8144, 8128
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8320, 8312
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7888, 8168
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8472, 8224
                                ]

                                port reset {
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8136, 8256
                                ]

                                junction Junction2 sp
                                [
                                    position = 8368, 8224
                                ]

                                junction Junction3 sp
                                [
                                    position = 8440, 8224
                                ]

                                junction Junction4 sp
                                [
                                    position = 7920, 8168
                                ]

                                connect Junction4 In as Connection67
                                connect reset Integrator1.reset as Connection62
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction4 as Connection66
                                connect Kp.in Junction4 as Connection68
                                connect Kp.out Sum5.in as Connection63
                                connect Limit1.out Junction3 as Connection47
                                connect Sum5.in1 Integrator1.out as Connection5
                                connect Sum5.out Junction2 as Connection44
                                connect Sum6.in Junction2 as Connection46
                                connect Sum6.in1 Junction3 as Connection49
                                connect Sum7.out Integrator1.in as Connection52
                                connect Sum7.in1 Kb.out as Connection53
                                connect Junction2 Limit1.in as Connection45
                                connect Sum7.in Ki.out as Connection64
                                connect Junction3 Out as Connection48

                                Ki = "Phase_Ki"
                                Kp = "Phase_Kp"
                                lowLim = "-1e5"
                                out0 = "0.0"
                                upLim = "1e5"

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller</span></p></body></html>"

                                    Kp {
                                        label = "Kp"
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        group = "General"
                                    }

                                    Ki {
                                        label = "Ki"
                                        widget = edit
                                        type = generic
                                        default_value = "5.0"
                                        group = "General"
                                    }

                                    upLim {
                                        label = "Upper limit"
                                        widget = edit
                                        type = generic
                                        default_value = "100.0"
                                        group = "General"
                                    }

                                    lowLim {
                                        label = "Lower limit"
                                        widget = edit
                                        type = generic
                                        default_value = "0.0"
                                        group = "General"
                                    }

                                    out0 {
                                        label = "Integrator initial output"
                                        widget = edit
                                        type = generic
                                        default_value = "fnom"
                                        group = "General"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                        
                                    ENDCODE
                                }
                            }
                            [
                                position = 8104, 8224
                                size = 64, 48
                            ]

                            component gen_rate_limiter "3 hz per sec" {
                                falling_limit = "-1e5/fn"
                                rising_limit = "1e5/fn"
                            }
                            [
                                position = 8712, 8224
                            ]

                            component gen_gain Phase_diff {
                                gain = "Phase_diff*np.pi/180.0"
                            }
                            [
                                position = 7904, 8360
                                hide_name = True
                            ]

                            component gen_gain Phase_diff1 {
                                gain = "0.01*Phase_diff*np.pi/180.0"
                            }
                            [
                                position = 8048, 8424
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_sum Sum1 {
                                signs = "++"
                            }
                            [
                                position = 8432, 8208
                                hide_name = True
                            ]

                            component gen_abs Abs2 {
                            }
                            [
                                position = 7976, 8288
                                rotation = right
                                hide_name = True
                            ]

                            component Subsystem "low pass" {
                                layout = dynamic
                                component gen_sum Sum1 {
                                }
                                [
                                    position = 8232, 8064
                                    hide_name = True
                                ]

                                component gen_gain a2 {
                                    gain = "a[1]"
                                }
                                [
                                    position = 8280, 8336
                                    scale = -1, 1
                                ]

                                component tm_delay "Unit Delay3" {
                                }
                                [
                                    position = 8336, 8128
                                    rotation = right
                                    hide_name = True
                                ]

                                component tm_delay "Unit Delay4" {
                                }
                                [
                                    position = 8336, 8264
                                    rotation = right
                                    hide_name = True
                                ]

                                component gen_gain b0 {
                                    gain = "b[0]"
                                }
                                [
                                    position = 8120, 8056
                                ]

                                component gen_gain b2 {
                                    gain = "b[2]"
                                }
                                [
                                    position = 8112, 8336
                                ]

                                component gen_gain b1 {
                                    gain = "b[1]"
                                }
                                [
                                    position = 8120, 8184
                                ]

                                component tm_delay "Unit Delay2" {
                                }
                                [
                                    position = 8048, 8264
                                    rotation = right
                                    hide_name = True
                                ]

                                component gen_sum Sum2 {
                                    signs = "++-"
                                }
                                [
                                    position = 8192, 8152
                                    rotation = left
                                    hide_name = True
                                ]

                                component tm_delay "Unit Delay1" {
                                }
                                [
                                    position = 8048, 8120
                                    rotation = right
                                    hide_name = True
                                ]

                                component gen_sum Sum3 {
                                    signs = "+-"
                                }
                                [
                                    position = 8192, 8296
                                    rotation = left
                                    hide_name = True
                                ]

                                component gen_gain a1 {
                                    gain = "a[0]"
                                }
                                [
                                    position = 8280, 8184
                                    scale = -1, 1
                                ]

                                port In {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8000, 8080
                                ]

                                port Out {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8384, 8064
                                ]

                                junction Junction1 sp
                                [
                                    position = 8048, 8080
                                ]

                                junction Junction2 sp
                                [
                                    position = 8336, 8176
                                ]

                                junction Junction3 sp
                                [
                                    position = 8048, 8184
                                ]

                                junction Junction4 sp
                                [
                                    position = 8336, 8064
                                ]

                                connect Sum2.in b1.out as Connection634
                                connect Sum3.out Sum2.in1 as Connection620
                                connect "Unit Delay1.out" Junction3 as Connection624
                                connect "Unit Delay3.out" Junction2 as Connection621
                                connect a1.in Junction2 as Connection641
                                connect Junction1 In as Connection643
                                connect Sum2.in2 a1.out as Connection640
                                connect a2.out Sum3.in1 as Connection638
                                connect Junction1 "Unit Delay1.in" as Connection615
                                connect Junction2 "Unit Delay4.in" as Connection622
                                connect a2.in "Unit Delay4.out" as Connection639
                                connect Junction3 "Unit Delay2.in" as Connection625
                                connect b0.in Junction1 as Connection633
                                connect Junction4 Out as Connection642
                                connect Junction4 "Unit Delay3.in" as Connection630
                                connect b1.in Junction3 as Connection635
                                connect Sum1.out Junction4 as Connection629
                                connect b2.out Sum3.in as Connection636
                                connect Sum1.in b0.out as Connection632
                                connect b2.in "Unit Delay2.out" as Connection637
                                connect Sum2.out Sum1.in1 as Connection617

                                a = "alowpass"
                                b = "blowpass"

                                mask {
                                    description = "Digital biquad filter
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Direct form 1"

                                    b {
                                        label = "b"
                                        widget = edit
                                        type = generic
                                        default_value = "bnotch"
                                    }

                                    a {
                                        label = "a"
                                        widget = edit
                                        type = generic
                                        default_value = "anotch"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                        
                                    ENDCODE
                                }
                            }
                            [
                                position = 7768, 8224
                                size = 48, 48
                            ]

                            component gen_probe phase_diff {
                            }
                            [
                                position = 7904, 8272
                                rotation = right
                            ]

                            component tm_delay "Unit Delay3" {
                            }
                            [
                                position = 8128, 8424
                                hide_name = True
                                scale = -1, 1
                            ]

                            component sys_signal_switch "Signal switch2" {
                                criterion = "ctrl > threshold"
                                threshold = "0.5"
                            }
                            [
                                position = 8608, 8224
                                hide_name = True
                            ]

                            component "core/Counter" Counter1 {
                                execution_rate = "Ts"
                            }
                            [
                                position = 8312, 8392
                                hide_name = True
                                size = 48, 48
                            ]

                            component tm_delay "Unit Delay4" {
                            }
                            [
                                position = 8488, 8392
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "+-"
                            }
                            [
                                position = 7536, 8224
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                            }
                            [
                                position = 7984, 8368
                                hide_name = True
                            ]

                            component gen_gain Gain12 {
                                gain = "1.0/fn"
                            }
                            [
                                position = 8304, 8216
                                hide_name = True
                            ]

                            component gen_c_function c_function {
                                in_terminal_dimensions = "inherit"
                                in_terminal_dimensions_str = "counter inherit"
                                in_terminal_labels = "False;"
                                in_terminal_properties = "real counter;"
                                no_feed_inputs = "[\'\']"
                                no_feed_outputs = "[\'\']"
                                out_terminal_dimensions = "inherit"
                                out_terminal_dimensions_str = "out inherit"
                                out_terminal_labels = "False;"
                                output_fnc = "/*Begin code section*/
if(counter>=0.1/execution_rate){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                            }
                            [
                                position = 8400, 8392
                                size = 48, 48
                            ]

                            component src_constant Constant2 {
                                execution_rate = "Ts"
                                value = "1.0"
                            }
                            [
                                position = 7840, 8360
                                hide_name = True
                            ]

                            component gen_comparator Comparator2 {
                            }
                            [
                                position = 8128, 8336
                                hide_name = True
                                scale = 1, -1
                            ]

                            component tm_delay "Unit Delay5" {
                            }
                            [
                                position = 8792, 8224
                                hide_name = True
                            ]

                            component gen_c_function confine_phase {
                                in_terminal_dimensions = "inherit"
                                in_terminal_dimensions_str = "dtheta inherit"
                                in_terminal_labels = "False;"
                                in_terminal_properties = "real dtheta;"
                                init_fnc = "/*Begin code section*/
dtheta = 0;
dtheta_confined = 0;
/*End code section*/"
                                no_feed_inputs = "[u\'\']"
                                no_feed_outputs = "[u\'\']"
                                out_terminal_dimensions = "inherit"
                                out_terminal_dimensions_str = "dtheta_confined inherit"
                                out_terminal_labels = "False;"
                                out_terminal_properties = "real dtheta_confined;"
                                output_fnc = "/*Begin code section*/
if (dtheta > 3.14159265359) {//confine theta to +/- 2*pi;
    dtheta_confined = dtheta - 6.28318530718;
}
else{
    if (dtheta < -3.14159265359){
        dtheta_confined = dtheta + 6.28318530718;
    }
    else{
        dtheta_confined = dtheta;
    }
}
/*End code section*/"
                            }
                            [
                                position = 7656, 8224
                                size = 48, 48
                            ]

                            component gen_logic_op "Logical operator1" {
                                operator = "NOT"
                            }
                            [
                                position = 8224, 8400
                                hide_name = True
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 8224, 8216
                                hide_name = True
                            ]

                            port phase_util {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7400, 8216
                            ]

                            port phase_inv {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7424, 8272
                            ]

                            port sync {
                                label = "sync"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8608, 8136
                                rotation = left
                                scale = 1, -1
                            ]

                            port df_synch {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8864, 8224
                            ]

                            port phase_lock {
                                label = "Phase match"
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8552, 8392
                            ]

                            port freq_lock {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8008, 8176
                            ]

                            port f_offset {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8344, 8168
                            ]

                            junction Junction51 sp
                            [
                                position = 8160, 8336
                            ]

                            junction Junction54 sp
                            [
                                position = 7976, 8224
                            ]

                            junction Junction55 sp
                            [
                                position = 8104, 8176
                            ]

                            junction Junction61 sp
                            [
                                position = 7904, 8224
                            ]

                            junction Junction43 sp
                            [
                                position = 8176, 8336
                            ]

                            connect "Logical operator1.in" Junction43 as Connection453
                            connect c_function.counter Counter1.out as Connection2095
                            connect PI.In Junction54 as Connection573
                            connect c_function.out "Unit Delay4.in" as Connection2096
                            connect confine_phase.dtheta Sum3.out as Connection2092
                            [
                                position = 0, 0
                            ]
                            connect PI.reset Junction55 as Connection576
                            connect confine_phase.dtheta_confined "low pass.In" as Connection2091
                            [
                                position = 0, 0
                            ]
                            connect Phase_diff.out Sum2.in as Connection542
                            connect f_offset Sum1.in as Connection537
                            connect Phase_diff1.out Sum2.in1 as Connection545
                            connect freq_lock Junction55 as Connection2090
                            connect Product1.in Junction55 as Connection574
                            connect "3 hz per sec.out" "Unit Delay5.in" as Connection1876
                            connect "low pass.Out" Junction61 as Connection843
                            connect Product1.in1 PI.Out as Connection577
                            connect Abs2.in Junction54 as Connection571
                            connect phase_util Sum3.in as Connection839
                            connect Comparator2.in2 Abs2.out as Connection12
                            connect "Signal switch2.out" "3 hz per sec.in" as Connection2083
                            connect sync "Signal switch2.in2" as Connection2089
                            connect "Signal switch2.in1" Constant4.out as Connection2082
                            connect Comparator2.out Junction51 as Connection539
                            connect "Signal switch2.in" Sum1.out as Connection2094
                            [
                                position = 0, 0
                            ]
                            connect Constant2.out Phase_diff.in as Connection15
                            connect Sum1.in1 Gain12.out as Connection2093
                            [
                                position = 0, 0
                            ]
                            connect Gain12.in Product1.out as Connection583
                            connect Junction43 Counter1.en as Connection454
                            connect Sum2.out Comparator2.in1 as Connection543
                            connect Junction51 Junction43 as Connection540
                            connect Sum3.in1 phase_inv as Connection840
                            connect "Unit Delay3.in" Junction51 as Connection541
                            connect Junction54 Junction61 as Connection841
                            connect Junction61 phase_diff.in as Connection842
                            connect "Unit Delay3.out" Phase_diff1.in as Connection544
                            connect "Unit Delay4.out" phase_lock as Connection845
                            connect "Logical operator1.out" Counter1.reset as Connection88
                            connect "Unit Delay5.out" df_synch as Connection2085
                        }
                        [
                            position = 8128, 8488
                            size = 176, 184
                        ]

                        component Subsystem Check_grid {
                            layout = dynamic
                            component src_constant "nominal voltage" {
                                execution_rate = "Ts"
                                value = "1.0"
                            }
                            [
                                position = 7944, 8304
                                hide_name = True
                            ]

                            component gen_abs Abs3 {
                            }
                            [
                                position = 7888, 8112
                                hide_name = True
                            ]

                            component gen_logic_op "Logical operator1" {
                                operator = "OR"
                            }
                            [
                                position = 8320, 8208
                                hide_name = True
                            ]

                            component gen_sum Sum4 {
                                signs = "+-"
                            }
                            [
                                position = 7984, 8120
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "+-"
                            }
                            [
                                position = 8024, 8272
                                hide_name = True
                            ]

                            component src_constant "nominal frequency" {
                                execution_rate = "Ts"
                                value = "1.0"
                            }
                            [
                                position = 7888, 8152
                                hide_name = True
                            ]

                            component gen_comparator Comparator1 {
                            }
                            [
                                position = 8192, 8128
                                hide_name = True
                            ]

                            component src_constant "+-10%" {
                                execution_rate = "Ts"
                                value = "0.1"
                            }
                            [
                                position = 8112, 8320
                                hide_name = True
                            ]

                            component gen_digital_probe "out of limit volts" {
                            }
                            [
                                position = 8352, 8280
                            ]

                            component src_constant "+-1,5 hz" {
                                execution_rate = "Ts"
                                value = "10.0/fn"
                            }
                            [
                                position = 8120, 8144
                                hide_name = True
                            ]

                            component gen_logic_op "Logical operator15" {
                                operator = "NOT"
                            }
                            [
                                position = 8440, 8208
                                hide_name = True
                            ]

                            component gen_comparator Comparator2 {
                            }
                            [
                                position = 8200, 8280
                                hide_name = True
                            ]

                            component gen_abs Abs1 {
                            }
                            [
                                position = 8064, 8120
                                hide_name = True
                            ]

                            component gen_abs Abs2 {
                            }
                            [
                                position = 8104, 8272
                                hide_name = True
                            ]

                            component gen_digital_probe "out of limit freq" {
                            }
                            [
                                position = 8344, 8128
                            ]

                            port freq {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7792, 8112
                            ]

                            port Vt {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7792, 8264
                            ]

                            port live_grid {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8544, 8208
                            ]

                            junction Junction1507 sp
                            [
                                position = 8256, 8128
                            ]

                            junction Junction1508 sp
                            [
                                position = 8256, 8280
                            ]

                            connect "out of limit freq.in" Junction1507 as Connection551
                            connect Comparator1.out Junction1507 as Connection549
                            connect "out of limit volts.in" Junction1508 as Connection554
                            connect Abs3.out Sum4.in as Connection574
                            connect Comparator2.out Junction1508 as Connection552
                            connect Junction1507 "Logical operator1.in" as Connection550
                            connect Junction1508 "Logical operator1.in1" as Connection553
                            connect "Logical operator1.out" "Logical operator15.in" as Connection823
                            connect "Logical operator15.out" live_grid as Connection824
                            connect Sum4.out Abs1.in as Connection827
                            [
                                position = 0, 0
                            ]
                            connect Sum5.out Abs2.in as Connection541
                            connect Sum5.in Vt as Connection825
                            connect freq Abs3.in as Connection828
                            [
                                position = 0, 0
                            ]
                            connect "+-1,5 hz.out" Comparator1.in2 as Connection540
                            connect "+-10%.out" Comparator2.in2 as Connection544
                            connect Abs1.out Comparator1.in1 as Connection539
                            connect "nominal frequency.out" Sum4.in1 as Connection534
                            connect "nominal voltage.out" Sum5.in1 as Connection542
                            connect Abs2.out Comparator2.in1 as Connection543
                        }
                        [
                            position = 8136, 8688
                            size = 104, 64
                        ]

                        component Subsystem PLL_Util {
                            layout = dynamic
                            component "core/Three phase PLL" PLL {
                                enable_pk = "True"
                                enable_sin = "False"
                                enable_zero = "False"
                                initial_pid_output = "2*np.pi*fn"
                                low_lim = "0"
                                rate_high = "5*fn"
                                rate_low = "-5*fn"
                                up_lim = "1.4*2*np.pi*fn"
                            }
                            [
                                position = 8144, 8176
                                size = 64, 128
                            ]

                            component gen_gain Gain4 {
                                gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                            }
                            [
                                position = 8224, 8304
                                rotation = right
                                hide_name = True
                            ]

                            component gen_terminator Termination3 {
                            }
                            [
                                position = 8200, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component gen_terminator Termination2 {
                            }
                            [
                                position = 8248, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "1.0/fn"
                            }
                            [
                                position = 8312, 8176
                                hide_name = True
                            ]

                            port C {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8264
                            ]

                            port f {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8400, 8176
                            ]

                            port wt {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8400, 8248
                            ]

                            port t {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8400, 8336
                            ]

                            port A {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8088
                            ]

                            port B {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8176
                            ]

                            connect Termination2.in PLL.q_axis as Connection802
                            connect Gain5.in PLL.freq as Connection803
                            connect Gain4.in PLL.peak as Connection807
                            connect Termination3.in PLL.d_axis as Connection801
                            connect PLL.vb B as Connection798
                            connect PLL.va A as Connection799
                            connect PLL.vc C as Connection800
                            connect f Gain5.out as Connection808
                            [
                                breakpoints = 8352, 8176
                            ]
                            connect PLL.theta wt as Connection809
                            [
                                breakpoints = 8272, 8248
                            ]
                            connect t Gain4.out as Connection810
                            [
                                breakpoints = 8304, 8336
                            ]
                        }
                        [
                            position = 7360, 8368
                            size = 80, 152
                        ]

                        port Vt_inv {
                            position = left:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7256, 8528
                        ]

                        port f_inv {
                            position = left:5
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7256, 8584
                        ]

                        port wt_inv {
                            position = left:6
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7256, 8640
                        ]

                        port live_grid {
                            position = right:14
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8312, 8688
                        ]

                        port grid_locked {
                            position = right:13
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8312, 8560
                        ]

                        port V_match {
                            position = right:12
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8304, 8264
                        ]

                        port nominal_state {
                            position = right:15
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8312, 8832
                        ]

                        port "Turn on Sync" {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8056, 8120
                        ]

                        port Va_util {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7256, 8312
                        ]

                        port Vb_util {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7256, 8368
                        ]

                        port Vc_util {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7256, 8424
                        ]

                        port df_sync {
                            position = right:11
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8312, 8416
                        ]

                        port dV_match {
                            position = right:10
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8304, 8200
                        ]

                        tag From123 {
                            value = "Vt_util"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8008, 8200
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From130 {
                            value = "f_util"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8016, 8672
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From133 {
                            value = "Vt_inv"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8016, 8848
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From132 {
                            value = "f_inv"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8016, 8816
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From128 {
                            value = "f_inv"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7680, 8464
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From124 {
                            value = "wt_util"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7952, 8512
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From122 {
                            value = "sync_ess"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8064, 8368
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From127 {
                            value = "wt_inv"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7952, 8560
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto4 {
                            value = "wt_util"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7488, 8424
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto6 {
                            value = "Vt_inv"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7336, 8528
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto1 {
                            value = "sync_ess"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8240, 8120
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto7 {
                            value = "wt_inv"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7336, 8640
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From121 {
                            value = "sync_ess"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7776, 8360
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From125 {
                            value = "f_util"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7680, 8416
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto2 {
                            value = "Vt_util"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7488, 8312
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto3 {
                            value = "f_util"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7488, 8368
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From126 {
                            value = "Vt_inv"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8008, 8264
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto5 {
                            value = "f_inv"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7336, 8584
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From129 {
                            value = "Vt_util"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8016, 8704
                            hide_name = True
                            size = 60, 20
                        ]

                        junction Junction1 sp
                        [
                            position = 7952, 8416
                        ]

                        junction Junction4 sp
                        [
                            position = 8152, 8120
                        ]

                        junction Junction5 sp
                        [
                            position = 8256, 8416
                        ]

                        junction Junction6 sp
                        [
                            position = 8256, 8560
                        ]

                        junction Junction9 sp
                        [
                            position = 8248, 8832
                        ]

                        connect Goto6 Vt_inv as Connection1964
                        connect Goto7 wt_inv as Connection1966
                        connect Junction1 phase_match.freq_lock as Connection593
                        connect Junction4 Vmatch.Sync_Ess as Connection1955
                        connect Junction5 phase_match.df_synch as Connection1972
                        connect Junction6 phase_match.phase_lock as Connection1975
                        connect Junction9 Check_nominal_conditions.on_nominal as Connection1999
                        connect "Turn on Sync" Junction4 as Connection1954
                        connect Check_grid.freq From130 as Connection1983
                        connect V_match Vmatch.V_match as Connection1986
                        connect Check_nominal_conditions.freq From132 as Connection1997
                        connect Va_util PLL_Util.A as Connection1958
                        connect From121 f_match.sync as Connection1969
                        connect Vb_util PLL_Util.B as Connection1960
                        connect From122 phase_match.sync as Connection1970
                        connect Vc_util PLL_Util.C as Connection1959
                        connect From123 Vmatch.Vt_Util as Connection1977
                        connect Vmatch.delta_V dV_match as Connection1953
                        connect df_sync Junction5 as Connection1971
                        connect From124 phase_match.phase_util as Connection1978
                        connect dfsynch.in Junction5 as Connection1973
                        connect From125 f_match.f_Util as Connection1979
                        connect "f_match.freq lock" Junction1 as Connection592
                        connect From126 Vmatch.Vt_Inv as Connection1982
                        connect freq_lock.in Junction1 as Connection594
                        connect grid_locked Junction6 as Connection1974
                        connect From127 phase_match.phase_inv as Connection1981
                        connect live_grid Check_grid.live_grid as Connection1985
                        connect From128 f_match.f_Inv as Connection1980
                        connect nominal_state Junction9 as Connection1995
                        connect on_nominal.in Junction9 as Connection1998
                        connect From129 Check_grid.Vt as Connection1984
                        connect phase_lock.in Junction6 as Connection1976
                        connect From133 Check_nominal_conditions.Vt as Connection1996
                        connect phase_match.f_offset f_match.delta_f as Connection588
                        connect Goto1 Junction4 as Connection1956
                        connect Goto2 PLL_Util.t as Connection1961
                        connect Goto3 PLL_Util.f as Connection1962
                        connect Goto4 PLL_Util.wt as Connection1963
                        connect Goto5 f_inv as Connection1965
                    }
                    [
                        position = 8208, 9056
                        size = 136, 280
                    ]

                    component Subsystem ABCtoDQ1 {
                        layout = dynamic
                        component gen_gain Gain1 {
                            gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                        }
                        [
                            position = 8336, 8120
                            rotation = left
                            hide_name = True
                        ]

                        component "core/abc to dq" "abc to dq1" {
                        }
                        [
                            position = 8256, 8184
                            size = 48, 80
                        ]

                        component gen_terminator Termination1 {
                        }
                        [
                            position = 8344, 8248
                            rotation = right
                            hide_name = True
                        ]

                        component gen_gain Gain2 {
                            gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                        }
                        [
                            position = 8384, 8120
                            rotation = left
                            hide_name = True
                        ]

                        port wt {
                            position = left:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8192, 8288
                            rotation = left
                        ]

                        port q {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8384, 8056
                            rotation = left
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8200, 8056
                            rotation = right
                        ]

                        port C {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8136, 8288
                            rotation = left
                        ]

                        port d {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8336, 8056
                            rotation = left
                        ]

                        port B {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8136, 8056
                            rotation = right
                        ]

                        connect Gain1.out d as Connection2338
                        connect "abc to dq1.va" A as Connection2342
                        connect Gain2.out q as Connection2337
                        connect B "abc to dq1.vb" as Connection2343
                        connect "abc to dq1.d_axis" Gain1.in as Connection2339
                        connect "abc to dq1.vc" C as Connection2344
                        connect "abc to dq1.q_axis" Gain2.in as Connection2340
                        connect "abc to dq1.wt" wt as Connection2345
                        connect "abc to dq1.zero_axis" Termination1.in as Connection2341
                    }
                    [
                        position = 7624, 9160
                        size = 72, 192
                    ]

                    component gen_probe f {
                        addr = "8966"
                        signal_type = "voltage"
                    }
                    [
                        position = 7752, 8736
                        rotation = right
                    ]

                    component gen_probe Vt {
                    }
                    [
                        position = 7688, 8736
                        rotation = right
                    ]

                    port On {
                        position = top:10
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7488, 8264
                    ]

                    port Vb_util {
                        position = left:18
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8056, 8984
                    ]

                    port Va_util {
                        position = left:17
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8056, 8936
                    ]

                    port Vc_util {
                        position = left:19
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8056, 9032
                    ]

                    port mode {
                        position = top:11
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7528, 8296
                    ]

                    port Contactor {
                        position = right:15
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7832, 8432
                        rotation = down
                        scale = -1, 1
                    ]

                    port m_a {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8864, 8472
                    ]

                    port m_b {
                        position = right:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8864, 8552
                    ]

                    port m_c {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8864, 8632
                    ]

                    port Ia_out {
                        position = left:20
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7528, 9088
                    ]

                    port Ib_out {
                        position = left:21
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7528, 9136
                    ]

                    port Ic_out {
                        position = left:22
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7528, 9184
                    ]

                    port Ib {
                        position = left:14
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7528, 8880
                    ]

                    port Ia {
                        position = left:13
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7528, 8832
                    ]

                    port Ic {
                        position = left:15
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7528, 8928
                    ]

                    port Vc {
                        position = left:12
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7528, 8696
                    ]

                    port Vb {
                        position = left:11
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7528, 8632
                    ]

                    port Va {
                        position = left:10
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7528, 8568
                    ]

                    port VDC {
                        position = left:16
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8256, 8120
                        rotation = right
                    ]

                    tag From197 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8056, 9176
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From157 {
                        value = "Vmode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8208
                        rotation = right
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From154 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8080, 8688
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From208 {
                        value = "wt_Vmode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8472, 8632
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From198 {
                        value = "Vmode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8168, 8568
                        rotation = right
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto107 {
                        value = "mq_Vmode"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8352, 8720
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto61 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7816, 8600
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto58 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7816, 8568
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto108 {
                        value = "on_nominal"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8352, 9176
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto90 {
                        value = "df_sync"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8352, 8984
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From188 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8560, 8776
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From68 {
                        value = "Vmode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8632, 8376
                        rotation = right
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From148 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8080, 8752
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From61 {
                        value = "VDC"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8248, 8568
                        rotation = right
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto101 {
                        value = "V_match"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8360, 9032
                        hide_name = True
                        size = 74, 20
                    ]

                    tag Goto34 {
                        value = "Id"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7768, 8824
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From112 {
                        value = "Id_out"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8064, 8368
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto93 {
                        value = "dV_match"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8352, 8936
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From202 {
                        value = "V_match"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8360
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From209 {
                        value = "on_nominal"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8424
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From199 {
                        value = "On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8208, 8568
                        rotation = right
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto102 {
                        value = "md_Imode"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8352, 8304
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From108 {
                        value = "Id"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8080, 8720
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto91 {
                        value = "pf"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8792, 8944
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From210 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7520, 9232
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto103 {
                        value = "wt_Imode"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8352, 8464
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto98 {
                        value = "Vmode"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7840, 8256
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From203 {
                        value = "wt_Imode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8472, 8536
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto43 {
                        value = "Q"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8792, 8816
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From66 {
                        value = "synch"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8136, 8880
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto92 {
                        value = "S"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8792, 8880
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto109 {
                        value = "Id_out"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7792, 9080
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto59 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7816, 8696
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From195 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8056, 9080
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From204 {
                        value = "mq_Imode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8472, 8504
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From60 {
                        value = "df_sync"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8080, 8784
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From113 {
                        value = "Iq_out"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8064, 8400
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto104 {
                        value = "mq_Imode"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8352, 8384
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From189 {
                        value = "Id_out"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8560, 8904
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From43 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8064, 8464
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto100 {
                        value = "synch"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7840, 8344
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto105 {
                        value = "wt_Vmode"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8352, 8784
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From205 {
                        value = "md_Imode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8472, 8472
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto67 {
                        value = "grid_locked"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8360, 9080
                        hide_name = True
                        size = 74, 20
                    ]

                    tag From156 {
                        value = "On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8216, 8208
                        rotation = right
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From146 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8064, 8304
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto42 {
                        value = "P"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8792, 8752
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto35 {
                        value = "Iq"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7808, 8984
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From38 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7520, 8976
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From190 {
                        value = "Iq_out"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8560, 8968
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From206 {
                        value = "md_Vmode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8472, 8568
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto106 {
                        value = "md_Vmode"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8352, 8656
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From196 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8056, 9128
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto99 {
                        value = "live_grid"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8352, 9128
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto110 {
                        value = "Iq_out"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7832, 9240
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From192 {
                        value = "dV_match"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8080, 8656
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From207 {
                        value = "mq_Vmode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8472, 8600
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From39 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8064, 8432
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto89 {
                        value = "VDC"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8320, 8240
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto60 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7816, 8664
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From200 {
                        value = "grid_locked"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8328
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From155 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8064, 8336
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From187 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8560, 8840
                        hide_name = True
                        size = 57, 20
                    ]

                    tag Goto96 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7816, 8632
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto97 {
                        value = "On"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7608, 8240
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From201 {
                        value = "live_grid"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8392
                        hide_name = True
                        size = 60, 20
                    ]

                    junction Junction330 sp
                    [
                        position = 8744, 8776
                    ]

                    junction Junction331 sp
                    [
                        position = 8744, 8840
                    ]

                    junction Junction333 sp
                    [
                        position = 8744, 8904
                    ]

                    junction Junction334 sp
                    [
                        position = 8744, 8968
                    ]

                    junction Junction341 sp
                    [
                        position = 7560, 8264
                    ]

                    junction Junction342 sp
                    [
                        position = 8256, 8240
                    ]

                    junction Junction329 sp
                    [
                        position = 7752, 8664
                    ]

                    junction Junction337 sp
                    [
                        position = 7688, 8632
                    ]

                    connect ABCtoDQ.A Ia as Connection2493
                    connect Junction330 Power_Meas.P as Connection2466
                    connect From208 Change_CtrlMode.wt_Vmode as Connection2734
                    connect Junction331 Power_Meas.Q as Connection2469
                    connect ABCtoDQ.B Ib as Connection2494
                    connect duty_cycle.mq Change_CtrlMode.mq as Connection2727
                    connect From209 Inv_Cab_SM.on_nominal as Connection2747
                    connect Junction333 S.in as Connection2479
                    connect duty_cycle.md Change_CtrlMode.md as Connection2728
                    connect ABCtoDQ.C Ic as Connection2495
                    connect From210 ABCtoDQ1.wt as Connection2748
                    connect Junction334 Power_Meas.pf as Connection2482
                    connect duty_cycle.wt Change_CtrlMode.wt as Connection2726
                    connect From38 ABCtoDQ.wt as Connection2360
                    connect duty_cycle.m_a m_a as Connection2313
                    connect Change_CtrlMode.mq_Imode From204 as Connection2730
                    connect Junction341 Inv_Cab_SM.On as Connection2601
                    connect From39 Imode_control.f as Connection2564
                    connect Junction342 Gain1.out as Connection2738
                    connect Change_CtrlMode.mq_Vmode From207 as Connection2733
                    connect From60 Vmode_control.df_sync as Connection2593
                    connect m_b duty_cycle.m_b as Connection2714
                    connect Contactor Inv_Cab_SM.CB as Connection2606
                    connect m_c duty_cycle.m_c as Connection2715
                    connect From112 Imode_control.Id as Connection2562
                    connect From61 Vmode_control.Vdc as Connection2736
                    connect On Junction341 as Connection2600
                    connect mode Inv_Cab_SM.mode as Connection2597
                    connect From146 Imode_control.Vd as Connection2560
                    connect From66 "Synch.Turn on Sync" as Connection2576
                    connect P.in Junction330 as Connection2465
                    connect pf.in Junction334 as Connection2481
                    connect From156 Imode_control.On as Connection2566
                    connect From68 Change_CtrlMode.Vmode as Connection2719
                    connect Power_Meas.S Junction333 as Connection2478
                    connect Q.in Junction331 as Connection2468
                    connect Ia_out ABCtoDQ1.A as Connection2860
                    connect From157 Imode_control.Vmode as Connection2567
                    connect Goto100 Inv_Cab_SM.Synch as Connection2605
                    connect From187 Power_Meas.Vq as Connection2462
                    connect Goto101 Synch.V_match as Connection2609
                    connect Synch.f_inv From196 as Connection2590
                    connect Ib_out ABCtoDQ1.B as Connection2861
                    connect Synch.wt_inv From197 as Connection2588
                    connect Ic_out ABCtoDQ1.C as Connection2862
                    connect From188 Power_Meas.Vd as Connection2461
                    connect Goto102 Imode_control.md as Connection2742
                    connect Synch.Vc_util Vc_util as Connection2584
                    connect From189 Power_Meas.Id as Connection2463
                    connect Goto103 Imode_control.wt as Connection2740
                    connect From190 Power_Meas.Iq as Connection2464
                    connect Goto104 Imode_control.mq as Connection2741
                    connect VDC Gain1.in as Connection2498
                    connect Va PLL_pu.A as Connection2526
                    connect From192 Vmode_control.dV_match as Connection2592
                    connect Goto105 Vmode_control.wt as Connection2744
                    connect Va_util Synch.Va_util as Connection2586
                    connect From195 Synch.Vt_inv as Connection2589
                    connect Goto106 Vmode_control.md as Connection2745
                    connect Vb PLL_pu.B as Connection2525
                    connect From198 Vmode_control.Vmode as Connection2603
                    connect Goto107 Vmode_control.mq as Connection2743
                    connect Vb_util Synch.Vb_util as Connection2577
                    connect From199 Vmode_control.On as Connection2604
                    connect Goto108 Synch.nominal_state as Connection2746
                    connect From200 Inv_Cab_SM.grid_locked as Connection2607
                    connect Vc PLL_pu.C as Connection2524
                    connect From201 Inv_Cab_SM.live_grid as Connection2610
                    connect Vmode_control.Id From108 as Connection2548
                    connect From202 Inv_Cab_SM.V_match as Connection2611
                    connect Vmode_control.f From148 as Connection2549
                    connect From203 Change_CtrlMode.wt_Imode as Connection2731
                    connect Goto42 Junction330 as Connection2467
                    connect Vmode_control.Vd From154 as Connection2547
                    connect From205 Change_CtrlMode.md_Imode as Connection2729
                    connect Goto43 Junction331 as Connection2470
                    connect From206 Change_CtrlMode.md_Vmode as Connection2732
                    connect Goto59 PLL_pu.wt as Connection2363
                    connect Goto67 Synch.grid_locked as Connection2585
                    connect Goto89 Junction342 as Connection2737
                    connect Goto90 Synch.df_sync as Connection2587
                    connect Goto91 Junction334 as Connection2483
                    connect Goto92 Junction333 as Connection2480
                    connect Goto93 Synch.dV_match as Connection2591
                    connect Goto97 Junction341 as Connection2602
                    connect Goto98 Inv_Cab_SM.Vmode as Connection2596
                    connect Goto99 Synch.live_grid as Connection2594
                    connect Imode_control.Iq From113 as Connection2563
                    connect Imode_control.Vq From155 as Connection2561
                    connect Imode_control.wt_ess From43 as Connection2565
                    connect Imode_control.Vdc Junction342 as Connection2739
                    connect PLL_pu.d Goto58 as Connection2863
                    [
                        breakpoints = 7688, 8568
                    ]
                    connect PLL_pu.q Goto61 as Connection2864
                    [
                        breakpoints = 7752, 8600
                    ]
                    connect ABCtoDQ.d Goto34 as Connection2865
                    [
                        breakpoints = 7712, 8824
                    ]
                    connect Goto35 ABCtoDQ.q as Connection2866
                    [
                        breakpoints = 7768, 8984; 7712, 8984
                    ]
                    connect ABCtoDQ1.d Goto109 as Connection2867
                    [
                        breakpoints = 7720, 9080
                    ]
                    connect Goto110 ABCtoDQ1.q as Connection2868
                    [
                        breakpoints = 7792, 9240; 7720, 9240
                    ]
                    connect Goto60 Junction329 as Connection2452
                    connect Junction329 PLL_pu.f as Connection2453
                    connect f.in Junction329 as Connection2454
                    connect Goto96 Junction337 as Connection2521
                    connect Junction337 PLL_pu.Vt as Connection2522
                    connect Vt.in Junction337 as Connection2523
                }
                [
                    position = 8376, 7328
                    size = 136, 440
                ]

                component "core/Current Measurement" Ia {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8440, 7672
                    size = 64, 32
                ]

                component "core/Current Measurement" Ib {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8432, 7768
                    size = 64, 32
                ]

                component "core/Current Measurement" Ic {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8432, 7864
                    size = 64, 32
                ]

                component "core/THD Measurement" "THD Va" {
                    exec_1 = "Ts"
                    frequency = "60"
                }
                [
                    position = 9136, 7272
                    size = 32, 32
                ]

                component "core/THD Measurement" "THD Vb" {
                    exec_1 = "Ts"
                    frequency = "60"
                }
                [
                    position = 9088, 7320
                    size = 32, 32
                ]

                component "core/THD Measurement" "THD Vc" {
                    exec_1 = "Ts"
                    frequency = "60"
                }
                [
                    position = 9152, 7360
                    size = 32, 32
                ]

                component "core/THD Measurement" "THD Ia" {
                    exec_1 = "Ts"
                    frequency = "60"
                }
                [
                    position = 9064, 7416
                    size = 32, 32
                ]

                component "core/THD Measurement" "THD Ib" {
                    exec_1 = "Ts"
                    frequency = "60"
                }
                [
                    position = 9104, 7456
                    size = 32, 32
                ]

                component "core/THD Measurement" "THD Ic" {
                    exec_1 = "Ts"
                    frequency = "60.0"
                }
                [
                    position = 9152, 7504
                    size = 32, 32
                ]

                component "core/Current Measurement" Idc_1 {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7464, 7672
                    size = 64, 32
                ]

                component gen_probe I_Bat_Charge {
                    streaming_en = "True"
                }
                [
                    position = 7512, 7584
                ]

                component gen_probe V_Bat_Charge {
                    streaming_en = "True"
                }
                [
                    position = 7808, 7904
                ]

                port A {
                    position = 144.0, -96.0
                    kind = pe
                    direction =  out
                }
                [
                    position = 9480, 7672
                    rotation = down
                ]

                port B {
                    position = 144.0, -0.1
                    kind = pe
                    direction =  out
                }
                [
                    position = 9480, 7768
                    rotation = down
                ]

                port C {
                    position = 144.0, 96.0
                    kind = pe
                    direction =  out
                }
                [
                    position = 9480, 7864
                    rotation = down
                ]

                port DCpos {
                    position = -144.0, -96.0
                    kind = pe
                }
                [
                    position = 7368, 7672
                ]

                port DCneg {
                    position = -144.0, 96.0
                    kind = pe
                }
                [
                    position = 7344, 7864
                ]

                port Inputs {
                    position = -112.0, -120.0
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7768, 7120
                    rotation = right
                ]

                port Outputs {
                    position = 112.0, -120.0
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8976, 7128
                    rotation = left
                ]

                tag From171 {
                    value = "inv_Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7176
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto2 {
                    value = "m_a"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8520, 7144
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto94 {
                    value = "m_c"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8520, 7400
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From167 {
                    value = "On"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8328, 7056
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From213 {
                    value = "m_a"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7864, 7584
                    hide_name = True
                    size = 60, 20
                ]

                tag From205 {
                    value = "mode"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8424, 7056
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From206 {
                    value = "On"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7864, 7608
                    hide_name = True
                    size = 60, 20
                ]

                tag From215 {
                    value = "m_c"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7864, 7536
                    hide_name = True
                    size = 60, 20
                ]

                tag From208 {
                    value = "util_Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7400
                    hide_name = True
                    size = 60, 20
                ]

                tag From214 {
                    value = "m_b"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7864, 7560
                    hide_name = True
                    size = 60, 20
                ]

                tag From209 {
                    value = "util_Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7368
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto98 {
                    value = "Ia_out"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 9128, 7640
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 0, 0
                ]

                tag From210 {
                    value = "util_Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7432
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto99 {
                    value = "Ic_out"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 9128, 7840
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 0, 0
                ]

                tag Goto92 {
                    value = "CB"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8520, 7528
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto100 {
                    value = "Ib_out"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 9128, 7736
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 0, 0
                ]

                tag From211 {
                    value = "CB"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 9144, 7576
                    hide_name = True
                    size = 60, 20
                ]

                tag From189 {
                    value = "inv_Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8832, 7368
                    hide_name = True
                    size = 60, 20
                ]

                tag From185 {
                    value = "On"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8832, 7296
                    hide_name = True
                    size = 60, 20
                ]

                tag From190 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8832, 7392
                    hide_name = True
                    size = 60, 20
                ]

                tag From188 {
                    value = "inv_Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8832, 7320
                    hide_name = True
                    size = 60, 20
                ]

                tag From187 {
                    value = "inv_Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8832, 7344
                    hide_name = True
                    size = 60, 20
                ]

                tag From192 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8832, 7440
                    hide_name = True
                    size = 60, 20
                ]

                tag From191 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8832, 7416
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto85 {
                    value = "inv_Vc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8928, 8016
                    rotation = right
                    hide_name = True
                    scale = -1, 1
                    size = 0, 0
                ]

                tag From212 {
                    value = "CB"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8832, 7272
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto88 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8496, 7832
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto87 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8496, 7736
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto84 {
                    value = "inv_Vb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8904, 8016
                    rotation = right
                    hide_name = True
                    scale = -1, 1
                    size = 0, 0
                ]

                tag Goto90 {
                    value = "util_Vb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 9352, 7952
                    rotation = right
                    hide_name = True
                    scale = -1, 1
                    size = 0, 0
                ]

                tag Goto91 {
                    value = "util_Va"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 9328, 7952
                    rotation = right
                    hide_name = True
                    scale = -1, 1
                    size = 0, 0
                ]

                tag Goto18 {
                    value = "VDC"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7784, 7768
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto83 {
                    value = "inv_Va"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8880, 8016
                    rotation = right
                    hide_name = True
                    scale = -1, 1
                    size = 0, 0
                ]

                tag Goto89 {
                    value = "util_Vc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 9376, 7952
                    rotation = right
                    hide_name = True
                    scale = -1, 1
                    size = 0, 0
                ]

                tag From182 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7304
                    hide_name = True
                    size = 60, 20
                ]

                tag From169 {
                    value = "inv_Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7144
                    hide_name = True
                    size = 60, 20
                ]

                tag From184 {
                    value = "VDC"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7336
                    hide_name = True
                    size = 60, 20
                ]

                tag From181 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7240
                    hide_name = True
                    size = 60, 20
                ]

                tag From170 {
                    value = "inv_Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7208
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto86 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8496, 7640
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag From183 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7272
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto93 {
                    value = "m_b"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8520, 7272
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From216 {
                    value = "Ib_out"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7496
                    hide_name = True
                    size = 0, 0
                ]

                tag From217 {
                    value = "Ic_out"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7528
                    hide_name = True
                    size = 0, 0
                ]

                tag From218 {
                    value = "Ia_out"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7464
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto102 {
                    value = "Vdc_b"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 7680, 7912
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto103 {
                    value = "inv_Vc_bat"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 9048, 8008
                    rotation = right
                    hide_name = True
                    scale = -1, 1
                    size = 0, 0
                ]

                tag Goto104 {
                    value = "inv_Vb_bat"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 9024, 8008
                    rotation = right
                    hide_name = True
                    scale = -1, 1
                    size = 0, 0
                ]

                tag Goto105 {
                    value = "inv_Va_bat"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 9000, 8008
                    rotation = right
                    hide_name = True
                    scale = -1, 1
                    size = 0, 0
                ]

                tag Goto106 {
                    value = "Ia_bat"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 8496, 7608
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto107 {
                    value = "Ib_bat"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 8496, 7704
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto108 {
                    value = "Ic_bat"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 8512, 7800
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto109 {
                    value = "B_THD_Va"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 9224, 7272
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto110 {
                    value = "B_THD_Vb"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 9208, 7320
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto111 {
                    value = "B_THD_Vc"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 9240, 7360
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto112 {
                    value = "B_THD_Ia"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 9152, 7416
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto113 {
                    value = "B_THD_Ib"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 9192, 7456
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 58, 20
                ]

                tag Goto114 {
                    value = "B_THD_Ic"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 9240, 7504
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto101 {
                    value = "Idc_bat"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 7376, 7624
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                junction Junction10 pe
                [
                    position = 8696, 8104
                ]

                junction Junction151 pe
                [
                    position = 7704, 7864
                ]

                junction Junction173 pe
                [
                    position = 7624, 7672
                ]

                junction Junction174 pe
                [
                    position = 7624, 7864
                ]

                junction Junction202 pe
                [
                    position = 8624, 7672
                ]

                junction Junction203 pe
                [
                    position = 8696, 7768
                ]

                junction Junction204 pe
                [
                    position = 8768, 7864
                ]

                junction Junction205 sp
                [
                    position = 7744, 7768
                ]

                junction Junction206 sp
                [
                    position = 8880, 7952
                ]

                junction Junction207 sp
                [
                    position = 8904, 7936
                ]

                junction Junction208 sp
                [
                    position = 8928, 7912
                ]

                junction Junction209 sp
                [
                    position = 8440, 7640
                ]

                junction Junction210 sp
                [
                    position = 8432, 7736
                ]

                junction Junction211 sp
                [
                    position = 8440, 7832
                ]

                junction Junction212 sp
                [
                    position = 8952, 7272
                ]

                junction Junction213 sp
                [
                    position = 8968, 7320
                ]

                junction Junction214 sp
                [
                    position = 8984, 7352
                ]

                junction Junction215 sp
                [
                    position = 9000, 7392
                ]

                junction Junction216 sp
                [
                    position = 8984, 7416
                ]

                junction Junction217 sp
                [
                    position = 8952, 7440
                ]

                junction Junction218 pe
                [
                    position = 7704, 7672
                ]

                junction Junction219 sp
                [
                    position = 7456, 7624
                ]

                junction Junction220 sp
                [
                    position = 7744, 7912
                ]

                connect A "Grid meas.a" as Connection2714
                connect B "Grid meas.b" as Connection2712
                connect C "Grid meas.c" as Connection2710
                connect Cdc.p_node Junction173 as Connection385
                connect Cdc.n_node Junction174 as Connection388
                connect Cfa.n_node Junction10 as Connection7
                connect Cfb.n_node Junction10 as Connection8
                connect Control.Va From169 as Connection2808
                connect Control.Vc From170 as Connection2806
                connect Control.Vb From171 as Connection2807
                connect Control.Ia From181 as Connection2805
                connect Control.Ic From182 as Connection2803
                connect Control.Ib From183 as Connection2804
                connect Control.VDC From184 as Connection2802
                connect Control.Vb_util From208 as Connection2800
                connect Control.Va_util From209 as Connection2801
                connect Control.Vc_util From210 as Connection2799
                connect Control.m_a Goto2 as Connection2795
                connect Control.Contactor Goto92 as Connection2798
                connect Control.m_c Goto94 as Connection2797
                connect DCneg Junction174 as Connection2562
                connect From167 Control.On as Connection2793
                connect From185 Output.Inv_On as Connection2501
                connect From205 Control.mode as Connection2794
                connect From206 "Three Phase Inverter1.En" as Connection2747
                connect From211 S1.ctrl_in as Connection2754
                connect From212 Output.Connected as Connection2755
                connect From213 "Three Phase Inverter1.InA" as Connection2769
                connect From215 "Three Phase Inverter1.InC" as Connection2771
                connect Goto100 Ib_out.out as Connection2778
                connect Goto93 Control.m_b as Connection2796
                connect Goto98 Ia_out.out as Connection2779
                connect Goto99 Ic_out.out as Connection2780
                connect "Grid meas.VC" Goto89 as Connection2736
                connect "Grid meas.VB" Goto90 as Connection2735
                connect "Grid meas.VA" Goto91 as Connection2734
                connect "Grid meas.C" S1.c_out as Connection2711
                connect "Grid meas.A" S1.a_out as Connection2715
                connect "Grid meas.B" S1.b_out as Connection2713
                connect Ia_out.p_node "Converter meas.a" as Connection2784
                connect Ia_out.n_node S1.a_in as Connection2781
                connect Ib_out.p_node "Converter meas.b" as Connection2786
                connect Ic_out.p_node "Converter meas.c" as Connection2788
                connect Ic_out.n_node S1.c_in as Connection2783
                connect Inputs Control_Inputs.Inputs as Connection2496
                connect Junction10 Cfc.n_node as Connection2689
                connect Junction151 Junction174 as Connection386
                connect Outputs Output.Out1 as Connection2499
                connect Ra.n_node La.n_node as Connection283
                connect Rb.n_node Lb.n_node as Connection51
                connect Rc.n_node Lc.n_node as Connection52
                connect Rdc.n_node Junction173 as Connection390
                connect Rfa.p_node Cfa.p_node as Connection53
                connect Rfb.p_node Cfb.p_node as Connection55
                connect Rfc.p_node Cfc.p_node as Connection57
                connect S1.b_in Ib_out.n_node as Connection2782
                connect "Three Phase Inverter1.InB" From214 as Connection2770
                connect "Three Phase Inverter1.neg_out" Junction151 as Connection163
                connect VDC.n_node Junction151 as Connection165
                connect From217 Control.Ic_out as Connection2809
                connect From216 Control.Ib_out as Connection2810
                connect From218 Control.Ia_out as Connection2811
                connect "Three Phase Inverter1.a_in" Ra.p_node as Connection2818
                [
                    breakpoints = 8152, 7672
                ]
                connect Rb.p_node "Three Phase Inverter1.b_in" as Connection2820
                [
                    breakpoints = 8152, 7768
                ]
                connect "Three Phase Inverter1.c_in" Rc.p_node as Connection2819
                [
                    breakpoints = 8152, 7864
                ]
                connect Ic.p_node Lc.p_node as Connection2827
                connect Ib.p_node Lb.p_node as Connection2828
                connect Ia.p_node La.p_node as Connection2829
                connect Rfa.n_node Junction202 as Connection2830
                connect Junction202 "Converter meas.A" as Connection2831
                [
                    breakpoints = 8624, 7672
                ]
                connect Ia.n_node Junction202 as Connection2832
                connect Rfb.n_node Junction203 as Connection2833
                connect Junction203 "Converter meas.B" as Connection2834
                [
                    breakpoints = 8696, 7768
                ]
                connect Ib.n_node Junction203 as Connection2835
                connect Rfc.n_node Junction204 as Connection2836
                connect Junction204 "Converter meas.C" as Connection2837
                [
                    breakpoints = 8768, 7864
                ]
                connect Ic.n_node Junction204 as Connection2838
                connect VDC.out Junction205 as Connection2842
                connect Junction205 Goto18 as Connection2843
                connect "Converter meas.VA" Junction206 as Connection2845
                connect Junction206 Goto83 as Connection2846
                connect Goto105 Junction206 as Connection2847
                connect "Converter meas.VB" Junction207 as Connection2848
                connect Junction207 Goto84 as Connection2849
                connect Goto104 Junction207 as Connection2850
                connect "Converter meas.VC" Junction208 as Connection2851
                connect Junction208 Goto85 as Connection2852
                connect Goto103 Junction208 as Connection2853
                connect Goto86 Junction209 as Connection2854
                connect Junction209 Ia.out as Connection2855
                [
                    breakpoints = 8440, 7648
                ]
                connect Goto106 Junction209 as Connection2856
                connect Goto87 Junction210 as Connection2857
                connect Junction210 Ib.out as Connection2858
                connect Goto107 Junction210 as Connection2859
                connect Goto88 Junction211 as Connection2860
                connect Junction211 Ic.out as Connection2861
                connect Goto108 Junction211 as Connection2862
                connect Output.Va Junction212 as Connection2869
                connect Junction212 From188 as Connection2870
                [
                    breakpoints = 8952, 7320; 8880, 7320
                ]
                connect "THD Va.In" Junction212 as Connection2871
                connect From187 Junction213 as Connection2872
                connect Junction213 Output.Vb as Connection2873
                connect "THD Vb.In" Junction213 as Connection2874
                connect Output.Vc Junction214 as Connection2875
                connect Junction214 From189 as Connection2876
                [
                    breakpoints = 8984, 7368; 8880, 7368
                ]
                connect "THD Vc.In" Junction214 as Connection2877
                connect From190 Junction215 as Connection2878
                connect Junction215 Output.Ia as Connection2879
                connect "THD Ia.In" Junction215 as Connection2880
                connect Output.Ib Junction216 as Connection2881
                connect Junction216 From191 as Connection2882
                connect "THD Ib.In" Junction216 as Connection2883
                connect From192 Junction217 as Connection2884
                connect Junction217 Output.Ic as Connection2885
                connect "THD Ic.In" Junction217 as Connection2886
                connect Goto109 "THD Va.Out" as Connection2887
                connect Goto110 "THD Vb.Out" as Connection2888
                connect Goto111 "THD Vc.Out" as Connection2889
                connect Goto112 "THD Ia.Out" as Connection2890
                connect Goto113 "THD Ib.Out" as Connection2891
                connect Goto114 "THD Ic.Out" as Connection2892
                connect DCpos Idc_1.p_node as Connection2894
                connect Idc_1.n_node Rdc.p_node as Connection2895
                connect Junction173 Junction218 as Connection2896
                [
                    breakpoints = 7624, 7672
                ]
                connect Junction218 VDC.p_node as Connection2897
                [
                    breakpoints = 7704, 7672; 7704, 7672
                ]
                connect "Three Phase Inverter1.pos_out" Junction218 as Connection2898
                connect Goto101 Junction219 as Connection2899
                connect Junction219 Idc_1.out as Connection2900
                connect I_Bat_Charge.in Junction219 as Connection2901
                connect Goto102 Junction220 as Connection2902
                connect Junction220 Junction205 as Connection2903
                connect V_Bat_Charge.in Junction220 as Connection2904

                Sn = "500e3"
                Ts = "Ts"
                Vn = "208"
                Vn_dc = "350"
                fsw = "2500"

                mask {
                    icon = "image(\'converter_cabinet.svg\')"
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Battery inverter (Switching)  model.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">The input \"mode\" define if the battery inverter is in grid forming or voltage mode (0) or in grid following  or current mode (1). When in voltage mode, the inverter will follow the references of voltage and frequency. When in current mode, the inverter will follow references for active and reactive power.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">The number of regular inputs is 5 and of outputs is 14. They are organized as an array in the following order:</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Inputs: 0 - On; 1 - mode; 2 - f_ref; 3 - Vref; 4 - Pref; 5 - Qref;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Outputs: 0 - Connected; 1 - Inv_On; 2 - Va; 3 - Vb; 4 - Vc; 5 - Vt; 6 - Ia; 7 - Ib; 8 - Ic; 9 - f; 10 - P; 11 - Q; 12 - S; 13 - pf;</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"
                    help_file = "battery_inverter.html"

                    Sn {
                        label = "Nominal power"
                        widget = edit
                        type = generic
                        default_value = "1.6e6"
                        unit = "VA"
                        group = "1 - General"
                    }

                    Vn {
                        label = "Nominal voltage"
                        widget = edit
                        type = generic
                        default_value = "480.0"
                        unit = "V (line to line)"
                        group = "1 - General"
                    }

                    Vn_dc {
                        label = "Nominal DC link voltage"
                        widget = edit
                        type = generic
                        default_value = "1000.0"
                        unit = "V"
                        group = "1 - General"
                    }

                    fn {
                        label = "Nominal frequency"
                        widget = edit
                        type = generic
                        default_value = "60.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    fsw {
                        label = "Switching frequency"
                        widget = edit
                        type = generic
                        default_value = "2500.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "200e-6"
                        unit = "s"
                        group = "1 - General"
                    }

                    L {
                        label = "LC filter inductance"
                        widget = edit
                        type = generic
                        default_value = "100.0e-6"
                        unit = "H"
                        group = "2 - Filter"
                    }

                    R {
                        label = "LC filter inductor ESR"
                        widget = edit
                        type = generic
                        default_value = "1e-5"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    OutputFilterFc {
                        label = "LC filter cut-off frequency"
                        widget = edit
                        type = generic
                        default_value = "500.0"
                        unit = "Hz"
                        group = "2 - Filter"
                    }

                    Resr {
                        label = "LC filter capacitor ESR"
                        widget = edit
                        type = generic
                        default_value = "15e-3"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    blowpass {
                        label = "Synch - PLL input filter num"
                        widget = edit
                        type = generic
                        default_value = "[  9.82591682e-06,   1.96518336e-05,   9.82591682e-06]"
                        group = "3 - Adv. 1"
                    }

                    alowpass {
                        label = "Synch - PLL input filter den"
                        widget = edit
                        type = generic
                        default_value = "[ -1.99111429,  0.9911536 ]"
                        group = "3 - Adv. 1"
                    }

                    V_diff {
                        label = "Synch - Accepted voltage diff."
                        widget = edit
                        type = generic
                        default_value = "5"
                        unit = "%"
                        group = "3 - Adv. 1"
                    }

                    Vmatch_Kp {
                        label = "Synch - Voltage match - PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "3 - Adv. 1"
                    }

                    Vmatch_Ki {
                        label = "Synch - Voltage match - PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "5.0"
                        group = "3 - Adv. 1"
                    }

                    f_diff {
                        label = "Synch - Accepted frequency diff."
                        widget = edit
                        type = generic
                        default_value = "0.2"
                        unit = "%"
                        group = "3 - Adv. 1"
                    }

                    fmatch_Kp {
                        label = "Synch - Frequency match - PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "3 - Adv. 1"
                    }

                    fmatch_Ki {
                        label = "Synch - Frequency match - PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "3 - Adv. 1"
                    }

                    Phase_diff {
                        label = "Synch - Accepted phase diff."
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        unit = "%"
                        group = "3 - Adv. 1"
                    }

                    Phase_Kp {
                        label = "Synch - Phase match - PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.005"
                        group = "3 - Adv. 1"
                    }

                    Phase_Ki {
                        label = "Synch - Phase match - PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.5"
                        group = "3 - Adv. 1"
                    }

                    ImodeId_Kp {
                        label = "Current mode Id - PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.347"
                        group = "4 - Adv. 2"
                    }

                    ImodeId_Ki {
                        label = "Current mode Id - PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "347.22"
                        group = "4 - Adv. 2"
                    }

                    ImodeIq_Kp {
                        label = "Current mode Iq - PI - Kd"
                        widget = edit
                        type = generic
                        default_value = "0.347"
                        group = "4 - Adv. 2"
                    }

                    ImodeIq_Ki {
                        label = "Current mode Iq - PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "347.22"
                        group = "4 - Adv. 2"
                    }

                    Imode_damp {
                        label = "Current mode Id and Iq damping gain"
                        widget = edit
                        type = generic
                        default_value = "-0.272"
                        group = "4 - Adv. 2"
                    }

                    powerRate {
                        label = "Maximum power reference change rate"
                        widget = edit
                        type = generic
                        default_value = "1e5"
                        unit = "p.u./s"
                        group = "4 - Adv. 2"
                    }

                    VmodeIdRef_Kp {
                        label = "Voltage mode Id ref - PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "5 - Adv. 3"
                    }

                    VmodeIdRef_Ki {
                        label = "Voltage mode Id ref - PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "5 - Adv. 3"
                    }

                    VmodeId_Kp {
                        label = "Voltage mode Id - PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.8328"
                        group = "5 - Adv. 3"
                    }

                    VmodeId_Ki {
                        label = "Voltage mode Id - PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "833.33"
                        group = "5 - Adv. 3"
                    }

                    Vmode_ovMod {
                        label = "Voltage mode Id overmodulation gain"
                        widget = edit
                        type = generic
                        default_value = "1.2"
                        group = "5 - Adv. 3"
                    }

                    Vmode_damp {
                        label = "Voltage mode Id damping gain"
                        widget = edit
                        type = generic
                        default_value = "-0.0001"
                        group = "5 - Adv. 3"
                    }

                    V_rise {
                        label = "V reference rising rate"
                        widget = edit
                        type = generic
                        default_value = "10e3"
                        unit = "p.u./s"
                        group = "5 - Adv. 3"
                    }

                    V_fall {
                        label = "V reference falling rate"
                        widget = edit
                        type = generic
                        default_value = "-10e3"
                        unit = "p.u./s"
                        group = "5 - Adv. 3"
                    }

                    f_rise {
                        label = "f reference rising rate"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        unit = "p.u./s"
                        group = "5 - Adv. 3"
                    }

                    f_fall {
                        label = "f reference falling rate"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        unit = "p.u./s"
                        group = "5 - Adv. 3"
                    }

                    mod_upLim {
                        label = "Modulation signals upper limit"
                        widget = edit
                        type = generic
                        default_value = "1.1546"
                        group = "6 - Adv. 4"
                    }

                    mod_lowLim {
                        label = "Modulation signals lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1.1546"
                        group = "6 - Adv. 4"
                    }

                    k {
                        label = "Active islanding detector k factor"
                        widget = edit
                        type = generic
                        default_value = "0.05"
                        group = "6 - Adv. 4"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, "converter_cabinet.svg")
                    ENDCODE
                }
            }
            [
                position = 8264, 8416
                size = 288, 239
            ]

            component gen_probe SOC {
                override_signal_name = "True"
                signal_name = "Batt_SOC"
                streaming_en = "True"
            }
            [
                position = 7992, 8368
            ]

            port A {
                position = right:1
                kind = pe
                direction =  out
            }
            [
                position = 8456, 8320
                rotation = down
            ]

            port B {
                position = right:2
                kind = pe
                direction =  out
            }
            [
                position = 8456, 8416
                rotation = down
            ]

            port C {
                position = right:3
                kind = pe
                direction =  out
            }
            [
                position = 8456, 8512
                rotation = down
            ]

            port from_PCC {
                position = top:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7344, 7912
            ]

            port from_PMS {
                position = top:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7344, 7848
            ]

            port toPCC {
                position = top:3
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8576, 8232
            ]

            tag Goto4 {
                value = "Pref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7664, 8088
                hide_name = True
            ]

            tag From2 {
                value = "Qref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8048, 8168
                hide_name = True
            ]

            tag From4 {
                value = "fref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8048, 8072
                hide_name = True
            ]

            tag From3 {
                value = "Pref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8048, 8136
                hide_name = True
            ]

            tag From5 {
                value = "Vref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8048, 8104
                hide_name = True
            ]

            tag From1 {
                value = "opMode"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8048, 8040
                hide_name = True
            ]

            tag Goto5 {
                value = "Qref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7664, 8168
                hide_name = True
            ]

            tag Goto1 {
                value = "opMode"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7664, 7848
                hide_name = True
            ]

            tag Goto3 {
                value = "fref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7664, 8008
                hide_name = True
            ]

            tag Goto2 {
                value = "Vref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7664, 7928
                hide_name = True
            ]

            tag Goto6 {
                value = "SOC"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8000, 8424
                hide_name = True
            ]

            junction Junction1 sp
            [
                position = 8376, 8232
            ]

            junction Junction4 pe
            [
                position = 7896, 8512
            ]

            junction Junction214 pe
            [
                position = 7904, 8512
            ]

            junction Junction215 sp
            [
                position = 7936, 8424
            ]

            connect "Battery inverter.A" A as Connection156
            connect "Battery inverter.B" B as Connection158
            connect "Battery inverter.C" C as Connection157
            connect "Bus Join2.out" "Battery inverter.Inputs" as Connection154
            connect "Bus Join2.in4" From3 as Connection173
            connect "Bus Join2.in2" From4 as Connection171
            connect From1 "Bus Join2.in1" as Connection170
            connect From2 "Bus Join2.in5" as Connection174
            connect From5 "Bus Join2.in3" as Connection172
            connect Goto1 Interface.opMode as Connection161
            connect Goto2 Interface.V_ref as Connection162
            connect Goto3 Interface.f_ref as Connection163
            connect Goto4 Interface.P as Connection164
            connect Goto5 Interface.Q as Connection165
            connect Interface.fromPCC from_PCC as Connection160
            connect Junction1 "Battery inverter.Outputs" as Connection176
            connect Junction1 split.In as Connection177
            connect On.out "Bus Join2.in" as Connection1
            connect Out.in Junction1 as Connection175
            connect Pref.out Interface.Pref as Connection168
            connect Qref.out Interface.Qref as Connection169
            connect Termination1.in mode.out as Connection179
            connect Vref.out Interface.Vref as Connection166
            connect f_ref.out Interface.wref as Connection167
            connect from_PMS Interface.fromPMS as Connection159
            connect toPCC split.ON as Connection178
            connect "Battery inverter.DCneg" Junction214 as Connection2867
            connect "Battery 1.n_node" Junction214 as Connection2869
            connect Junction214 Junction4 as Connection2878
            [
                breakpoints = 7904, 8512; 7904, 8512
            ]
            connect "Battery 1.p_node" "Battery inverter.DCpos" as Connection2879
            connect Goto6 Junction215 as Connection2881
            connect Junction215 "Battery 1.out" as Connection2882
            connect SOC.in Junction215 as Connection2883

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Energy Storage System (ESS) inverter.</p></body></html>"

                CODE define_icon
                    mdl.set_component_icon_image(item_handle, "converter_cabinet.svg")
                ENDCODE

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 7360, 9096
            rotation = left
            size = 160, 160
        ]

        component src_scada_input op_mode {
            execution_rate = "Ts2"
            max = "1"
            min = "0"
            unit = ""
        }
        [
            position = 7136, 8376
            rotation = right
        ]

        component Subsystem CESS {
            layout = dynamic
            component Subsystem "RC Snubber" {
                layout = dynamic
                component pas_resistor R2 {
                    resistance = "R"
                }
                [
                    position = 8192, 8144
                    rotation = right
                ]

                component pas_capacitor C3 {
                    capacitance = "C"
                }
                [
                    position = 8264, 8240
                    rotation = right
                ]

                component pas_capacitor C1 {
                    capacitance = "C"
                }
                [
                    position = 8120, 8240
                    rotation = right
                ]

                component pas_resistor R1 {
                    resistance = "R"
                }
                [
                    position = 8120, 8144
                    rotation = right
                ]

                component pas_resistor R3 {
                    resistance = "R"
                }
                [
                    position = 8264, 8144
                    rotation = right
                ]

                component pas_capacitor C2 {
                    capacitance = "C"
                }
                [
                    position = 8192, 8240
                    rotation = right
                ]

                port A {
                    position = top:1
                    kind = pe
                }
                [
                    position = 8120, 8064
                    rotation = right
                ]

                port B {
                    position = top:2
                    kind = pe
                }
                [
                    position = 8192, 8064
                    rotation = right
                ]

                port C {
                    position = top:3
                    kind = pe
                }
                [
                    position = 8264, 8064
                    rotation = right
                ]

                port N {
                    position = bottom:2
                    kind = pe
                }
                [
                    position = 8192, 8320
                    rotation = left
                ]

                junction Junction1 pe
                [
                    position = 8192, 8288
                ]

                junction Junction2 pe
                [
                    position = 8192, 8288
                ]

                connect C1.n_node Junction2 as Connection21
                connect C1.p_node R1.n_node as Connection10
                connect C1.p_node R1.n_node as Connection11
                connect C1.p_node R1.n_node as Connection9
                connect C2.n_node Junction1 as Connection18
                connect C2.p_node R2.n_node as Connection24
                connect C3.n_node Junction2 as Connection23
                connect Junction1 N as Connection19
                connect Junction2 Junction1 as Connection22
                connect R1.p_node A as Connection13
                connect R2.p_node B as Connection15
                connect R3.p_node C as Connection16
                connect R3.n_node C3.p_node as Connection25

                C = "50e-6"
                R = "0.2"

                mask {
                    R {
                        label = "R"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "ohms"
                        group = "General"
                    }

                    C {
                        label = "C"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "F"
                        group = "General"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 8272, 8072
                size = 64, 48
            ]

            component "core/Three Phase Core Coupling" "Core Coupling 1" {
            }
            [
                position = 8160, 7896
                scale = -1, 1
                size = 12, 256
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 7760, 7800
                rotation = down
                scale = -1, 1
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 7760, 7896
                rotation = down
                scale = -1, 1
            ]

            port C {
                position = left:3
                kind = pe
            }
            [
                position = 7760, 7992
                rotation = down
                scale = -1, 1
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 8376, 7800
                scale = -1, 1
            ]

            port b {
                position = right:4
                kind = pe
            }
            [
                position = 8376, 7896
                scale = -1, 1
            ]

            port c {
                position = right:6
                kind = pe
            }
            [
                position = 8376, 7992
                scale = -1, 1
            ]

            junction Junction1 pe
            [
                position = 8256, 7800
            ]

            junction Junction2 pe
            [
                position = 8272, 7896
            ]

            junction Junction3 pe
            [
                position = 8288, 7992
            ]

            connect "Core Coupling 1.a_in" Junction1 as Connection42
            connect "Core Coupling 1.b_in" Junction2 as Connection40
            connect Junction1 "RC Snubber.A" as Connection31
            connect Junction2 "RC Snubber.B" as Connection34
            connect Junction3 "Core Coupling 1.c_in" as Connection43
            connect "RC Snubber.C" Junction3 as Connection36
            connect a Junction1 as Connection32
            connect b Junction2 as Connection35
            connect c Junction3 as Connection38
            connect A "Core Coupling 1.a_out" as Connection44
            connect B "Core Coupling 1.b_out" as Connection45
            connect C "Core Coupling 1.c_out" as Connection46
        }
        [
            position = 7360, 8920
            rotation = right
            scale = -1, 1
            size = 48, 160
        ]

        component Subsystem Fuel_Cell {
            layout = dynamic
            component src_scada_input Connect {
                addr = "1427111948"
                execution_rate = "Ts_Var"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7928, 7928
            ]

            component src_scada_input V_ref {
                def_value = "208.0"
                execution_rate = "Ts_Var"
                max = "2.0*208.0"
                min = "0"
                unit = "V (line to line)"
            }
            [
                position = 7992, 8056
            ]

            component src_scada_input Pref_FC {
                def_value = "40"
                execution_rate = "Ts_Var"
                max = "50"
                min = "0"
                unit = "kW"
            }
            [
                position = 7928, 8016
            ]

            component src_scada_input Q_mode {
                execution_rate = "Ts_Var"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7928, 8104
            ]

            component gen_bus_join "Bus Join4" {
                inputs = "6"
            }
            [
                position = 8072, 8248
                rotation = right
                hide_name = True
            ]

            component gen_probe Out {
            }
            [
                position = 8448, 8272
            ]

            component Subsystem interface {
                layout = dynamic
                component gen_bus_split "Bus Split1" {
                    outputs = "5"
                }
                [
                    position = 8048, 8256
                    hide_name = True
                ]

                component gen_terminator Termination2 {
                }
                [
                    position = 8128, 8136
                    rotation = left
                    hide_name = True
                ]

                component gen_c_function SM {
                    in_terminal_dimensions = "inherit;inherit"
                    in_terminal_dimensions_str = "enable_in inherit;force_off inherit"
                    in_terminal_labels = "False;False;"
                    in_terminal_properties = "real enable_in;inherit force_off;"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "enable inherit"
                    out_terminal_labels = "False;"
                    out_terminal_properties = "real enable;"
                    output_fnc = "/*Begin code section*/
if(force_off){
    enable = 0;
}
else{
    enable = enable_in;
}
/*End code section*/"
                }
                [
                    position = 8336, 8280
                    size = 48, 48
                ]

                component gen_terminator Termination3 {
                }
                [
                    position = 8160, 8096
                    rotation = left
                    hide_name = True
                ]

                component "core/Rate Transition" "Rate Transition1" {
                    execution_rate = "Ts_Var"
                }
                [
                    position = 8232, 8288
                    hide_name = True
                    size = 32, 32
                ]

                component gen_terminator Termination4 {
                }
                [
                    position = 8192, 8136
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 8096, 8176
                    rotation = left
                    hide_name = True
                ]

                port fromPMS {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7976, 8256
                ]

                port Enable_in {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8296, 8192
                    rotation = right
                ]

                port Enable {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8408, 8280
                ]

                connect "Rate Transition1.in" "Bus Split1.out4" as Connection873
                connect Termination3.in "Bus Split1.out2" as Connection876
                connect SM.force_off "Rate Transition1.out" as Connection878
                connect SM.enable_in Enable_in as Connection879
                connect Termination2.in "Bus Split1.out1" as Connection875
                connect Termination4.in "Bus Split1.out3" as Connection877
                connect Termination1.in "Bus Split1.out" as Connection874
                connect SM.enable Enable as Connection881
                connect "Bus Split1.in" fromPMS as Connection880
            }
            [
                position = 7568, 7984
                size = 112, 96
            ]

            component src_scada_input Enable {
                addr = "1427111948"
                execution_rate = "Ts_Var"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7424, 7952
            ]

            component src_scada_input Q_ref {
                execution_rate = "Ts_Var"
                unit = "kVAr"
            }
            [
                position = 7992, 8152
            ]

            component Subsystem "SOFC inverter" {
                layout = static
                component "core/Three Phase Inverter" "3ph_inverter 1" {
                    carrier_freq = "fsw"
                    ctrl_src = "Internal modulator"
                    d_time = "1e-6"
                }
                [
                    position = 7736, 8248
                    size = 127, 256
                ]

                component pas_capacitor Ca1 {
                    capacitance = "18.8e-2"
                }
                [
                    position = 7472, 8248
                    rotation = right
                ]

                component gen_c_function delay {
                    global_variables = "real counter;"
                    in_terminal_dimensions = "inherit"
                    in_terminal_dimensions_str = "in inherit"
                    in_terminal_labels = "False;"
                    init_fnc = "/*Begin code section*/
out = 0;
counter = 0;
/*End code section*/"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "out inherit"
                    out_terminal_labels = "False;"
                    output_fnc = "/*Begin code section*/
if(out == 0){
    if(in > 0.5){
        counter += execution_rate;
        if(counter>Delay){
            out = 1;
        }
    }
    else{
        counter -= counter;
        out = 0;
    }
}
else{
    counter = 0;
    if(in <= 0.5){
        out = 0;
    }
}
/*End code section*/"
                    parameters = "real Delay;"
                }
                [
                    position = 7448, 8080
                    size = 48, 48
                ]

                component pas_resistor R0b {
                    resistance = "R0"
                }
                [
                    position = 8024, 8248
                ]

                component pas_resistor R8 {
                    resistance = "Rres"
                }
                [
                    position = 8328, 8416
                    rotation = right
                ]

                component pas_inductor L4 {
                    inductance = "L"
                }
                [
                    position = 8824, 8344
                ]

                component gen_digital_probe On {
                }
                [
                    position = 7608, 8080
                    rotation = right
                ]

                component pas_resistor R0c1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8344
                ]

                component pas_inductor L2 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8248
                ]

                component Subsystem SOFC {
                    layout = dynamic
                    component "core/Current Measurement" Ia1 {
                        sig_output = "True"
                    }
                    [
                        position = 8304, 8264
                        size = 64, 32
                    ]

                    component Subsystem SOFC {
                        layout = dynamic
                        component gen_sum Sum2 {
                            signs = "+-"
                        }
                        [
                            position = 7520, 8024
                        ]

                        component pas_resistor R1 {
                            resistance = "r_ohm*N0"
                        }
                        [
                            position = 8944, 7856
                            rotation = right
                        ]

                        component src_voltage Vs1 {
                            init_const_value = "E0*N0"
                            override_signal_name = "True"
                            signal_name = "E0*N0"
                        }
                        [
                            position = 9072, 8032
                            rotation = right
                        ]

                        component gen_gain N0 {
                            gain = "N0"
                        }
                        [
                            position = 8816, 8048
                        ]

                        component gen_gain 1divtau_f {
                            gain = "1/tau_f"
                        }
                        [
                            position = 7776, 7904
                        ]

                        component gen_gain K_r {
                            gain = "K_r"
                        }
                        [
                            position = 7312, 8160
                            rotation = right
                        ]

                        component gen_product Product1 {
                            signs = "*/*"
                        }
                        [
                            position = 8464, 8048
                        ]

                        component gen_integrator Integrator3 {
                            init_value = "p_H2O_0"
                        }
                        [
                            position = 7968, 8216
                        ]

                        component gen_integrator Integrator4 {
                            init_value = "p_O2_0"
                        }
                        [
                            position = 8112, 8392
                        ]

                        component gen_sum Sum1 {
                            signs = "+-"
                        }
                        [
                            position = 7632, 7904
                        ]

                        component gen_gain 1divK_H2 {
                            gain = "1/K_H2"
                        }
                        [
                            position = 7696, 8024
                        ]

                        component gen_gain 1divtau_H2O {
                            gain = "1/tau_H2O"
                        }
                        [
                            position = 7824, 8216
                        ]

                        component gen_integrator Integrator2 {
                            init_value = "p_H2_0"
                        }
                        [
                            position = 8096, 8032
                        ]

                        component gen_gain "R*Tdiv2divF" {
                            gain = "R*T/2/F"
                        }
                        [
                            position = 8704, 8048
                        ]

                        component gen_bus_join "Bus Join1" {
                            inputs = "6"
                        }
                        [
                            position = 8960, 8384
                        ]

                        component gen_gain 1div_r_HO1 {
                            gain = "1/r_HO"
                        }
                        [
                            position = 7488, 8336
                            rotation = right
                        ]

                        component gen_sum Sum6 {
                            signs = "+-"
                        }
                        [
                            position = 7824, 8392
                        ]

                        component "core/Signal Controlled Voltage Source" Vsp1 {
                        }
                        [
                            position = 8976, 7936
                            size = 64, 32
                        ]

                        component gen_sum Sum4 {
                            signs = "+-"
                        }
                        [
                            position = 7680, 8216
                        ]

                        component gen_math_fnc exponential {
                            mathematical_fn = "sqrt"
                        }
                        [
                            position = 8400, 8304
                            rotation = left
                        ]

                        component gen_sum Sum3 {
                            signs = "+-"
                        }
                        [
                            position = 7808, 8032
                        ]

                        component gen_gain 1divtau_H2 {
                            gain = "1/tau_H2"
                        }
                        [
                            position = 7952, 8032
                        ]

                        component gen_gain 1divK_O2 {
                            gain = "1/K_O2"
                        }
                        [
                            position = 7696, 8384
                        ]

                        component gen_gain 1divtau_O2 {
                            gain = "1/tau_O2"
                        }
                        [
                            position = 7968, 8392
                        ]

                        component gen_gain 2KrdivUopt {
                            gain = "2*K_r/U_opt"
                        }
                        [
                            position = 7552, 7840
                            rotation = right
                        ]

                        component gen_sum Sum5 {
                            signs = "+-"
                        }
                        [
                            position = 7568, 8384
                        ]

                        component gen_gain 1divK_H2O {
                            gain = "1/K_H2O"
                        }
                        [
                            position = 7456, 8128
                            rotation = right
                        ]

                        component gen_gain 2K_r {
                            gain = "2*K_r"
                        }
                        [
                            position = 7376, 8032
                        ]

                        component gen_math_fnc Ln {
                            mathematical_fn = "ln"
                        }
                        [
                            position = 8592, 8048
                        ]

                        component gen_integrator Integrator1 {
                            init_value = "q_H2_0"
                        }
                        [
                            position = 7904, 7904
                        ]

                        port In1 {
                            label = "IDC"
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7312, 7744
                            rotation = right
                        ]

                        port Out3 {
                            label = "m"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9032, 8384
                        ]

                        port P2 {
                            label = "VDC+"
                            position = right:2
                            kind = pe
                        }
                        [
                            position = 8944, 7776
                            rotation = right
                        ]

                        port P4 {
                            label = "VDC-"
                            position = right:3
                            kind = pe
                        }
                        [
                            position = 9072, 8112
                            rotation = left
                        ]

                        tag p_H2O {
                            value = "p_H2O"
                            scope = global
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8336, 8216
                        ]

                        tag q_H2 {
                            value = "q_H2"
                            scope = global
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8064, 7904
                        ]

                        tag I_DC {
                            value = "I_DC"
                            scope = global
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7776, 7792
                        ]

                        tag From5 {
                            value = "p_O2"
                            scope = global
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8752, 8528
                        ]

                        tag From2 {
                            value = "q_H2"
                            scope = global
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8736, 8344
                        ]

                        tag p_H2 {
                            value = "p_H2"
                            scope = global
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8288, 7944
                        ]

                        tag qH2 {
                            value = "q_H2"
                            scope = global
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7488, 8248
                            rotation = right
                        ]

                        tag From6 {
                            value = "V_Nernst"
                            scope = global
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8752, 8592
                        ]

                        tag p_O2 {
                            value = "p_O2"
                            scope = global
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8480, 8392
                        ]

                        tag IDC {
                            value = "I_DC"
                            scope = global
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8736, 8280
                        ]

                        tag From4 {
                            value = "p_H2O"
                            scope = global
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8736, 8464
                        ]

                        tag V_Nernst {
                            value = "V_Nernst"
                            scope = global
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8960, 8048
                        ]

                        tag From3 {
                            value = "p_H2"
                            scope = global
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8736, 8408
                        ]

                        junction Junction11 sp
                        [
                            position = 8400, 8392
                        ]

                        junction Junction9 sp
                        [
                            position = 8224, 8216
                        ]

                        junction Junction14 sp
                        [
                            position = 8864, 8048
                        ]

                        junction Junction2 sp
                        [
                            position = 7584, 7968
                        ]

                        junction Junction1 sp
                        [
                            position = 7984, 7904
                        ]

                        junction Junction7 sp
                        [
                            position = 8176, 8040
                        ]

                        junction Junction10 sp
                        [
                            position = 8224, 8392
                        ]

                        junction Junction5 sp
                        [
                            position = 8176, 8032
                        ]

                        junction Junction15 sp
                        [
                            position = 7312, 7792
                        ]

                        junction Junction13 sp
                        [
                            position = 7552, 7792
                        ]

                        junction Junction12 sp
                        [
                            position = 7312, 8032
                        ]

                        junction Junction6 sp
                        [
                            position = 7472, 8032
                        ]

                        junction Junction8 sp
                        [
                            position = 8224, 8216
                        ]

                        connect K_r.out Sum5.in1 as Connection50
                        connect Vsp1.in Junction14 as Connection90
                        connect 1divK_H2O.out Sum4.in as Connection31
                        connect Junction9 Junction8 as Connection46
                        [
                            breakpoints = 8224, 8216; 8224, 8216
                        ]
                        connect p_H2 Junction7 as Connection32
                        connect 1divtau_H2O.out Integrator3.in as Connection36
                        connect Integrator2.out Junction5 as Connection25
                        connect Vsp1.p_node R1.n_node as Connection92
                        connect Junction6 Sum2.in1 as Connection29
                        connect K_r.in Junction12 as Connection78
                        [
                            breakpoints = 7312, 8136
                        ]
                        connect Sum3.in1 Junction7 as Connection34
                        [
                            breakpoints = 8176, 8112; 8176, 8040
                        ]
                        connect p_O2 Junction11 as Connection68
                        connect Sum4.in1 Junction9 as Connection45
                        [
                            breakpoints = 7632, 8288; 8224, 8288
                        ]
                        connect "Bus Join1.out" Out3 as Connection105
                        connect Sum2.out 1divK_H2.in as Connection20
                        connect Sum3.out 1divtau_H2.in as Connection22
                        connect 1divK_H2O.in Junction6 as Connection30
                        connect From3 "Bus Join1.in2" as Connection100
                        [
                            breakpoints = 8784, 8368; 8912, 8368
                        ]
                        connect Ln.out "R*Tdiv2divF.in" as Connection85
                        connect 2KrdivUopt.in Junction13 as Connection83
                        connect Junction13 Junction15 as Connection95
                        connect Junction15 Junction12 as Connection96
                        [
                            breakpoints = 7312, 7800; 7312, 8032
                        ]
                        connect From6 "Bus Join1.in5" as Connection103
                        [
                            breakpoints = 8848, 8592; 8848, 8424
                        ]
                        connect Sum5.out 1divK_O2.in as Connection51
                        connect 1divtau_H2.out Integrator2.in as Connection23
                        connect 1divK_O2.out Sum6.in as Connection52
                        connect Junction14 V_Nernst as Connection89
                        connect Junction5 Product1.in as Connection26
                        connect Sum1.in1 Junction2 as Connection12
                        connect Junction11 Junction10 as Connection69
                        connect Junction10 Sum6.in1 as Connection66
                        [
                            breakpoints = 8224, 8392; 8224, 8464; 8224, 8464; 7776, 8464
                        ]
                        connect Integrator1.out Junction1 as Connection7
                        connect "R*Tdiv2divF.out" N0.in as Connection86
                        connect 1divK_H2.out Sum3.in as Connection21
                        connect IDC "Bus Join1.in" as Connection98
                        connect N0.out Junction14 as Connection88
                        connect Sum6.out 1divtau_O2.in as Connection53
                        connect Junction1 q_H2 as Connection8
                        connect Sum2.in Junction2 as Connection10
                        [
                            breakpoints = 7472, 8016; 7472, 7968; 7488, 7968
                        ]
                        connect Junction15 In1 as Connection104
                        connect Integrator3.out Junction8 as Connection38
                        connect Product1.out Ln.in as Connection84
                        connect I_DC Junction13 as Connection81
                        connect exponential.out Product1.in2 as Connection71
                        connect Integrator4.out Junction10 as Connection65
                        [
                            breakpoints = 8208, 8392
                        ]
                        connect Junction7 Junction5 as Connection33
                        connect Vsp1.n_node Vs1.p_node as Connection91
                        connect Junction8 Product1.in1 as Connection39
                        [
                            breakpoints = 8224, 8216; 8224, 8048
                        ]
                        connect Sum1.out 1divtau_f.in as Connection4
                        connect exponential.in Junction11 as Connection70
                        connect 2KrdivUopt.out Sum1.in as Connection1
                        connect R1.p_node P2 as Connection106
                        connect From5 "Bus Join1.in4" as Connection102
                        [
                            breakpoints = 8816, 8528; 8816, 8408
                        ]
                        connect 1divtau_H2O.in Sum4.out as Connection35
                        connect 1div_r_HO1.out Sum5.in as Connection49
                        connect 2K_r.out Junction6 as Connection28
                        connect Vs1.n_node P4 as Connection107
                        connect Junction12 2K_r.in as Connection79
                        [
                            breakpoints = 7312, 8024; 7312, 8032; 7344, 8032
                        ]
                        connect Junction2 Junction1 as Connection11
                        [
                            breakpoints = 7584, 7968; 7984, 7968
                        ]
                        connect 1divtau_O2.out Integrator4.in as Connection54
                        connect From2 "Bus Join1.in1" as Connection99
                        [
                            breakpoints = 8784, 8344; 8896, 8344
                        ]
                        connect 1divtau_f.out Integrator1.in as Connection5
                        connect From4 "Bus Join1.in3" as Connection101
                        [
                            breakpoints = 8800, 8464; 8800, 8424; 8800, 8424; 8800, 8392
                        ]
                        connect qH2 1div_r_HO1.in as Connection48
                        connect p_H2O Junction9 as Connection47

                        I_FC_0 = "250"
                        K = "[8.43e-4, 2.81e-4, 2.52e-3]"
                        N0 = "500"
                        Ts = "1e-6"
                        U = "[0.9, 0.8, 0.85]"
                        r_ohm = "0.126e-4"
                        taus = "[26.1, 78.3, 2.91]"

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This block models a Solid Oxide Fuel Cell. The model assumes the following:</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">i.   The fuel cell gases are ideal</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">ii.  Only one pressure is defined in the interior of the electrodes</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">iii. The fuel cell temperature is invariant</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">iv.  Nernst\'s equation applies.</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The model is taken from:</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Y. Zhu and K. Tomsovic, \'Development of models for analyzing the load-following performance of microturbines and fuel cells\', Electric Power Systems Research,62, 2002, 1-11.</p></body></html>"

                            T {
                                label = "Absolute temperature (K)"
                                widget = edit
                                type = generic
                                default_value = "1273"
                            }

                            I_FC_0 {
                                label = "Initial current (A)"
                                widget = edit
                                type = generic
                                default_value = "100"
                            }

                            F {
                                label = "Faraday\'s constant (C/kmol)"
                                widget = edit
                                type = generic
                                default_value = "96.487e6"
                            }

                            R {
                                label = "Universal gas constant J/(kmol K)"
                                widget = edit
                                type = generic
                                default_value = "8314"
                            }

                            E0 {
                                label = "Ideal standard potential (V)"
                                widget = edit
                                type = generic
                                default_value = "1.18"
                            }

                            N0 {
                                label = "Number of cells in series"
                                widget = edit
                                type = generic
                                default_value = "450"
                            }

                            U {
                                label = "Maximum, minimal and optimal fuel utilization"
                                widget = edit
                                type = generic
                                default_value = "[0.9 0.8 0.5]"
                            }

                            K {
                                label = "Valve molar constant for hydrogen, water and oxygen (kmol/(s atm)"
                                widget = edit
                                type = generic
                                default_value = "[8.43e-4 2.81e-4 2.52e-3]"
                            }

                            taus {
                                label = "Response time for hydrogen, water and oxygen flow (s)"
                                widget = edit
                                type = generic
                                default_value = "[26.1 78.3 2.91]"
                            }

                            r_ohm {
                                label = "Ohmic loss per cell (ohms)"
                                widget = edit
                                type = generic
                                default_value = "3.2813e-004"
                            }

                            tau_e {
                                label = "Electrical response time (s)"
                                widget = edit
                                type = generic
                                default_value = "0.8"
                            }

                            tau_f {
                                label = "Fuel processor response time (s)"
                                widget = edit
                                type = generic
                                default_value = "5"
                            }

                            r_HO {
                                label = "Ratio of hydrogen to oxygen"
                                widget = edit
                                type = generic
                                default_value = "1.145"
                            }

                            Ts {
                                label = "Execution Rate"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "s"
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                                
                            ENDCODE

                            CODE init
                            ENDCODE
                        }
                    }
                    [
                        position = 8080, 8360
                        size = 80, 192
                    ]

                    component gen_probe Fuel_Cell {
                        override_signal_name = "True"
                        signal_name = "FC_mf"
                    }
                    [
                        position = 8512, 8352
                    ]

                    component gen_bus_split "Bus Split1" {
                        outputs = "6"
                    }
                    [
                        position = 8240, 8336
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 8376, 8296
                        hide_name = True
                    ]

                    component gen_terminator Termination2 {
                    }
                    [
                        position = 8312, 8312
                        hide_name = True
                    ]

                    component gen_terminator Termination3 {
                    }
                    [
                        position = 8368, 8328
                        hide_name = True
                    ]

                    component gen_terminator Termination4 {
                    }
                    [
                        position = 8376, 8384
                        hide_name = True
                    ]

                    component gen_terminator Termination5 {
                    }
                    [
                        position = 8336, 8400
                        hide_name = True
                    ]

                    component gen_gain Gain1 {
                        gain = "3600/1000"
                    }
                    [
                        position = 8432, 8352
                        hide_name = True
                    ]

                    port P1 {
                        label = "Vdc-"
                        position = right:2
                        kind = pe
                    }
                    [
                        position = 8576, 8456
                        rotation = left
                    ]

                    port P2 {
                        label = "Vdc+"
                        position = right:1
                        kind = pe
                    }
                    [
                        position = 8544, 8256
                        rotation = down
                    ]

                    tag IDC {
                        value = "I_DC"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8416, 8192
                    ]

                    junction Junction4 sp
                    [
                        position = 8304, 8192
                    ]

                    connect Ia1.n_node P2 as Connection167
                    connect Ia1.out Junction4 as Connection19
                    connect Junction4 SOFC.In1 as Connection20
                    [
                        breakpoints = 8304, 8192; 8024, 8192
                    ]
                    connect IDC Junction4 as Connection169
                    [
                        breakpoints = 8416, 8192; 8352, 8192
                    ]
                    connect SOFC.P4 P1 as Connection171
                    [
                        breakpoints = 8256, 8432
                    ]
                    connect SOFC.P2 Ia1.p_node as Connection172
                    [
                        breakpoints = 8176, 8360; 8176, 8264; 8248, 8264
                    ]
                    connect "Bus Split1.in" SOFC.Out3 as Connection173
                    connect Termination1.in "Bus Split1.out" as Connection175
                    connect Termination2.in "Bus Split1.out1" as Connection176
                    connect Termination3.in "Bus Split1.out2" as Connection177
                    connect Termination4.in "Bus Split1.out4" as Connection178
                    [
                        breakpoints = 8304, 8384; 8304, 8360
                    ]
                    connect Termination5.in "Bus Split1.out5" as Connection179
                    connect Gain1.in "Bus Split1.out3" as Connection180
                    connect Gain1.out Fuel_Cell.in as Connection181
                }
                [
                    position = 7192, 8232
                    size = 96, 192
                ]

                component "core/Voltage Measurement" Vc {
                    execution_rate = "Ts_Var"
                    sig_output = "True"
                }
                [
                    position = 8592, 8520
                    rotation = right
                    size = 64, 32
                ]

                component pas_resistor R0a1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8152
                ]

                component "core/Voltage Measurement" Vdc {
                    execution_rate = "Ts_Var"
                    override_signal_name = "True"
                    sig_output = "True"
                    signal_name = "FC_Vdc"
                }
                [
                    position = 7544, 8256
                    rotation = right
                    size = 64, 32
                ]

                component gen_logic_op "Logical operator1" {
                }
                [
                    position = 7544, 8040
                    hide_name = True
                ]

                component pas_resistor R7 {
                    resistance = "Rres"
                }
                [
                    position = 8248, 8416
                    rotation = right
                ]

                component "core/Current Measurement" Ib {
                    execution_rate = "Ts_Var"
                    sig_output = "True"
                }
                [
                    position = 8128, 8248
                    size = 64, 32
                ]

                component pas_resistor R9 {
                    resistance = "Rres"
                }
                [
                    position = 8416, 8416
                    rotation = right
                ]

                component pas_capacitor C3 {
                    capacitance = "C"
                }
                [
                    position = 8416, 8504
                    rotation = right
                ]

                component pas_resistor R0a {
                    resistance = "R0"
                }
                [
                    position = 8024, 8152
                ]

                component "core/Current Measurement" Ic {
                    execution_rate = "Ts_Var"
                    sig_output = "True"
                }
                [
                    position = 8128, 8344
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vab {
                }
                [
                    position = 7848, 8200
                    rotation = right
                    size = 64, 32
                ]

                component pas_inductor L3 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8344
                ]

                component "core/Current Measurement" Ia {
                    execution_rate = "Ts_Var"
                    sig_output = "True"
                }
                [
                    position = 8128, 8152
                    size = 64, 32
                ]

                component pas_inductor L6 {
                    inductance = "L"
                }
                [
                    position = 8824, 8248
                ]

                component Subsystem Output {
                    layout = dynamic
                    component gen_bus_join "Bus Join1" {
                        inputs = "14"
                    }
                    [
                        position = 8192, 8192
                        rotation = left
                        hide_name = True
                    ]

                    port Connected {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8248
                    ]

                    port Va {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8328
                    ]

                    port Vb {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8368
                    ]

                    port Ia {
                        position = left:7
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8496
                    ]

                    port Vc {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8408
                    ]

                    port Inv_On {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8288
                    ]

                    port Ic {
                        position = left:9
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8576
                    ]

                    port Outputs {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8192, 8120
                        rotation = left
                    ]

                    port Ib {
                        position = left:8
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8536
                    ]

                    tag From34 {
                        value = "f"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8624
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From33 {
                        value = "S"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8696
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From30 {
                        value = "P"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8648
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From32 {
                        value = "pf"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8720
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From29 {
                        value = "Vt"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8456
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From31 {
                        value = "Q"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8672
                        hide_name = True
                        size = 60, 20
                    ]

                    connect "Bus Join1.in1" Inv_On as Connection9
                    connect "Bus Join1.out" Outputs as Connection6
                    connect "Bus Join1.in" Connected as Connection5
                    connect From31 "Bus Join1.in11" as Connection13
                    connect "Bus Join1.in3" Vb as Connection3
                    connect "Bus Join1.in8" Ic as Connection1
                    connect From34 "Bus Join1.in9" as Connection11
                    connect From29 "Bus Join1.in5" as Connection10
                    connect From33 "Bus Join1.in12" as Connection14
                    connect "Bus Join1.in2" Va as Connection8
                    connect From32 "Bus Join1.in13" as Connection15
                    connect "Bus Join1.in7" Ib as Connection4
                    connect From30 "Bus Join1.in10" as Connection12
                    connect "Bus Join1.in6" Ia as Connection2
                    connect "Bus Join1.in4" Vc as Connection7
                }
                [
                    position = 8672, 7680
                    rotation = left
                    size = 96, 152
                ]

                component "core/Voltage Measurement" Vb {
                    execution_rate = "Ts_Var"
                    sig_output = "True"
                }
                [
                    position = 8536, 8472
                    rotation = right
                    size = 64, 32
                ]

                component pas_inductor L5 {
                    inductance = "L"
                }
                [
                    position = 8824, 8152
                ]

                component Subsystem Input {
                    layout = dynamic
                    component gen_bus_split "Bus Split2" {
                        outputs = "6"
                    }
                    [
                        position = 8136, 8104
                        rotation = right
                        hide_name = True
                    ]

                    port Inputs {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8136, 8032
                        rotation = right
                    ]

                    tag Goto32 {
                        value = "Connect"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8160
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto27 {
                        value = "Pref_SOFC"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8208
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto28 {
                        value = "V_ref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8232
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto30 {
                        value = "Q_mode"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8256
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto29 {
                        value = "Q_ref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8280
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto31 {
                        value = "Enable"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8184
                        hide_name = True
                        size = 0, 0
                    ]

                    connect "Bus Split2.out5" Goto29 as Connection760
                    connect "Bus Split2.out1" Goto31 as Connection756
                    connect "Bus Split2.out2" Goto27 as Connection757
                    connect "Bus Split2.out" Goto32 as Connection755
                    connect "Bus Split2.in" Inputs as Connection761
                    connect "Bus Split2.out3" Goto28 as Connection758
                    connect "Bus Split2.out4" Goto30 as Connection759
                }
                [
                    position = 7968, 7672
                    size = 72, 72
                ]

                component pas_resistor R0c {
                    resistance = "R0"
                }
                [
                    position = 8024, 8344
                ]

                component gen_digital_probe enable {
                }
                [
                    position = 7432, 7992
                    rotation = left
                ]

                component pas_resistor R4 {
                    resistance = "1e-3"
                }
                [
                    position = 7432, 8152
                ]

                component "core/Voltage Measurement" Va {
                    execution_rate = "Ts_Var"
                    sig_output = "True"
                }
                [
                    position = 8480, 8416
                    rotation = right
                    size = 64, 32
                ]

                component pas_inductor L1 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8152
                ]

                component "core/Triple Pole Single Throw Contactor" S1 {
                    ctrl_src = "Model"
                }
                [
                    position = 8944, 8248
                    size = 64, 256
                ]

                component pas_capacitor C2 {
                    capacitance = "C"
                }
                [
                    position = 8328, 8504
                    rotation = right
                ]

                component Subsystem Control {
                    layout = dynamic
                    component Subsystem Grid_follow {
                        layout = dynamic
                        component Subsystem Current_abc_to_dq {
                            layout = dynamic
                            component gen_terminator Termination1 {
                            }
                            [
                                position = 7920, 8080
                                rotation = right
                                hide_name = True
                            ]

                            component gen_gain Gain2 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 8008
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 7944
                                hide_name = True
                            ]

                            component "core/abc to dq" "abc to dq1" {
                            }
                            [
                                position = 7864, 8008
                                size = 48, 80
                            ]

                            port wt {
                                label = "wt"
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 8088
                                rotation = left
                            ]

                            port Id {
                                label = "Id"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 7944
                            ]

                            port Ia {
                                label = "Ia"
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 7936
                                rotation = right
                            ]

                            port Iq {
                                label = "Iq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8008
                            ]

                            port Ic {
                                label = "Ic"
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7744, 8088
                                rotation = left
                            ]

                            port Ib {
                                label = "Ib"
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 7936
                                rotation = right
                            ]

                            connect "abc to dq1.zero_axis" Termination1.in as Connection29
                            connect Ib "abc to dq1.vb" as Connection31
                            connect Iq Gain2.out as Connection26
                            connect "abc to dq1.q_axis" Gain2.in as Connection28
                            connect wt "abc to dq1.wt" as Connection33
                            connect Gain1.out Id as Connection24
                            connect "abc to dq1.va" Ia as Connection30
                            connect "abc to dq1.d_axis" Gain1.in as Connection27
                            connect "abc to dq1.vc" Ic as Connection32
                        }
                        [
                            position = 9352, 8408
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component sys_signal_switch "Signal switch4" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 7808, 8384
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch3" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8336, 8376
                            hide_name = True
                        ]

                        component Subsystem Limit_PQref {
                            layout = dynamic
                            component gen_rate_limiter "P rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8192
                            ]

                            component gen_rate_limiter "S rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8336
                            ]

                            component tm_delay "Unit Delay1" {
                            }
                            [
                                position = 8200, 8192
                                hide_name = True
                            ]

                            component gen_rate_limiter "Q rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8264
                            ]

                            component tm_delay "Unit Delay2" {
                            }
                            [
                                position = 8200, 8336
                                hide_name = True
                            ]

                            component Subsystem limS_overPQ {
                                layout = dynamic
                                component gen_c_function "S limiting over PQ" {
                                    global_variables = "real S_PQref;"
                                    in_terminal_dimensions = "inherit;inherit;inherit"
                                    in_terminal_dimensions_str = "Pref inherit;Qref inherit;Sref inherit"
                                    in_terminal_labels = "False;False;False;"
                                    in_terminal_properties = "inherit Pref;inherit Qref;inherit Sref;"
                                    init_fnc = "/*Begin code section*/
S_PQref = 0;
/*End code section*/"
                                    no_feed_inputs = "[\'\']"
                                    no_feed_outputs = "[\'\']"
                                    out_terminal_dimensions = "inherit;inherit"
                                    out_terminal_dimensions_str = "P inherit;Q inherit"
                                    out_terminal_labels = "False;False;"
                                    out_terminal_properties = "inherit P;inherit Q;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
S_PQref = sqrt(Pref*Pref+Qref*Qref);

if (S_PQref > Sref) {
    P = (Pref/S_PQref)*Sref;
    Q = (Qref/S_PQref)*Sref;
} else {
    P = Pref;
    Q = Qref;
}
/*End code section*/"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8120
                                    rotation = left
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8112
                                    rotation = right
                                ]

                                port Sref {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8272
                                    rotation = left
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8040, 8192
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8272
                                    rotation = right
                                ]

                                connect "S limiting over PQ.Sref" Sref as Connection4
                                connect "S limiting over PQ.Qref" Qref as Connection1
                                connect "S limiting over PQ.P" P as Connection3
                                connect "S limiting over PQ.Pref" Pref as Connection5
                                connect "S limiting over PQ.Q" Q as Connection2
                            }
                            [
                                position = 8096, 8264
                                size = 56, 184
                            ]

                            component Subsystem priority_PQlim {
                                layout = dynamic
                                component gen_c_function "PQ limiting with priority" {
                                    global_variables = "real signQ;real signP;real Sref;"
                                    in_terminal_dimensions = "inherit;inherit;inherit"
                                    in_terminal_dimensions_str = "Pref inherit;Qref inherit;Smax inherit"
                                    in_terminal_labels = "False;False;False;"
                                    in_terminal_properties = "inherit Pref;inherit Qref;inherit Smax;"
                                    init_fnc = "/*Begin code section*/
Sref = 0;
/*End code section*/"
                                    no_feed_inputs = "[\'\']"
                                    no_feed_outputs = "[\'\']"
                                    out_terminal_dimensions = "inherit;inherit;inherit"
                                    out_terminal_dimensions_str = "P inherit;Q inherit;S inherit"
                                    out_terminal_labels = "False;False;False;"
                                    out_terminal_properties = "inherit P;inherit Q;inherit S;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
Sref = sqrt(Pref*Pref+Qref*Qref);

if (Qref>=0) signQ = 1;
else signQ = -1;
if (Pref>=0) signP = 1;
else signP = -1;

if (Sref <= Smax) {
    S = Sref;
    P = Pref;
    Q = Qref;
} else {
    S = Smax;
    if (type==1) {
        // P priority
        if (fabs(Pref) > Smax) {
            P = signP*Smax;
            Q = 0;
        } else {
            P = Pref;
            Q = signQ*sqrt(Smax*Smax - Pref*Pref);
        }
    } else if (type == 2) {
        // Q priority
        if (fabs(Qref) > Smax) {
            Q = signQ*Smax;
            P = 0;
        } else {
            Q = Qref;
            P = signP*sqrt(Smax*Smax-Qref*Qref);
        }
    } else {
        // Preserve Power Factor
        P = (Pref/Sref)*Smax;
        Q = (Qref/Sref)*Smax;
    }
}
/*End code section*/"
                                    parameters = "real type;"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8128
                                    rotation = left
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8128
                                    rotation = right
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8368, 8192
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8032, 8192
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8272
                                    rotation = right
                                ]

                                port Smax {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8272
                                    rotation = left
                                ]

                                connect "PQ limiting with priority.Smax" Smax as Connection1
                                connect "PQ limiting with priority.Qref" Qref as Connection3
                                connect "PQ limiting with priority.Pref" Pref as Connection2
                                connect "PQ limiting with priority.P" P as Connection5
                                connect "PQ limiting with priority.S" S as Connection4
                                connect "PQ limiting with priority.Q" Q as Connection6
                            }
                            [
                                position = 7872, 8264
                                size = 56, 184
                            ]

                            port Qref {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8264
                            ]

                            port Plim {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8192
                            ]

                            port Qlim {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8336
                            ]

                            port Pref {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8192
                            ]

                            port Smax {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8336
                            ]

                            connect "Q rate limit.in" priority_PQlim.Q as Connection159
                            connect "Unit Delay2.in" limS_overPQ.Q as Connection163
                            connect Pref priority_PQlim.Pref as Connection155
                            connect "Q rate limit.out" limS_overPQ.Qref as Connection162
                            connect "Unit Delay1.in" limS_overPQ.P as Connection164
                            connect Plim "Unit Delay1.out" as Connection161
                            connect Qref priority_PQlim.Qref as Connection156
                            connect "S rate limit.out" limS_overPQ.Sref as Connection165
                            connect "P rate limit.in" priority_PQlim.P as Connection158
                            connect "S rate limit.in" priority_PQlim.S as Connection157
                            connect "Unit Delay2.out" Qlim as Connection160
                            connect Smax priority_PQlim.Smax as Connection154
                            connect "P rate limit.out" limS_overPQ.Pref as Connection166

                            type = "1.0"

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Generate Power reference respecting limits defined by maximum apparent power and type of priority.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Choose type parameter to define the behaviour of the block on saturation: Type=0 preserves power factor, Type=1 prioritizes Active Power, Type=2 prioritizes reactive power.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Limited power outputs \"Plim\" and \"Qlim\" have one sample delay and can be used for higher level controller anti-windup purposes.</span></p></body></html>"

                                type {
                                    label = "Priority type"
                                    widget = edit
                                    type = generic
                                    default_value = "2.0"
                                }

                                ratemax {
                                    label = "Max power rate"
                                    widget = edit
                                    type = generic
                                    default_value = "powerRate"
                                    unit = "pu/s"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 9216, 8024
                            rotation = right
                            size = 64, 96
                        ]

                        component gen_gain Gain4 {
                            gain = "1.0/Vn"
                        }
                        [
                            position = 7696, 8368
                            hide_name = True
                        ]

                        component gen_sum Sum1 {
                            signs = "+-"
                        }
                        [
                            position = 7912, 8432
                            hide_name = True
                        ]

                        component gen_digital_probe Qmode {
                        }
                        [
                            position = 8512, 8320
                        ]

                        component Subsystem ControlSignal_Calculation {
                            layout = dynamic
                            component gen_probe Vdc {
                            }
                            [
                                position = 7136, 8424
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 6984, 8168
                                hide_name = True
                            ]

                            component gen_sum Sum8 {
                            }
                            [
                                position = 7816, 8096
                                hide_name = True
                            ]

                            component Subsystem PI_d {
                                layout = dynamic
                                component gen_gain Kb {
                                }
                                [
                                    position = 8280, 8344
                                    scale = -1, 1
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8312, 8184
                                    hide_name = True
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[-1.15]"
                                    limit_upper = "[1.15]"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8256
                                    hide_name = True
                                ]

                                component gen_gain Ki {
                                    gain = "Id_Ki"
                                }
                                [
                                    position = 7992, 8240
                                ]

                                component gen_gain Kp {
                                    gain = "Id_Kp"
                                }
                                [
                                    position = 8168, 8176
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "Id_lowLim"
                                    upper_limit = "Id_upLim"
                                }
                                [
                                    position = 8472, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8384, 8344
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8104, 8248
                                    hide_name = True
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8136, 8296
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7848, 8200
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8576, 8184
                                ]

                                junction Junction74 sp
                                [
                                    position = 7912, 8200
                                ]

                                junction Junction73 sp
                                [
                                    position = 8504, 8184
                                ]

                                junction Junction72 sp
                                [
                                    position = 8432, 8184
                                ]

                                connect Out Junction73 as Connection61
                                connect Kp.out Sum5.in as Connection66
                                connect Junction73 Limit1.out as Connection60
                                connect Sum7.in1 Kb.out as Connection53
                                connect Junction72 Limit1.in as Connection57
                                connect Sum6.in1 Junction73 as Connection59
                                connect Sum7.out Integrator1.in as Connection63
                                connect Sum6.in Junction72 as Connection56
                                connect Junction74 In as Connection73
                                connect Reset Integrator1.reset as Connection64
                                connect Sum5.in1 Integrator1.out as Connection6
                                connect Ki.out Sum7.in as Connection71
                                connect Ki.in Junction74 as Connection74
                                connect Kb.in Sum6.out as Connection50
                                connect Kp.in Junction74 as Connection72
                                connect Sum5.out Junction72 as Connection58
                            }
                            [
                                position = 6904, 8072
                                size = 64, 48
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 6768, 8280
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_gain Gain5 {
                                gain = "0.5"
                            }
                            [
                                position = 7208, 8472
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "L0*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 6880, 8176
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                            }
                            [
                                position = 7392, 8080
                                hide_name = True
                            ]

                            component gen_z_domain_transfer LPF_dc {
                                a_coeff = "[1.0/(2*np.pi*1),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 6864, 8472
                            ]

                            component gen_sum Sum6 {
                            }
                            [
                                position = 7136, 8368
                                hide_name = True
                            ]

                            component gen_product Product7 {
                                signs = "*/"
                            }
                            [
                                position = 7504, 8296
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "+-"
                            }
                            [
                                position = 7144, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 7392, 8288
                                hide_name = True
                            ]

                            component Subsystem PI_q {
                                layout = dynamic
                                component gen_limiter Limit1 {
                                    lower_limit = "Iq_lowLim"
                                    upper_limit = "Iq_upLim"
                                }
                                [
                                    position = 8472, 8184
                                    hide_name = True
                                ]

                                component gen_gain Kp {
                                    gain = "Iq_Kp"
                                }
                                [
                                    position = 8136, 8176
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8312, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8384, 8344
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_gain Ki {
                                    gain = "Iq_Ki"
                                }
                                [
                                    position = 8008, 8240
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8280, 8344
                                    scale = -1, 1
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8104, 8248
                                    hide_name = True
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[-1.15]"
                                    limit_upper = "[1.15]"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8256
                                    hide_name = True
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7912, 8208
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8576, 8184
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8120, 8296
                                ]

                                junction Junction73 sp
                                [
                                    position = 8504, 8184
                                ]

                                junction Junction72 sp
                                [
                                    position = 8432, 8184
                                ]

                                junction Junction74 sp
                                [
                                    position = 7968, 8208
                                ]

                                connect Sum5.in1 Integrator1.out as Connection6
                                connect Reset Integrator1.reset as Connection64
                                connect Sum7.out Integrator1.in as Connection63
                                connect Sum6.in1 Junction73 as Connection59
                                connect Sum7.in1 Kb.out as Connection53
                                connect Junction74 In as Connection69
                                connect Junction73 Limit1.out as Connection60
                                connect Junction72 Limit1.in as Connection57
                                connect Kp.out Sum5.in as Connection65
                                connect Sum5.out Junction72 as Connection58
                                connect Out Junction73 as Connection61
                                connect Ki.in Junction74 as Connection70
                                connect Kb.in Sum6.out as Connection50
                                connect Sum6.in Junction72 as Connection56
                                connect Ki.out Sum7.in as Connection66
                                connect Kp.in Junction74 as Connection68
                            }
                            [
                                position = 6936, 8280
                                size = 64, 48
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 7704, 8152
                                hide_name = True
                            ]

                            component gen_product Product8 {
                                signs = "*/"
                            }
                            [
                                position = 7488, 8088
                                hide_name = True
                            ]

                            component gen_sum Sum9 {
                            }
                            [
                                position = 7816, 8288
                                hide_name = True
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 6968, 8376
                                hide_name = True
                            ]

                            component gen_gain Gain2 {
                                gain = "L0*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 6872, 8384
                                hide_name = True
                            ]

                            component gen_gain Gain11 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7600, 8296
                                hide_name = True
                            ]

                            component gen_gain Gain10 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7600, 8088
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 6768, 8072
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 7704, 8216
                                hide_name = True
                            ]

                            component src_constant Damp {
                                execution_rate = "Ts"
                                value = "Damp"
                            }
                            [
                                position = 7616, 8184
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 6952, 8472
                                hide_name = True
                            ]

                            port Iq_ref {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6688, 8232
                                rotation = down
                                scale = -1, 1
                            ]

                            port Iq_meas {
                                position = right:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6488, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port Reset {
                                position = top:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6848, 8008
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vq {
                                position = top:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7056, 8360
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_meas {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6488, 8080
                                rotation = down
                                scale = -1, 1
                            ]

                            port md {
                                label = "Ud"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port mq {
                                label = "Uq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port w {
                                position = top:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6496, 8512
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6688, 8024
                                rotation = down
                                scale = -1, 1
                            ]

                            port VDC {
                                position = top:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6800, 8472
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7056, 8152
                                rotation = down
                                scale = -1, 1
                            ]

                            tag From23 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6888, 8136
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From28 {
                                value = "Iq"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7560, 8224
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto4 {
                                value = "Iq"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6592, 8312
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6600, 8512
                                size = 0, 0
                            ]

                            tag Goto3 {
                                value = "Id"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6608, 8056
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From27 {
                                value = "Id"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7560, 8144
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto2 {
                                value = "Reset"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6984, 8008
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From26 {
                                value = "Reset"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6816, 8224
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From25 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6872, 8344
                                hide_name = True
                                size = 60, 20
                            ]

                            junction Junction146 sp
                            [
                                position = 6640, 8080
                            ]

                            junction Junction164 sp
                            [
                                position = 6904, 8008
                            ]

                            junction Junction145 sp
                            [
                                position = 6592, 8288
                            ]

                            junction Junction155 sp
                            [
                                position = 7440, 8304
                            ]

                            junction Junction151 sp
                            [
                                position = 6536, 8288
                            ]

                            junction Junction150 sp
                            [
                                position = 6544, 8080
                            ]

                            junction Junction166 sp
                            [
                                position = 7072, 8472
                            ]

                            junction Junction165 sp
                            [
                                position = 7656, 8184
                            ]

                            connect mq Sum9.out as Connection174
                            connect Junction166 Vdc.in as Connection185
                            connect From23 Product1.in as Connection1
                            connect Vq Sum6.in as Connection32
                            connect Junction151 Iq_meas as Connection68
                            connect Sum3.in PI_d.Out as Connection178
                            connect Damp.out Junction165 as Connection182
                            connect PI_d.In Sum1.out as Connection55
                            connect Gain5.in Junction166 as Connection193
                            connect From25 Product2.in as Connection2
                            connect Gain1.out Product1.in1 as Connection6
                            connect Product6.in Junction165 as Connection180
                            connect PI_q.In Sum2.out as Connection165
                            connect Gain1.in Junction145 as Connection5
                            connect Gain10.out Sum8.in as Connection189
                            connect Sum9.in1 Gain11.out as Connection190
                            connect Vd Sum5.in as Connection31
                            connect Sum8.out md as Connection173
                            connect Product5.in From27 as Connection101
                            connect Sum7.in1 Sum6.out as Connection176
                            connect Limit3.out Junction166 as Connection186
                            connect Sum6.in1 Product2.out as Connection26
                            connect Junction145 Junction151 as Connection67
                            connect Product5.out Sum8.in1 as Connection95
                            connect PI_d.Reset Junction164 as Connection172
                            connect Sum5.in1 Product1.out as Connection24
                            connect Product8.in Sum3.out as Connection143
                            connect Junction165 Product5.in1 as Connection181
                            connect Limit3.in LPF_dc.out as Connection187
                            connect Sum1.in1 Id_ref as Connection20
                            connect Sum5.out Sum3.in1 as Connection177
                            connect From26 PI_q.Reset as Connection169
                            connect Product6.out Sum9.in as Connection96
                            connect VDC LPF_dc.in as Connection124
                            connect Product6.in1 From28 as Connection102
                            connect Junction155 Gain5.out as Connection192
                            connect Junction164 Reset as Connection171
                            connect Sum7.in PI_q.Out as Connection175
                            connect Junction150 Id_meas as Connection65
                            connect Junction155 Product7.in1 as Connection116
                            connect Sum2.in1 Iq_ref as Connection22
                            connect Junction146 Junction150 as Connection64
                            connect Product7.in Sum7.out as Connection145
                            connect Goto3 Junction150 as Connection66
                            connect Goto4 Junction151 as Connection69
                            connect Sum2.in Junction145 as Connection21
                            connect Gain11.in Product7.out as Connection191
                            connect Junction146 Sum1.in as Connection11
                            connect Product8.in1 Junction155 as Connection115
                            connect Goto2 Junction164 as Connection170
                            connect Gain2.in Junction146 as Connection7
                            connect Product8.out Gain10.in as Connection188
                            connect Goto1 w as Connection34
                            connect Gain2.out Product2.in1 as Connection8
                        }
                        [
                            position = 9696, 8272
                            scale = -1, 1
                            size = 168, 448
                        ]

                        component src_constant Constant2 {
                            execution_rate = "Ts_Var"
                            value = "0"
                        }
                        [
                            position = 8264, 8392
                            hide_name = True
                        ]

                        component gen_probe pf {
                        }
                        [
                            position = 9320, 7816
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_logic_op "Logical operator1" {
                            operator = "NOT"
                        }
                        [
                            position = 8000, 8344
                            rotation = right
                            hide_name = True
                        ]

                        component gen_probe Q {
                        }
                        [
                            position = 9320, 7688
                            rotation = down
                            scale = -1, 1
                        ]

                        component Subsystem PI_Vt {
                            layout = dynamic
                            component gen_gain Kp {
                                gain = "V_Kp"
                            }
                            [
                                position = 8112, 8200
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "V_lowLim"
                                upper_limit = "V_upLim"
                            }
                            [
                                position = 8456, 8208
                                hide_name = True
                            ]

                            component gen_gain Ki {
                                gain = "V_Ki"
                            }
                            [
                                position = 7992, 8280
                            ]

                            component gen_integrator Integrator1 {
                                limit_lower = "[-1.15]"
                                limit_upper = "[1.15]"
                                show_reset = "either"
                            }
                            [
                                position = 8216, 8304
                            ]

                            component gen_sum Sum5 {
                            }
                            [
                                position = 8312, 8208
                            ]

                            component gen_gain Kb {
                                gain = "1000.0"
                            }
                            [
                                position = 8256, 8384
                                scale = -1, 1
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8360, 8384
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 8080, 8288
                                hide_name = True
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8552, 8208
                            ]

                            port Reset {
                                label = "Reset"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8312
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7880, 8232
                            ]

                            junction Junction73 sp
                            [
                                position = 8488, 8208
                            ]

                            junction Junction74 sp
                            [
                                position = 7944, 8232
                            ]

                            junction Junction72 sp
                            [
                                position = 8416, 8208
                            ]

                            connect Sum5.out Junction72 as Connection65
                            connect Ki.out Sum7.in as Connection78
                            connect Sum5.in1 Integrator1.out as Connection6
                            connect Integrator1.reset Reset as Connection2
                            connect Junction73 Limit1.out as Connection67
                            connect Sum7.in1 Kb.out as Connection53
                            connect Ki.in Junction74 as Connection81
                            connect Kb.in Sum6.out as Connection50
                            connect Junction74 In as Connection80
                            connect Sum6.in1 Junction73 as Connection66
                            connect Limit1.in Junction72 as Connection63
                            connect Out Junction73 as Connection68
                            connect Junction72 Sum6.in as Connection64
                            connect Kp.out Sum5.in as Connection72
                            connect Sum7.out Integrator1.in as Connection69
                            connect Kp.in Junction74 as Connection79
                        }
                        [
                            position = 8000, 8432
                            size = 64, 48
                        ]

                        component Subsystem Power_Meas {
                            layout = dynamic
                            component gen_gain Gain4 {
                                gain = "Sn"
                            }
                            [
                                position = 7952, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component gen_gain Gain6 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8232
                                rotation = right
                                hide_name = True
                            ]

                            component Subsystem Power_Meas_DQpu {
                                layout = dynamic
                                component gen_product Product2 {
                                }
                                [
                                    position = 8024, 8152
                                    hide_name = True
                                ]

                                component gen_c_function S_and_pf {
                                    in_terminal_dimensions = "inherit;inherit"
                                    in_terminal_dimensions_str = "P inherit;Q inherit"
                                    in_terminal_labels = "False;False;"
                                    in_terminal_properties = "real P;inherit Q;"
                                    init_fnc = "/*Begin code section*/
P = 0;
Q = 0;
S = 0;
pf = 0;
/*End code section*/"
                                    no_feed_inputs = "[u\'\']"
                                    no_feed_outputs = "[u\'\']"
                                    out_terminal_dimensions = "inherit;inherit"
                                    out_terminal_dimensions_str = "S inherit;pf inherit"
                                    out_terminal_labels = "False;False;"
                                    out_terminal_properties = "inherit S;inherit pf;"
                                    output_fnc = "/*Begin code section*/
S = sqrt(P*P+Q*Q);
if(S>0){
    pf = P/S;
}
else{
    pf = 0;
}
/*End code section*/"
                                }
                                [
                                    position = 8392, 8192
                                    size = 0, 0
                                ]

                                component gen_product Product3 {
                                }
                                [
                                    position = 8024, 8320
                                    hide_name = True
                                ]

                                component gen_sum Sum1 {
                                }
                                [
                                    position = 8128, 8112
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_P {
                                    a_coeff = "[1.0/(2*np.pi*fc_P),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8112
                                ]

                                component gen_z_domain_transfer LPF_Q {
                                    a_coeff = "[1.0/(2*np.pi*fc_Q),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8272
                                ]

                                component gen_product Product4 {
                                }
                                [
                                    position = 8024, 8232
                                    hide_name = True
                                ]

                                component gen_sum Sum2 {
                                    signs = "+-"
                                }
                                [
                                    position = 8128, 8272
                                    hide_name = True
                                ]

                                component gen_product Product1 {
                                }
                                [
                                    position = 8024, 8064
                                    hide_name = True
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8112
                                ]

                                port Id {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8240
                                ]

                                port Iq {
                                    position = left:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8328
                                ]

                                port Vq {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8144
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8144
                                ]

                                port pf {
                                    position = right:4
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8240
                                ]

                                port Vd {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8056
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8272
                                ]

                                junction Junction6 sp
                                [
                                    position = 8264, 8272
                                ]

                                junction Junction4 sp
                                [
                                    position = 7960, 8056
                                ]

                                junction Junction3 sp
                                [
                                    position = 7944, 8144
                                ]

                                junction Junction1 sp
                                [
                                    position = 7920, 8240
                                ]

                                junction Junction2 sp
                                [
                                    position = 7928, 8328
                                ]

                                junction Junction5 sp
                                [
                                    position = 8264, 8112
                                ]

                                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = Vd*Id+Vq*Iq;</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Q = Vq*Id-Vd*Iq;</p></body></html> ENDCOMMENT 
                                [
                                    position = 8000, 7976
                                ]

                                connect LPF_Q.in Sum2.out as Connection40
                                connect Sum2.in Product4.out as Connection37
                                connect Junction6 LPF_Q.out as Connection47
                                connect S_and_pf.Q Junction6 as Connection48
                                connect Product3.in Junction4 as Connection36
                                connect Junction6 Q as Connection56
                                connect S_and_pf.S S as Connection51
                                connect Junction3 Vq as Connection53
                                connect Junction3 Product2.in as Connection32
                                connect LPF_P.in Sum1.out as Connection39
                                connect Junction2 Iq as Connection52
                                connect Product4.in Junction3 as Connection33
                                connect Sum1.in Product1.out as Connection29
                                connect S_and_pf.P Junction5 as Connection45
                                connect Junction1 Product4.in1 as Connection24
                                connect Junction4 Vd as Connection50
                                connect Sum2.in1 Product3.out as Connection38
                                connect Junction5 LPF_P.out as Connection44
                                connect Junction1 Id as Connection49
                                connect Product1.in1 Junction1 as Connection25
                                connect Junction5 P as Connection55
                                connect Sum1.in1 Product2.out as Connection30
                                connect S_and_pf.pf pf as Connection54
                                connect Junction2 Product3.in1 as Connection27
                                connect Junction4 Product1.in as Connection35
                                connect Product2.in1 Junction2 as Connection28

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power measurement in DQ frame with inputs and outputs in per unit.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Zero component is not considered in the power calculation, thus this measurement is not suitable for unbalanced systems.</p></body></html>"

                                    fc_P {
                                        label = "Active power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    fc_Q {
                                        label = "Reactive power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                        
                                    ENDCODE
                                }
                            }
                            [
                                position = 7864, 8160
                                size = 72, 128
                            ]

                            port Vq {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8048
                                rotation = right
                            ]

                            port Id {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8248
                                rotation = left
                            ]

                            port pf {
                                position = right:4
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = right
                            ]

                            port Iq {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8248
                                rotation = left
                            ]

                            port Q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8000
                                rotation = left
                            ]

                            port Vd {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8048
                                rotation = right
                            ]

                            port P {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8000
                                rotation = left
                            ]

                            port S {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8288
                                rotation = right
                            ]

                            connect pf Power_Meas_DQpu.pf as Connection19
                            connect Vd Power_Meas_DQpu.Vd as Connection15
                            connect Id Power_Meas_DQpu.Id as Connection14
                            connect Iq Power_Meas_DQpu.Iq as Connection17
                            connect Gain6.out S as Connection13
                            connect Gain5.out Q as Connection11
                            connect Gain4.out P as Connection10
                            connect Gain4.in Power_Meas_DQpu.P as Connection20
                            connect Gain6.in Power_Meas_DQpu.S as Connection16
                            connect Vq Power_Meas_DQpu.Vq as Connection18
                            connect Gain5.in Power_Meas_DQpu.Q as Connection21
                        }
                        [
                            position = 9128, 7720
                            size = 96, 232
                        ]

                        component gen_c_function delay {
                            global_variables = "real counter;"
                            in_terminal_dimensions = "inherit"
                            in_terminal_dimensions_str = "in inherit"
                            in_terminal_labels = "False;"
                            init_fnc = "/*Begin code section*/
out = 0;
counter = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "out inherit"
                            out_terminal_labels = "False;"
                            output_fnc = "/*Begin code section*/
if(out == 0){
    if(in > 0.5){
        counter += execution_rate;
        if(counter>Delay){
            out = 1;
        }
    }
    else{
        counter -= counter;
        out = 0;
    }
}
else{
    counter = 0;
    if(in <= 0.5){
        out = 0;
    }
}
/*End code section*/"
                            parameters = "real Delay;"
                        }
                        [
                            position = 8624, 7920
                            size = 48, 48
                        ]

                        component gen_gain Gain2 {
                            gain = "1000.0/Sn"
                        }
                        [
                            position = 8224, 8360
                            hide_name = True
                        ]

                        component src_constant Constant3 {
                            execution_rate = "inherit"
                        }
                        [
                            position = 9104, 7960
                            hide_name = True
                        ]

                        component gen_probe wt_pll {
                            addr = "8966"
                        }
                        [
                            position = 9104, 8520
                            rotation = right
                        ]

                        component gen_probe Vt_pu {
                        }
                        [
                            position = 8912, 8256
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe S {
                        }
                        [
                            position = 9320, 7752
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_logic_op "Logical operator2" {
                        }
                        [
                            position = 8728, 7928
                            hide_name = True
                        ]

                        component "core/Edge Detection" "Edge Detection1" {
                        }
                        [
                            position = 9632, 7936
                            rotation = right
                            hide_name = True
                            size = 32, 32
                        ]

                        component gen_gain Gain3 {
                            gain = "1.0/(Vn_dc)"
                        }
                        [
                            position = 9696, 7912
                            rotation = right
                            hide_name = True
                            scale = -1, 1
                        ]

                        component Subsystem Current_ref {
                            layout = dynamic
                            component gen_product Product4 {
                            }
                            [
                                position = 7680, 8080
                                hide_name = True
                            ]

                            component gen_product Product2 {
                                signs = "*/"
                            }
                            [
                                position = 7960, 8168
                                hide_name = True
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 7616, 8328
                                hide_name = True
                            ]

                            component gen_product Product1 {
                                signs = "*/"
                            }
                            [
                                position = 7960, 8080
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "+-"
                            }
                            [
                                position = 7792, 8072
                                hide_name = True
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 7680, 8152
                                hide_name = True
                            ]

                            component gen_sum Sum4 {
                            }
                            [
                                position = 7792, 8160
                                hide_name = True
                            ]

                            component gen_product Product7 {
                            }
                            [
                                position = 7512, 8328
                                hide_name = True
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 7680, 8224
                                hide_name = True
                            ]

                            component gen_product Product3 {
                            }
                            [
                                position = 7680, 8008
                                hide_name = True
                            ]

                            port Ird {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8168
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vt {
                                position = right:6
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8320
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8072
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vq {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8000
                                rotation = down
                                scale = -1, 1
                            ]

                            port Q_ref {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8216
                                rotation = down
                                scale = -1, 1
                            ]

                            port Irq {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8080
                                rotation = down
                                scale = -1, 1
                            ]

                            port P_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            junction Junction143 sp
                            [
                                position = 7536, 8000
                            ]

                            junction Junction146 sp
                            [
                                position = 7584, 8144
                            ]

                            junction Junction147 sp
                            [
                                position = 7552, 8216
                            ]

                            junction Junction142 sp
                            [
                                position = 7520, 8072
                            ]

                            junction Junction148 sp
                            [
                                position = 7864, 8176
                            ]

                            junction Junction145 sp
                            [
                                position = 7448, 8320
                            ]

                            connect Product6.out Sum4.in1 as Connection37
                            connect Product5.in Junction146 as Connection70
                            connect Product6.in Junction147 as Connection73
                            connect Product7.in1 Junction145 as Connection65
                            connect Junction148 Product2.in1 as Connection79
                            connect Product1.in1 Junction148 as Connection78
                            connect Junction143 Product3.in as Connection13
                            connect Product4.out Sum3.in1 as Connection31
                            connect Product5.out Sum4.in as Connection34
                            connect Junction142 Vd as Connection12
                            connect Product5.in1 Junction142 as Connection33
                            connect Vq Junction143 as Connection3
                            connect Product3.out Sum3.in as Connection28
                            connect Vt Junction145 as Connection63
                            connect Ird Product2.out as Connection82
                            connect Irq Product1.out as Connection81
                            connect Product4.in Junction142 as Connection30
                            connect Product2.in Sum4.out as Connection26
                            connect Product6.in1 Junction143 as Connection36
                            connect Junction145 Product7.in as Connection64
                            connect Junction146 Product3.in1 as Connection71
                            connect P_ref Junction146 as Connection72
                            connect Q_ref Junction147 as Connection75
                            connect Limit3.in Product7.out as Connection77
                            connect Product1.in Sum3.out as Connection23
                            connect Limit3.out Junction148 as Connection80
                            connect Junction147 Product4.in1 as Connection74
                        }
                        [
                            position = 9352, 8136
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8472, 8416
                            hide_name = True
                        ]

                        component gen_probe w_pu {
                        }
                        [
                            position = 8912, 8336
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_gain Gain5 {
                            gain = "1.39"
                        }
                        [
                            position = 9328, 7624
                        ]

                        port VDC {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9696, 7856
                            rotation = right
                            scale = -1, 1
                        ]

                        port Enable {
                            position = top:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9632, 7824
                            rotation = right
                            scale = -1, 1
                        ]

                        port wt {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9864, 8552
                        ]

                        port Connected {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8544, 7872
                            rotation = right
                        ]

                        port V_d {
                            position = right:10
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8136
                            rotation = down
                            scale = -1, 1
                        ]

                        port w {
                            position = right:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8376
                            rotation = down
                            scale = -1, 1
                        ]

                        port V_q {
                            position = right:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8216
                            rotation = down
                            scale = -1, 1
                        ]

                        port Ic {
                            position = right:17
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9168, 8432
                            rotation = down
                            scale = -1, 1
                        ]

                        port Vt {
                            position = right:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8296
                            rotation = down
                            scale = -1, 1
                        ]

                        port Ib {
                            position = right:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9208, 8384
                            rotation = down
                            scale = -1, 1
                        ]

                        port md {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9872, 8064
                        ]

                        port wt_in {
                            position = right:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8856, 8480
                            rotation = down
                            scale = -1, 1
                        ]

                        port Ia {
                            position = right:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9168, 8336
                            rotation = down
                            scale = -1, 1
                        ]

                        port mq {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9864, 8480
                        ]

                        tag From25 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9728, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From3 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8136
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From31 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7688
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto1 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9216, 8520
                            hide_name = True
                            size = 54, 25
                        ]

                        tag From43 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7752, 8304
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From30 {
                            value = "Pref_SOFC"
                            scope = global
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9168, 7888
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From28 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7656, 8464
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From23 {
                            value = "w"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9664, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto33 {
                            value = "Q"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7664
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From38 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8240, 8272
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto23 {
                            value = "Iq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9480, 8456
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto3 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8216
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From45 {
                            value = "V_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7600, 8368
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From26 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9760, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From1 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9704, 8552
                            rotation = down
                            hide_name = True
                            scale = -1, 1
                            size = 56, 25
                        ]

                        tag Goto22 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9488, 8312
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From35 {
                            value = "Iq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7816
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From46 {
                            value = "Q_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8128, 8360
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto17 {
                            value = "w"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8376
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From42 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8200
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto24 {
                            value = "Enable"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9568, 7880
                            rotation = down
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto34 {
                            value = "S"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7728
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From37 {
                            value = "Enable"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8600, 7984
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From32 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7624
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From4 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8168
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto19 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8296
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From39 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7936, 8288
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From27 {
                            value = "Qref"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9168, 7920
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto26 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8656, 7872
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From34 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9000, 7752
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto4 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8136
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto25 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8824, 7928
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto35 {
                            value = "pf"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7792
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto18 {
                            value = "Qref"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8680, 8416
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto32 {
                            value = "P"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9256, 7600
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From47 {
                            value = "Q_mode"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8408, 8320
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto36 {
                            value = "FC_Power"
                            scope = global
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9464, 7664
                        ]

                        junction Junction176 sp
                        [
                            position = 9632, 7880
                        ]

                        junction Junction167 sp
                        [
                            position = 9168, 8480
                        ]

                        junction Junction190 sp
                        [
                            position = 9208, 7752
                        ]

                        junction Junction188 sp
                        [
                            position = 9208, 7624
                        ]

                        junction Junction174 sp
                        [
                            position = 9432, 8480
                        ]

                        junction Junction191 sp
                        [
                            position = 9208, 7816
                        ]

                        junction Junction189 sp
                        [
                            position = 9208, 7688
                        ]

                        junction Junction177 sp
                        [
                            position = 7728, 8464
                        ]

                        junction Junction183 sp
                        [
                            position = 9104, 8480
                        ]

                        junction Junction187 sp
                        [
                            position = 8472, 8320
                        ]

                        junction Junction192 sp
                        [
                            position = 8912, 8376
                        ]

                        junction Junction193 sp
                        [
                            position = 8912, 8296
                        ]

                        junction Junction173 sp
                        [
                            position = 9432, 8336
                        ]

                        junction Junction184 sp
                        [
                            position = 8576, 7920
                        ]

                        connect Goto35 Junction191 as Connection550
                        connect Gain3.in VDC as Connection298
                        connect Current_ref.Vq From3 as Connection475
                        connect Goto32 Junction188 as Connection541
                        connect wt From1 as Connection392
                        connect From39 "Logical operator1.in" as Connection439
                        connect "Logical operator2.in" delay.out as Connection505
                        connect "Signal switch3.out" "Signal switch1.in" as Connection420
                        connect Junction188 Power_Meas.P as Connection540
                        connect From46 Gain2.in as Connection533
                        connect "Signal switch4.in2" From43 as Connection518
                        connect w Junction192 as Connection553
                        connect PI_Vt.Out "Signal switch1.in1" as Connection519
                        connect Junction174 Current_abc_to_dq.Iq as Connection400
                        connect Junction193 Goto19 as Connection557
                        connect Goto34 Junction190 as Connection547
                        connect Junction177 Sum1.in1 as Connection432
                        connect Power_Meas.Iq From35 as Connection405
                        connect pf.in Junction191 as Connection548
                        connect "Signal switch1.in2" Junction187 as Connection536
                        connect Constant2.out "Signal switch3.in1" as Connection424
                        connect Junction167 Junction183 as Connection484
                        connect Junction167 Goto1 as Connection483
                        connect Goto25 "Logical operator2.out" as Connection472
                        connect Junction190 Power_Meas.S as Connection546
                        connect Goto26 Junction184 as Connection494
                        connect Ib Current_abc_to_dq.Ib as Connection283
                        connect "Signal switch4.out" Sum1.in as Connection430
                        connect Goto33 Junction189 as Connection544
                        connect From47 Junction187 as Connection538
                        connect Goto23 Junction174 as Connection401
                        connect From31 Power_Meas.Vq as Connection403
                        connect "Edge Detection1.In1" Junction176 as Connection427
                        connect Goto24 Junction176 as Connection425
                        connect delay.in Junction184 as Connection506
                        connect "Signal switch3.in" Gain2.out as Connection419
                        connect From42 Current_ref.Vt as Connection487
                        connect Q.in Junction189 as Connection542
                        connect S.in Junction190 as Connection545
                        connect Current_abc_to_dq.Id Junction173 as Connection396
                        connect wt_pll.in Junction183 as Connection486
                        connect w_pu.in Junction192 as Connection555
                        connect "Signal switch4.in1" Junction177 as Connection433
                        connect Vt Junction193 as Connection556
                        connect From38 "Signal switch3.in2" as Connection422
                        [
                            breakpoints = 8312, 8272; 8336, 8272
                        ]
                        connect From30 Limit_PQref.Pref as Connection569
                        connect From23 ControlSignal_Calculation.w as Connection246
                        connect Limit_PQref.Plim Current_ref.P_ref as Connection567
                        connect Junction189 Power_Meas.Q as Connection543
                        connect From28 Junction177 as Connection431
                        connect Junction184 Connected as Connection493
                        connect Goto22 Junction173 as Connection398
                        connect Vt_pu.in Junction193 as Connection558
                        connect Ia Current_abc_to_dq.Ia as Connection282
                        connect Sum1.out PI_Vt.In as Connection330
                        connect Constant3.out Limit_PQref.Smax as Connection571
                        connect Junction176 Enable as Connection426
                        connect Junction187 Qmode.in as Connection537
                        connect Ic Current_abc_to_dq.Ic as Connection284
                        connect From25 ControlSignal_Calculation.Vq as Connection248
                        connect Current_abc_to_dq.wt Junction167 as Connection370
                        connect From26 ControlSignal_Calculation.Vd as Connection249
                        connect From27 Limit_PQref.Qref as Connection570
                        connect Junction191 Power_Meas.pf as Connection549
                        connect "Signal switch4.in" Gain4.out as Connection429
                        connect From45 Gain4.in as Connection531
                        connect From32 Power_Meas.Vd as Connection402
                        connect Junction192 Goto17 as Connection554
                        connect From34 Power_Meas.Id as Connection404
                        connect Current_ref.Vd From4 as Connection474
                        connect "Edge Detection1.Out1" ControlSignal_Calculation.Reset as Connection410
                        connect "Logical operator1.out" PI_Vt.Reset as Connection521
                        connect Junction183 wt_in as Connection485
                        connect ControlSignal_Calculation.VDC Gain3.out as Connection297
                        connect Current_ref.Q_ref Limit_PQref.Qlim as Connection568
                        connect From37 "Logical operator2.in1" as Connection470
                        connect V_d Goto4 as Connection577
                        [
                            breakpoints = 8920, 8136
                        ]
                        connect V_q Goto3 as Connection578
                        [
                            breakpoints = 8920, 8216
                        ]
                        connect ControlSignal_Calculation.Id_ref Current_ref.Ird as Connection579
                        [
                            breakpoints = 9488, 8064
                        ]
                        connect Current_ref.Irq ControlSignal_Calculation.Iq_ref as Connection580
                        [
                            breakpoints = 9488, 8208
                        ]
                        connect ControlSignal_Calculation.Id_meas Junction173 as Connection581
                        [
                            breakpoints = 9480, 8336
                        ]
                        connect ControlSignal_Calculation.Iq_meas Junction174 as Connection582
                        [
                            breakpoints = 9480, 8480
                        ]
                        connect md ControlSignal_Calculation.md as Connection583
                        [
                            breakpoints = 9816, 8064
                        ]
                        connect mq ControlSignal_Calculation.mq as Connection584
                        [
                            breakpoints = 9816, 8480
                        ]
                        connect Goto18 "Signal switch1.out" as Connection585
                        [
                            breakpoints = 8680, 8416; 8624, 8416
                        ]
                        connect Gain5.in Junction188 as Connection587
                        connect Goto36 Gain5.out as Connection591
                        [
                            breakpoints = 9464, 7664; 9400, 7624
                        ]
                    }
                    [
                        position = 7936, 7576
                        scale = -1, 1
                        size = 216, 264
                    ]

                    component Subsystem PLL {
                        layout = dynamic
                        component "core/Three phase PLL" PLL {
                            enable_pk = "True"
                            enable_sin = "False"
                            enable_zero = "False"
                            low_lim = "0"
                            rate_high = "5*fn"
                            rate_low = "-5*fn"
                            up_lim = "1.4*2*np.pi*fn"
                        }
                        [
                            position = 8064, 8184
                            size = 64, 128
                        ]

                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8184
                            hide_name = True
                        ]

                        component src_constant Constant1 {
                            execution_rate = "inherit"
                            value = "0"
                        }
                        [
                            position = 7832, 8336
                            hide_name = True
                        ]

                        component gen_probe Vt_meas {
                        }
                        [
                            position = 8520, 8160
                            scale = 1, -1
                        ]

                        component gen_gain Gain5 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8168, 8320
                            rotation = right
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/fn"
                        }
                        [
                            position = 8208, 8088
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain4 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8112, 8080
                            rotation = left
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch3" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8280
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8088
                            hide_name = True
                        ]

                        component gen_probe f_meas {
                        }
                        [
                            position = 8520, 8224
                        ]

                        component gen_gain Gain3 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8160, 8080
                            rotation = left
                            hide_name = True
                        ]

                        port B {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8168
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8072
                        ]

                        port Vq {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7968
                        ]

                        port wt {
                            position = right:6
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8200
                        ]

                        port C {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8264
                        ]

                        port Vd {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7920
                        ]

                        port f {
                            position = right:5
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8016
                        ]

                        port Vt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8360
                        ]

                        port Connected {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7920, 7968
                            rotation = right
                        ]

                        tag From2 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8432, 8160
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From4 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7968, 8232
                            hide_name = True
                            scale = -1, 1
                            size = 0, 0
                        ]

                        tag Goto34 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7984, 8024
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto33 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8264, 8136
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From3 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7968, 8136
                            hide_name = True
                            scale = -1, 1
                            size = 0, 0
                        ]

                        tag From1 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8432, 8224
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto32 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8232, 8272
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction4 sp
                        [
                            position = 7888, 8296
                        ]

                        junction Junction2 sp
                        [
                            position = 8168, 8272
                        ]

                        junction Junction5 sp
                        [
                            position = 7920, 8024
                        ]

                        junction Junction1 sp
                        [
                            position = 8208, 8136
                        ]

                        junction Junction3 sp
                        [
                            position = 7888, 8200
                        ]

                        connect Junction1 Gain1.in as Connection83
                        connect Gain3.out Vq as Connection54
                        connect Junction5 Connected as Connection111
                        connect PLL.freq Junction1 as Connection84
                        connect Gain1.out f as Connection27
                        connect Constant1.out Junction4 as Connection100
                        connect From3 "Signal switch2.in2" as Connection113
                        connect "Signal switch3.in" C as Connection94
                        connect Gain5.in Junction2 as Connection86
                        connect Junction4 Junction3 as Connection101
                        connect Vt Gain5.out as Connection56
                        connect B "Signal switch2.in" as Connection95
                        connect "Signal switch1.in" A as Connection89
                        connect Vd Gain4.out as Connection55
                        connect "Signal switch2.in1" Junction3 as Connection99
                        connect Junction3 "Signal switch1.in1" as Connection98
                        connect Goto34 Junction5 as Connection112
                        connect Junction2 Goto32 as Connection87
                        connect From2 Vt_meas.in as Connection74
                        connect PLL.peak Junction2 as Connection88
                        connect From4 "Signal switch3.in2" as Connection115
                        connect PLL.vb "Signal switch2.out" as Connection92
                        connect "Signal switch3.in1" Junction4 as Connection102
                        connect Gain3.in PLL.q_axis as Connection81
                        connect PLL.d_axis Gain4.in as Connection80
                        connect PLL.theta wt as Connection85
                        connect "Signal switch1.out" PLL.va as Connection91
                        connect From1 f_meas.in as Connection73
                        connect Goto33 Junction1 as Connection82
                        connect "Signal switch3.out" PLL.vc as Connection114
                        connect "Signal switch1.in2" Junction5 as Connection110
                    }
                    [
                        position = 7440, 7568
                        size = 64, 176
                    ]

                    component Subsystem duty_cycle {
                        layout = dynamic
                        component gen_limiter Limit2 {
                            lower_limit = "mod_lowLim"
                            upper_limit = "mod_upLim"
                        }
                        [
                            position = 7456, 7944
                            hide_name = True
                        ]

                        component Subsystem ZSM {
                            layout = dynamic
                            component gen_sum Sum6 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8176
                                hide_name = True
                            ]

                            component src_constant Constant1 {
                                execution_rate = "inherit"
                                value = "k"
                            }
                            [
                                position = 7336, 8080
                                hide_name = True
                            ]

                            component src_constant Constant4 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7808, 8064
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8264
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8264
                                hide_name = True
                            ]

                            component gen_minmax "Min Max1" {
                                inputs = "3"
                            }
                            [
                                position = 7584, 8160
                                hide_name = True
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 7848, 8256
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "--+"
                            }
                            [
                                position = 7984, 8152
                                hide_name = True
                            ]

                            component src_constant Constant3 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7672, 8128
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8120
                                hide_name = True
                            ]

                            component src_constant Constant2 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7656, 8288
                                hide_name = True
                            ]

                            component gen_minmax "Min Max2" {
                                inputs = "3"
                                operation = "max"
                            }
                            [
                                position = 7584, 8256
                                hide_name = True
                            ]

                            component gen_sum Sum8 {
                                signs = "-+"
                            }
                            [
                                position = 7888, 8056
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8096
                                hide_name = True
                            ]

                            component gen_probe Z0 {
                            }
                            [
                                position = 8048, 8088
                                rotation = left
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 7848, 8152
                                hide_name = True
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "0"
                                upper_limit = "1"
                            }
                            [
                                position = 7408, 8080
                                hide_name = True
                            ]

                            port Dz_C {
                                position = left:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8264
                                rotation = down
                                scale = -1, 1
                            ]

                            port Da {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dc {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8272
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_A {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port Db {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8208
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_B {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8176
                                rotation = down
                                scale = -1, 1
                            ]

                            tag From2 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7736, 8208
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto3 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8240
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto2 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7648, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From4 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8088
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From9 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7784, 8016
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From8 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8288
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto4 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8304
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From3 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8120
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From6 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8200
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From5 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From7 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8256
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7488, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto5 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 8120, 8152
                                hide_name = True
                                size = 0, 0
                            ]

                            junction Junction254 sp
                            [
                                position = 7480, 8144
                            ]

                            junction Junction256 sp
                            [
                                position = 7512, 8272
                            ]

                            junction Junction255 sp
                            [
                                position = 7496, 8208
                            ]

                            junction Junction257 sp
                            [
                                position = 7344, 8144
                            ]

                            junction Junction258 sp
                            [
                                position = 7344, 8208
                            ]

                            junction Junction260 sp
                            [
                                position = 8048, 8152
                            ]

                            junction Junction259 sp
                            [
                                position = 7344, 8272
                            ]

                            connect Goto1 Limit1.out as Connection1439
                            connect Constant2.out Sum1.in1 as Connection1427
                            connect From4 Sum5.in as Connection1487
                            connect From2 Product1.in as Connection1441
                            connect Constant3.out Sum2.in1 as Connection1434
                            connect Db Junction258 as Connection1477
                            connect Sum8.out Sum3.in as Connection1497
                            connect From5 Sum6.in as Connection1489
                            connect Dc Junction259 as Connection1480
                            connect From7 Sum7.in as Connection1493
                            connect Junction257 Junction254 as Connection1475
                            connect Sum7.out Dz_C as Connection1491
                            connect Product2.out Sum3.in1 as Connection1450
                            connect Junction255 "Min Max1.in1" as Connection1469
                            connect Goto2 Junction257 as Connection1476
                            connect "Min Max2.in2" Junction256 as Connection1471
                            connect Junction256 "Min Max1.in2" as Connection1472
                            connect From9 Sum8.in as Connection1496
                            connect Goto3 Junction258 as Connection1479
                            connect Junction254 "Min Max2.in" as Connection1466
                            connect Product2.in1 "Min Max1.out" as Connection1430
                            connect Product1.in1 Sum1.out as Connection1428
                            connect Sum2.out Product2.in as Connection1435
                            connect Da Junction257 as Connection1474
                            connect Constant1.out Limit1.in as Connection1425
                            connect "Min Max2.in1" Junction255 as Connection1468
                            connect Product1.out Sum3.in2 as Connection1451
                            connect Junction260 Sum3.out as Connection1485
                            connect Junction258 Junction255 as Connection1478
                            connect From8 Sum7.in1 as Connection1492
                            connect Sum5.out Dz_A as Connection1447
                            connect From1 Sum2.in as Connection1440
                            connect From6 Sum6.in1 as Connection1488
                            connect Constant4.out Sum8.in1 as Connection1495
                            connect Junction259 Junction256 as Connection1481
                            connect Goto5 Junction260 as Connection1486
                            connect From3 Sum5.in1 as Connection1446
                            connect Sum1.in "Min Max2.out" as Connection1426
                            connect Goto4 Junction259 as Connection1482
                            connect Z0.in Junction260 as Connection1484
                            connect Sum6.out Dz_B as Connection1490
                            connect "Min Max1.in" Junction254 as Connection1465

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">This block implements a zero sequence modulator (ZSM).</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">To change the ZSM type, user can adjust the coefficient k. This coefficient is a real number between 0 and 1.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 0, the modulation type is bottom clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1/2, the modulation type is midpoint clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1, the modulation type is top clamp.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                                k {
                                    label = "Modulation type coefficent k"
                                    widget = edit
                                    type = generic
                                    default_value = "0.5"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 7776, 8216
                            scale = -1, 1
                            size = 88, 168
                        ]

                        component gen_limiter Limit3 {
                            lower_limit = "-1.1546"
                            upper_limit = "1.1546"
                        }
                        [
                            position = 7456, 7992
                            hide_name = True
                        ]

                        component src_constant o_ref {
                            execution_rate = "Ts_Var"
                            value = "0"
                        }
                        [
                            position = 7504, 8016
                            hide_name = True
                        ]

                        component "core/dq to abc" "dq to abc1" {
                            execution_rate = "inherit"
                        }
                        [
                            position = 7552, 8096
                            rotation = right
                            size = 48, 80
                        ]

                        port m_c {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8280
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_b {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8216
                            rotation = down
                            scale = -1, 1
                        ]

                        port mq {
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7360, 7992
                        ]

                        port wt {
                            position = right:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7360, 8040
                        ]

                        port m_a {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8152
                            rotation = down
                            scale = -1, 1
                        ]

                        port md {
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7360, 7944
                        ]

                        connect mq Limit3.in as Connection2334
                        connect wt "dq to abc1.wt" as Connection2335
                        connect o_ref.out "dq to abc1.zero_input" as Connection2332
                        connect md Limit2.in as Connection2333
                        connect m_a ZSM.Dz_A as Connection2345
                        [
                            breakpoints = 7856, 8152
                        ]
                        connect ZSM.Dz_B m_b as Connection2346
                        [
                            breakpoints = 7856, 8216
                        ]
                        connect ZSM.Dz_C m_c as Connection2347
                        [
                            breakpoints = 7856, 8280
                        ]
                        connect "dq to abc1.phase_c" ZSM.Dc as Connection2348
                        [
                            breakpoints = 7664, 8280
                        ]
                        connect ZSM.Db "dq to abc1.phase_b" as Connection2349
                        [
                            breakpoints = 7664, 8216
                        ]
                        connect "dq to abc1.phase_a" ZSM.Da as Connection2350
                        [
                            breakpoints = 7664, 8152
                        ]
                        connect Limit3.out "dq to abc1.q_input" as Connection2351
                        [
                            breakpoints = 7544, 7992
                        ]
                        connect Limit2.out "dq to abc1.d_input" as Connection2352
                        [
                            breakpoints = 7504, 7944
                        ]
                    }
                    [
                        position = 8168, 7576
                        scale = -1, 1
                        size = 96, 272
                    ]

                    port ma {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 7464
                    ]

                    port Ib {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7712, 7656
                        rotation = down
                        scale = -1, 1
                    ]

                    port Connected {
                        position = top:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7936, 7280
                        rotation = right
                    ]

                    port VDC {
                        position = top:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8024, 7392
                        rotation = right
                    ]

                    port mc {
                        position = right:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 7688
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7848, 7392
                        rotation = right
                    ]

                    port Vb {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7568
                    ]

                    port Va {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7504
                    ]

                    port Ia {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7672, 7624
                        rotation = down
                        scale = -1, 1
                    ]

                    port Ic {
                        position = left:6
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7672, 7688
                        rotation = down
                        scale = -1, 1
                    ]

                    port Vc {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7632
                    ]

                    port mb {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 7576
                    ]

                    tag From14 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7464
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From16 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7528
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From18 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7592
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From15 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7496
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto16 {
                        value = "Connected"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8008, 7320
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto10 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7568
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From17 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7560
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto12 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7504
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From19 {
                        value = "Connected"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7360, 7440
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto13 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7536
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto14 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7600
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto15 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7632
                        hide_name = True
                        size = 60, 20
                    ]

                    junction Junction1 sp
                    [
                        position = 7936, 7320
                    ]

                    connect PLL.Vd Goto12 as Connection554
                    connect duty_cycle.mq Grid_follow.mq as Connection545
                    connect duty_cycle.wt Grid_follow.wt as Connection546
                    connect Grid_follow.Connected Junction1 as Connection543
                    connect From14 Grid_follow.V_d as Connection480
                    connect PLL.B Vb as Connection552
                    connect From15 Grid_follow.V_q as Connection481
                    connect ma duty_cycle.m_a as Connection547
                    connect Ic Grid_follow.Ic as Connection497
                    connect mb duty_cycle.m_b as Connection548
                    connect Goto15 PLL.wt as Connection558
                    connect duty_cycle.md Grid_follow.md as Connection544
                    connect PLL.C Vc as Connection553
                    connect PLL.A Va as Connection550
                    connect Goto16 Junction1 as Connection541
                    connect PLL.Connected From19 as Connection551
                    connect Ib Grid_follow.Ib as Connection496
                    connect From17 Grid_follow.w as Connection502
                    connect Goto13 PLL.Vq as Connection555
                    connect Junction1 Connected as Connection542
                    connect Ia Grid_follow.Ia as Connection495
                    connect From18 Grid_follow.wt_in as Connection485
                    connect Enable Grid_follow.Enable as Connection532
                    connect Goto14 PLL.f as Connection557
                    connect mc duty_cycle.m_c as Connection549
                    connect PLL.Vt Goto10 as Connection556
                    connect From16 Grid_follow.Vt as Connection482
                    connect VDC Grid_follow.VDC as Connection487
                }
                [
                    position = 8168, 7904
                    size = 128, 208
                ]

                component pas_capacitor C1 {
                    capacitance = "C"
                }
                [
                    position = 8248, 8504
                    rotation = right
                ]

                component pas_resistor R0b1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8248
                ]

                component "core/THD Measurement" "THD Va" {
                    exec_1 = "Ts"
                    frequency = "60"
                }
                [
                    position = 8856, 7776
                    size = 32, 32
                ]

                component "core/THD Measurement" "THD Vb" {
                    exec_1 = "Ts"
                    frequency = "60"
                }
                [
                    position = 8808, 7824
                    size = 32, 32
                ]

                component "core/THD Measurement" "THD Vc" {
                    exec_1 = "Ts"
                    frequency = "60"
                }
                [
                    position = 8872, 7856
                    size = 32, 32
                ]

                component "core/THD Measurement" "THD Ia" {
                    exec_1 = "Ts"
                    frequency = "60"
                }
                [
                    position = 8784, 7904
                    size = 32, 32
                ]

                component "core/THD Measurement" "THD Ib" {
                    exec_1 = "Ts"
                    frequency = "60"
                }
                [
                    position = 8824, 7952
                    size = 32, 32
                ]

                component "core/THD Measurement" "THD Ic" {
                    exec_1 = "Ts"
                    frequency = "60.0"
                }
                [
                    position = 8872, 8000
                    size = 32, 32
                ]

                component "core/Current Measurement" FC_Idc {
                    execution_rate = "Ts_Var"
                    override_signal_name = "True"
                    sig_output = "True"
                    signal_name = "FC_Idc"
                }
                [
                    position = 7328, 8144
                    size = 64, 32
                ]

                port Outputs {
                    position = 152.0, -120.0
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8672, 7584
                    rotation = left
                ]

                port B {
                    position = 180.0, -0.1
                    kind = pe
                }
                [
                    position = 9040, 8248
                    rotation = down
                ]

                port C {
                    position = 180.0, 96.0
                    kind = pe
                }
                [
                    position = 9040, 8344
                    rotation = down
                ]

                port A {
                    position = 180.0, -96.0
                    kind = pe
                }
                [
                    position = 9040, 8152
                    rotation = down
                ]

                port Inputs {
                    position = -152.0, -120.0
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7968, 7584
                    rotation = right
                ]

                tag From37 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7664, 7944
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto14 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8312
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto13 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8216
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto17 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8304, 7904
                    hide_name = True
                    size = 60, 20
                ]

                tag From38 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7664, 7920
                    hide_name = True
                    size = 60, 20
                ]

                tag From21 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7968, 7984
                    hide_name = True
                    size = 60, 20
                ]

                tag From34 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7904
                    hide_name = True
                    size = 60, 20
                ]

                tag From33 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7928
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto5 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8768, 8520
                    hide_name = True
                    size = 60, 20
                ]

                tag From32 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7832
                    hide_name = True
                    size = 60, 20
                ]

                tag From28 {
                    value = "Inv_On"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7784
                    hide_name = True
                    size = 60, 20
                ]

                tag From36 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7664, 7968
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto1 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8768, 8416
                    hide_name = True
                    size = 60, 20
                ]

                tag From35 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7880
                    hide_name = True
                    size = 60, 20
                ]

                tag From24 {
                    value = "Enable"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7336, 8032
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto3 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8304, 7824
                    hide_name = True
                    size = 60, 20
                ]

                tag From25 {
                    value = "Enable"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8128, 7728
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From20 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8032, 7952
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto4 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8768, 8472
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto16 {
                    value = "Inv_On"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7664, 8000
                    hide_name = True
                    size = 60, 20
                ]

                tag From19 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7968, 7920
                    hide_name = True
                    size = 60, 20
                ]

                tag From23 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7336, 8080
                    hide_name = True
                    size = 60, 20
                ]

                tag From30 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7856
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto18 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8304, 7984
                    hide_name = True
                    size = 60, 20
                ]

                tag From27 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8168, 7728
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From9 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7968, 7856
                    hide_name = True
                    size = 60, 20
                ]

                tag From10 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8032, 7888
                    hide_name = True
                    size = 60, 20
                ]

                tag From26 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8856, 8080
                    hide_name = True
                    size = 60, 20
                ]

                tag From18 {
                    value = "Vdc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8208, 7728
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From31 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7808
                    hide_name = True
                    size = 60, 20
                ]

                tag From29 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7760
                    hide_name = True
                    size = 60, 20
                ]

                tag From8 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8032, 7824
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto15 {
                    value = "Vdc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7624, 8256
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto12 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8112
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto19 {
                    value = "FC_Vc"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 8760, 8672
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto20 {
                    value = "FC_Va"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 8760, 8568
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto21 {
                    value = "FC_Vb"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 8760, 8624
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto22 {
                    value = "FC_Ic"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 8200, 8280
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto23 {
                    value = "FC_Ia"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8064
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto24 {
                    value = "FC_Ib"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 8200, 8176
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto26 {
                    value = "FC_Vdc"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 7624, 8304
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto109 {
                    value = "FC_THD_Va"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 8944, 7776
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto110 {
                    value = "FC_THD_Vb"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 8928, 7824
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto111 {
                    value = "FC_THD_Vc"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 8960, 7856
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto112 {
                    value = "FC_THD_Ia"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 8880, 7904
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto113 {
                    value = "FC_THD_Ib"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 8912, 7952
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 58, 20
                ]

                tag Goto114 {
                    value = "FC_THD_Ic"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 8960, 8000
                    rotation = down
                    hide_name = True
                    scale = -1, -1
                    size = 0, 0
                ]

                tag Goto25 {
                    value = "FC_Idc"
                    scope = global
                    kind = sp
                    direction = in
                }
                [
                    position = 7368, 8112
                    hide_name = True
                    size = 60, 20
                ]

                junction Junction116 pe
                [
                    position = 8480, 8624
                ]

                junction Junction142 pe
                [
                    position = 7472, 8344
                ]

                junction Junction89 pe
                [
                    position = 7544, 8344
                ]

                junction Junction140 pe
                [
                    position = 8592, 8344
                ]

                junction Junction136 pe
                [
                    position = 8480, 8152
                ]

                junction Junction132 sp
                [
                    position = 7608, 8040
                ]

                junction Junction127 pe
                [
                    position = 7472, 8152
                ]

                junction Junction78 pe
                [
                    position = 8536, 8624
                ]

                junction Junction121 pe
                [
                    position = 8248, 8152
                ]

                junction Junction135 sp
                [
                    position = 7584, 8040
                ]

                junction Junction115 pe
                [
                    position = 8416, 8624
                ]

                junction Junction134 sp
                [
                    position = 7432, 8032
                ]

                junction Junction119 pe
                [
                    position = 7848, 8152
                ]

                junction Junction125 pe
                [
                    position = 8416, 8344
                ]

                junction Junction120 pe
                [
                    position = 7848, 8248
                ]

                junction Junction138 pe
                [
                    position = 8536, 8248
                ]

                junction Junction70 pe
                [
                    position = 8328, 8624
                ]

                junction Junction123 pe
                [
                    position = 8328, 8248
                ]

                junction Junction144 sp
                [
                    position = 8688, 8416
                ]

                junction Junction145 sp
                [
                    position = 8664, 8472
                ]

                junction Junction146 sp
                [
                    position = 8632, 8520
                ]

                junction Junction147 sp
                [
                    position = 8128, 8112
                ]

                junction Junction148 sp
                [
                    position = 8136, 8216
                ]

                junction Junction149 sp
                [
                    position = 8136, 8312
                ]

                junction Junction150 sp
                [
                    position = 7576, 8256
                ]

                junction Junction151 sp
                [
                    position = 8648, 7776
                ]

                junction Junction152 sp
                [
                    position = 8664, 7816
                ]

                junction Junction153 sp
                [
                    position = 8680, 7848
                ]

                junction Junction154 sp
                [
                    position = 8696, 7880
                ]

                junction Junction155 sp
                [
                    position = 8704, 7904
                ]

                junction Junction156 sp
                [
                    position = 8672, 7928
                ]

                junction Junction157 pe
                [
                    position = 7544, 8152
                ]

                connect Goto16 Junction135 as Connection758
                connect From23 delay.in as Connection734
                connect S1.a_in L5.n_node as Connection695
                connect Junction134 "Logical operator1.in" as Connection747
                connect "3ph_inverter 1.a_in" Junction119 as Connection634
                connect C S1.c_out as Connection696
                connect Junction115 Junction116 as Connection622
                connect R9.p_node Junction125 as Connection681
                connect Vdc.n_node Junction89 as Connection473
                connect Junction125 Ic.n_node as Connection682
                connect Junction116 Va.n_node as Connection621
                connect Junction89 "3ph_inverter 1.neg_out" as Connection474
                connect Inputs Input.Inputs as Connection755
                connect S1.b_in L6.n_node as Connection699
                connect R4.n_node Junction127 as Connection690
                connect R0a.p_node L1.n_node as Connection611
                connect Junction142 Junction89 as Connection808
                [
                    breakpoints = 7472, 8344
                ]
                connect From27 Control.Connected as Connection754
                connect L3.n_node R0c.p_node as Connection614
                connect "3ph_inverter 1.b_in" Junction120 as Connection637
                connect Junction120 Vab.n_node as Connection638
                connect "Logical operator1.out" Junction135 as Connection756
                connect Junction132 "3ph_inverter 1.En" as Connection738
                connect From24 Junction134 as Connection748
                connect From10 Control.Vc as Connection487
                connect From26 S1.ctrl_in as Connection753
                connect From28 Output.Inv_On as Connection761
                connect Junction115 Junction70 as Connection619
                connect R0b.p_node L2.n_node as Connection613
                connect Junction70 C2.n_node as Connection143
                connect C1.p_node R7.n_node as Connection139
                connect From8 Control.Va as Connection485
                connect Junction138 Junction123 as Connection780
                connect Junction123 R8.p_node as Connection677
                connect S1.c_in L4.n_node as Connection697
                connect On.in Junction132 as Connection739
                connect L2.p_node Junction120 as Connection639
                connect Vb.n_node Junction78 as Connection363
                connect C1.n_node Junction70 as Connection142
                connect Junction127 Ca1.p_node as Connection689
                connect "3ph_inverter 1.c_in" L3.p_node as Connection640
                connect Goto3 Control.ma as Connection490
                connect Ic.p_node R0c.n_node as Connection667
                connect Vc.p_node Junction140 as Connection784
                connect R0c1.n_node L4.p_node as Connection655
                connect R9.n_node C3.p_node as Connection145
                connect L6.p_node R0b1.n_node as Connection650
                connect Control.Ic From21 as Connection493
                connect From36 "3ph_inverter 1.InA" as Connection791
                connect Ib.n_node Junction123 as Connection676
                connect B S1.b_out as Connection698
                connect Junction135 Junction132 as Connection757
                connect SOFC.P1 Junction142 as Connection809
                [
                    breakpoints = 7296, 8352; 7472, 8352
                ]
                connect C2.p_node R8.n_node as Connection144
                connect enable.in Junction134 as Connection749
                connect From20 Control.Ib as Connection492
                connect R0b.n_node Ib.p_node as Connection662
                connect Vc.n_node Junction78 as Connection617
                connect C3.n_node Junction115 as Connection618
                connect Output.Connected From29 as Connection760
                connect A S1.a_out as Connection694
                connect L1.p_node Junction119 as Connection636
                connect Junction78 Junction116 as Connection620
                connect From38 "3ph_inverter 1.InC" as Connection793
                connect Ca1.n_node Junction142 as Connection807
                connect Va.p_node Junction136 as Connection774
                connect From25 Control.Enable as Connection750
                connect Vb.p_node Junction138 as Connection779
                connect Junction140 Junction125 as Connection785
                connect Ia.n_node Junction121 as Connection671
                connect Junction119 Vab.p_node as Connection635
                connect delay.out "Logical operator1.in1" as Connection735
                connect From19 Control.Ia as Connection491
                connect From9 Control.Vb as Connection486
                connect Junction136 Junction121 as Connection775
                connect Goto18 Control.mc as Connection790
                connect From18 Control.VDC as Connection489
                connect R0a.n_node Ia.p_node as Connection664
                connect Outputs Output.Outputs as Connection759
                connect From37 "3ph_inverter 1.InB" as Connection792
                connect Junction121 R7.p_node as Connection672
                connect Goto17 Control.mb as Connection789
                connect L5.p_node R0a1.n_node as Connection652
                connect Junction136 R0a1.p_node as Connection815
                [
                    breakpoints = 8480, 8152; 8632, 8152
                ]
                connect R0b1.p_node Junction138 as Connection817
                [
                    breakpoints = 8632, 8248
                ]
                connect Junction140 R0c1.p_node as Connection816
                [
                    breakpoints = 8592, 8344; 8632, 8344
                ]
                connect Goto1 Junction144 as Connection818
                connect Junction144 Va.out as Connection819
                connect Goto20 Junction144 as Connection820
                connect Goto4 Junction145 as Connection821
                connect Junction145 Vb.out as Connection822
                connect Goto21 Junction145 as Connection823
                connect Goto5 Junction146 as Connection824
                connect Junction146 Vc.out as Connection825
                connect Goto19 Junction146 as Connection826
                connect Goto12 Junction147 as Connection827
                connect Junction147 Ia.out as Connection828
                connect Goto23 Junction147 as Connection829
                [
                    breakpoints = 8128, 8104
                ]
                connect Goto13 Junction148 as Connection830
                connect Junction148 Ib.out as Connection831
                connect Goto24 Junction148 as Connection832
                connect Goto14 Junction149 as Connection833
                connect Junction149 Ic.out as Connection834
                connect Goto22 Junction149 as Connection835
                connect Goto15 Junction150 as Connection839
                connect Junction150 Vdc.out as Connection840
                connect Goto26 Junction150 as Connection841
                connect Goto109 "THD Va.Out" as Connection2887
                connect Goto110 "THD Vb.Out" as Connection2888
                connect Goto111 "THD Vc.Out" as Connection2889
                connect Goto112 "THD Ia.Out" as Connection2890
                connect Goto113 "THD Ib.Out" as Connection2891
                connect Goto114 "THD Ic.Out" as Connection2892
                connect From31 Junction151 as Connection2893
                connect Junction151 Output.Va as Connection2894
                connect "THD Va.In" Junction151 as Connection2895
                connect From32 Junction152 as Connection2896
                connect Junction152 Output.Vb as Connection2897
                connect "THD Vb.In" Junction152 as Connection2898
                connect From30 Junction153 as Connection2899
                connect Junction153 Output.Vc as Connection2900
                connect "THD Vc.In" Junction153 as Connection2901
                connect From35 Junction154 as Connection2902
                connect Junction154 Output.Ia as Connection2903
                connect "THD Ia.In" Junction154 as Connection2904
                [
                    breakpoints = 8752, 7880; 8696, 7880
                ]
                connect From34 Junction155 as Connection2905
                connect Junction155 Output.Ib as Connection2906
                connect "THD Ib.In" Junction155 as Connection2907
                connect From33 Junction156 as Connection2908
                connect Junction156 Output.Ic as Connection2909
                connect "THD Ic.In" Junction156 as Connection2910
                connect Goto25 FC_Idc.out as Connection838
                connect FC_Idc.p_node SOFC.P2 as Connection2912
                connect FC_Idc.n_node R4.p_node as Connection2913
                connect Junction127 Junction157 as Connection2914
                [
                    breakpoints = 7472, 8152
                ]
                connect Junction157 Vdc.p_node as Connection2915
                [
                    breakpoints = 7544, 8152; 7544, 8152
                ]
                connect "3ph_inverter 1.pos_out" Junction157 as Connection2916

                Id_Kp = "3"
                Iq_Kp = "3"
                Ts = "Ts_Var"
                Vn_dc = "400"

                mask {
                    icon = "image(\'wind_power_plant.svg\')"
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Wind power plant switching model.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Active power output is based on wind speed input. Reactive power output is based on terminal voltage control or direct reactive power setpoints. If the input \"Q_mode\" is high, the reactive power output will be set by the reference given in the input \"Q_ref\", else, the reactive power reference is based on the reference given in the input \"V_ref\".</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">The number of inputs is 6 and of outputs is 14 and they are configured in the following order:</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Inputs: 0 - Connect; 1 - Enable; 2 - wind_speed; 3 - V_ref; 4 - Q_mode; 5 - Q_ref;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Outputs: 0 - Connected; 1 - Inv_On; 2 - Va; 3 - Vb; 4 - Vc; 5 - Vt; 6 - Ia; 7 - Ib; 8 - Ic; 9 - f; 10 - P; 11 - Q; 12 - S; 13 - pf;</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"
                    help_file = "wind_power_plant.html"

                    Vn {
                        label = "Nominal voltage"
                        widget = edit
                        type = generic
                        default_value = "208"
                        unit = "V"
                        group = "1 - General"
                    }

                    Sn {
                        label = "Nominal power"
                        widget = edit
                        type = generic
                        default_value = "50e3"
                        unit = "VA"
                        group = "1 - General"
                    }

                    fn {
                        label = "Nominal frequency"
                        widget = edit
                        type = generic
                        default_value = "60.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    fsw {
                        label = "Inverter switching frequency"
                        widget = edit
                        type = generic
                        default_value = "10000.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    Vn_dc {
                        label = "Nominal DC voltage"
                        widget = edit
                        type = generic
                        default_value = "350"
                        unit = "V"
                        group = "1 - General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "Ts"
                        unit = "s"
                        group = "1 - General"
                    }

                    L0 {
                        label = "Inverter side inductor"
                        widget = edit
                        type = generic
                        default_value = "798.05e-6"
                        unit = "H"
                        group = "2 - Filter"
                    }

                    R0 {
                        label = "Inductors series resistors"
                        widget = edit
                        type = generic
                        default_value = "1e-5"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    L {
                        label = "Grid side inductor"
                        widget = edit
                        type = generic
                        default_value = "10.2876e-6"
                        unit = "H"
                        group = "2 - Filter"
                    }

                    Rres {
                        label = "Shunt resistance"
                        widget = edit
                        type = generic
                        default_value = "0.06455"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    C {
                        label = "Shunt capacitor"
                        widget = edit
                        type = generic
                        default_value = "270.84e-6"
                        unit = "F"
                        group = "2 - Filter"
                    }

                    V_Kp {
                        label = "Voltage PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "15.0"
                        group = "3 - Adv. 1"
                    }

                    V_Ki {
                        label = "Voltage PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "3 - Adv. 1"
                    }

                    V_upLim {
                        label = "Voltage PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "4.0"
                        group = "3 - Adv. 1"
                    }

                    V_lowLim {
                        label = "Voltage PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-4.0"
                        group = "3 - Adv. 1"
                    }

                    Id_Kp {
                        label = "d current PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "4 - Adv. 2"
                    }

                    Id_Ki {
                        label = "d current PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "30.0"
                        group = "4 - Adv. 2"
                    }

                    Id_upLim {
                        label = "d current PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "4 - Adv. 2"
                    }

                    Id_lowLim {
                        label = "d current PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        group = "4 - Adv. 2"
                    }

                    Iq_Kp {
                        label = "q current PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_Ki {
                        label = "q current PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "30.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_upLim {
                        label = "q current PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_lowLim {
                        label = "q current PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        group = "5 - Adv. 3"
                    }

                    Damp {
                        label = "d and q currents damping"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "6 - Adv. 4"
                    }

                    mod_upLim {
                        label = "Modulation signals upper limit"
                        widget = edit
                        type = generic
                        default_value = "1.1546"
                        group = "6 - Adv. 4"
                    }

                    mod_lowLim {
                        label = "Modulation signals lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1.1546"
                        group = "6 - Adv. 4"
                    }

                    Delay {
                        label = "Time delay to turn on after grid connection"
                        widget = edit
                        type = generic
                        default_value = "0.125"
                        unit = "s"
                        group = "6 - Adv. 4"
                    }

                    powerRate {
                        label = "Maximum power reference change rate"
                        widget = edit
                        type = generic
                        default_value = "5"
                        unit = "pu/s"
                        group = "6 - Adv. 4"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE

                    CODE define_icon
                        image('wind_power_plant.svg')
                    ENDCODE
                }
            }
            [
                position = 8224, 8448
                size = 353, 239
            ]

            port A {
                position = right:1
                kind = pe
            }
            [
                position = 8448, 8360
                rotation = down
            ]

            port B {
                position = right:2
                kind = pe
            }
            [
                position = 8448, 8456
                rotation = down
            ]

            port C {
                position = right:3
                kind = pe
            }
            [
                position = 8448, 8552
                rotation = down
            ]

            port from_PMS {
                position = top:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7424, 8016
            ]

            tag Goto2 {
                value = "enable"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7712, 7984
                hide_name = True
            ]

            tag From1 {
                value = "enable"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7984, 7984
                hide_name = True
            ]

            connect Q_mode.out "Bus Join4.in4" as Connection862
            connect Q_ref.out "Bus Join4.in5" as Connection861
            connect V_ref.out "Bus Join4.in3" as Connection863
            connect from_PMS interface.fromPMS as Connection873
            connect Pref_FC.out "Bus Join4.in2" as Connection868
            connect Connect.out "Bus Join4.in" as Connection867
            connect Enable.out interface.Enable_in as Connection872
            connect From1 "Bus Join4.in1" as Connection875
            connect Goto2 interface.Enable as Connection874
            connect "SOFC inverter.Inputs" "Bus Join4.out" as Connection876
            connect "SOFC inverter.Outputs" Out.in as Connection877
            connect "SOFC inverter.A" A as Connection878
            connect "SOFC inverter.B" B as Connection879
            connect "SOFC inverter.C" C as Connection880

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Wind Power Plant.</p></body></html>"

                CODE define_icon
                    mdl.set_component_icon_image(item_handle, "converter_cabinet.svg")
                ENDCODE

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 8224, 9112
            rotation = left
            size = 160, 160
        ]

        component Subsystem PDC {
            layout = dynamic
            component "core/Three Phase Two Winding Transformer" Tr7 {
                L1 = "0.0034"
                L2 = "5.0817e-6"
                Lm = "5.18e3"
                R1 = "0.0862"
                R2 = "1.2272e-4"
                Rm = "5.18e3"
                Sn = "30e6"
                V1 = "4160"
                V2 = "208"
                current_vals_SI = "[0.31428898062975824, 130.95374192906596]"
                current_vals_pu = "[0.002400000000001005, 0.9999999999995368]"
                f = "60.0"
                flux_vals_SI = "[32.409397037946476, 41.0519029147322]"
                flux_vals_pu = "[1.2000000000000948, 1.5199999999999776]"
                input = "SI"
                l1 = "0.0283"
                l2 = "0.0283"
                lm = "323.248820151"
                r1 = "0.005"
                r2 = "0.005"
                rm = "42.8722063131"
            }
            [
                position = 8160, 7896
                rotation = down
                scale = -1, -1
                size = 126, 256
            ]

            component Subsystem Snubber {
                layout = dynamic
                component pas_resistor R3 {
                    resistance = "43264"
                }
                [
                    position = 8264, 8144
                    rotation = right
                ]

                component pas_resistor R1 {
                    resistance = "43264"
                }
                [
                    position = 8120, 8144
                    rotation = right
                ]

                component pas_resistor R2 {
                    resistance = "43264"
                }
                [
                    position = 8192, 8144
                    rotation = right
                ]

                port B {
                    position = top:2
                    kind = pe
                }
                [
                    position = 8192, 8064
                    rotation = right
                ]

                port G {
                    position = bottom:1
                    kind = pe
                }
                [
                    position = 8192, 8296
                    rotation = left
                ]

                port C {
                    position = top:3
                    kind = pe
                }
                [
                    position = 8264, 8064
                    rotation = right
                ]

                port A {
                    position = top:1
                    kind = pe
                }
                [
                    position = 8120, 8064
                    rotation = right
                ]

                junction Junction1490 pe
                [
                    position = 8192, 8248
                ]

                junction Junction1491 pe
                [
                    position = 8192, 8248
                ]

                connect R2.n_node Junction1490 as Connection385
                connect G Junction1491 as Connection403
                connect Junction1491 Junction1490 as Connection402
                connect R1.p_node A as Connection399
                connect R2.p_node B as Connection397
                connect R3.p_node C as Connection398
                connect R3.n_node Junction1491 as Connection401
                connect Junction1490 R1.n_node as Connection395
            }
            [
                position = 7888, 8048
                size = 64, 48
            ]

            component Subsystem Snubber1 {
                layout = dynamic
                component pas_resistor R3 {
                    resistance = "43264"
                }
                [
                    position = 8264, 8144
                    rotation = right
                ]

                component pas_resistor R1 {
                    resistance = "43264"
                }
                [
                    position = 8120, 8144
                    rotation = right
                ]

                component pas_resistor R2 {
                    resistance = "43264"
                }
                [
                    position = 8192, 8144
                    rotation = right
                ]

                port B {
                    position = top:2
                    kind = pe
                }
                [
                    position = 8192, 8064
                    rotation = right
                ]

                port G {
                    position = bottom:1
                    kind = pe
                }
                [
                    position = 8192, 8296
                    rotation = left
                ]

                port C {
                    position = top:3
                    kind = pe
                }
                [
                    position = 8264, 8064
                    rotation = right
                ]

                port A {
                    position = top:1
                    kind = pe
                }
                [
                    position = 8120, 8064
                    rotation = right
                ]

                junction Junction1490 pe
                [
                    position = 8192, 8248
                ]

                junction Junction1491 pe
                [
                    position = 8192, 8248
                ]

                connect R2.n_node Junction1490 as Connection385
                connect G Junction1491 as Connection403
                connect Junction1491 Junction1490 as Connection402
                connect R1.p_node A as Connection399
                connect R2.p_node B as Connection397
                connect R3.p_node C as Connection398
                connect R3.n_node Junction1491 as Connection401
                connect Junction1490 R1.n_node as Connection395
            }
            [
                position = 8296, 8048
                size = 64, 48
            ]

            component "core/Voltage Measurement" Vc_prim {
                addr = "5"
                execution_rate = "Ts_Var"
                override_signal_name = "True"
                signal_name = "Vc_prim"
            }
            [
                position = 8056, 8040
                rotation = right
                size = 64, 32
            ]

            component "core/Voltage Measurement" Vb_prim {
                addr = "4"
                execution_rate = "Ts_Var"
                override_signal_name = "True"
                signal_name = "Vb_prim"
            }
            [
                position = 8008, 7936
                rotation = right
                size = 64, 32
            ]

            component "core/Voltage Measurement" Va_prim {
                addr = "3"
                execution_rate = "Ts_Var"
                override_signal_name = "True"
                signal_name = "Va_prim"
            }
            [
                position = 7960, 7848
                rotation = right
                size = 64, 32
            ]

            component "core/Voltage Measurement" Vc_sec {
                addr = "5"
                execution_rate = "Ts_Var"
                override_signal_name = "True"
                signal_name = "Vc_sec"
            }
            [
                position = 8432, 8040
                rotation = right
                size = 64, 32
            ]

            component "core/Voltage Measurement" Vb_sec {
                addr = "4"
                execution_rate = "Ts_Var"
                override_signal_name = "True"
                signal_name = "Vb_sec"
            }
            [
                position = 8392, 7952
                rotation = right
                size = 64, 32
            ]

            component "core/Voltage Measurement" Va_sec {
                addr = "3"
                execution_rate = "Ts_Var"
                override_signal_name = "True"
                signal_name = "Va_sec"
            }
            [
                position = 8360, 7856
                rotation = right
                size = 64, 32
            ]

            component "core/Current Measurement" Ia_Prim {
                override_signal_name = "True"
                signal_name = "Ia_Prim"
            }
            [
                position = 8016, 7800
                size = 64, 32
            ]

            component "core/Current Measurement" Ib_prim {
                override_signal_name = "True"
                signal_name = "Ib_Prim"
            }
            [
                position = 7928, 7896
                size = 64, 32
            ]

            component "core/Current Measurement" Ic_prim {
                override_signal_name = "True"
                signal_name = "Ic_Prim"
            }
            [
                position = 7976, 7992
                size = 64, 32
            ]

            component "core/Current Measurement" Ia_sec {
                override_signal_name = "True"
                signal_name = "Ia_sec"
            }
            [
                position = 8432, 7800
                size = 64, 32
            ]

            component "core/Current Measurement" Ib_sec {
                override_signal_name = "True"
                signal_name = "Ib_sec"
            }
            [
                position = 8456, 7896
                size = 64, 32
            ]

            component "core/Current Measurement" Ic_sec {
                override_signal_name = "True"
                signal_name = "Ic_sec"
            }
            [
                position = 8480, 7992
                size = 64, 32
            ]

            port C {
                position = left:3
                kind = pe
            }
            [
                position = 7824, 7992
                rotation = down
                scale = -1, 1
            ]

            port c {
                position = right:6
                kind = pe
            }
            [
                position = 8544, 7992
                scale = -1, 1
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 7824, 7800
                rotation = down
                scale = -1, 1
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 7824, 7896
                rotation = down
                scale = -1, 1
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 8504, 7800
                scale = -1, 1
            ]

            port b {
                position = right:4
                kind = pe
            }
            [
                position = 8528, 7896
                scale = -1, 1
            ]

            junction Junction1 pe
            [
                position = 7872, 7800
            ]

            junction Junction2 pe
            [
                position = 7888, 7896
            ]

            junction Junction4 pe
            [
                position = 8280, 7800
            ]

            junction Junction5 pe
            [
                position = 8296, 7896
            ]

            junction Junction6 pe
            [
                position = 8312, 7992
            ]

            junction Junction7 pe
            [
                position = 7904, 7992
            ]

            junction Junction8 pe
            [
                position = 7960, 7800
            ]

            junction Junction9 pe
            [
                position = 8008, 7896
            ]

            junction Junction10 pe
            [
                position = 7960, 8080
            ]

            junction Junction11 pe
            [
                position = 8056, 7992
            ]

            junction Junction12 pe
            [
                position = 8008, 8080
            ]

            junction Junction13 pe
            [
                position = 8360, 7800
            ]

            junction Junction14 pe
            [
                position = 8392, 7896
            ]

            junction Junction15 pe
            [
                position = 8360, 8080
            ]

            junction Junction16 pe
            [
                position = 8432, 7992
            ]

            junction Junction17 pe
            [
                position = 8392, 8080
            ]

            connect A Junction1 as Connection15
            connect Snubber.A Junction1 as Connection17
            connect B Junction2 as Connection18
            connect Snubber.B Junction2 as Connection20
            connect Junction4 Tr7.sec_1 as Connection25
            connect Snubber1.A Junction4 as Connection26
            connect Junction5 Tr7.sec_2 as Connection28
            connect Snubber1.B Junction5 as Connection29
            connect Junction6 Tr7.sec_3 as Connection35
            connect Snubber1.C Junction6 as Connection36
            connect C Junction7 as Connection38
            connect Snubber.C Junction7 as Connection40
            connect Junction1 Junction8 as Connection41
            connect Va_prim.p_node Junction8 as Connection43
            connect Junction9 Tr7.prm_2 as Connection46
            connect Vb_prim.p_node Junction9 as Connection47
            connect Va_prim.n_node Junction10 as Connection48
            [
                breakpoints = 7960, 7888; 7960, 7968; 7960, 7968; 7960, 7968; 7960, 7968; 7960, 7968; 7960, 7968; 7960, 8080; 7960, 8080; 7960, 8080; 7960, 8080; 7960, 8080; 7960, 8080; 7960, 8080
            ]
            connect Junction10 Snubber.G as Connection49
            connect Junction11 Tr7.prm_3 as Connection52
            connect Vc_prim.p_node Junction11 as Connection53
            connect Vb_prim.n_node Junction12 as Connection54
            connect Junction12 Junction10 as Connection55
            connect Vc_prim.n_node Junction12 as Connection56
            connect Junction13 Junction4 as Connection58
            connect Va_sec.p_node Junction13 as Connection59
            connect Junction5 Junction14 as Connection61
            [
                breakpoints = 8296, 7896; 8312, 7896
            ]
            connect Vb_sec.p_node Junction14 as Connection63
            connect Va_sec.n_node Junction15 as Connection64
            [
                breakpoints = 8360, 7896
            ]
            connect Junction15 Snubber1.G as Connection65
            [
                breakpoints = 8360, 8080
            ]
            connect Junction16 Junction6 as Connection68
            connect Vc_sec.p_node Junction16 as Connection69
            connect Vb_sec.n_node Junction17 as Connection70
            connect Junction17 Junction15 as Connection71
            connect Vc_sec.n_node Junction17 as Connection72
            connect Junction8 Ia_Prim.p_node as Connection801
            connect Ia_Prim.n_node Tr7.prm_1 as Connection802
            connect Junction2 Ib_prim.p_node as Connection803
            connect Ib_prim.n_node Junction9 as Connection804
            connect Junction7 Ic_prim.p_node as Connection805
            connect Ic_prim.n_node Junction11 as Connection806
            connect c Ic_sec.n_node as Connection807
            connect Ic_sec.p_node Junction16 as Connection808
            connect Junction14 Ib_sec.p_node as Connection809
            connect Ib_sec.n_node b as Connection810
            connect a Ia_sec.n_node as Connection811
            connect Ia_sec.p_node Junction13 as Connection812
        }
        [
            position = 7560, 8680
            rotation = right
            scale = -1, 1
            size = 48, 160
        ]

        component Subsystem PCC_monitor {
            layout = dynamic
            component "core/Triple Pole Single Throw Contactor" S1 {
                ctrl_src = "Model"
            }
            [
                position = 8280, 8304
                size = 64, 256
            ]

            component gen_probe "Q kVAr" {
            }
            [
                position = 9792, 8000
            ]

            component "core/Voltage Measurement" Va {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8768, 8480
                rotation = right
                size = 64, 32
            ]

            component "core/Current Measurement" Ic {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8416, 8400
                size = 64, 32
            ]

            component gen_probe "P  KW" {
                signal_type = "power"
            }
            [
                position = 9792, 7936
            ]

            component "core/Voltage Measurement" Vc {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8896, 8592
                rotation = right
                size = 64, 32
            ]

            component gen_sr_ff "SR Flip Flop4" {
            }
            [
                position = 7752, 7976
                hide_name = True
            ]

            component "core/Current Measurement" Ia {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8416, 8208
                size = 64, 32
            ]

            component Subsystem Snubber {
                layout = dynamic
                component pas_resistor R22 {
                    resistance = "1e6"
                }
                [
                    position = 8376, 7944
                    rotation = right
                ]

                component pas_resistor R21 {
                    resistance = "1e6"
                }
                [
                    position = 8232, 7944
                    rotation = right
                ]

                component pas_resistor R20 {
                    resistance = "1e6"
                }
                [
                    position = 8304, 7944
                    rotation = right
                ]

                port A {
                    position = top:4
                    kind = pe
                }
                [
                    position = 8232, 7848
                    rotation = right
                ]

                port C {
                    position = top:6
                    kind = pe
                }
                [
                    position = 8376, 7848
                    rotation = right
                ]

                port B {
                    position = top:5
                    kind = pe
                }
                [
                    position = 8304, 7848
                    rotation = right
                ]

                port G {
                    position = bottom:3
                    kind = pe
                }
                [
                    position = 8304, 8112
                    rotation = left
                ]

                junction Junction1516 pe
                [
                    position = 8304, 8032
                ]

                junction Junction1517 pe
                [
                    position = 8304, 8032
                ]

                connect Junction1517 R22.n_node as Connection763
                connect B R20.p_node as Connection759
                connect Junction1516 Junction1517 as Connection762
                connect G Junction1517 as Connection764
                connect A R21.p_node as Connection758
                connect R20.n_node Junction1516 as Connection698
                connect Junction1516 R21.n_node as Connection755
                connect R22.p_node C as Connection760
            }
            [
                position = 7776, 8512
                size = 88, 80
            ]

            component Subsystem Synch_check {
                layout = dynamic
                component gen_digital_probe VABC_nom {
                }
                [
                    position = 7424, 8256
                    rotation = left
                    scale = -1, -1
                ]

                component gen_digital_probe f_ABC_nom {
                }
                [
                    position = 7344, 8456
                    rotation = left
                    scale = -1, -1
                ]

                component gen_digital_probe abc_dead {
                }
                [
                    position = 7360, 8232
                    rotation = right
                ]

                component gen_digital_probe Check_phase_ON {
                }
                [
                    position = 7296, 8520
                ]

                component Subsystem Calculate_dw_synch {
                    layout = dynamic
                    component src_constant zero {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 8256, 8128
                    ]

                    component tm_delay "Unit Delay1" {
                    }
                    [
                        position = 8272, 8008
                    ]

                    component gen_z_domain_transfer LPF_dw {
                        a_coeff = "[1.0/(2*np.pi*1),1]"
                        b_coeff = "1"
                        domain = "S-domain"
                        method = "Bilinear"
                    }
                    [
                        position = 8184, 8096
                    ]

                    component gen_sum Sum4 {
                    }
                    [
                        position = 8096, 8096
                    ]

                    component sys_signal_switch "Signal switch1" {
                        threshold = "0.5"
                    }
                    [
                        position = 8328, 8112
                        hide_name = True
                    ]

                    port dw_phase {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7960, 8104
                    ]

                    port dw_f {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7960, 8040
                    ]

                    port dw_synch {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8400, 8112
                    ]

                    port Activate {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8200, 8008
                    ]

                    connect "Unit Delay1.in" Activate as Connection180
                    connect LPF_dw.out "Signal switch1.in" as Connection241
                    connect Sum4.out LPF_dw.in as Connection240
                    connect "Unit Delay1.out" "Signal switch1.in2" as Connection181
                    connect dw_synch "Signal switch1.out" as Connection177
                    connect Sum4.in1 dw_phase as Connection231
                    connect zero.out "Signal switch1.in1" as Connection179
                    connect dw_f Sum4.in as Connection239
                }
                [
                    position = 7864, 8176
                    size = 128, 208
                ]

                component gen_digital_probe V_match {
                }
                [
                    position = 7432, 8088
                    rotation = left
                ]

                component gen_digital_probe synch_check_ON {
                }
                [
                    position = 7904, 8392
                ]

                component gen_logic_op and1 {
                }
                [
                    position = 7168, 8520
                ]

                component gen_bus_join "Bus Join" {
                }
                [
                    position = 8400, 8504
                    rotation = right
                    hide_name = True
                ]

                component Subsystem PLLs {
                    layout = dynamic
                    component Subsystem PLL1 {
                        layout = dynamic
                        component gen_z_domain_transfer LPF_q1 {
                            a_coeff = "[1,2*zeta*(2*np.pi*fc_w),(2*np.pi*fc_w)**2.0]"
                            b_coeff = "(2*np.pi*fc_w)**2.0"
                            domain = "S-domain"
                            init_states = "2*np.pi*f"
                            method = "Bilinear"
                        }
                        [
                            position = 8376, 7984
                            hide_name = True
                        ]

                        component gen_c_function integrator {
                            in_terminal_dimensions = "inherit"
                            in_terminal_dimensions_str = "in inherit"
                            in_terminal_labels = "False;"
                            init_fnc = "/*Begin code section*/
out = 0;
in = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "out inherit"
                            out_terminal_labels = "False;"
                            out_terminal_properties = "inherit out;"
                            output_fnc = "/*Begin code section*/
out += execution_rate*in;
if(in>=0.0){
    if(out >= 6.283185307179586)
    {
        out -= 6.283185307179586;
    }
}
else{
        if(out <= -6.283185307179586)
    {
        out += 6.283185307179586;
    }
}
/*End code section*/"
                        }
                        [
                            position = 8352, 8136
                        ]

                        component Subsystem Normalize {
                            layout = dynamic
                            component gen_c_function V_terminal {
                                in_terminal_dimensions_str = "d inherit;q inherit;"
                                in_terminal_labels = "False;False;"
                                in_terminal_properties = "real d;inherit q;"
                                init_fnc = "/*Begin code section*/
d = 0;
q = 0;
t = 0;
/*End code section*/"
                                no_feed_inputs = "[u\'\']"
                                no_feed_outputs = "[u\'\']"
                                out_terminal_dimensions_str = "t inherit;q_pu inherit;"
                                out_terminal_labels = "False;False;"
                                out_terminal_properties = "real t;inherit q_pu;"
                                output_fnc = "/*Begin code section*/
t = (powf(d,2.0)+powf(q,2.0));
t = sqrt(t);
if(t<0.1){
    q_pu = q/0.1;
}
else{
    q_pu = q/t;
}
/*End code section*/"
                            }
                            [
                                position = 8192, 8192
                            ]

                            port Vt {
                                position = top:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8104
                                rotation = left
                            ]

                            port q_pu {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8352, 8200
                            ]

                            port d {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8152
                            ]

                            port q {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8216
                            ]

                            connect V_terminal.d d as Connection1
                            connect V_terminal.q q as Connection3
                            connect V_terminal.t Vt as Connection8
                            connect q_pu V_terminal.q_pu as Connection9
                        }
                        [
                            position = 8096, 8136
                            size = 64, 64
                        ]

                        component Subsystem PID {
                            layout = dynamic
                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8328, 8488
                                scale = -1, 1
                            ]

                            component gen_sum Sum8 {
                                signs = "+-"
                            }
                            [
                                position = 8048, 8224
                            ]

                            component gen_integrator Integrator2 {
                                limit_lower = "-1"
                                limit_upper = "1"
                            }
                            [
                                position = 8152, 8320
                                scale = -1, 1
                            ]

                            component gen_gain Kp {
                                gain = "Kp"
                            }
                            [
                                position = 8056, 8128
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 8096, 8400
                            ]

                            component gen_gain Ki {
                                gain = "Ki"
                            }
                            [
                                position = 7960, 8392
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "lowLim*2*np.pi*f/100.0"
                                upper_limit = "upLim*2*np.pi*f/100.0"
                            }
                            [
                                position = 8408, 8224
                            ]

                            component gen_sum Sum5 {
                                signs = "3"
                            }
                            [
                                position = 8320, 8224
                            ]

                            component gen_gain Kd {
                                gain = "Kd"
                            }
                            [
                                position = 7920, 8216
                            ]

                            component gen_integrator Integrator1 {
                                init_value = "2*np.pi*f"
                                limit_lower = "-1"
                                limit_upper = "1"
                            }
                            [
                                position = 8224, 8400
                            ]

                            component gen_gain Gain1 {
                                gain = "2*np.pi*fc_Kd"
                            }
                            [
                                position = 8168, 8224
                            ]

                            component gen_gain Kb {
                                gain = "1000.0"
                            }
                            [
                                position = 8224, 8488
                                scale = -1, 1
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8184
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8224
                            ]

                            junction Junction2 sp
                            [
                                position = 8368, 8224
                            ]

                            junction Junction3 sp
                            [
                                position = 8440, 8224
                            ]

                            junction Junction6 sp
                            [
                                position = 7792, 8184
                            ]

                            junction Junction7 sp
                            [
                                position = 7792, 8216
                            ]

                            junction Junction8 sp
                            [
                                position = 8208, 8224
                            ]

                            connect Kp.in Junction6 as Connection73
                            connect Junction7 Junction6 as Connection82
                            connect Kp.out Sum5.in as Connection69
                            connect Junction8 Gain1.out as Connection87
                            connect Limit1.out Junction3 as Connection47
                            connect Kb.in Sum6.out as Connection50
                            connect Sum5.in2 Integrator1.out as Connection85
                            connect Kd.in Junction7 as Connection83
                            connect Kd.out Sum8.in as Connection80
                            connect Sum5.out Junction2 as Connection44
                            connect Ki.in Junction7 as Connection81
                            connect Sum5.in1 Junction8 as Connection88
                            connect Gain1.in Sum8.out as Connection61
                            connect In Junction6 as Connection74
                            connect Ki.out Sum7.in as Connection75
                            connect Sum6.in Junction2 as Connection46
                            connect Integrator2.in Junction8 as Connection86
                            connect Sum6.in1 Junction3 as Connection49
                            connect Integrator2.out Sum8.in1 as Connection66
                            connect Sum7.out Integrator1.in as Connection52
                            connect Junction2 Limit1.in as Connection45
                            connect Sum7.in1 Kb.out as Connection53
                            connect Junction3 Out as Connection48
                        }
                        [
                            position = 8200, 8136
                            rotation = down
                            scale = -1, 1
                            size = 64, 48
                        ]

                        component gen_terminator Termination1 {
                        }
                        [
                            position = 7848, 8200
                            rotation = right
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_q {
                            a_coeff = "[1.0/(2*np.pi*fc_q),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 7912, 8144
                            hide_name = True
                        ]

                        component tm_delay "Unit Delay1" {
                        }
                        [
                            position = 8432, 8224
                            rotation = right
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/(2*np.pi)"
                        }
                        [
                            position = 8440, 7984
                            hide_name = True
                        ]

                        component gen_rate_limiter "Rate Limiter1" {
                            falling_limit = "2*np.pi*w_fall"
                            rising_limit = "2*np.pi*w_rise"
                        }
                        [
                            position = 8304, 7984
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_d {
                            a_coeff = "[1.0/(2*np.pi*fc_d),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 7856, 8120
                            hide_name = True
                        ]

                        component Subsystem ABC_dqz {
                            layout = dynamic
                            component gen_abc2alpha_beta "abc to alpha beta" {
                            }
                            [
                                position = 8024, 8192
                            ]

                            component gen_alpha_beta2d_q "alpha beta to dq" {
                            }
                            [
                                position = 8248, 8192
                            ]

                            port B {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7904, 8104
                                rotation = right
                            ]

                            port C {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7856, 8104
                                rotation = right
                            ]

                            port d {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8320, 8136
                                rotation = left
                            ]

                            port A {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8104
                                rotation = right
                            ]

                            port q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8368, 8136
                                rotation = left
                            ]

                            port z {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8096, 8288
                                rotation = right
                            ]

                            port wt {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8176, 8288
                                rotation = left
                            ]

                            connect q "alpha beta to dq.q" as Connection2693
                            connect "alpha beta to dq.alpha" "abc to alpha beta.alpha" as Connection2688
                            connect "abc to alpha beta.beta" "alpha beta to dq.beta" as Connection2689
                            connect "abc to alpha beta.B" B as Connection2686
                            connect z "abc to alpha beta.gamma" as Connection2691
                            connect d "alpha beta to dq.d" as Connection2692
                            connect "alpha beta to dq.wt" wt as Connection2690
                            connect "abc to alpha beta.C" C as Connection2687
                            connect "abc to alpha beta.A" A as Connection2685
                        }
                        [
                            position = 7776, 8144
                            size = 48, 96
                        ]

                        port f {
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8504, 7984
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7608, 8152
                            rotation = left
                        ]

                        port B {
                            label = "B"
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7648, 8176
                            rotation = left
                        ]

                        port C {
                            label = "C"
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7688, 8200
                            rotation = left
                        ]

                        port d {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8024
                        ]

                        port Vt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8072
                        ]

                        port q {
                            label = "q"
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8080
                        ]

                        port wt {
                            position = right:5
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8504, 8072
                        ]

                        junction Junction6 sp
                        [
                            position = 8408, 8136
                        ]

                        junction Junction14 sp
                        [
                            position = 7960, 8120
                        ]

                        junction Junction15 sp
                        [
                            position = 8000, 8144
                        ]

                        junction Junction16 sp
                        [
                            position = 8264, 8136
                        ]

                        connect ABC_dqz.d LPF_d.in as Connection271
                        connect Junction14 d as Connection262
                        connect "Unit Delay1.in" Junction6 as Connection194
                        connect Junction15 q as Connection261
                        connect ABC_dqz.q LPF_q.in as Connection272
                        connect Junction16 integrator.in as Connection269
                        connect f Gain1.out as Connection264
                        connect Junction6 integrator.out as Connection195
                        connect ABC_dqz.z Termination1.in as Connection273
                        connect LPF_d.out Junction14 as Connection254
                        connect "Unit Delay1.out" ABC_dqz.wt as Connection274
                        connect wt Junction6 as Connection196
                        connect LPF_q.out Junction15 as Connection257
                        connect Gain1.in LPF_q1.out as Connection265
                        connect LPF_q1.in "Rate Limiter1.out" as Connection259
                        connect Junction14 Normalize.d as Connection253
                        connect Normalize.q Junction15 as Connection255
                        connect Normalize.Vt Vt as Connection211
                        connect PID.Out Junction16 as Connection270
                        connect ABC_dqz.A A as Connection277
                        connect PID.In Normalize.q_pu as Connection267
                        connect ABC_dqz.B B as Connection276
                        connect "Rate Limiter1.in" Junction16 as Connection268
                        connect ABC_dqz.C C as Connection275

                        Kd = "0.0"
                        f = "f"
                        w_fall = "-5*f"
                        w_rise = "5*f"

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Simple PLL with wrapped wt</span></p></body></html>"

                            Kp {
                                label = "Proportional gain"
                                widget = edit
                                type = generic
                                default_value = "100.0"
                            }

                            Ki {
                                label = "Integral gain"
                                widget = edit
                                type = generic
                                default_value = "3200.0"
                            }

                            Kd {
                                label = "Differential gain"
                                widget = edit
                                type = generic
                                default_value = "1.0"
                            }

                            fc_Kd {
                                label = "Derivative control LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "113.6821"
                            }

                            fc_d {
                                label = "d channel LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "10.0"
                                unit = "Hz"
                            }

                            fc_q {
                                label = "q channel LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "10.0"
                                unit = "Hz"
                            }

                            f {
                                label = "Target frequency"
                                widget = edit
                                type = generic
                                default_value = "60.0"
                                unit = "Hz"
                            }

                            upLim {
                                label = "Frequency deviation upper limit"
                                widget = edit
                                type = generic
                                default_value = "140"
                                unit = "%"
                            }

                            lowLim {
                                label = "Frequency deviation lower limit"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "%"
                            }

                            zeta {
                                label = "w 2nd order LPF damping ratio"
                                widget = edit
                                type = generic
                                default_value = "0.707"
                            }

                            fc_w {
                                label = "w 2nd order LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "25"
                                unit = "Hz"
                            }

                            w_rise {
                                label = "w Rising rate"
                                widget = edit
                                type = generic
                                default_value = "60"
                                unit = "Hz/s"
                            }

                            w_fall {
                                label = "w Falling rate"
                                widget = edit
                                type = generic
                                default_value = "-60"
                                unit = "Hz/s"
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                                
                            ENDCODE
                        }
                    }
                    [
                        position = 8168, 8264
                        size = 88, 240
                    ]

                    component gen_probe wt_abc {
                    }
                    [
                        position = 8592, 8152
                    ]

                    component gen_terminator Termination3 {
                    }
                    [
                        position = 8256, 8112
                        rotation = left
                        hide_name = True
                    ]

                    component Subsystem PLL {
                        layout = dynamic
                        component gen_gain Gain1 {
                            gain = "1.0/(2*np.pi)"
                        }
                        [
                            position = 8440, 7984
                            hide_name = True
                        ]

                        component gen_terminator Termination1 {
                        }
                        [
                            position = 7848, 8200
                            rotation = right
                            hide_name = True
                        ]

                        component gen_c_function integrator {
                            in_terminal_dimensions = "inherit"
                            in_terminal_dimensions_str = "in inherit"
                            in_terminal_labels = "False;"
                            init_fnc = "/*Begin code section*/
out = 0;
in = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "out inherit"
                            out_terminal_labels = "False;"
                            out_terminal_properties = "inherit out;"
                            output_fnc = "/*Begin code section*/
out += execution_rate*in;
if(in>=0.0){
    if(out >= 6.283185307179586)
    {
        out -= 6.283185307179586;
    }
}
else{
        if(out <= -6.283185307179586)
    {
        out += 6.283185307179586;
    }
}
/*End code section*/"
                        }
                        [
                            position = 8352, 8136
                            size = 48, 48
                        ]

                        component gen_z_domain_transfer LPF_q {
                            a_coeff = "[1.0/(2*np.pi*fc_q),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 7912, 8144
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_q1 {
                            a_coeff = "[1,2*zeta*(2*np.pi*fc_w),(2*np.pi*fc_w)**2.0]"
                            b_coeff = "(2*np.pi*fc_w)**2.0"
                            domain = "S-domain"
                            init_states = "2*np.pi*f"
                            method = "Bilinear"
                        }
                        [
                            position = 8376, 7984
                            hide_name = True
                        ]

                        component Subsystem PID {
                            layout = dynamic
                            component gen_integrator Integrator2 {
                                limit_lower = "-1"
                                limit_upper = "1"
                            }
                            [
                                position = 8152, 8320
                                scale = -1, 1
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 8096, 8400
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8328, 8488
                                scale = -1, 1
                            ]

                            component gen_sum Sum5 {
                                signs = "3"
                            }
                            [
                                position = 8320, 8224
                            ]

                            component gen_gain Kp {
                                gain = "Kp"
                            }
                            [
                                position = 8056, 8128
                            ]

                            component gen_gain Kb {
                                gain = "1000.0"
                            }
                            [
                                position = 8224, 8488
                                scale = -1, 1
                            ]

                            component gen_sum Sum8 {
                                signs = "+-"
                            }
                            [
                                position = 8048, 8224
                            ]

                            component gen_gain Ki {
                                gain = "Ki"
                            }
                            [
                                position = 7960, 8392
                            ]

                            component gen_gain Gain1 {
                                gain = "2*np.pi*fc_Kd"
                            }
                            [
                                position = 8168, 8224
                            ]

                            component gen_integrator Integrator1 {
                                init_value = "2*np.pi*f"
                                limit_lower = "-1"
                                limit_upper = "1"
                            }
                            [
                                position = 8224, 8400
                            ]

                            component gen_gain Kd {
                                gain = "Kd"
                            }
                            [
                                position = 7920, 8216
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "lowLim*2*np.pi*f/100.0"
                                upper_limit = "upLim*2*np.pi*f/100.0"
                            }
                            [
                                position = 8408, 8224
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8224
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8184
                            ]

                            junction Junction2 sp
                            [
                                position = 8368, 8224
                            ]

                            junction Junction3 sp
                            [
                                position = 8440, 8224
                            ]

                            junction Junction6 sp
                            [
                                position = 7792, 8184
                            ]

                            junction Junction7 sp
                            [
                                position = 7792, 8216
                            ]

                            junction Junction8 sp
                            [
                                position = 8208, 8224
                            ]

                            connect Junction7 Junction6 as Connection82
                            connect Junction8 Gain1.out as Connection87
                            connect Kb.in Sum6.out as Connection50
                            connect Kd.in Junction7 as Connection83
                            connect Kd.out Sum8.in as Connection80
                            connect Ki.in Junction7 as Connection81
                            connect Sum6.in Junction2 as Connection46
                            connect Ki.out Sum7.in as Connection75
                            connect Sum5.in1 Junction8 as Connection88
                            connect Kp.in Junction6 as Connection73
                            connect In Junction6 as Connection74
                            connect Sum6.in1 Junction3 as Connection49
                            connect Kp.out Sum5.in as Connection69
                            connect Integrator2.in Junction8 as Connection86
                            connect Sum7.out Integrator1.in as Connection52
                            connect Limit1.out Junction3 as Connection47
                            connect Integrator2.out Sum8.in1 as Connection66
                            connect Sum7.in1 Kb.out as Connection53
                            connect Sum5.in2 Integrator1.out as Connection85
                            connect Junction2 Limit1.in as Connection45
                            connect Sum5.out Junction2 as Connection44
                            connect Gain1.in Sum8.out as Connection61
                            connect Junction3 Out as Connection48
                        }
                        [
                            position = 8200, 8136
                            rotation = down
                            scale = -1, 1
                            size = 64, 48
                        ]

                        component Subsystem Normalize {
                            layout = dynamic
                            component gen_c_function V_terminal {
                                in_terminal_dimensions_str = "d inherit;q inherit;"
                                in_terminal_labels = "False;False;"
                                in_terminal_properties = "real d;inherit q;"
                                init_fnc = "/*Begin code section*/
d = 0;
q = 0;
t = 0;
/*End code section*/"
                                no_feed_inputs = "[u\'\']"
                                no_feed_outputs = "[u\'\']"
                                out_terminal_dimensions_str = "t inherit;q_pu inherit;"
                                out_terminal_labels = "False;False;"
                                out_terminal_properties = "real t;inherit q_pu;"
                                output_fnc = "/*Begin code section*/
t = (powf(d,2.0)+powf(q,2.0));
t = sqrt(t);
if(t<0.1){
    q_pu = q/0.1;
}
else{
    q_pu = q/t;
}
/*End code section*/"
                            }
                            [
                                position = 8192, 8192
                                size = 48, 48
                            ]

                            port q_pu {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8352, 8200
                            ]

                            port q {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8216
                            ]

                            port Vt {
                                position = top:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8104
                                rotation = left
                            ]

                            port d {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8152
                            ]

                            connect q_pu V_terminal.q_pu as Connection9
                            connect V_terminal.t Vt as Connection8
                            connect V_terminal.d d as Connection1
                            connect V_terminal.q q as Connection3
                        }
                        [
                            position = 8096, 8136
                            size = 64, 64
                        ]

                        component gen_z_domain_transfer LPF_d {
                            a_coeff = "[1.0/(2*np.pi*fc_d),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 7856, 8120
                            hide_name = True
                        ]

                        component Subsystem ABC_dqz {
                            layout = dynamic
                            component gen_abc2alpha_beta "abc to alpha beta" {
                            }
                            [
                                position = 8024, 8192
                            ]

                            component gen_alpha_beta2d_q "alpha beta to dq" {
                            }
                            [
                                position = 8248, 8192
                            ]

                            port wt {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8176, 8288
                                rotation = left
                            ]

                            port q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8368, 8136
                                rotation = left
                            ]

                            port z {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8096, 8288
                                rotation = right
                            ]

                            port B {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7904, 8104
                                rotation = right
                            ]

                            port C {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7856, 8104
                                rotation = right
                            ]

                            port A {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8104
                                rotation = right
                            ]

                            port d {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8320, 8136
                                rotation = left
                            ]

                            connect "abc to alpha beta.A" A as Connection2685
                            connect "abc to alpha beta.C" C as Connection2687
                            connect "alpha beta to dq.alpha" "abc to alpha beta.alpha" as Connection2688
                            connect q "alpha beta to dq.q" as Connection2693
                            connect "abc to alpha beta.B" B as Connection2686
                            connect z "abc to alpha beta.gamma" as Connection2691
                            connect "abc to alpha beta.beta" "alpha beta to dq.beta" as Connection2689
                            connect d "alpha beta to dq.d" as Connection2692
                            connect "alpha beta to dq.wt" wt as Connection2690
                        }
                        [
                            position = 7776, 8144
                            size = 48, 96
                        ]

                        component tm_delay "Unit Delay1" {
                        }
                        [
                            position = 8432, 8224
                            rotation = right
                            hide_name = True
                        ]

                        component gen_rate_limiter "Rate Limiter1" {
                            falling_limit = "2*np.pi*w_fall"
                            rising_limit = "2*np.pi*w_rise"
                        }
                        [
                            position = 8304, 7984
                            hide_name = True
                        ]

                        port f {
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8504, 7984
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7608, 8152
                            rotation = left
                        ]

                        port B {
                            label = "B"
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7648, 8176
                            rotation = left
                        ]

                        port C {
                            label = "C"
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7688, 8200
                            rotation = left
                        ]

                        port d {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8024
                        ]

                        port Vt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8072
                        ]

                        port q {
                            label = "q"
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8080
                        ]

                        port wt {
                            position = right:5
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8504, 8072
                        ]

                        junction Junction6 sp
                        [
                            position = 8408, 8136
                        ]

                        junction Junction14 sp
                        [
                            position = 7960, 8120
                        ]

                        junction Junction15 sp
                        [
                            position = 8000, 8144
                        ]

                        junction Junction16 sp
                        [
                            position = 8264, 8136
                        ]

                        connect ABC_dqz.B B as Connection276
                        connect "Unit Delay1.out" ABC_dqz.wt as Connection274
                        connect ABC_dqz.C C as Connection275
                        connect Junction14 Normalize.d as Connection253
                        connect "Unit Delay1.in" Junction6 as Connection194
                        connect Junction14 d as Connection262
                        connect ABC_dqz.d LPF_d.in as Connection271
                        connect Junction15 q as Connection261
                        connect f Gain1.out as Connection264
                        connect Junction16 integrator.in as Connection269
                        connect ABC_dqz.q LPF_q.in as Connection272
                        connect Junction6 integrator.out as Connection195
                        connect wt Junction6 as Connection196
                        connect LPF_d.out Junction14 as Connection254
                        connect ABC_dqz.z Termination1.in as Connection273
                        connect LPF_q.out Junction15 as Connection257
                        connect Gain1.in LPF_q1.out as Connection265
                        connect LPF_q1.in "Rate Limiter1.out" as Connection259
                        connect Normalize.q Junction15 as Connection255
                        connect Normalize.Vt Vt as Connection211
                        connect PID.Out Junction16 as Connection270
                        connect ABC_dqz.A A as Connection277
                        connect PID.In Normalize.q_pu as Connection267
                        connect "Rate Limiter1.in" Junction16 as Connection268

                        Kd = "0.0"
                        f = "f"
                        w_fall = "-5*f"
                        w_rise = "5*f"

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Simple PLL with wrapped wt</span></p></body></html>"

                            Kp {
                                label = "Proportional gain"
                                widget = edit
                                type = generic
                                default_value = "100.0"
                            }

                            Ki {
                                label = "Integral gain"
                                widget = edit
                                type = generic
                                default_value = "3200.0"
                            }

                            Kd {
                                label = "Differential gain"
                                widget = edit
                                type = generic
                                default_value = "1.0"
                            }

                            fc_Kd {
                                label = "Derivative control LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "113.6821"
                            }

                            fc_d {
                                label = "d channel LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "10.0"
                                unit = "Hz"
                            }

                            fc_q {
                                label = "q channel LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "10.0"
                                unit = "Hz"
                            }

                            f {
                                label = "Target frequency"
                                widget = edit
                                type = generic
                                default_value = "60.0"
                                unit = "Hz"
                            }

                            upLim {
                                label = "Frequency deviation upper limit"
                                widget = edit
                                type = generic
                                default_value = "140"
                                unit = "%"
                            }

                            lowLim {
                                label = "Frequency deviation lower limit"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "%"
                            }

                            zeta {
                                label = "w 2nd order LPF damping ratio"
                                widget = edit
                                type = generic
                                default_value = "0.707"
                            }

                            fc_w {
                                label = "w 2nd order LPF cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "25"
                                unit = "Hz"
                            }

                            w_rise {
                                label = "w Rising rate"
                                widget = edit
                                type = generic
                                default_value = "60"
                                unit = "Hz/s"
                            }

                            w_fall {
                                label = "w Falling rate"
                                widget = edit
                                type = generic
                                default_value = "-60"
                                unit = "Hz/s"
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                                
                            ENDCODE
                        }
                    }
                    [
                        position = 8168, 7928
                        size = 88, 240
                    ]

                    component gen_probe VABC {
                    }
                    [
                        position = 8328, 7888
                        rotation = left
                    ]

                    component gen_terminator Termination4 {
                    }
                    [
                        position = 8288, 8160
                        rotation = left
                        hide_name = True
                    ]

                    component gen_terminator Termination2 {
                    }
                    [
                        position = 8280, 7824
                        rotation = left
                        hide_name = True
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 8248, 7776
                        rotation = left
                        hide_name = True
                    ]

                    component gen_probe Vabc {
                    }
                    [
                        position = 8336, 8224
                        rotation = left
                    ]

                    component gen_sum Sum1 {
                        signs = "+-"
                    }
                    [
                        position = 8592, 8088
                        hide_name = True
                    ]

                    component gen_probe wt_ABC {
                    }
                    [
                        position = 8592, 8016
                    ]

                    port Vc {
                        position = left:6
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8056, 8360
                    ]

                    port f_ABC {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 7976
                    ]

                    port "Phase diff" {
                        position = right:5
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8744, 8088
                    ]

                    port V_ABC {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8392, 7928
                    ]

                    port f_abc {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8288, 8312
                    ]

                    port V_abc {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8392, 8264
                    ]

                    port VA {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8048, 7832
                    ]

                    port VB {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8048, 7928
                    ]

                    port VC {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8048, 8024
                    ]

                    port Va {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8056, 8168
                    ]

                    port Vb {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8056, 8264
                    ]

                    tag Goto2 {
                        value = "wt_ABC"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8288, 8024
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From2 {
                        value = "wt_ABC"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8408, 8080
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto3 {
                        value = "wt_abc"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8296, 8360
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From3 {
                        value = "wt_abc"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8472, 8096
                        hide_name = True
                        size = 0, 0
                    ]

                    junction Junction14 sp
                    [
                        position = 8528, 8096
                    ]

                    junction Junction15 sp
                    [
                        position = 8528, 8080
                    ]

                    junction Junction19 sp
                    [
                        position = 8328, 7928
                    ]

                    junction Junction20 sp
                    [
                        position = 8336, 8264
                    ]

                    connect Goto3 PLL1.wt as Connection760
                    connect Termination1.in PLL.d as Connection753
                    connect Termination2.in PLL.q as Connection754
                    connect Vc PLL1.C as Connection765
                    connect Termination3.in PLL1.d as Connection756
                    connect Junction15 Sum1.in as Connection271
                    connect f_ABC PLL.f as Connection758
                    connect Termination4.in PLL1.q as Connection757
                    connect Junction19 V_ABC as Connection749
                    connect VABC.in Junction19 as Connection748
                    connect f_abc PLL1.f as Connection759
                    connect VB PLL.B as Connection746
                    connect Junction20 V_abc as Connection762
                    connect Vb PLL1.B as Connection766
                    connect From2 Junction15 as Connection270
                    connect wt_ABC.in Junction15 as Connection272
                    connect VC PLL.C as Connection747
                    connect PLL.Vt Junction19 as Connection750
                    connect Va PLL1.A as Connection764
                    connect wt_abc.in Junction14 as Connection269
                    connect From3 Junction14 as Connection267
                    connect PLL.A VA as Connection767
                    connect PLL1.Vt Junction20 as Connection763
                    connect Vabc.in Junction20 as Connection761
                    connect Goto2 PLL.wt as Connection752
                    connect Junction14 Sum1.in1 as Connection268
                    connect "Phase diff" Sum1.out as Connection336
                }
                [
                    position = 6744, 8328
                    size = 104, 368
                ]

                component gen_logic_op and2 {
                    inputs = "4"
                }
                [
                    position = 7824, 8520
                    rotation = left
                ]

                component gen_digital_probe f_match {
                }
                [
                    position = 7488, 8320
                    rotation = left
                ]

                component Subsystem Contactor_Control {
                    layout = dynamic
                    component gen_c_function CB_SM {
                        in_terminal_dimensions = "inherit;inherit;inherit;inherit;inherit"
                        in_terminal_dimensions_str = "Close_cmd inherit;Open_cmd inherit;ABC_nom inherit;abc_dead inherit;Matched inherit"
                        in_terminal_labels = "False;False;False;False;False;"
                        in_terminal_properties = "inherit Close_cmd;inherit Open_cmd;inherit ABC_nom;inherit abc_dead;inherit Matched;"
                        init_fnc = "/*Begin code section*/
close_CB = 0;
open_CB = 1;
/*End code section*/"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit;inherit"
                        out_terminal_dimensions_str = "close_CB inherit;open_CB inherit"
                        out_terminal_labels = "False;False;"
                        out_terminal_properties = "real close_CB;inherit open_CB;"
                        output_fnc = "/*Begin code section*/
if((Open_cmd>0.0) || (!ABC_nom)){
    close_CB = 0;
    open_CB = 1;
}
else{
    if(Close_cmd>0.0){
        if((abc_dead) || (Matched)){
            close_CB = 1;
            open_CB = 0;
        }
        else{
            close_CB = 0;
        }
    }
    else{
        close_CB = 0;
    }
}
/*End code section*/"
                    }
                    [
                        position = 7576, 8336
                        size = 48, 96
                    ]

                    component gen_terminator Termination12 {
                    }
                    [
                        position = 7760, 8392
                        rotation = right
                        hide_name = True
                    ]

                    component gen_digital_probe set_CB {
                    }
                    [
                        position = 7632, 8224
                        rotation = left
                    ]

                    component gen_digital_probe reset_CB {
                    }
                    [
                        position = 7640, 8432
                        rotation = right
                    ]

                    component gen_logic_op "Logical operator1" {
                        inputs = "3"
                    }
                    [
                        position = 7448, 8488
                        rotation = left
                        hide_name = True
                    ]

                    component gen_sr_ff "SR Flip Flop1" {
                    }
                    [
                        position = 7712, 8336
                        hide_name = True
                    ]

                    component gen_digital_probe CB_cmd {
                    }
                    [
                        position = 7760, 8280
                        rotation = left
                    ]

                    port CB {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7808, 8320
                    ]

                    port ABC_nom {
                        position = left:6
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7264, 8336
                    ]

                    port phase_match {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7264, 8576
                    ]

                    port f_match {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7344, 8536
                    ]

                    port V_match {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7344, 8600
                    ]

                    port "Close Breaker" {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7488, 8224
                        rotation = right
                    ]

                    port "Open Breaker" {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7320, 8224
                        rotation = right
                    ]

                    port abc_dead {
                        position = left:7
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7344, 8432
                        rotation = left
                    ]

                    junction Junction32 sp
                    [
                        position = 7760, 8320
                    ]

                    junction Junction33 sp
                    [
                        position = 7632, 8304
                    ]

                    junction Junction34 sp
                    [
                        position = 7640, 8368
                    ]

                    comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">This state machine reads the</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">breaker commands and take</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">respective actions. It also</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">checks the grid (ABC) status</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">and force the breaker open</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">if the grid is not in nominal </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">conditions.</p></body></html> ENDCOMMENT 
                    [
                        position = 7488, 8504
                    ]

                    connect "Open Breaker" CB_SM.Open_cmd as Connection591
                    connect "SR Flip Flop1.out" Junction32 as Connection530
                    connect Termination12.in "SR Flip Flop1.out_n" as Connection55
                    connect abc_dead CB_SM.abc_dead as Connection579
                    connect phase_match "Logical operator1.in1" as Connection570
                    connect reset_CB.in Junction34 as Connection600
                    connect ABC_nom CB_SM.ABC_nom as Connection594
                    connect set_CB.in Junction33 as Connection597
                    connect CB_SM.close_CB Junction33 as Connection595
                    connect CB_SM.open_CB Junction34 as Connection598
                    connect CB_cmd.in Junction32 as Connection528
                    connect "Close Breaker" CB_SM.Close_cmd as Connection574
                    connect Junction32 CB as Connection529
                    connect Junction33 "SR Flip Flop1.s_in" as Connection596
                    connect Junction34 "SR Flip Flop1.r_in" as Connection599
                    connect "Logical operator1.out" CB_SM.Matched as Connection580
                    connect "Logical operator1.in2" V_match as Connection571
                    connect "Logical operator1.in" f_match as Connection569
                }
                [
                    position = 8368, 8200
                    size = 168, 248
                ]

                component gen_digital_probe Phase_match {
                }
                [
                    position = 7376, 8760
                    rotation = right
                ]

                component Subsystem check_f_diff {
                    layout = dynamic
                    component gen_comparator Comparator1 {
                    }
                    [
                        position = 8280, 8256
                        hide_name = True
                        scale = 1, -1
                    ]

                    component gen_gain Freq_diff {
                        gain = "delta_f/100.0"
                    }
                    [
                        position = 8208, 8304
                    ]

                    component gen_z_domain_transfer LPF_dwf {
                        a_coeff = "[1.0/(2*np.pi*1),1]"
                        b_coeff = "1"
                        domain = "S-domain"
                        method = "Bilinear"
                    }
                    [
                        position = 8128, 8152
                    ]

                    component gen_abs Abs4 {
                    }
                    [
                        position = 7856, 8416
                        hide_name = True
                    ]

                    component gen_probe f_diff {
                    }
                    [
                        position = 8248, 8088
                    ]

                    component gen_c_function interval_check {
                        in_terminal_dimensions = "inherit"
                        in_terminal_dimensions_str = "in inherit"
                        in_terminal_labels = "False;"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "False;"
                        output_fnc = "/*Begin code section*/
if((in>=f*(1-fn_thresh/100.0)) && in<=f*(1+fn_thresh/100.0)){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                        parameters = "real fn_thresh;real f;"
                    }
                    [
                        position = 7952, 8416
                    ]

                    component Subsystem PI {
                        layout = dynamic
                        component gen_sum Sum6 {
                            signs = "-+"
                        }
                        [
                            position = 8320, 8312
                            scale = -1, 1
                        ]

                        component gen_sum Sum7 {
                        }
                        [
                            position = 8088, 8224
                        ]

                        component gen_integrator Integrator1 {
                            limit_lower = "[\'-inf\']"
                            limit_upper = "[\'inf\']"
                        }
                        [
                            position = 8216, 8224
                        ]

                        component gen_gain Kp {
                            gain = "f_Kp"
                        }
                        [
                            position = 7968, 8136
                        ]

                        component gen_gain Ki {
                            gain = "f_Ki"
                        }
                        [
                            position = 7968, 8216
                        ]

                        component gen_gain Kb {
                        }
                        [
                            position = 8216, 8312
                            scale = -1, 1
                        ]

                        component gen_limiter Limit1 {
                            lower_limit = "f_lowLim"
                            upper_limit = "f_upLim"
                        }
                        [
                            position = 8408, 8216
                        ]

                        component gen_sum Sum5 {
                        }
                        [
                            position = 8320, 8216
                        ]

                        port Out {
                            label = "Out"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8472, 8216
                        ]

                        port In {
                            label = "In"
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7824, 8184
                        ]

                        junction Junction2 sp
                        [
                            position = 8368, 8216
                        ]

                        junction Junction3 sp
                        [
                            position = 8440, 8216
                        ]

                        junction Junction4 sp
                        [
                            position = 7888, 8184
                        ]

                        connect Sum5.in1 Integrator1.out as Connection5
                        connect Sum5.out Junction2 as Connection44
                        connect Sum6.in Junction2 as Connection46
                        connect Sum6.in1 Junction3 as Connection49
                        connect Sum7.out Integrator1.in as Connection52
                        connect Sum7.in1 Kb.out as Connection53
                        connect Junction4 In as Connection58
                        connect Junction2 Limit1.in as Connection45
                        connect Junction3 Out as Connection48
                        connect Kb.in Sum6.out as Connection50
                        connect Ki.in Junction4 as Connection59
                        connect Ki.out Sum7.in as Connection55
                        connect Kp.in Junction4 as Connection57
                        connect Kp.out Sum5.in as Connection54
                        connect Limit1.out Junction3 as Connection47
                    }
                    [
                        position = 8304, 8152
                        size = 64, 48
                    ]

                    component gen_probe f_ABC_nom {
                    }
                    [
                        position = 8160, 8480
                        rotation = right
                    ]

                    component gen_sum Sum1 {
                        signs = "+-"
                    }
                    [
                        position = 8056, 8152
                    ]

                    component src_constant Constant1 {
                        execution_rate = "Ts"
                        value = "f"
                    }
                    [
                        position = 8120, 8304
                        hide_name = True
                    ]

                    component gen_gain toPU {
                        gain = "[1.0/(2.0*f)]"
                    }
                    [
                        position = 8216, 8152
                    ]

                    component gen_abs Abs3 {
                    }
                    [
                        position = 8208, 8248
                    ]

                    port dw_f {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8384, 8152
                    ]

                    port f_match {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8384, 8256
                    ]

                    port f_ABC {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7752, 8144
                    ]

                    port f_abc {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7968, 8160
                    ]

                    port "f_ABC nom" {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8248, 8416
                    ]

                    junction Junction1 sp
                    [
                        position = 8168, 8152
                    ]

                    junction Junction12 sp
                    [
                        position = 7808, 8144
                    ]

                    junction Junction13 sp
                    [
                        position = 8160, 8416
                    ]

                    connect toPU.in Junction1 as Connection40
                    connect Abs3.in Junction1 as Connection7
                    connect toPU.out PI.In as Connection63
                    connect Abs4.in Junction12 as Connection278
                    connect interval_check.in Abs4.out as Connection280
                    connect Comparator1.in2 Abs3.out as Connection10
                    connect Comparator1.out f_match as Connection59
                    connect Constant1.out Freq_diff.in as Connection14
                    connect Freq_diff.out Comparator1.in1 as Connection17
                    connect Junction1 LPF_dwf.out as Connection61
                    connect Junction12 f_ABC as Connection277
                    connect Sum1.in Junction12 as Connection276
                    connect Junction13 f_ABC_nom.in as Connection282
                    connect Sum1.in1 f_abc as Connection60
                    connect LPF_dwf.in Sum1.out as Connection62
                    connect PI.Out dw_f as Connection64
                    connect "f_ABC nom" Junction13 as Connection281
                    connect f_diff.in Junction1 as Connection56
                    connect interval_check.out Junction13 as Connection283
                }
                [
                    position = 7216, 8368
                    size = 144, 120
                ]

                component gen_logic_op not {
                    operator = "NOT"
                }
                [
                    position = 7736, 8576
                    hide_name = True
                ]

                component Subsystem check_phase_diff {
                    layout = dynamic
                    component gen_probe phase_filter {
                    }
                    [
                        position = 8112, 8040
                    ]

                    component gen_gain to_pu {
                        gain = "1.0/(2*np.pi)"
                    }
                    [
                        position = 8128, 7976
                    ]

                    component src_constant One {
                        execution_rate = "Ts"
                    }
                    [
                        position = 8000, 8216
                    ]

                    component gen_probe phase_diff {
                    }
                    [
                        position = 8040, 7904
                    ]

                    component gen_c_function confine_phase {
                        in_terminal_dimensions_str = "dtheta inherit;"
                        in_terminal_labels = "False;"
                        in_terminal_properties = "real dtheta;"
                        init_fnc = "/*Begin code section*/
dtheta = 0;
dtheta_confined = 0;
/*End code section*/"
                        no_feed_inputs = "[u\'\']"
                        no_feed_outputs = "[u\'\']"
                        out_terminal_dimensions_str = "dtheta_confined inherit;"
                        out_terminal_labels = "False;"
                        out_terminal_properties = "real dtheta_confined;"
                        output_fnc = "/*Begin code section*/
if (dtheta > 3.14159265359) {//confine theta to +/- 2*pi;
    dtheta_confined = dtheta - 6.28318530718;
}
else{
    if (dtheta < -3.14159265359){
        dtheta_confined = dtheta + 6.28318530718;
    }
}
/*End code section*/"
                    }
                    [
                        position = 7920, 7976
                    ]

                    component Subsystem Counter {
                        layout = dynamic
                        component "core/Counter" Counter1 {
                        }
                        [
                            position = 8192, 8200
                            size = 48, 48
                        ]

                        component gen_rel_op less_than {
                            relational_op = "<"
                        }
                        [
                            position = 8336, 8192
                        ]

                        component src_constant Constant3 {
                            execution_rate = "Ts"
                            value = ".1/Ts"
                        }
                        [
                            position = 8256, 8144
                        ]

                        component gen_logic_op not {
                            operator = "NOT"
                        }
                        [
                            position = 8104, 8248
                        ]

                        port In {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 8192
                        ]

                        port Out {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8400, 8192
                        ]

                        junction Junction14 sp
                        [
                            position = 8056, 8192
                        ]

                        connect Junction14 In as Connection562
                        connect less_than.out Out as Connection561
                        connect Junction14 not.in as Connection560
                        connect Counter1.en Junction14 as Connection559
                        connect less_than.in1 Counter1.out as Connection450
                        connect not.out Counter1.reset as Connection88
                        connect Constant3.out less_than.in as Connection66
                    }
                    [
                        position = 8256, 8168
                        size = 48, 48
                    ]

                    component gen_comparator Comparator2 {
                    }
                    [
                        position = 8160, 8168
                        hide_name = True
                        scale = 1, -1
                    ]

                    component gen_product Product1 {
                    }
                    [
                        position = 8384, 7968
                        hide_name = True
                    ]

                    component gen_gain Phase_diff {
                        gain = "delta_phi*np.pi/180.0"
                    }
                    [
                        position = 8088, 8216
                    ]

                    component Subsystem PI {
                        layout = dynamic
                        component gen_sum Sum7 {
                        }
                        [
                            position = 8088, 8224
                        ]

                        component gen_limiter Limit1 {
                            lower_limit = "phase_lowLim"
                            upper_limit = "phase_upLim"
                        }
                        [
                            position = 8408, 8224
                        ]

                        component gen_integrator Integrator1 {
                            limit_lower = "phase_lowLim"
                            limit_upper = "phase_upLim"
                            show_reset = "either"
                        }
                        [
                            position = 8216, 8232
                        ]

                        component gen_gain Kp {
                            gain = "phase_Kp"
                        }
                        [
                            position = 7952, 8144
                        ]

                        component gen_gain Ki {
                            gain = "phase_Ki"
                        }
                        [
                            position = 7952, 8216
                        ]

                        component gen_sum Sum6 {
                            signs = "-+"
                        }
                        [
                            position = 8320, 8312
                            scale = -1, 1
                        ]

                        component gen_sum Sum5 {
                        }
                        [
                            position = 8320, 8224
                        ]

                        component gen_gain Kb {
                        }
                        [
                            position = 8216, 8312
                            scale = -1, 1
                        ]

                        port In {
                            label = "In"
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7824, 8184
                        ]

                        port Out {
                            label = "Out"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8472, 8224
                        ]

                        port Reset {
                            label = "Reset"
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8144, 8264
                        ]

                        junction Junction2 sp
                        [
                            position = 8368, 8224
                        ]

                        junction Junction3 sp
                        [
                            position = 8440, 8224
                        ]

                        junction Junction4 sp
                        [
                            position = 7856, 8184
                        ]

                        connect Sum5.out Junction2 as Connection44
                        connect Sum6.in Junction2 as Connection46
                        connect Sum6.in1 Junction3 as Connection49
                        connect Sum7.out Integrator1.in as Connection52
                        connect Sum7.in1 Kb.out as Connection53
                        connect Integrator1.reset Reset as Connection2
                        connect Junction2 Limit1.in as Connection45
                        connect Junction3 Out as Connection48
                        connect Junction4 In as Connection58
                        connect Kb.in Sum6.out as Connection50
                        connect Ki.in Junction4 as Connection59
                        connect Kp.in Junction4 as Connection57
                        connect Ki.out Sum7.in as Connection56
                        connect Kp.out Sum5.in as Connection54
                        connect Limit1.out Junction3 as Connection47
                        connect Sum5.in1 Integrator1.out as Connection5
                    }
                    [
                        position = 8240, 7976
                        size = 64, 48
                    ]

                    component gen_abs Abs2 {
                    }
                    [
                        position = 8064, 8112
                        rotation = right
                    ]

                    component gen_z_domain_transfer LPF {
                        a_coeff = "[1.0/(2*np.pi*0.5),1]"
                        b_coeff = "1"
                        domain = "S-domain"
                        method = "Bilinear"
                    }
                    [
                        position = 8032, 7976
                    ]

                    port dw_phase {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8504, 7968
                    ]

                    port phase_Grid {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7832, 7976
                    ]

                    port phase_match {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8360, 8168
                    ]

                    port Activate {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8240, 7864
                        rotation = left
                        scale = 1, -1
                    ]

                    junction Junction15 sp
                    [
                        position = 8064, 7976
                    ]

                    junction Junction17 sp
                    [
                        position = 8064, 8040
                    ]

                    junction Junction21 sp
                    [
                        position = 8240, 7912
                    ]

                    junction Junction22 sp
                    [
                        position = 7992, 7976
                    ]

                    connect to_pu.out PI.In as Connection713
                    connect Activate Junction21 as Connection622
                    connect Comparator2.in2 Abs2.out as Connection712
                    connect Comparator2.out Counter.In as Connection674
                    connect Junction15 LPF.out as Connection582
                    connect Junction17 Junction15 as Connection591
                    connect One.out Phase_diff.in as Connection15
                    connect Junction21 PI.Reset as Connection693
                    connect Phase_diff.out Comparator2.in1 as Connection49
                    connect Junction21 Product1.in as Connection623
                    connect Product1.in1 PI.Out as Connection692
                    connect Junction22 phase_diff.in as Connection719
                    connect confine_phase.dtheta_confined Junction22 as Connection720
                    connect LPF.in Junction22 as Connection718
                    connect confine_phase.dtheta phase_Grid as Connection721
                    connect dw_phase Product1.out as Connection714
                    connect phase_filter.in Junction17 as Connection592
                    connect phase_match Counter.Out as Connection673
                    connect Abs2.in Junction17 as Connection590
                    connect to_pu.in Junction15 as Connection581
                }
                [
                    position = 7232, 8648
                    size = 168, 112
                ]

                component gen_logic_op not1 {
                    operator = "NOT"
                }
                [
                    position = 7736, 8656
                    hide_name = True
                ]

                component gen_digital_probe ABC_nom {
                }
                [
                    position = 7808, 8776
                    rotation = left
                    scale = -1, -1
                ]

                component Subsystem check_V_diff {
                    layout = dynamic
                    component Subsystem PI {
                        layout = dynamic
                        component gen_gain Ki {
                            gain = "V_Ki"
                        }
                        [
                            position = 7976, 8216
                        ]

                        component gen_sum Sum5 {
                        }
                        [
                            position = 8320, 8224
                        ]

                        component gen_integrator Integrator1 {
                            limit_lower = "-1"
                            limit_upper = "1"
                            show_reset = "either"
                        }
                        [
                            position = 8216, 8232
                        ]

                        component gen_gain Kp {
                            gain = "V_Kp"
                        }
                        [
                            position = 8024, 8168
                        ]

                        component gen_sum Sum6 {
                            signs = "-+"
                        }
                        [
                            position = 8320, 8312
                            scale = -1, 1
                        ]

                        component gen_sum Sum7 {
                        }
                        [
                            position = 8088, 8224
                        ]

                        component gen_gain Kb {
                        }
                        [
                            position = 8216, 8312
                            scale = -1, 1
                        ]

                        component gen_limiter Limit1 {
                            lower_limit = "V_lowLim"
                            upper_limit = "V_upLim"
                        }
                        [
                            position = 8408, 8224
                        ]

                        port Reset {
                            label = "Reset"
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8144, 8264
                        ]

                        port In {
                            label = "In"
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7888, 8168
                        ]

                        port Out {
                            label = "Out"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8472, 8224
                        ]

                        junction Junction2 sp
                        [
                            position = 8368, 8224
                        ]

                        junction Junction3 sp
                        [
                            position = 8440, 8224
                        ]

                        junction Junction4 sp
                        [
                            position = 7944, 8168
                        ]

                        connect Junction2 Limit1.in as Connection45
                        connect Junction3 Out as Connection48
                        connect Junction4 Kp.in as Connection59
                        connect Kb.in Sum6.out as Connection50
                        connect Ki.in Junction4 as Connection60
                        connect Ki.out Sum7.in as Connection56
                        connect Kp.out Sum5.in as Connection55
                        connect Limit1.out Junction3 as Connection47
                        connect Sum5.in1 Integrator1.out as Connection5
                        connect Sum5.out Junction2 as Connection44
                        connect Sum6.in Junction2 as Connection46
                        connect Sum6.in1 Junction3 as Connection49
                        connect Sum7.out Integrator1.in as Connection52
                        connect Sum7.in1 Kb.out as Connection53
                        connect In Junction4 as Connection58
                        connect Integrator1.reset Reset as Connection2
                    }
                    [
                        position = 8272, 8144
                        size = 64, 48
                    ]

                    component gen_comparator Comparator1 {
                    }
                    [
                        position = 8336, 8224
                        hide_name = True
                        scale = 1, -1
                    ]

                    component gen_abs Abs3 {
                    }
                    [
                        position = 8264, 8216
                        hide_name = True
                    ]

                    component gen_probe Vabc_dead {
                    }
                    [
                        position = 8128, 8408
                        rotation = right
                    ]

                    component gen_gain pu1 {
                        gain = "1.0/(Vn/((3.0/2.0)**0.5))"
                    }
                    [
                        position = 7760, 8120
                        hide_name = True
                    ]

                    component gen_probe VABC_nom {
                    }
                    [
                        position = 8184, 8552
                        rotation = right
                    ]

                    component src_constant zero {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 8360, 8176
                        hide_name = True
                    ]

                    component gen_c_function less_eq {
                        in_terminal_dimensions = "inherit"
                        in_terminal_dimensions_str = "in inherit"
                        in_terminal_labels = "False;"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "False;"
                        output_fnc = "/*Begin code section*/
if(in<=0.001){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                    }
                    [
                        position = 8080, 8344
                        size = 48, 48
                    ]

                    component gen_sum Sum1 {
                        signs = "+-"
                    }
                    [
                        position = 8056, 8144
                        hide_name = True
                    ]

                    component gen_gain Volt_diff {
                        gain = "delta_V/100.0"
                    }
                    [
                        position = 8264, 8256
                    ]

                    component tm_delay "Unit Delay1" {
                    }
                    [
                        position = 8144, 8064
                        hide_name = True
                    ]

                    component gen_c_function interval_check {
                        in_terminal_dimensions = "inherit"
                        in_terminal_dimensions_str = "in inherit"
                        in_terminal_labels = "False;"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "False;"
                        output_fnc = "/*Begin code section*/
if((in>=(1-Vn_thresh/100.0)) && in<=(1+Vn_thresh/100.0)){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                        parameters = "real Vn_thresh;"
                    }
                    [
                        position = 7952, 8488
                        size = 48, 48
                    ]

                    component gen_probe V_diff {
                    }
                    [
                        position = 8200, 8096
                    ]

                    component gen_abs Abs5 {
                    }
                    [
                        position = 8008, 8344
                        hide_name = True
                    ]

                    component src_constant one {
                        execution_rate = "Ts"
                    }
                    [
                        position = 8200, 8256
                    ]

                    component sys_signal_switch "Signal switch1" {
                        threshold = "0.5"
                    }
                    [
                        position = 8432, 8160
                        hide_name = True
                    ]

                    component gen_gain pu2 {
                        gain = "1.0/(Vn/((3.0/2.0)**0.5))"
                    }
                    [
                        position = 7944, 8152
                        hide_name = True
                    ]

                    component gen_abs Abs4 {
                    }
                    [
                        position = 7872, 8488
                        hide_name = True
                    ]

                    port V_match {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8400, 8224
                    ]

                    port VABC {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7696, 8120
                    ]

                    port Vabc {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7880, 8152
                    ]

                    port "Vabc dead" {
                        position = right:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8264, 8344
                    ]

                    port "VABC nom" {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8272, 8488
                    ]

                    port dV {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8496, 8160
                    ]

                    port Activate {
                        position = top:auto
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8064, 8064
                    ]

                    junction Junction3 sp
                    [
                        position = 8168, 8144
                    ]

                    junction Junction4 sp
                    [
                        position = 8272, 8064
                    ]

                    junction Junction5 sp
                    [
                        position = 7808, 8120
                    ]

                    junction Junction9 sp
                    [
                        position = 8168, 8144
                    ]

                    junction Junction10 sp
                    [
                        position = 7976, 8152
                    ]

                    junction Junction12 sp
                    [
                        position = 8128, 8344
                    ]

                    junction Junction13 sp
                    [
                        position = 8184, 8488
                    ]

                    connect Junction3 Junction9 as Connection251
                    connect Sum1.in Junction5 as Connection225
                    connect interval_check.out Junction13 as Connection294
                    connect Abs4.in Junction5 as Connection227
                    connect Junction4 "Unit Delay1.out" as Connection219
                    connect interval_check.in Abs4.out as Connection291
                    connect Sum1.out Junction9 as Connection253
                    connect less_eq.out Junction12 as Connection288
                    connect Junction5 pu1.out as Connection246
                    connect VABC_nom.in Junction13 as Connection292
                    connect one.out Volt_diff.in as Connection14
                    connect Abs5.in Junction10 as Connection256
                    connect V_diff.in Junction3 as Connection215
                    connect Junction9 Abs3.in as Connection252
                    connect Abs5.out less_eq.in as Connection289
                    connect V_match Comparator1.out as Connection187
                    connect PI.In Junction3 as Connection217
                    connect Activate "Unit Delay1.in" as Connection208
                    connect pu2.in Vabc as Connection249
                    connect "Vabc dead" Junction12 as Connection286
                    connect Comparator1.in2 Abs3.out as Connection10
                    connect PI.Reset Junction4 as Connection220
                    connect pu1.in VABC as Connection247
                    connect Junction10 pu2.out as Connection255
                    connect PI.Out "Signal switch1.in" as Connection214
                    connect dV "Signal switch1.out" as Connection181
                    connect zero.out "Signal switch1.in1" as Connection179
                    connect Volt_diff.out Comparator1.in1 as Connection17
                    connect Junction12 Vabc_dead.in as Connection287
                    connect "Signal switch1.in2" Junction4 as Connection218
                    connect Junction13 "VABC nom" as Connection293
                    connect Sum1.in1 Junction10 as Connection254
                }
                [
                    position = 7216, 8152
                    size = 144, 136
                ]

                component gen_logic_op "Logical operator2" {
                }
                [
                    position = 7736, 8720
                    hide_name = True
                ]

                port Vb {
                    position = top:5
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8424
                ]

                port Vc {
                    position = top:6
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8488
                ]

                port synch_ref {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8448, 8560
                ]

                port "Open Breaker" {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8688
                ]

                port "Close Breaker" {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8632
                ]

                port CB {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8552, 8200
                ]

                port VA {
                    position = top:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8168
                ]

                port VB {
                    position = top:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8232
                ]

                port VC {
                    position = top:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8296
                ]

                port Va {
                    position = top:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6616, 8360
                ]

                tag From62 {
                    value = "f_abc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7064, 8408
                    hide_name = True
                    size = 0, 0
                ]

                tag From63 {
                    value = "f_ABC"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7064, 8328
                    hide_name = True
                    size = 0, 0
                ]

                tag From64 {
                    value = "phase_diff"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7080, 8648
                    hide_name = True
                    size = 0, 0
                ]

                tag From65 {
                    value = "dw_f"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7736, 8096
                    hide_name = True
                    size = 0, 0
                ]

                tag From66 {
                    value = "dw_phase"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7736, 8256
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto32 {
                    value = "dV"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7424, 8048
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto37 {
                    value = "Close_CB"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6712, 8632
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto43 {
                    value = "phase_diff"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6872, 8488
                    hide_name = True
                    size = 0, 0
                ]

                tag From47 {
                    value = "Activate"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7736, 8176
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto22 {
                    value = "f_match"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7552, 8368
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto31 {
                    value = "Activate"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7888, 8456
                    hide_name = True
                    size = 0, 0
                ]

                tag From30 {
                    value = "f_match"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7072, 8512
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto40 {
                    value = "Vabc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6872, 8248
                    hide_name = True
                    size = 0, 0
                ]

                tag From48 {
                    value = "Activate"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7160, 8048
                    hide_name = True
                    size = 0, 0
                ]

                tag From69 {
                    value = "f_ABC_nom"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7624, 8728
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto28 {
                    value = "dw_synch"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8032, 8176
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto39 {
                    value = "VABC"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6872, 8168
                    hide_name = True
                    size = 0, 0
                ]

                tag From42 {
                    value = "dw_synch"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8320, 8424
                    hide_name = True
                    size = 0, 0
                ]

                tag From60 {
                    value = "VABC"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7064, 8104
                    hide_name = True
                    size = 0, 0
                ]

                tag From68 {
                    value = "Vabc_dead"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8296
                    hide_name = True
                    size = 0, 0
                ]

                tag From67 {
                    value = "phase_match"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8200
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto38 {
                    value = "Open_CB"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6712, 8688
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto41 {
                    value = "f_ABC"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6872, 8328
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto36 {
                    value = "VABC_nom"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7496, 8200
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto48 {
                    value = "phase_match"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7448, 8680
                    hide_name = True
                    size = 0, 0
                ]

                tag From49 {
                    value = "dV"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8320, 8448
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto42 {
                    value = "f_abc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 6872, 8408
                    hide_name = True
                    size = 0, 0
                ]

                tag From53 {
                    value = "Activate"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7072, 8552
                    hide_name = True
                    size = 0, 0
                ]

                tag From39 {
                    value = "VABC_nom"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7624, 8704
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto44 {
                    value = "Vabc_dead"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7496, 8168
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto47 {
                    value = "dw_phase"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7448, 8616
                    hide_name = True
                    size = 0, 0
                ]

                tag From70 {
                    value = "ABC_nom"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8264
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto33 {
                    value = "V_match"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7496, 8136
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto45 {
                    value = "dw_f"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7416, 8328
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto46 {
                    value = "f_ABC_nom"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7416, 8408
                    hide_name = True
                    size = 0, 0
                ]

                tag From61 {
                    value = "Vabc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7064, 8200
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto20 {
                    value = "CB_status"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8560, 8160
                    hide_name = True
                    size = 0, 0
                ]

                tag From37 {
                    value = "f_match"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8168
                    hide_name = True
                    size = 0, 0
                ]

                tag From59 {
                    value = "Open_CB"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8136
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto49 {
                    value = "ABC_nom"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7920, 8720
                    hide_name = True
                    size = 0, 0
                ]

                tag From56 {
                    value = "Close_CB"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7624, 8616
                    hide_name = True
                    size = 0, 0
                ]

                tag From50 {
                    value = "V_match"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8232
                    hide_name = True
                    size = 0, 0
                ]

                tag From58 {
                    value = "Close_CB"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8200, 8104
                    hide_name = True
                    size = 0, 0
                ]

                tag From57 {
                    value = "Open_CB"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7624, 8656
                    hide_name = True
                    size = 0, 0
                ]

                tag From33 {
                    value = "CB_status"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7624, 8576
                    hide_name = True
                    size = 60, 20
                ]

                junction Junction51 sp
                [
                    position = 7376, 8680
                ]

                junction Junction52 sp
                [
                    position = 7848, 8720
                ]

                junction Junction35 sp
                [
                    position = 7488, 8368
                ]

                junction Junction53 sp
                [
                    position = 8496, 8200
                ]

                junction Junction39 sp
                [
                    position = 7824, 8456
                ]

                junction Junction54 sp
                [
                    position = 7360, 8168
                ]

                junction Junction55 sp
                [
                    position = 7424, 8200
                ]

                junction Junction46 sp
                [
                    position = 7232, 8520
                ]

                junction Junction56 sp
                [
                    position = 7344, 8408
                ]

                junction Junction57 sp
                [
                    position = 7808, 8720
                ]

                junction Junction48 sp
                [
                    position = 7432, 8136
                ]

                connect Junction53 CB as Connection702
                connect ABC_nom.in Junction57 as Connection715
                connect From64 check_phase_diff.phase_Grid as Connection674
                connect Junction54 "check_V_diff.Vabc dead" as Connection705
                connect Goto41 PLLs.f_ABC as Connection659
                connect and2.in not.out as Connection552
                connect From65 Calculate_dw_synch.dw_f as Connection683
                connect Junction55 "check_V_diff.VABC nom" as Connection708
                connect From66 Calculate_dw_synch.dw_phase as Connection684
                connect Junction56 "check_f_diff.f_ABC nom" as Connection711
                connect From67 Contactor_Control.phase_match as Connection696
                connect Junction57 Junction52 as Connection714
                connect From68 Contactor_Control.abc_dead as Connection698
                connect "Logical operator2.in1" From69 as Connection688
                connect check_phase_diff.Activate Junction46 as Connection624
                connect From70 Contactor_Control.ABC_nom as Connection700
                connect "Logical operator2.out" Junction57 as Connection713
                connect Goto20 Junction53 as Connection701
                connect PLLs.VA VA as Connection727
                connect PLLs.VC VC as Connection725
                connect Goto31 Junction39 as Connection561
                connect Phase_match.in Junction51 as Connection682
                connect VABC_nom.in Junction55 as Connection709
                connect Goto33 Junction48 as Connection653
                connect VB PLLs.VB as Connection726
                connect Goto36 Junction55 as Connection707
                connect Va PLLs.Va as Connection630
                connect Junction52 and2.in3 as Connection691
                connect Goto37 "Close Breaker" as Connection637
                connect Vb PLLs.Vb as Connection628
                connect Goto38 "Open Breaker" as Connection638
                connect Vc PLLs.Vc as Connection629
                connect Goto39 PLLs.V_ABC as Connection658
                connect abc_dead.in Junction54 as Connection706
                connect Goto40 PLLs.V_abc as Connection657
                connect and1.in From30 as Connection273
                connect Contactor_Control.CB Junction53 as Connection703
                connect From39 "Logical operator2.in" as Connection687
                connect Goto48 Junction51 as Connection680
                connect From47 Calculate_dw_synch.Activate as Connection556
                connect Goto49 Junction52 as Connection692
                connect f_ABC_nom.in Junction56 as Connection712
                connect From48 check_V_diff.Activate as Connection647
                connect f_match.in Junction35 as Connection282
                connect From49 "Bus Join.in1" as Connection730
                connect Junction35 Goto22 as Connection283
                connect not.in From33 as Connection551
                connect From50 Contactor_Control.V_match as Connection699
                connect Junction39 and2.out as Connection562
                connect not1.out and2.in2 as Connection634
                connect From53 and1.in1 as Connection585
                connect Junction46 and1.out as Connection623
                connect synch_check_ON.in Junction39 as Connection563
                connect From56 and2.in1 as Connection639
                connect "Bus Join.in" From42 as Connection729
                connect Goto42 PLLs.f_abc as Connection660
                connect From57 not1.in as Connection640
                connect "Bus Join.out" synch_ref as Connection728
                connect From63 check_f_diff.f_ABC as Connection670
                connect Goto43 "PLLs.Phase diff" as Connection661
                connect check_V_diff.V_match Junction48 as Connection655
                connect Junction48 V_match.in as Connection654
                connect Check_phase_ON.in Junction46 as Connection622
                connect From58 "Contactor_Control.Close Breaker" as Connection694
                connect Goto44 Junction54 as Connection704
                connect check_f_diff.f_match Junction35 as Connection284
                connect From60 check_V_diff.VABC as Connection663
                connect Contactor_Control.f_match From37 as Connection697
                connect From61 check_V_diff.Vabc as Connection664
                connect Junction51 check_phase_diff.phase_match as Connection681
                connect "Contactor_Control.Open Breaker" From59 as Connection695
                connect From62 check_f_diff.f_abc as Connection671
                connect Goto46 Junction56 as Connection710
                connect Goto32 check_V_diff.dV as Connection731
                [
                    breakpoints = 7368, 8104; 7312, 8104
                ]
                connect Goto45 check_f_diff.dw_f as Connection732
                [
                    breakpoints = 7416, 8328; 7344, 8328
                ]
                connect check_phase_diff.dw_phase Goto47 as Connection733
                [
                    breakpoints = 7384, 8616
                ]
                connect Goto28 Calculate_dw_synch.dw_synch as Connection734
                [
                    breakpoints = 8032, 8176; 7960, 8176
                ]

                Vn = "4160"
                f = "60.0"
                fn_thresh = "5"

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                    Vn {
                        label = "Nominal voltage"
                        widget = edit
                        type = generic
                        default_value = "12470"
                        unit = "V (line to line)"
                        group = "General"
                    }

                    f {
                        label = "Nominal frequency"
                        widget = edit
                        type = generic
                        default_value = "60"
                        unit = "Hz"
                        group = "General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "Ts"
                        unit = "s"
                        group = "General"
                    }

                    fn_thresh {
                        label = "Grid nominal frequency operation threshold"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "%"
                        group = "Freq. Match"
                    }

                    delta_f {
                        label = "Accepted frequency difference"
                        widget = edit
                        type = generic
                        default_value = "0.5"
                        unit = "%"
                        group = "Freq. Match"
                    }

                    f_Kp {
                        label = "PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "Freq. Match"
                    }

                    f_Ki {
                        label = "PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "Freq. Match"
                    }

                    f_upLim {
                        label = "PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "Freq. Match"
                    }

                    f_lowLim {
                        label = "PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1.0"
                        group = "Freq. Match"
                    }

                    delta_phi {
                        label = "Accepted phase difference"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        unit = "°"
                        group = "Phase Synch"
                    }

                    phase_Kp {
                        label = "PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "Phase Synch"
                    }

                    phase_Ki {
                        label = "PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.00012"
                        group = "Phase Synch"
                    }

                    phase_upLim {
                        label = "PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "Phase Synch"
                    }

                    phase_lowLim {
                        label = "PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-0.1"
                        group = "Phase Synch"
                    }

                    Vn_thresh {
                        label = "Grid nominal voltage operation threshold"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "%"
                        group = "Voltage Match"
                    }

                    delta_V {
                        label = "Accepted voltage difference"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        unit = "%"
                        group = "Voltage Match"
                    }

                    V_Kp {
                        label = "PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.0071"
                        group = "Voltage Match"
                    }

                    V_Ki {
                        label = "PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.0354"
                        group = "Voltage Match"
                    }

                    V_upLim {
                        label = "PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "Voltage Match"
                    }

                    V_lowLim {
                        label = "PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1.0"
                        group = "Voltage Match"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 8080, 8000
                rotation = down
                scale = -1, 1
                size = 296, 120
            ]

            component "core/Voltage Measurement" VC {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8056, 8576
                rotation = right
                size = 64, 32
            ]

            component gen_bus_split "Bus Split1" {
            }
            [
                position = 7600, 7968
                hide_name = True
            ]

            component gen_terminator Termination4 {
            }
            [
                position = 7840, 7992
                hide_name = True
            ]

            component Subsystem "PQ measure" {
                layout = dynamic
                component gen_terminator Termination1 {
                }
                [
                    position = 8264, 8152
                    rotation = left
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_PQ_transform "PQ Power Meter1" {
                }
                [
                    position = 8096, 8192
                ]

                component gen_terminator Termination2 {
                }
                [
                    position = 8264, 8232
                    rotation = left
                    hide_name = True
                    scale = -1, -1
                ]

                port Va {
                    position = right:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8016, 8088
                    rotation = right
                    scale = -1, 1
                ]

                port Vb {
                    position = right:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7960, 8120
                    rotation = right
                    scale = -1, 1
                ]

                port Vc {
                    position = right:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7912, 8152
                    rotation = right
                    scale = -1, 1
                ]

                port Ia {
                    position = right:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7912, 8224
                    rotation = left
                    scale = -1, 1
                ]

                port Ib {
                    position = right:5
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7960, 8256
                    rotation = left
                    scale = -1, 1
                ]

                port Ic {
                    position = right:6
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8016, 8288
                    rotation = left
                    scale = -1, 1
                ]

                port S {
                    position = left:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8208, 8264
                    rotation = right
                    scale = -1, 1
                ]

                port pf {
                    position = left:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8168, 8288
                    rotation = right
                    scale = -1, 1
                ]

                port Q {
                    position = left:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8208, 8120
                    rotation = left
                    scale = -1, 1
                ]

                port P {
                    position = left:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8168, 8088
                    rotation = left
                    scale = -1, 1
                ]

                connect Vc "PQ Power Meter1.vc" as Connection15
                connect pf "PQ Power Meter1.k_factor" as Connection12
                connect "PQ Power Meter1.ia" Ia as Connection1
                connect "PQ Power Meter1.ib" Ib as Connection2
                connect "PQ Power Meter1.ic" Ic as Connection3
                connect "PQ Power Meter1.Pdc" P as Connection4
                connect "PQ Power Meter1.Qdc" Q as Connection5
                connect S "PQ Power Meter1.apparent" as Connection9
                connect Termination1.in "PQ Power Meter1.Pac" as Connection10
                connect Termination2.in "PQ Power Meter1.Qac" as Connection11
                connect Va "PQ Power Meter1.va" as Connection13
                connect Vb "PQ Power Meter1.vb" as Connection14
            }
            [
                position = 9616, 8032
                scale = -1, 1
                size = 72, 232
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "Ts"
            }
            [
                position = 7504, 7968
                hide_name = True
                size = 32, 32
            ]

            component "core/Voltage Measurement" VB {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 7992, 8520
                rotation = right
                size = 64, 32
            ]

            component gen_probe pf {
            }
            [
                position = 9792, 8128
            ]

            component Subsystem Snubber1 {
                layout = dynamic
                component pas_resistor R22 {
                    resistance = "1e6"
                }
                [
                    position = 8376, 7944
                    rotation = right
                ]

                component pas_resistor R20 {
                    resistance = "1e6"
                }
                [
                    position = 8304, 7944
                    rotation = right
                ]

                component pas_resistor R21 {
                    resistance = "1e6"
                }
                [
                    position = 8232, 7944
                    rotation = right
                ]

                port A {
                    position = top:4
                    kind = pe
                }
                [
                    position = 8232, 7848
                    rotation = right
                ]

                port C {
                    position = top:6
                    kind = pe
                }
                [
                    position = 8376, 7848
                    rotation = right
                ]

                port B {
                    position = top:5
                    kind = pe
                }
                [
                    position = 8304, 7848
                    rotation = right
                ]

                port G {
                    position = bottom:3
                    kind = pe
                }
                [
                    position = 8304, 8112
                    rotation = left
                ]

                junction Junction1516 pe
                [
                    position = 8304, 8032
                ]

                junction Junction1517 pe
                [
                    position = 8304, 8032
                ]

                connect G Junction1517 as Connection764
                connect R22.p_node C as Connection760
                connect Junction1517 R22.n_node as Connection763
                connect Junction1516 Junction1517 as Connection762
                connect B R20.p_node as Connection759
                connect Junction1516 R21.n_node as Connection755
                connect R20.n_node Junction1516 as Connection698
                connect A R21.p_node as Connection758
            }
            [
                position = 8616, 8528
                size = 88, 80
            ]

            component "core/Voltage Measurement" VA {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 7928, 8464
                rotation = right
                size = 64, 32
            ]

            component gen_bus_join "Bus Join1" {
            }
            [
                position = 9728, 7880
                rotation = left
                hide_name = True
            ]

            component gen_probe S {
            }
            [
                position = 9792, 8064
            ]

            component "core/Current Measurement" Ib {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8416, 8304
                size = 64, 32
            ]

            component "core/Voltage Measurement" Vb {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8832, 8536
                rotation = right
                size = 64, 32
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 9032, 8208
                rotation = down
            ]

            port b {
                position = right:2
                kind = pe
            }
            [
                position = 9032, 8304
                rotation = down
            ]

            port Inputs {
                position = top:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7424, 7968
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 7504, 8304
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 7504, 8208
            ]

            port c {
                position = right:3
                kind = pe
            }
            [
                position = 9032, 8400
                rotation = down
            ]

            port CB_fb {
                position = top:3
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8344, 8040
            ]

            port C {
                position = left:3
                kind = pe
            }
            [
                position = 7504, 8400
            ]

            port synch_ref {
                position = top:4
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8344, 7960
            ]

            port power_meas {
                position = top:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 9728, 7824
                rotation = left
            ]

            tag Goto47 {
                value = "Prim Va"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 9232, 8368
                hide_name = True
                size = 0, 0
            ]

            tag Goto48 {
                value = "Prim Vb"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 9232, 8416
                hide_name = True
                size = 0, 0
            ]

            tag Goto49 {
                value = "Prim Vc"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 9232, 8464
                hide_name = True
                size = 0, 0
            ]

            tag Goto50 {
                value = "Prim Ia"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8808, 7904
                hide_name = True
                size = 0, 0
            ]

            tag Goto51 {
                value = "Prim Ib"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8808, 7952
                hide_name = True
                size = 0, 0
            ]

            tag Goto52 {
                value = "Prim Ic"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8808, 8000
                hide_name = True
                size = 0, 0
            ]

            junction Junction53 pe
            [
                position = 7992, 8304
            ]

            junction Junction71 sp
            [
                position = 8280, 8040
            ]

            junction Junction56 pe
            [
                position = 7928, 8640
            ]

            junction Junction57 pe
            [
                position = 8768, 8656
            ]

            junction Junction59 pe
            [
                position = 8592, 8208
            ]

            junction Junction60 pe
            [
                position = 8616, 8304
            ]

            junction Junction61 pe
            [
                position = 8640, 8400
            ]

            junction Junction45 sp
            [
                position = 7704, 7992
            ]

            junction Junction62 pe
            [
                position = 8768, 8208
            ]

            junction Junction49 pe
            [
                position = 7752, 8208
            ]

            junction Junction50 pe
            [
                position = 7776, 8304
            ]

            junction Junction63 pe
            [
                position = 8832, 8304
            ]

            junction Junction51 pe
            [
                position = 7800, 8400
            ]

            junction Junction65 pe
            [
                position = 7992, 8640
            ]

            junction Junction52 pe
            [
                position = 7928, 8208
            ]

            junction Junction66 pe
            [
                position = 8056, 8400
            ]

            junction Junction67 pe
            [
                position = 8832, 8656
            ]

            junction Junction68 pe
            [
                position = 8896, 8400
            ]

            junction Junction69 sp
            [
                position = 9720, 7936
            ]

            junction Junction70 sp
            [
                position = 9736, 8000
            ]

            junction Junction72 sp
            [
                position = 8816, 8480
            ]

            junction Junction73 sp
            [
                position = 8880, 8536
            ]

            junction Junction74 sp
            [
                position = 8952, 8592
            ]

            junction Junction75 sp
            [
                position = 9184, 8464
            ]

            junction Junction76 sp
            [
                position = 9128, 8416
            ]

            junction Junction77 sp
            [
                position = 9080, 8368
            ]

            junction Junction78 sp
            [
                position = 8632, 8048
            ]

            junction Junction79 sp
            [
                position = 8696, 8080
            ]

            junction Junction80 sp
            [
                position = 8760, 8112
            ]

            comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Inputs: <br />0 - Close Breaker command</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - Open Breaker command</p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Outputs:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 - speed bias - sync check</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 - voltage bias - sync check</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> </p></body></html> ENDCOMMENT 
            [
                position = 7944, 7744
            ]

            connect VA.p_node Junction52 as Connection1043
            connect B Junction50 as Connection1032
            connect Junction63 b as Connection1081
            connect VA.n_node Junction56 as Connection1054
            connect "Bus Join1.in" Junction69 as Connection1118
            connect Junction65 Junction56 as Connection1089
            connect VB.p_node Junction53 as Connection1046
            connect "Bus Join1.out" power_meas as Connection1115
            connect Junction66 S1.c_in as Connection1092
            connect VB.n_node Junction65 as Connection1088
            connect C Junction51 as Connection1035
            connect Junction67 Junction57 as Connection1097
            connect VC.n_node Junction65 as Connection1090
            connect CB_fb Junction71 as Connection1128
            connect Junction68 c as Connection1100
            connect VC.p_node Junction66 as Connection1093
            connect "Rate Transition1.out" "Bus Split1.in" as Connection1130
            connect pf.in "PQ measure.pf" as Connection1125
            connect Junction69 "PQ measure.P" as Connection1119
            connect Va.n_node Junction57 as Connection1063
            connect S.in "PQ measure.S" as Connection1124
            connect Junction70 "Bus Join1.in1" as Connection1122
            connect Va.p_node Junction62 as Connection1079
            connect S1.a_out Ia.p_node as Connection1106
            connect Junction71 S1.ctrl_in as Connection1127
            connect S1.b_out Ib.p_node as Connection1108
            connect Vb.p_node Junction63 as Connection1082
            connect "P  KW.in" Junction69 as Connection1120
            connect S1.a_in Junction52 as Connection1041
            connect Vb.n_node Junction67 as Connection1096
            connect "PQ measure.Q" Junction70 as Connection1121
            connect S1.b_in Junction53 as Connection1044
            connect Vc.n_node Junction67 as Connection1098
            connect "SR Flip Flop4.s_in" "Bus Split1.out" as Connection1013
            connect "Q kVAr.in" Junction70 as Connection1123
            connect Vc.p_node Junction68 as Connection1101
            connect "SR Flip Flop4.r_in" Junction45 as Connection1014
            connect "SR Flip Flop4.out" "Synch_check.Close Breaker" as Connection1011
            connect Snubber.A Junction49 as Connection1031
            connect Snubber.B Junction50 as Connection1034
            connect Snubber.C Junction51 as Connection1037
            connect Ia.n_node Junction59 as Connection1107
            connect Snubber.G Junction56 as Connection1105
            connect Ib.n_node Junction60 as Connection1109
            connect Snubber1.G Junction57 as Connection1064
            connect Ic.p_node S1.c_out as Connection1111
            connect Snubber1.A Junction59 as Connection1070
            connect Inputs "Rate Transition1.in" as Connection1129
            connect Snubber1.B Junction60 as Connection1073
            connect Junction45 "Bus Split1.out1" as Connection1015
            connect Snubber1.C Junction61 as Connection1076
            connect Junction51 Junction66 as Connection1091
            connect Junction52 Junction49 as Connection1042
            connect Junction53 Junction50 as Connection1045
            connect Junction62 a as Connection1078
            connect Junction59 Junction62 as Connection1077
            connect "Synch_check.Open Breaker" Junction45 as Connection1016
            connect Termination4.in "SR Flip Flop4.out_n" as Connection1010
            connect Junction60 Junction63 as Connection1080
            connect Synch_check.CB Junction71 as Connection1126
            connect Junction61 Ic.n_node as Connection1110
            connect Synch_check.synch_ref synch_ref as Connection880
            connect A Junction49 as Connection1029
            connect Junction61 Junction68 as Connection1099
            connect Synch_check.VA VA.out as Connection1137
            [
                breakpoints = 7952, 8072; 7952, 8424
            ]
            connect Synch_check.VB VB.out as Connection1138
            connect Synch_check.VC VC.out as Connection1139
            [
                breakpoints = 8072, 8072; 8072, 8536
            ]
            connect Va.out Junction72 as Connection1140
            connect Synch_check.Va Junction72 as Connection1142
            [
                breakpoints = 8104, 8600; 8736, 8600
            ]
            connect Vb.out Junction73 as Connection1143
            connect Synch_check.Vb Junction73 as Connection1145
            connect Vc.out Junction74 as Connection1146
            connect Synch_check.Vc Junction74 as Connection1148
            connect Junction74 Junction75 as Connection1173
            [
                breakpoints = 8952, 8592; 9184, 8592; 9184, 8520
            ]
            connect Junction75 "PQ measure.Vc" as Connection1174
            [
                breakpoints = 9184, 8016
            ]
            connect Goto49 Junction75 as Connection1175
            connect Junction73 Junction76 as Connection1176
            [
                breakpoints = 8880, 8536; 9128, 8536; 9128, 8440
            ]
            connect Junction76 "PQ measure.Vb" as Connection1177
            [
                breakpoints = 9128, 7984
            ]
            connect Goto48 Junction76 as Connection1178
            connect "PQ measure.Va" Junction77 as Connection1179
            [
                breakpoints = 9080, 7952
            ]
            connect Junction77 Junction72 as Connection1180
            [
                breakpoints = 9080, 8368; 9080, 8480
            ]
            connect Goto47 Junction77 as Connection1181
            connect Ia.out Junction78 as Connection1182
            [
                breakpoints = 8616, 8048
            ]
            connect Junction78 "PQ measure.Ia" as Connection1183
            connect Goto50 Junction78 as Connection1184
            connect Ib.out Junction79 as Connection1185
            connect Junction79 "PQ measure.Ib" as Connection1186
            [
                breakpoints = 8696, 8080
            ]
            connect Goto51 Junction79 as Connection1187
            connect "PQ measure.Ic" Junction80 as Connection1188
            connect Junction80 Ic.out as Connection1189
            [
                breakpoints = 8760, 8112; 8504, 8112; 8504, 8096; 8512, 8376
            ]
            connect Goto52 Junction80 as Connection1190

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">PCC monitor block</p></body></html>"

                Ts {
                    label = "Execution rate"
                    widget = edit
                    type = generic
                    default_value = "Ts"
                    unit = "s"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 7560, 8296
            rotation = left
            scale = 1, -1
            size = 144, 160
        ]

        component Subsystem DG_800kW {
            layout = dynamic
            component src_scada_input wref {
                addr = "1427111952"
                def_value = "1"
                execution_rate = "Ts"
                max = "1000000.0"
                min = "-1000000.0"
                unit = ""
            }
            [
                position = 7352, 8104
            ]

            component src_scada_input Vref {
                addr = "1427111940"
                def_value = "1"
                execution_rate = "Ts"
                max = "1000000.0"
                min = "-1000000.0"
                unit = "pu"
            }
            [
                position = 7352, 8040
            ]

            component Subsystem Interface {
                layout = dynamic
                component gen_bus_split "Bus Split2" {
                }
                [
                    position = 7976, 8304
                    rotation = left
                    hide_name = True
                ]

                component gen_gain Gain1 {
                    gain = "1/Sb"
                }
                [
                    position = 7960, 8160
                    rotation = right
                    hide_name = True
                ]

                component gen_bus_split "Bus Split1" {
                    outputs = "5"
                }
                [
                    position = 7808, 8040
                    hide_name = True
                ]

                component gen_c_function SM {
                    in_terminal_dimensions = "inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit;inherit"
                    in_terminal_dimensions_str = "DERoption inherit;formGrid inherit;Ppms inherit;Qpms inherit;dw inherit;dV inherit;wref inherit;Vref inherit;Pref inherit;Qref inherit"
                    in_terminal_labels = "[(\'DERoption\', True), (\'formGrid\', True), (\'Ppms\', True), (\'Qpms\', True), (\'dw\', True), (\'dV\', True), (\'wref\', True), (\'Vref\', True), (\'Pref\', True), (\'Qref\', True)]"
                    in_terminal_properties = "inherit DERoption;inherit formGrid;inherit Ppms;inherit Qpms;inherit dw;inherit dV;inherit wref;inherit Vref;inherit Pref;inherit Qref;"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit;inherit;inherit;inherit;inherit"
                    out_terminal_dimensions_str = "gridForm inherit;V inherit;w inherit;P inherit;Q inherit"
                    out_terminal_labels = "[(\'gridForm\', True), (\'V\', True), (\'w\', True), (\'P\', True), (\'Q\', True)]"
                    out_terminal_properties = "inherit gridForm;inherit V;inherit w;inherit P;inherit Q;"
                    output_fnc = "/*Begin code section*/
if(DERoption > 0){
    if(formGrid > 0){
        gridForm = 2;
        V = Vref + dV;
        w = wref + dw;
        P = 0;
        Q = 0;
    }
    else{
        gridForm = 1;
        V = Vref;
        w = wref;
        P = Pref + Ppms;
        Q = Qref + Qpms;
    }
}
else{
    gridForm = 1;
    V = Vref;
    w = wref;
    P = Pref + Ppms;
    Q = Qref + Qpms;
}
/*End code section*/"
                }
                [
                    position = 8264, 8248
                    size = 64, 208
                ]

                component "core/Rate Transition" "Rate Transition1" {
                    execution_rate = "Ts"
                }
                [
                    position = 7728, 8040
                    hide_name = True
                    size = 32, 32
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 7872, 8120
                    rotation = right
                    hide_name = True
                ]

                component gen_gain Gain3 {
                    gain = "1/Sb"
                }
                [
                    position = 7912, 8160
                    rotation = right
                    hide_name = True
                ]

                component gen_c_function getPF {
                    global_variables = "real x;"
                    in_terminal_dimensions = "inherit;inherit"
                    in_terminal_dimensions_str = "P inherit;Q inherit"
                    in_terminal_labels = "[(\'P\', True), (\'Q\', True)]"
                    in_terminal_properties = "real P;inherit Q;"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "pf inherit"
                    out_terminal_labels = "[(\'pf\', True)]"
                    out_terminal_properties = "real pf;"
                    output_fnc = "/*Begin code section*/
if(fabs(P)>0.1){
    x = P*P+Q*Q;
    if(Q>=0){
        pf = P/sqrt(x);
    }
    else{
        pf = -P/sqrt(x);
    }
}
else{
    pf = 1;
}
/*End code section*/"
                }
                [
                    position = 8368, 8344
                    rotation = right
                    size = 48, 48
                ]

                port Qref {
                    position = left:7
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8192, 8344
                    rotation = left
                ]

                port pf {
                    position = right:7
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8368, 8448
                    rotation = right
                ]

                port wref {
                    position = left:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8104, 8440
                    rotation = left
                ]

                port V_ref {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8448, 8088
                ]

                port Pref {
                    position = left:5
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8168, 8376
                    rotation = left
                ]

                port fromPMS {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7664, 8040
                ]

                port fromPCC {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7864, 8368
                ]

                port opMode {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8448, 8000
                ]

                port P {
                    position = right:4
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8448, 8320
                    rotation = right
                ]

                port w_ref {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8448, 8192
                ]

                port Vref {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8136, 8408
                    rotation = left
                ]

                junction Junction5 sp
                [
                    position = 8376, 8264
                ]

                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Outputs are in per unit</p></body></html> ENDCOMMENT 
                [
                    position = 8512, 8136
                ]

                comment Comment2 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Inputs are in per unit</p></body></html> ENDCOMMENT 
                [
                    position = 8080, 8096
                ]

                connect SM.wref wref as Connection956
                connect "Rate Transition1.in" fromPMS as Connection893
                connect "Bus Split2.out1" SM.dV as Connection937
                connect Termination1.in "Bus Split1.out4" as Connection997
                connect Gain1.in "Bus Split1.out2" as Connection1000
                connect getPF.P Junction5 as Connection932
                connect "Bus Split1.out" SM.DERoption as Connection1002
                connect SM.Pref Pref as Connection954
                connect SM.Vref Vref as Connection955
                connect Junction5 SM.P as Connection931
                connect SM.dw "Bus Split2.out" as Connection936
                connect "Bus Split1.out1" SM.formGrid as Connection1001
                [
                    breakpoints = 8176, 8024; 8176, 8192
                ]
                connect "Rate Transition1.out" "Bus Split1.in" as Connection998
                connect "Bus Split2.in" fromPCC as Connection892
                connect Gain1.out SM.Ppms as Connection939
                connect "Bus Split1.out3" Gain3.in as Connection999
                connect Gain3.out SM.Qpms as Connection940
                connect getPF.Q SM.Q as Connection929
                connect Qref SM.Qref as Connection953
                connect opMode SM.gridForm as Connection1003
                [
                    breakpoints = 8320, 8000
                ]
                connect SM.V V_ref as Connection1004
                [
                    breakpoints = 8368, 8088
                ]
                connect SM.w w_ref as Connection1005
                [
                    breakpoints = 8400, 8192
                ]
                connect P Junction5 as Connection1006
                [
                    breakpoints = 8448, 8264
                ]
                connect pf getPF.pf as Connection1007
                [
                    breakpoints = 8368, 8392
                ]

                Sb = "0.95e6"
                Ts = "Ts"

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Interface for PMS with Diesel genset</p></body></html>"

                    Sb {
                        label = "Diesel genset nominal power"
                        widget = edit
                        type = generic
                        default_value = "2.2e6"
                        unit = "VA"
                        group = "General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "s"
                        group = "General"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7496, 8072
                size = 128, 368
            ]

            component src_scada_input Gen_Control_Mode {
                addr = "1427111944"
                execution_rate = "Ts"
                max = "2"
                min = "0"
                unit = ""
            }
            [
                position = 7928, 8096
            ]

            component gen_terminator Termination1 {
            }
            [
                position = 7520, 8320
            ]

            component gen_bus_join "Bus Join3" {
                inputs = "9"
            }
            [
                position = 8088, 8288
                rotation = right
                hide_name = True
            ]

            component src_scada_input Gen_On {
                addr = "1427111952"
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7928, 7872
            ]

            component src_scada_input Load_share_on {
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7976, 8160
            ]

            component src_scada_input Pref {
                addr = "1427111936"
                def_value = "1"
                execution_rate = "Ts"
                max = "1000000.0"
                min = "-1000000.0"
                unit = ""
            }
            [
                position = 7352, 8168
            ]

            component src_scada_input Qref {
                execution_rate = "Ts"
                unit = ""
            }
            [
                position = 7352, 8232
            ]

            component src_scada_input Gen_OP_mode {
                def_value = "1"
                execution_rate = "Ts"
                max = "2"
                min = "0"
                unit = ""
            }
            [
                position = 7392, 8320
            ]

            component Subsystem split {
                layout = dynamic
                component gen_terminator T2 {
                }
                [
                    position = 8456, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T8 {
                }
                [
                    position = 8424, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_logic_op "Logical operator1" {
                }
                [
                    position = 8264, 8040
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T11 {
                }
                [
                    position = 8264, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T {
                }
                [
                    position = 8312, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T10 {
                }
                [
                    position = 8504, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_bus_split "Bus Split1" {
                    outputs = "14"
                }
                [
                    position = 8192, 8192
                    hide_name = True
                ]

                component gen_terminator T6 {
                }
                [
                    position = 8336, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T9 {
                }
                [
                    position = 8464, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T4 {
                }
                [
                    position = 8504, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T7 {
                }
                [
                    position = 8384, 8048
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator T3 {
                }
                [
                    position = 8408, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T5 {
                }
                [
                    position = 8552, 8352
                    rotation = right
                    hide_name = True
                ]

                component gen_terminator T1 {
                }
                [
                    position = 8360, 8352
                    rotation = right
                    hide_name = True
                ]

                port ON {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8264, 7968
                    rotation = left
                ]

                port In {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8120, 8192
                ]

                connect T2.in "Bus Split1.out9" as Connection7
                connect "Bus Split1.in" In as Connection1
                connect T8.in "Bus Split1.out4" as Connection15
                connect T11.in "Bus Split1.out13" as Connection18
                connect T10.in "Bus Split1.out6" as Connection17
                connect T7.in "Bus Split1.out3" as Connection14
                connect T1.in "Bus Split1.out11" as Connection5
                connect T3.in "Bus Split1.out10" as Connection6
                connect T6.in "Bus Split1.out2" as Connection13
                connect "Bus Split1.out5" T9.in as Connection16
                connect T.in "Bus Split1.out12" as Connection4
                connect "Bus Split1.out1" "Logical operator1.in1" as Connection11
                connect "Logical operator1.in" "Bus Split1.out" as Connection10
                connect ON "Logical operator1.out" as Connection12
                connect T5.in "Bus Split1.out7" as Connection9
                connect T4.in "Bus Split1.out8" as Connection8
            }
            [
                position = 8488, 8320
                size = 48, 48
            ]

            component src_scada_input Load_share {
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7912, 8208
            ]

            component Subsystem Diesel_Gen {
                layout = static
                component Subsystem Control {
                    layout = dynamic
                    component Subsystem check_steady_state_w {
                        layout = dynamic
                        component gen_abs Abs1 {
                        }
                        [
                            position = 8280, 8160
                            hide_name = True
                        ]

                        component src_constant Constant3 {
                            execution_rate = "Ts"
                            value = "2.0*np.pi*f/pms"
                        }
                        [
                            position = 8128, 8208
                            hide_name = True
                        ]

                        component gen_sum Sum3 {
                            signs = "+-"
                        }
                        [
                            position = 8208, 8160
                            hide_name = True
                        ]

                        component gen_gain speed_diff {
                            gain = "delta_wn/100.0"
                        }
                        [
                            position = 8232, 8208
                        ]

                        component gen_comparator Comparator3 {
                        }
                        [
                            position = 8360, 8200
                            hide_name = True
                            scale = 1, -1
                        ]

                        port w_meas {
                            position = left:auto
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8096, 8152
                        ]

                        port ss_speed {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8424, 8200
                        ]

                        junction Junction9 sp
                        [
                            position = 8168, 8208
                        ]

                        connect speed_diff.out Comparator3.in1 as Connection57
                        connect Comparator3.in2 Abs1.out as Connection13
                        connect Sum3.in1 Junction9 as Connection54
                        connect w_meas Sum3.in as Connection59
                        connect Junction9 speed_diff.in as Connection39
                        connect Constant3.out Junction9 as Connection16
                        connect Abs1.in Sum3.out as Connection5
                        connect Comparator3.out ss_speed as Connection58
                    }
                    [
                        position = 7968, 8440
                        size = 96, 48
                    ]

                    component gen_bus_split "Bus Split1" {
                        outputs = "4"
                    }
                    [
                        position = 7296, 8104
                        rotation = right
                        hide_name = True
                    ]

                    component Subsystem Define_control_mode {
                        layout = dynamic
                        component gen_c_function Control_mode {
                            in_terminal_dimensions = "inherit"
                            in_terminal_dimensions_str = "Control_mode inherit"
                            in_terminal_labels = "[(\'Control_mode\', True)]"
                            in_terminal_properties = "real Control_mode;"
                            init_fnc = "/*Begin code section*/
P_control = 0;
Q_control = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit;inherit"
                            out_terminal_dimensions_str = "P_control inherit;Q_control inherit"
                            out_terminal_labels = "[(\'P_control\', True), (\'Q_control\', True)]"
                            out_terminal_properties = "real P_control;inherit Q_control;"
                            output_fnc = "/*Begin code section*/
if(Control_mode == 1){
    //PV mode
    P_control = 1;
    Q_control = 0;
}
else{
    if(Control_mode == 2){
        //PQ mode
        P_control = 1;
        Q_control = 1;
    }
    else{
        P_control = 0;
        Q_control = 0;
    }
}
/*End code section*/"
                        }
                        [
                            position = 8224, 8184
                            size = 176, 96
                        ]

                        port P_Control {
                            position = right:11
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8432, 8152
                        ]

                        port Gen_Control_Mode {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8056, 8184
                        ]

                        port Q_Control {
                            position = right:12
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8432, 8216
                        ]

                        connect Control_mode.Q_control Q_Control as Connection1
                        connect Control_mode.P_control P_Control as Connection2
                        connect Control_mode.Control_mode Gen_Control_Mode as Connection3
                    }
                    [
                        position = 7328, 8432
                        size = 144, 64
                    ]

                    component gen_round Round1 {
                        round_fn = "round"
                    }
                    [
                        position = 7208, 7656
                        hide_name = True
                    ]

                    component gen_c_function read_OP_mode {
                        in_terminal_dimensions = "inherit;inherit"
                        in_terminal_dimensions_str = "OP_mode inherit;GCB_status inherit"
                        in_terminal_labels = "[(\'OP_mode\', True), (\'GCB_status\', True)]"
                        in_terminal_properties = "real OP_mode;inherit GCB_status;"
                        init_fnc = "/*Begin code section*/
OP_mode =0;
enable = 0;
StandBy = 1;
GridFollowing = 0;
GridForming = 0;
/*End code section*/"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit;inherit;inherit;inherit"
                        out_terminal_dimensions_str = "StandBy inherit;GridFollowing inherit;GridForming inherit;enable inherit"
                        out_terminal_labels = "[(\'StandBy\', True), (\'GridFollowing\', True), (\'GridForming\', True), (\'enable\', True)]"
                        out_terminal_properties = "real StandBy;inherit GridFollowing;inherit GridForming;inherit enable;"
                        output_fnc = "/*Begin code section*/
if(OP_mode==0){
    StandBy= 1;
    GridFollowing = 0;
    GridForming = 0;
    enable = 0;
}
else{
    if(OP_mode == 1){
        StandBy = 0;
        GridFollowing = 1;
        GridForming = 0;
        if(GCB_status == 0){
            enable = 0;
        }
        else{
            enable = 1;
        }
    }
    else{
        StandBy = 0;
        GridFollowing = 0;
        GridForming = 1;
        enable = 0;
    }
}
/*End code section*/"
                    }
                    [
                        position = 7288, 7800
                        rotation = right
                        size = 128, 96
                    ]

                    component gen_digital_probe Gen_On {
                    }
                    [
                        position = 7120, 8064
                    ]

                    component tm_delay "Unit Delay2" {
                        execution_rate = "Ts"
                    }
                    [
                        position = 7920, 8104
                        hide_name = True
                    ]

                    component gen_bus_split "Bus Split3" {
                        outputs = "9"
                    }
                    [
                        position = 6952, 8048
                        rotation = right
                        hide_name = True
                    ]

                    component Subsystem Output {
                        layout = dynamic

                        port Gen_On {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8080, 8160
                        ]

                        port w_meas {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8080, 8216
                        ]

                        tag Goto8 {
                            value = "w_meas"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8200, 8216
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto7 {
                            value = "Gen_On"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8200, 8160
                            hide_name = True
                            size = 0, 0
                        ]

                        connect Goto8 w_meas as Connection631
                        connect Gen_On Goto7 as Connection632
                    }
                    [
                        position = 8448, 8416
                        size = 56, 72
                    ]

                    component gen_digital_probe GridForming {
                    }
                    [
                        position = 7416, 7952
                    ]

                    component tm_delay "Unit Delay1" {
                    }
                    [
                        position = 7208, 7696
                        hide_name = True
                    ]

                    component gen_digital_probe GridFollowing {
                    }
                    [
                        position = 7504, 7928
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 7384, 8280
                        hide_name = True
                    ]

                    component Subsystem Start_Exciter {
                        layout = dynamic
                        component gen_logic_op and {
                        }
                        [
                            position = 8312, 8144
                            hide_name = True
                        ]

                        component gen_gain "w to wpu" {
                            execution_rate = "Ts"
                            gain = "1.0/(2*np.pi*f/pms)"
                        }
                        [
                            position = 8152, 8192
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_comparator Comparator1 {
                        }
                        [
                            position = 8224, 8200
                            hide_name = True
                        ]

                        component src_constant steadyState_w {
                            execution_rate = "Ts"
                        }
                        [
                            position = 7952, 8256
                        ]

                        component gen_gain Exciter_start_speed {
                            gain = "exc_dwn/100.0"
                        }
                        [
                            position = 8152, 8248
                        ]

                        port Start {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8432, 8144
                        ]

                        port Gen_On {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8136
                        ]

                        port w_meas {
                            position = left:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8192
                        ]

                        connect and.out Start as Connection76
                        connect Exciter_start_speed.out Comparator1.in2 as Connection5
                        connect "w to wpu.in" w_meas as Connection75
                        connect steadyState_w.out Exciter_start_speed.in as Connection56
                        connect and.in Gen_On as Connection74
                        connect Comparator1.in1 "w to wpu.out" as Connection2
                        connect Comparator1.out and.in1 as Connection73
                    }
                    [
                        position = 7704, 7704
                        size = 104, 64
                    ]

                    component gen_bus_join "Bus Join1" {
                        inputs = "5"
                    }
                    [
                        position = 8456, 8192
                        rotation = left
                        hide_name = True
                    ]

                    component Subsystem Read_Control_mode {
                        layout = dynamic
                        component gen_digital_probe PV_mode {
                        }
                        [
                            position = 8264, 8192
                        ]

                        component gen_digital_probe Vf_mode {
                        }
                        [
                            position = 8264, 8128
                        ]

                        component gen_digital_probe PQ_mode {
                        }
                        [
                            position = 8264, 8256
                        ]

                        component gen_c_function State {
                            in_terminal_dimensions = "inherit;inherit;inherit"
                            in_terminal_dimensions_str = "enable inherit;P inherit;Q inherit"
                            in_terminal_labels = "[(\'enable\', True), (\'P\', True), (\'Q\', True)]"
                            in_terminal_properties = "real enable;inherit P;inherit Q;"
                            init_fnc = "/*Begin code section*/
Vf = 0;
PV = 0;
PQ = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit;inherit;inherit"
                            out_terminal_dimensions_str = "Vf inherit;PV inherit;PQ inherit"
                            out_terminal_labels = "[(\'Vf\', True), (\'PV\', True), (\'PQ\', True)]"
                            out_terminal_properties = "real Vf;inherit PV;inherit PQ;"
                            output_fnc = "/*Begin code section*/
if(enable && P && Q){
    Vf = 0;
    PV = 0;
    PQ = 1;
}
else{
    if(enable && P){
        Vf = 0;
        PV = 1;
        PQ = 0;
    }
    else{
        Vf = 1;
        PV = 0;
        PQ = 0;
    }
}
/*End code section*/"
                        }
                        [
                            position = 8144, 8192
                            size = 56, 168
                        ]

                        port Q_control_mode {
                            position = left:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7992, 8256
                        ]

                        port P_control_mode {
                            position = left:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7992, 8192
                        ]

                        port Enable_outer_loop {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7992, 8128
                        ]

                        connect State.P P_control_mode as Connection2
                        connect State.PQ PQ_mode.in as Connection6
                        connect PV_mode.in State.PV as Connection4
                        connect State.Vf Vf_mode.in as Connection5
                        connect State.Q Q_control_mode as Connection3
                        connect Enable_outer_loop State.enable as Connection1
                    }
                    [
                        position = 7728, 8448
                        size = 96, 96
                    ]

                    component gen_digital_probe StandBy {
                    }
                    [
                        position = 7416, 7888
                    ]

                    component gen_digital_probe Exciter_on {
                    }
                    [
                        position = 7800, 7664
                        rotation = left
                    ]

                    component Subsystem Governor_and_Engine {
                        layout = dynamic
                        component gen_probe wmeas {
                            addr = "8977"
                        }
                        [
                            position = 7832, 8080
                        ]

                        component src_constant Inner_w_droop {
                            execution_rate = "Ts"
                            value = "inner_w_droop"
                        }
                        [
                            position = 7528, 8232
                        ]

                        component Subsystem DEGOV {
                            layout = dynamic
                            component gen_transport_delay "Transport Delay1" {
                                init_value = "Pm0"
                                time_delay = "Td"
                            }
                            [
                                position = 8392, 8160
                                hide_name = True
                            ]

                            component Subsystem Integrator {
                                layout = dynamic
                                component gen_limiter Limit1 {
                                    lower_limit = "Tmin"
                                    upper_limit = "Tmax"
                                }
                                [
                                    position = 8408, 8224
                                    hide_name = True
                                ]

                                component gen_integrator Integrator1 {
                                    init_value = "Pm0"
                                    limit_lower = "phase_lowLim"
                                    limit_upper = "phase_upLim"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8224
                                    hide_name = True
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8320, 8304
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8088, 8216
                                    hide_name = True
                                ]

                                component gen_gain Kb {
                                    gain = "1.5"
                                }
                                [
                                    position = 8216, 8304
                                    scale = -1, 1
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8472, 8224
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8144, 8256
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7968, 8208
                                ]

                                junction Junction4 sp
                                [
                                    position = 8368, 8224
                                ]

                                junction Junction3 sp
                                [
                                    position = 8440, 8224
                                ]

                                connect Junction4 Sum6.in as Connection56
                                connect Junction3 Out as Connection48
                                connect Kb.in Sum6.out as Connection50
                                connect Limit1.out Junction3 as Connection66
                                connect Sum7.in1 Kb.out as Connection53
                                connect Integrator1.reset Reset as Connection2
                                connect Limit1.in Junction4 as Connection55
                                connect Junction4 Integrator1.out as Connection65
                                connect Sum7.out Integrator1.in as Connection52
                                connect Sum6.in1 Junction3 as Connection49
                                connect In Sum7.in as Connection58
                            }
                            [
                                position = 8264, 8160
                                size = 64, 48
                            ]

                            component gen_gain K {
                                gain = "K"
                            }
                            [
                                position = 8112, 8160
                            ]

                            component gen_gain Kp {
                                gain = "gov_Kp"
                            }
                            [
                                position = 8040, 8160
                            ]

                            component gen_z_domain_transfer TF2 {
                                a_coeff = "[T5*T6,T5+T6,1]"
                                b_coeff = "[T4,1]"
                                domain = "S-domain"
                                init_states = "[0]"
                                method = "Bilinear"
                            }
                            [
                                position = 8176, 8160
                            ]

                            component gen_z_domain_transfer TF1 {
                                a_coeff = "[T1*T2,T1,1]"
                                b_coeff = "[T3,1]"
                                domain = "S-domain"
                                init_states = "[0]"
                                method = "Bilinear"
                            }
                            [
                                position = 7960, 8160
                            ]

                            port T {
                                label = "T"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8488, 8160
                            ]

                            port reset {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8208, 8104
                            ]

                            port w_bias {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7832, 8160
                            ]

                            comment Comment4 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">Electric Control Box:</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">           (1 + sT3)</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">----------------------------------</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">  1 + sT1 + (s^2)T1T2</span></p></body></html> ENDCOMMENT 
                            [
                                position = 7872, 8208
                            ]

                            comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">Engine</span></p></body></html> ENDCOMMENT 
                            [
                                position = 8368, 8192
                            ]

                            comment Comment3 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">Actuator:</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">          K (1 + sT4)</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">----------------------------------</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">   s(1 + sT5)(1 + sT6)</span></p></body></html> ENDCOMMENT 
                            [
                                position = 8128, 8208
                            ]

                            connect reset Integrator.Reset as Connection33
                            connect "Transport Delay1.out" T as Connection28
                            connect Integrator.Out "Transport Delay1.in" as Connection32
                            connect w_bias TF1.in as Connection34
                            connect TF1.out Kp.in as Connection36
                            connect Integrator.In TF2.out as Connection31
                            connect TF2.in K.out as Connection27
                            connect Kp.out K.in as Connection35
                        }
                        [
                            position = 8072, 8000
                            size = 120, 64
                        ]

                        component sys_signal_switch w_switch {
                            threshold = "0.5"
                        }
                        [
                            position = 7496, 7944
                            hide_name = True
                        ]

                        component gen_sum Sum5 {
                            signs = "3"
                        }
                        [
                            position = 7704, 7984
                            hide_name = True
                        ]

                        component gen_sum Sum4 {
                            signs = "+--"
                        }
                        [
                            position = 7920, 8000
                            hide_name = True
                        ]

                        component gen_product Product1 {
                        }
                        [
                            position = 7672, 8200
                            hide_name = True
                        ]

                        component gen_rate_limiter w_ramp {
                            falling_limit = "inner_w_fall"
                            rising_limit = "inner_w_rise"
                        }
                        [
                            position = 7568, 7944
                            hide_name = True
                        ]

                        component src_constant zero {
                            execution_rate = "Ts"
                            value = "0.0"
                        }
                        [
                            position = 7352, 7960
                            hide_name = True
                        ]

                        component gen_gain "w to wpu" {
                            execution_rate = "Ts"
                            gain = "1/(2*np.pi*f/pms)"
                        }
                        [
                            position = 7728, 8080
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_gain "Tpu to T" {
                            execution_rate = "Ts"
                            gain = "-Sb*pms/(2*np.pi*f)"
                        }
                        [
                            position = 8200, 8000
                        ]

                        component gen_gain to_pu {
                            execution_rate = "Ts"
                            gain = "1/Sb"
                        }
                        [
                            position = 7576, 8192
                            rotation = down
                            scale = -1, 1
                        ]

                        component sys_signal_switch w_switch1 {
                            threshold = "0.5"
                        }
                        [
                            position = 7832, 8216
                            hide_name = True
                        ]

                        port GCB_status {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8160
                            rotation = down
                            scale = -1, 1
                        ]

                        port P_meas {
                            position = left:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7504, 8192
                            rotation = down
                            scale = -1, 1
                        ]

                        port "Gen On" {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7448, 7872
                            rotation = down
                            scale = -1, 1
                        ]

                        port w_ref {
                            position = left:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7432, 7928
                            rotation = down
                            scale = -1, 1
                        ]

                        port w_meas_in {
                            position = left:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7656, 8080
                            rotation = down
                            scale = -1, 1
                        ]

                        port T_out {
                            label = "T_out"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8264, 8000
                        ]

                        port w_bias {
                            position = left:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7592, 7984
                        ]

                        port dw_synch {
                            position = left:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7632, 8000
                        ]

                        tag From1 {
                            value = "zero"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7752, 8232
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto1 {
                            value = "zero"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7440, 7984
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction9 sp
                        [
                            position = 7496, 7872
                        ]

                        junction Junction13 sp
                        [
                            position = 7784, 8080
                        ]

                        junction Junction12 sp
                        [
                            position = 7392, 7960
                        ]

                        connect From1 w_switch1.in1 as Connection695
                        connect w_ref w_switch.in as Connection763
                        connect to_pu.in P_meas as Connection619
                        connect DEGOV.T "Tpu to T.in" as Connection720
                        connect Junction13 wmeas.in as Connection755
                        connect "w to wpu.in" w_meas_in as Connection166
                        connect Product1.in to_pu.out as Connection618
                        connect Inner_w_droop.out Product1.in1 as Connection764
                        connect Junction9 DEGOV.reset as Connection679
                        connect Junction12 Goto1 as Connection699
                        connect "Tpu to T.out" T_out as Connection30
                        connect w_ramp.out Sum5.in as Connection762
                        connect w_bias Sum5.in1 as Connection700
                        connect Product1.out w_switch1.in as Connection712
                        connect GCB_status w_switch1.in2 as Connection691
                        connect dw_synch Sum5.in2 as Connection701
                        connect Junction12 w_switch.in1 as Connection693
                        connect zero.out Junction12 as Connection692
                        connect "w to wpu.out" Junction13 as Connection754
                        connect "Gen On" Junction9 as Connection678
                        connect w_ramp.in w_switch.out as Connection761
                        connect Sum4.out DEGOV.w_bias as Connection742
                        connect Sum4.in1 Junction13 as Connection756
                        connect w_switch.in2 Junction9 as Connection680
                        connect Sum4.in Sum5.out as Connection765
                        [
                            breakpoints = 7768, 7984
                        ]
                        connect Sum4.in2 w_switch1.out as Connection766
                        [
                            breakpoints = 7880, 8080
                        ]
                    }
                    [
                        position = 8008, 8240
                        size = 184, 208
                    ]

                    component Subsystem "pf Control" {
                        layout = dynamic
                        component gen_c_function norm_pf_meas {
                            in_terminal_dimensions_str = "pf inherit;Q inherit;"
                            in_terminal_labels = "False;False;"
                            in_terminal_properties = "real pf;inherit Q;"
                            init_fnc = "/*Begin code section*/
pf = 1.0;
pf_norm = 1.0;
Q = 0.0;
/*End code section*/"
                            no_feed_inputs = "[u\'\']"
                            no_feed_outputs = "[u\'\']"
                            out_terminal_dimensions_str = "pf_norm inherit;"
                            out_terminal_labels = "False;"
                            out_terminal_properties = "real pf_norm;"
                            output_fnc = "/*Begin code section*/
if(pf>=0){
    if(Q>=0){
        pf_norm = 2-pf; // normalized pf ranges from 1 to 2
    }
    else{
        pf_norm = pf; // normalized pf ranges from 0 to 1
    }
}
else{
    if(Q>=0){
        pf_norm = 2+pf; // normalized pf ranges from 1 to 2
    }
    else{
        pf_norm = -pf; // normalized pf ranges from  0 to 1
    }
}
/*End code section*/"
                        }
                        [
                            position = 7760, 8304
                            size = 48, 48
                        ]

                        component sys_signal_switch "Signal switch4" {
                            criterion = "ctrl > threshold"
                            execution_rate = "Ts"
                        }
                        [
                            position = 8304, 8216
                            hide_name = True
                        ]

                        component src_constant Constant1 {
                            execution_rate = "Ts"
                            value = "0.1/Sb"
                        }
                        [
                            position = 7720, 7992
                            hide_name = True
                        ]

                        component gen_rate_limiter "Rate Limiter1" {
                            falling_limit = "pf_fall"
                            rising_limit = "pf_rise"
                        }
                        [
                            position = 7936, 8192
                            hide_name = True
                        ]

                        component gen_c_function norm_pf_ref {
                            global_variables = "real u;"
                            in_terminal_dimensions_str = "pf inherit;P inherit;"
                            in_terminal_labels = "False;False;"
                            in_terminal_properties = "real pf;inherit P;"
                            init_fnc = "/*Begin code section*/
pf = 1.0;
pf_norm = 1.0;
/*End code section*/"
                            no_feed_inputs = "[u\'\']"
                            no_feed_outputs = "[u\'\']"
                            out_terminal_dimensions_str = "pf_norm inherit;"
                            out_terminal_labels = "False;"
                            out_terminal_properties = "real pf_norm;"
                            output_fnc = "/*Begin code section*/
if(P>=0){
    if(pf>=0){
        pf_norm = 2-pf; // normalized pf ranges from 1 to 2
    }
    else{
        pf_norm = -pf; // normalized pf ranges from 0 to 1
    }
}
else{
    if(pf>=0){
        pf_norm = 2-pf; // normalized pf ranges from 1 to 2
    }
    else{
        pf_norm = -pf; // normalized pf ranges from  0 to 1
    }
}
/*End code section*/"
                        }
                        [
                            position = 7712, 8176
                            size = 48, 48
                        ]

                        component gen_rel_op greater_equal {
                            relational_op = ">="
                        }
                        [
                            position = 7824, 7944
                            hide_name = True
                        ]

                        component Subsystem PI {
                            layout = dynamic
                            component gen_sum Sum7 {
                            }
                            [
                                position = 8088, 8224
                                hide_name = True
                            ]

                            component gen_gain Kb {
                            }
                            [
                                position = 8216, 8312
                                scale = -1, 1
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "pf_lowLim"
                                upper_limit = "pf_upLim"
                            }
                            [
                                position = 8408, 8224
                                hide_name = True
                            ]

                            component gen_gain Kp {
                                gain = "pf_Kp"
                            }
                            [
                                position = 7992, 8136
                            ]

                            component gen_integrator Integrator1 {
                                limit_lower = "[\'-inf\']"
                                limit_upper = "[\'inf\']"
                                show_reset = "either"
                            }
                            [
                                position = 8216, 8232
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8320, 8312
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_gain Ki {
                                gain = "pf_Ki"
                            }
                            [
                                position = 7992, 8216
                            ]

                            component gen_sum Sum5 {
                            }
                            [
                                position = 8320, 8224
                                hide_name = True
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8224
                            ]

                            port Reset {
                                label = "Reset"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8144, 8264
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7824, 8176
                            ]

                            junction Junction2 sp
                            [
                                position = 8368, 8224
                            ]

                            junction Junction3 sp
                            [
                                position = 8440, 8224
                            ]

                            junction Junction4 sp
                            [
                                position = 7920, 8176
                            ]

                            connect Sum7.out Integrator1.in as Connection52
                            connect Junction2 Limit1.in as Connection45
                            connect Sum7.in Ki.out as Connection54
                            connect Junction3 Out as Connection48
                            connect Junction4 In as Connection60
                            connect Kb.in Sum6.out as Connection50
                            connect Ki.in Junction4 as Connection61
                            connect Kp.in Junction4 as Connection59
                            connect Kp.out Sum5.in as Connection57
                            connect Limit1.out Junction3 as Connection47
                            connect Sum5.in1 Integrator1.out as Connection5
                            connect Sum5.out Junction2 as Connection44
                            connect Sum6.in Junction2 as Connection46
                            connect Integrator1.reset Reset as Connection2
                            connect Sum6.in1 Junction3 as Connection49
                            connect Sum7.in1 Kb.out as Connection53
                        }
                        [
                            position = 8144, 8200
                            size = 64, 48
                        ]

                        component src_constant zero1 {
                            execution_rate = "Ts"
                            value = "[0]"
                        }
                        [
                            position = 8240, 8232
                            hide_name = True
                        ]

                        component gen_sum Sum6 {
                            execution_rate = "Ts"
                            signs = "+-"
                        }
                        [
                            position = 8032, 8200
                            hide_name = True
                        ]

                        component gen_logic_op "Logical operator5" {
                            inputs = "4"
                        }
                        [
                            position = 7904, 8016
                            rotation = right
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                            execution_rate = "Ts"
                            threshold = "0.5"
                        }
                        [
                            position = 7872, 8192
                            hide_name = True
                        ]

                        port P_control_mode {
                            position = left:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7720, 7880
                        ]

                        port pf_ref {
                            position = left:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7616, 8128
                        ]

                        port pf_meas {
                            position = left:17
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7640, 8280
                        ]

                        port Q_meas_in {
                            position = left:18
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7640, 8344
                        ]

                        port Pref {
                            position = left:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7720, 7936
                        ]

                        port Q_control_mode {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7792, 7840
                        ]

                        port P_meas {
                            position = left:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7616, 8184
                        ]

                        port enable {
                            position = left:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7832, 7800
                        ]

                        port Q_active {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8064, 8000
                        ]

                        port dV_out {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8392, 8216
                        ]

                        tag From2 {
                            value = "Q_mode"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7808, 8120
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto1 {
                            value = "Q_mode"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8072, 8064
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction84 sp
                        [
                            position = 8144, 8120
                        ]

                        junction Junction85 sp
                        [
                            position = 7840, 8248
                        ]

                        junction Junction88 sp
                        [
                            position = 7984, 8064
                        ]

                        junction Junction81 sp
                        [
                            position = 7872, 8120
                        ]

                        connect "Signal switch2.out" "Rate Limiter1.in" as Connection133
                        connect Junction84 "Signal switch4.in2" as Connection80
                        connect PI.Out "Signal switch4.in" as Connection77
                        connect Q_control_mode "Logical operator5.in1" as Connection135
                        connect Junction85 "Signal switch2.in1" as Connection99
                        connect pf_meas norm_pf_meas.pf as Connection104
                        connect Junction81 Junction84 as Connection79
                        connect From2 Junction81 as Connection52
                        connect Constant1.out greater_equal.in1 as Connection125
                        connect enable "Logical operator5.in" as Connection136
                        connect greater_equal.in Pref as Connection124
                        connect P_control_mode "Logical operator5.in2" as Connection84
                        connect Q_meas_in norm_pf_meas.Q as Connection96
                        connect norm_pf_ref.pf pf_ref as Connection132
                        connect Junction88 "Logical operator5.out" as Connection129
                        connect P_meas norm_pf_ref.P as Connection127
                        connect Sum6.in1 Junction85 as Connection98
                        connect "Rate Limiter1.out" Sum6.in as Connection134
                        connect Q_active Junction88 as Connection130
                        connect greater_equal.out "Logical operator5.in3" as Connection126
                        connect Junction81 "Signal switch2.in2" as Connection53
                        connect Goto1 Junction88 as Connection128
                        connect PI.Reset Junction84 as Connection81
                        connect Sum6.out PI.In as Connection123
                        connect zero1.out "Signal switch4.in1" as Connection75
                        connect "Signal switch2.in" norm_pf_ref.pf_norm as Connection137
                        [
                            breakpoints = 7768, 8176
                        ]
                        connect dV_out "Signal switch4.out" as Connection138
                        [
                            breakpoints = 8344, 8216
                        ]
                        connect Junction85 norm_pf_meas.pf_norm as Connection139
                        [
                            breakpoints = 7840, 8248; 7840, 8304
                        ]
                    }
                    [
                        position = 7736, 7912
                        size = 144, 272
                    ]

                    component gen_bus_split "Bus Split2" {
                        outputs = "3"
                    }
                    [
                        position = 6952, 7856
                        hide_name = True
                    ]

                    component Subsystem Exciter {
                        layout = dynamic
                        component gen_gain to_pu {
                            execution_rate = "Ts"
                            gain = "1.0/Sb"
                        }
                        [
                            position = 8032, 8384
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_gain Vfpu_to_Vf {
                            execution_rate = "Ts"
                            gain = "Vn*((2.0/3.0)**0.5)/Ns_Nfd"
                        }
                        [
                            position = 8648, 8200
                        ]

                        component Subsystem DC4B {
                            layout = dynamic
                            component gen_z_domain_transfer TF3 {
                                a_coeff = "[Te,Ke]"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 8552, 8168
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 8200, 8160
                                hide_name = True
                            ]

                            component src_constant One {
                                execution_rate = "Ts"
                            }
                            [
                                position = 7872, 8272
                            ]

                            component sys_signal_switch switch {
                                criterion = "ctrl > threshold"
                            }
                            [
                                position = 8000, 8256
                                hide_name = True
                                scale = 1, -1
                            ]

                            component gen_gain Kf {
                                gain = "Kf"
                            }
                            [
                                position = 8424, 8032
                                scale = -1, 1
                            ]

                            component gen_sum Sum1 {
                                signs = "++-"
                            }
                            [
                                position = 7896, 8160
                                hide_name = True
                            ]

                            component gen_gain KA {
                                gain = "Ka"
                            }
                            [
                                position = 8304, 8160
                            ]

                            component gen_z_domain_transfer TF1 {
                                a_coeff = "[Tr,1]"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 7768, 8216
                            ]

                            component gen_c_function "Variable Limit" {
                                in_terminal_dimensions_str = "in inherit;LimitChange inherit;"
                                in_terminal_labels = "True;True;"
                                in_terminal_properties = "inherit in;inherit LimitChange;"
                                init_fnc = "/*Begin code section*/
LimitChange = 0;
out = 0;
/*End code section*/"
                                no_feed_inputs = "[u\'\']"
                                no_feed_outputs = "[u\'\']"
                                out_terminal_dimensions_str = "out inherit;"
                                out_terminal_labels = "True;"
                                out_terminal_properties = "inherit out;"
                                output_fnc = "/*Begin code section*/
if(LimitChange == 0.0){
    LimitChange = 0.01;
}

if(in>=Vrmax*LimitChange){
    out = Vrmax*LimitChange;
}
else{
    if(in<=Vrmin*LimitChange){
        out = Vrmin*LimitChange;
    }
    else{
        out = in;
    }
}
/*End code section*/"
                                parameters = "real Vrmax;real Vrmin;"
                            }
                            [
                                position = 8464, 8168
                                size = 48, 48
                            ]

                            component gen_z_domain_transfer TF4 {
                                a_coeff = "[Tf,1]"
                                b_coeff = "[1,0]"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 8328, 8032
                                scale = -1, 1
                            ]

                            component Subsystem PI {
                                layout = dynamic
                                component gen_limiter Limit1 {
                                    lower_limit = "Vrmin/Ka"
                                    upper_limit = "Vrmax/Ka"
                                }
                                [
                                    position = 8408, 8224
                                    hide_name = True
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8320, 8224
                                    hide_name = True
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[\'-inf\']"
                                    limit_upper = "[\'inf\']"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8232
                                    hide_name = True
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8216, 8312
                                    scale = -1, 1
                                ]

                                component gen_gain Kp {
                                    gain = "exc_Kp"
                                }
                                [
                                    position = 7992, 8152
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8320, 8312
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_gain Ki {
                                    gain = "exc_Ki"
                                }
                                [
                                    position = 7992, 8216
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8088, 8224
                                    hide_name = True
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8144, 8264
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7824, 8184
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8472, 8224
                                ]

                                junction Junction3 sp
                                [
                                    position = 8440, 8224
                                ]

                                junction Junction2 sp
                                [
                                    position = 8368, 8224
                                ]

                                junction Junction4 sp
                                [
                                    position = 7928, 8184
                                ]

                                connect Ki.in Junction4 as Connection56
                                connect Kp.out Sum5.in as Connection59
                                connect Junction2 Limit1.in as Connection45
                                connect Limit1.out Junction3 as Connection47
                                connect Kb.in Sum6.out as Connection50
                                connect Kp.in Junction4 as Connection58
                                connect Ki.out Sum7.in as Connection54
                                connect Junction3 Out as Connection48
                                connect Junction4 In as Connection57
                                connect Integrator1.reset Reset as Connection2
                                connect Sum6.in Junction2 as Connection46
                                connect Sum7.out Integrator1.in as Connection52
                                connect Sum7.in1 Kb.out as Connection53
                                connect Sum6.in1 Junction3 as Connection49
                                connect Sum5.out Junction2 as Connection44
                                connect Sum5.in1 Integrator1.out as Connection5
                            }
                            [
                                position = 8104, 8152
                                size = 64, 48
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 8000, 8152
                                hide_name = True
                            ]

                            component gen_z_domain_transfer TF2 {
                                a_coeff = "[Ta,1]"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 8376, 8160
                            ]

                            component gen_probe Va {
                            }
                            [
                                position = 8288, 8096
                            ]

                            port Vfd {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8672, 8168
                            ]

                            port Linearize {
                                position = top:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8320
                            ]

                            port reset {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8088
                            ]

                            port Vt {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8216
                            ]

                            port Vpss {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8104
                            ]

                            port Vref {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8160
                            ]

                            junction Junction13 sp
                            [
                                position = 7816, 8216
                            ]

                            junction Junction14 sp
                            [
                                position = 8608, 8168
                            ]

                            junction Junction6 sp
                            [
                                position = 8248, 8160
                            ]

                            junction Junction10 sp
                            [
                                position = 8160, 8256
                            ]

                            connect Junction6 KA.in as Connection77
                            connect TF2.in KA.out as Connection10
                            connect Junction13 Sum1.in2 as Connection114
                            connect Product1.in PI.Out as Connection49
                            connect TF4.in Kf.out as Connection127
                            connect reset PI.Reset as Connection117
                            connect Junction10 Product1.in1 as Connection102
                            connect TF4.out Sum2.in as Connection123
                            connect Vpss Sum1.in as Connection45
                            connect PI.In Sum2.out as Connection48
                            connect Kf.in Junction14 as Connection128
                            connect TF3.out Junction14 as Connection125
                            connect Vref Sum1.in1 as Connection46
                            connect Vt TF1.in as Connection112
                            connect "Variable Limit.in" TF2.out as Connection89
                            connect Product1.out Junction6 as Connection76
                            connect Linearize switch.in2 as Connection74
                            connect Junction14 Vfd as Connection126
                            connect TF1.out Junction13 as Connection113
                            connect switch.out Junction10 as Connection101
                            connect "Variable Limit.LimitChange" Junction10 as Connection103
                            connect Va.in Junction6 as Connection78
                            connect One.out switch.in as Connection75
                            connect TF3.in "Variable Limit.out" as Connection118
                            connect Sum2.in1 Sum1.out as Connection5
                            connect switch.in1 Junction13 as Connection115

                            Ka = "Ka"
                            Ke = "Ke"
                            Kf = "Kf"
                            Ta = "Ta"
                            Te = "Te"
                            Tf = "Tf"
                            Tr = "Tr"
                            Vf0 = "Vf0"
                            Vfmax = "Efmax"
                            Vfmin = "Efmin"
                            Vrmax = "Vrmax"
                            Vrmin = "Vrmin"
                            exc_Ki = "exc_Ki"
                            exc_Kp = "exc_Kp"

                            mask {
                                description = "IEEE DC1A exciter model."

                                Tr {
                                    label = "Time constant Tr"
                                    widget = edit
                                    type = generic
                                    default_value = "2e-6"
                                    group = "General"
                                }

                                exc_Kp {
                                    label = "Exciter PI proportional gain"
                                    widget = edit
                                    type = generic
                                    default_value = "1"
                                    group = "General"
                                }

                                exc_Ki {
                                    label = "Exciter PI integral gain"
                                    widget = edit
                                    type = generic
                                    default_value = "0"
                                    group = "General"
                                }

                                Ka {
                                    label = "Major regulator gain Ka"
                                    widget = edit
                                    type = generic
                                    default_value = "200"
                                    group = "General"
                                }

                                Ta {
                                    label = "Major regulator time constant  Ta"
                                    widget = edit
                                    type = generic
                                    default_value = "2e-3"
                                    group = "General"
                                }

                                Vrmax {
                                    label = "Saturation upper limit"
                                    widget = edit
                                    type = generic
                                    default_value = "10"
                                    group = "General"
                                }

                                Vrmin {
                                    label = "Saturation lower limit"
                                    widget = edit
                                    type = generic
                                    default_value = "-10"
                                    group = "General"
                                }

                                Te {
                                    label = "Exciter time constant Te"
                                    widget = edit
                                    type = generic
                                    default_value = "1e-8"
                                    group = "General"
                                }

                                Ke {
                                    label = "Exciter gain Ke"
                                    widget = edit
                                    type = generic
                                    default_value = "1"
                                    group = "General"
                                }

                                Kf {
                                    label = "Stabilization feedback gain Kf"
                                    widget = edit
                                    type = generic
                                    default_value = "0.0"
                                    group = "General"
                                }

                                Tf {
                                    label = "Stabilization feedback time constant Tf"
                                    widget = edit
                                    type = generic
                                    default_value = "1.0e-12"
                                    group = "General"
                                }

                                Vf0 {
                                    label = "Initial field voltage"
                                    widget = edit
                                    type = generic
                                    default_value = "0"
                                    group = "General"
                                }

                                Vfmax {
                                    label = "Exciter saturation upper limit"
                                    widget = edit
                                    type = generic
                                    default_value = "[\'inf\']"
                                    group = "General"
                                }

                                Vfmin {
                                    label = "Exciter saturation lower limit"
                                    widget = edit
                                    type = generic
                                    default_value = "[\'-inf\']"
                                    group = "General"
                                }

                                Ts {
                                    label = "Execution rate"
                                    widget = edit
                                    type = generic
                                    default_value = "Ts"
                                    group = "General"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 8448, 8208
                            size = 112, 120
                        ]

                        component gen_probe Vt {
                            addr = "8978"
                            execution_rate = "Ts"
                        }
                        [
                            position = 8360, 8304
                            rotation = right
                        ]

                        component gen_product Product2 {
                            signs = "3"
                        }
                        [
                            position = 8112, 8272
                            rotation = left
                            hide_name = True
                        ]

                        component src_constant Vpss {
                            execution_rate = "Ts"
                            value = "[0]"
                        }
                        [
                            position = 8176, 8128
                        ]

                        component src_constant V_inner_droop {
                            execution_rate = "Ts"
                            value = "V_inner_droop"
                        }
                        [
                            position = 7928, 8432
                        ]

                        component src_constant Zero {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 7680, 8168
                            hide_name = True
                        ]

                        component gen_sum Sum2 {
                            execution_rate = "Ts"
                            signs = "+-"
                        }
                        [
                            position = 8184, 8208
                            hide_name = True
                        ]

                        component gen_gain Vt_to_Vtpu {
                            execution_rate = "Ts"
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8304, 8248
                        ]

                        component gen_rate_limiter "Rate Limit" {
                            falling_limit = "V_fall"
                            rising_limit = "V_rise"
                        }
                        [
                            position = 7816, 8184
                            hide_name = True
                        ]

                        component gen_product Product1 {
                        }
                        [
                            position = 8568, 8200
                            hide_name = True
                        ]

                        component src_constant Const {
                            execution_rate = "Ts"
                            value = "Vf0/Ka"
                        }
                        [
                            position = 8176, 8072
                        ]

                        component gen_gain one_ov_sqrt_3 {
                            execution_rate = "Ts"
                            gain = "1.0/(3.0**0.5)"
                        }
                        [
                            position = 8032, 8432
                            hide_name = True
                            scale = 1, -1
                        ]

                        component src_constant One {
                            execution_rate = "Ts"
                            value = "1.0"
                        }
                        [
                            position = 8448, 8104
                        ]

                        component sys_signal_switch switch {
                            threshold = "0.5"
                        }
                        [
                            position = 7752, 8184
                            hide_name = True
                            scale = 1, -1
                        ]

                        component gen_sum Sum1 {
                            execution_rate = "Ts"
                        }
                        [
                            position = 8264, 8104
                            hide_name = True
                        ]

                        component gen_sum Sum {
                            execution_rate = "Ts"
                            signs = "3"
                        }
                        [
                            position = 8016, 8200
                            hide_name = True
                        ]

                        port Q_meas {
                            position = left:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7928, 8384
                            rotation = down
                            scale = -1, 1
                        ]

                        port GCB_status {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7928, 8336
                            rotation = down
                            scale = -1, 1
                        ]

                        port dV {
                            position = left:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7944, 8216
                        ]

                        port Start {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7696, 8256
                        ]

                        port Vref {
                            position = left:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7680, 8200
                        ]

                        port Delta_V_in {
                            position = left:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7880, 8200
                        ]

                        port Vf_out {
                            label = "Vf_out"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8712, 8200
                        ]

                        port Vt_in {
                            position = left:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8240, 8248
                        ]

                        tag Goto1 {
                            value = "start"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7816, 8256
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From1 {
                            value = "start"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8328, 8032
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction112 sp
                        [
                            position = 7752, 8256
                        ]

                        junction Junction117 sp
                        [
                            position = 8416, 8072
                        ]

                        junction Junction118 sp
                        [
                            position = 8360, 8248
                        ]

                        connect One.out DC4B.Linearize as Connection740
                        connect "Rate Limit.in" switch.out as Connection58
                        connect Sum.in1 Delta_V_in as Connection25
                        connect GCB_status Product2.in as Connection709
                        connect one_ov_sqrt_3.out Product2.in2 as Connection724
                        connect Product2.out Sum2.in1 as Connection717
                        connect Const.out Sum1.in as Connection3
                        connect DC4B.Vref Sum2.out as Connection745
                        connect Vf_out Vfpu_to_Vf.out as Connection126
                        connect to_pu.in Q_meas as Connection619
                        connect Vpss.out Sum1.in1 as Connection32
                        connect DC4B.Vfd Product1.in1 as Connection739
                        connect Start Junction112 as Connection119
                        connect Sum1.out DC4B.Vpss as Connection744
                        connect Product2.in1 to_pu.out as Connection710
                        connect Junction117 From1 as Connection742
                        connect Vt_to_Vtpu.out Junction118 as Connection746
                        connect Product1.in Junction117 as Connection741
                        connect Vt_to_Vtpu.in Vt_in as Connection36
                        connect DC4B.Vt Junction118 as Connection748
                        connect Junction118 Vt.in as Connection747
                        connect Junction112 switch.in2 as Connection120
                        connect V_inner_droop.out one_ov_sqrt_3.in as Connection749
                        connect Vfpu_to_Vf.in Product1.out as Connection125
                        connect DC4B.reset Junction117 as Connection743
                        connect Zero.out switch.in1 as Connection45
                        connect Goto1 Junction112 as Connection121
                        connect dV Sum.in2 as Connection88
                        connect "Rate Limit.out" Sum.in as Connection59
                        connect Vref switch.in as Connection87
                        connect Sum2.in Sum.out as Connection750
                        [
                            breakpoints = 8072, 8200
                        ]
                    }
                    [
                        position = 8088, 7816
                        size = 192, 200
                    ]

                    component Subsystem Freq_setpoint_control {
                        layout = dynamic
                        component src_constant w_Droop {
                            execution_rate = "Ts"
                            value = "w_droop"
                        }
                        [
                            position = 8120, 8296
                        ]

                        component gen_product Product2 {
                            signs = "3"
                        }
                        [
                            position = 8032, 7936
                            hide_name = True
                        ]

                        component gen_gain P_3ph_to_pu {
                            execution_rate = "Ts"
                            gain = "1.0/Sb"
                        }
                        [
                            position = 7960, 8352
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_sum Sum6 {
                            execution_rate = "Ts"
                            signs = "-+"
                        }
                        [
                            position = 8616, 7952
                            hide_name = True
                            scale = 1, -1
                        ]

                        component sys_signal_switch mode_switch {
                            criterion = "ctrl > threshold"
                            execution_rate = "Ts"
                            threshold = "0.5"
                        }
                        [
                            position = 8776, 8352
                            hide_name = True
                        ]

                        component gen_sum Sum3 {
                            signs = "+-"
                        }
                        [
                            position = 9184, 8352
                        ]

                        component Subsystem PI {
                            layout = dynamic
                            component gen_limiter Limit1 {
                                lower_limit = "w_sp_lowLim"
                                upper_limit = "w_sp_upLim"
                            }
                            [
                                position = 8408, 8224
                                hide_name = True
                            ]

                            component gen_gain Ki {
                                gain = "w_sp_Ki"
                            }
                            [
                                position = 8008, 8216
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 8088, 8224
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8320, 8312
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_sum Sum5 {
                            }
                            [
                                position = 8320, 8224
                                hide_name = True
                            ]

                            component gen_gain Kp {
                                gain = "w_sp_Kp"
                            }
                            [
                                position = 8008, 8152
                            ]

                            component gen_gain Kb {
                            }
                            [
                                position = 8216, 8312
                                scale = -1, 1
                            ]

                            component gen_integrator Integrator1 {
                                limit_lower = "[\'-inf\']"
                                limit_upper = "[\'inf\']"
                                show_reset = "either"
                            }
                            [
                                position = 8216, 8232
                                hide_name = True
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8224
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7872, 8184
                            ]

                            port Reset {
                                label = "Reset"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8144, 8264
                            ]

                            junction Junction4 sp
                            [
                                position = 7928, 8184
                            ]

                            junction Junction3 sp
                            [
                                position = 8440, 8224
                            ]

                            junction Junction2 sp
                            [
                                position = 8368, 8224
                            ]

                            connect Junction4 In as Connection58
                            connect Kb.in Sum6.out as Connection50
                            connect Ki.in Junction4 as Connection59
                            connect Sum6.in Junction2 as Connection46
                            connect Ki.out Sum7.in as Connection54
                            connect Kp.out Sum5.in as Connection55
                            connect Limit1.out Junction3 as Connection47
                            connect Sum5.in1 Integrator1.out as Connection5
                            connect Sum5.out Junction2 as Connection44
                            connect Kp.in Junction4 as Connection57
                            connect Integrator1.reset Reset as Connection2
                            connect Sum6.in1 Junction3 as Connection49
                            connect Junction2 Limit1.in as Connection45
                            connect Sum7.out Integrator1.in as Connection52
                            connect Junction3 Out as Connection48
                            connect Sum7.in1 Kb.out as Connection53
                        }
                        [
                            position = 9296, 8352
                            size = 64, 48
                        ]

                        component gen_limiter P_limit {
                            lower_limit = "0.0"
                            upper_limit = "1.0/1.25"
                        }
                        [
                            position = 7872, 7936
                            hide_name = True
                        ]

                        component gen_rate_limiter P_ramp {
                            falling_limit = "P_fall"
                            rising_limit = "P_rise"
                        }
                        [
                            position = 7936, 7936
                            hide_name = True
                        ]

                        component sys_signal_switch f_droop_switch {
                            criterion = "ctrl > threshold"
                            execution_rate = "Ts"
                            threshold = "0.5"
                        }
                        [
                            position = 8360, 8360
                            hide_name = True
                        ]

                        component gen_sum Sum7 {
                        }
                        [
                            position = 8976, 8344
                            hide_name = True
                        ]

                        component gen_gain "w to wpu" {
                            execution_rate = "Ts"
                            gain = "1/(2*np.pi*f/pms)"
                        }
                        [
                            position = 7880, 8016
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_product Product3 {
                            signs = "3"
                        }
                        [
                            position = 8152, 8056
                            hide_name = True
                        ]

                        component sys_signal_switch w_switch {
                            threshold = "0.5"
                        }
                        [
                            position = 8400, 8512
                            hide_name = True
                        ]

                        component sys_signal_switch load_share_switch {
                            criterion = "ctrl > threshold"
                            execution_rate = "Ts"
                            threshold = "0.5"
                        }
                        [
                            position = 8888, 8232
                            hide_name = True
                        ]

                        component gen_sum Sum5 {
                            execution_rate = "Ts"
                        }
                        [
                            position = 8168, 7944
                            hide_name = True
                            scale = 1, -1
                        ]

                        component src_constant P_Droop {
                            execution_rate = "Ts"
                            value = "P_droop"
                        }
                        [
                            position = 7864, 7864
                        ]

                        component src_constant zero1 {
                            execution_rate = "Ts"
                            value = "0.0"
                        }
                        [
                            position = 8280, 8528
                            hide_name = True
                        ]

                        component gen_sum Sum8 {
                            execution_rate = "Ts"
                            signs = "-+"
                        }
                        [
                            position = 8608, 8368
                            hide_name = True
                        ]

                        component gen_product Product1 {
                        }
                        [
                            position = 8208, 8344
                            hide_name = True
                        ]

                        component gen_rate_limiter w_ramp {
                            falling_limit = "w_fall"
                            rising_limit = "w_rise"
                        }
                        [
                            position = 8472, 8512
                            hide_name = True
                        ]

                        component sys_signal_switch mode_switch1 {
                            criterion = "ctrl > threshold"
                            execution_rate = "Ts"
                            threshold = "0.5"
                        }
                        [
                            position = 9408, 8368
                            hide_name = True
                        ]

                        port P_ref {
                            position = left:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7808, 7936
                        ]

                        port enable {
                            position = left:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8312, 8280
                        ]

                        port w_meas {
                            position = left:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7808, 8016
                            rotation = down
                            scale = -1, 1
                        ]

                        port w_ref {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8320, 8496
                            rotation = down
                            scale = -1, 1
                        ]

                        port Load_Share {
                            position = left:18
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8800, 8200
                        ]

                        port w_bias {
                            position = auto:auto
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9480, 8368
                        ]

                        port Load_Share_on {
                            position = left:17
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8824, 8136
                        ]

                        port P_mode {
                            position = left:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8712, 8288
                        ]

                        port Pmeas_in {
                            position = left:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7864, 8352
                            rotation = down
                            scale = -1, 1
                        ]

                        tag From3 {
                            value = "zero"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8800, 8248
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto2 {
                            value = "zero"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8416, 8568
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From5 {
                            value = "enable"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9216, 8272
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From2 {
                            value = "zero"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8280, 8376
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From4 {
                            value = "w_meas"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9096, 8360
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto4 {
                            value = "enable"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8440, 8280
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto1 {
                            value = "P_droop"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8064, 7864
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto3 {
                            value = "w_meas"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7968, 8040
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From7 {
                            value = "zero"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9320, 8416
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From1 {
                            value = "P_droop"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8064, 8056
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From6 {
                            value = "enable"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8344, 8440
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction4 sp
                        [
                            position = 8072, 8016
                        ]

                        junction Junction6 sp
                        [
                            position = 8056, 8352
                        ]

                        junction Junction7 sp
                        [
                            position = 8344, 8528
                        ]

                        junction Junction8 sp
                        [
                            position = 7992, 8016
                        ]

                        junction Junction13 sp
                        [
                            position = 7920, 8016
                        ]

                        junction Junction14 sp
                        [
                            position = 8360, 8280
                        ]

                        junction Junction15 sp
                        [
                            position = 9296, 8272
                        ]

                        junction Junction16 sp
                        [
                            position = 7992, 7864
                        ]

                        comment Comment2 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">w'_sp</span></p></body></html> ENDCOMMENT 
                        [
                            position = 8384, 8328
                        ]

                        comment Comment4 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">w_P_sp</span></p></body></html> ENDCOMMENT 
                        [
                            position = 8208, 7912
                        ]

                        comment Comment7 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">w''_sp</span></p></body></html> ENDCOMMENT 
                        [
                            position = 8640, 8376
                        ]

                        comment Comment3 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">w_sp</span></p></body></html> ENDCOMMENT 
                        [
                            position = 8512, 8384
                        ]

                        comment Comment5 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">Power setpoint loop</span></p></body></html> ENDCOMMENT 
                        [
                            position = 7904, 7816
                        ]

                        comment Comment6 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">w''_sp</span></p></body></html> ENDCOMMENT 
                        [
                            position = 8656, 8056
                            rotation = right
                        ]

                        comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">Frequency setpoint loop</span></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:10pt;"><br /></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">w'_sp = f_rated*Droop*Ppu</span></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:10pt;"><br /></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">Ppu = Pmeas/Prated</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">f_rated = 1pu</span></p></body></html> ENDCOMMENT 
                        [
                            position = 8008, 8392
                        ]

                        connect Junction15 PI.Reset as Connection715
                        connect Junction16 Goto1 as Connection725
                        connect enable Junction14 as Connection708
                        connect Junction4 Junction8 as Connection674
                        connect f_droop_switch.in Product1.out as Connection634
                        connect Junction6 Product1.in1 as Connection648
                        connect load_share_switch.out Sum7.in as Connection650
                        connect Junction7 w_switch.in1 as Connection653
                        connect Junction8 Product2.in2 as Connection675
                        connect mode_switch.out Sum7.in1 as Connection644
                        connect mode_switch.in1 Sum8.out as Connection643
                        connect Load_Share load_share_switch.in as Connection659
                        connect mode_switch1.in2 Junction15 as Connection716
                        connect Load_Share_on load_share_switch.in2 as Connection718
                        connect mode_switch1.in PI.Out as Connection712
                        connect P_3ph_to_pu.out Junction6 as Connection647
                        connect "w to wpu.out" Junction13 as Connection696
                        connect P_Droop.out Junction16 as Connection726
                        connect P_limit.in P_ref as Connection721
                        connect w_Droop.out Product1.in as Connection722
                        connect P_mode mode_switch.in2 as Connection719
                        connect P_ramp.in P_limit.out as Connection720
                        connect Pmeas_in P_3ph_to_pu.in as Connection58
                        connect w_bias mode_switch1.out as Connection713
                        connect Product2.in Junction16 as Connection724
                        connect w_meas "w to wpu.in" as Connection677
                        connect Product2.in1 P_ramp.out as Connection645
                        connect w_ramp.in w_switch.out as Connection103
                        connect w_ref w_switch.in as Connection180
                        connect Product3.in Junction4 as Connection626
                        connect Product3.in2 Junction6 as Connection649
                        connect From1 Product3.in1 as Connection631
                        connect Sum3.in1 From4 as Connection707
                        connect zero1.out Junction7 as Connection652
                        connect Sum3.out PI.In as Connection687
                        connect From2 f_droop_switch.in1 as Connection655
                        connect From3 load_share_switch.in1 as Connection656
                        connect From5 Junction15 as Connection714
                        connect From6 w_switch.in2 as Connection711
                        connect From7 mode_switch1.in1 as Connection717
                        connect Goto2 Junction7 as Connection654
                        connect Goto3 Junction13 as Connection698
                        connect Goto4 Junction14 as Connection710
                        connect Sum5.in Junction4 as Connection624
                        connect Sum5.in1 Product2.out as Connection611
                        connect Sum8.in f_droop_switch.out as Connection637
                        connect Junction13 Junction8 as Connection697
                        connect Sum8.in1 w_ramp.out as Connection638
                        connect Junction14 f_droop_switch.in2 as Connection709
                        connect Sum5.out Sum6.in1 as Connection727
                        [
                            breakpoints = 8360, 7944
                        ]
                        connect Sum6.in Product3.out as Connection728
                        [
                            breakpoints = 8360, 8056
                        ]
                        connect mode_switch.in Sum6.out as Connection729
                        [
                            breakpoints = 8656, 7992
                        ]
                        connect Sum3.in Sum7.out as Connection730
                        [
                            breakpoints = 9056, 8344
                        ]
                    }
                    [
                        position = 7696, 8224
                        size = 120, 264
                    ]

                    component tm_delay "Unit Delay3" {
                        execution_rate = "Ts"
                    }
                    [
                        position = 8024, 7664
                        hide_name = True
                    ]

                    port wmeas {
                        position = right:13
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7840, 8320
                    ]

                    port T_in {
                        position = right:12
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7272, 8280
                    ]

                    port Meas_feedback {
                        position = left:13
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7208, 8024
                    ]

                    port From_synch_check {
                        position = left:11
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6864, 7856
                    ]

                    port To_synch_check {
                        position = left:12
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8456, 8112
                        rotation = left
                    ]

                    port T_out {
                        position = right:14
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8176, 8240
                    ]

                    port Inputs {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6864, 7960
                    ]

                    port Vf_out {
                        position = right:11
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8272, 7816
                    ]

                    tag Goto12 {
                        value = "V_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8144
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From62 {
                        value = "P_control_mode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8272
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From70 {
                        value = "pf_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 7928
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto4 {
                        value = "GCB_status"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7048, 7856
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto14 {
                        value = "P_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8192
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto37 {
                        value = "dV"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7048, 7880
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From46 {
                        value = "GCB_status"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7128, 7696
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto35 {
                        value = "StandBy"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7416, 7856
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto36 {
                        value = "GridFollow"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7504, 7896
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From51 {
                        value = "GridForm"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8336, 8288
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From49 {
                        value = "StandBy"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8336, 8264
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto33 {
                        value = "enable_outer_loop"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7320, 7976
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto3 {
                        value = "Vt_meas"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7392, 8200
                        hide_name = True
                        size = 58, 20
                    ]

                    tag From6 {
                        value = "P_control_mode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8448
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From13 {
                        value = "V_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7912, 7768
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From63 {
                        value = "Load_Share_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8304
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From61 {
                        value = "Q_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7912, 7896
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From72 {
                        value = "w_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8336, 8432
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From16 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8336, 8240
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From45 {
                        value = "Gen_OP_mode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7128, 7656
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From12 {
                        value = "P_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 7896
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From11 {
                        value = "Q_control_mode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 7800
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From9 {
                        value = "dw_Synch"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7840, 8256
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From66 {
                        value = "P_control_mode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 7864
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto34 {
                        value = "GridForm"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7416, 8008
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto40 {
                        value = "Load_Share_On"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8288
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From47 {
                        value = "enable_outer_loop"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 7832
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From58 {
                        value = "P_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7840, 8288
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From56 {
                        value = "w_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8208
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto43 {
                        value = "P_control_mode"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7464, 8416
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto44 {
                        value = "Q_control_mode"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7464, 8448
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From67 {
                        value = "Gen_control_mode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7192, 8432
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From10 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7840, 8160
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From54 {
                        value = "ss_speed"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8336, 8336
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto39 {
                        value = "Exciter_on"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7864, 7728
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto45 {
                        value = "Q_active"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7872, 8024
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto42 {
                        value = "Load_Share"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8312
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto1 {
                        value = "P_meas"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7392, 8152
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto9 {
                        value = "w_meas"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7952, 8392
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto46 {
                        value = "pf_meas"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7392, 8224
                        hide_name = True
                        size = 58, 20
                    ]

                    tag Goto32 {
                        value = "Gen_OP_mode"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8240
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto13 {
                        value = "w_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8168
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From71 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8336, 8400
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From5 {
                        value = "enable_outer_loop"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8424
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From15 {
                        value = "w_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8112
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From27 {
                        value = "pf_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 7992
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From69 {
                        value = "P_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 7960
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From2 {
                        value = "P_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8240
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From52 {
                        value = "dV"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7912, 7832
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From4 {
                        value = "enable_outer_loop"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8176
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From65 {
                        value = "Q_active"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8472
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From59 {
                        value = "enable_outer_loop"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7840, 8104
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto38 {
                        value = "ss_speed"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8088, 8440
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto10 {
                        value = "dw_Synch"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7048, 7832
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From7 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7576, 7688
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From60 {
                        value = "enable_outer_loop"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7944, 7664
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From8 {
                        value = "w_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7576, 7720
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From50 {
                        value = "GridFollow"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8336, 8312
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From3 {
                        value = "Vt_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7912, 7864
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto2 {
                        value = "Q_meas"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7392, 8176
                        hide_name = True
                        size = 58, 20
                    ]

                    tag From1 {
                        value = "Q_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8024
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From68 {
                        value = "w_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7840, 8192
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto15 {
                        value = "pf_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8216
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto11 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8120
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From14 {
                        value = "P_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8144
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto16 {
                        value = "Gen_control_mode"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8264
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From64 {
                        value = "Load_Share"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8336
                        hide_name = True
                        size = 0, 0
                    ]

                    junction Junction26 sp
                    [
                        position = 7456, 7928
                    ]

                    junction Junction27 sp
                    [
                        position = 7368, 7952
                    ]

                    junction Junction13 sp
                    [
                        position = 7800, 7704
                    ]

                    junction Junction14 sp
                    [
                        position = 7888, 8392
                    ]

                    junction Junction15 sp
                    [
                        position = 7800, 7704
                    ]

                    junction Junction22 sp
                    [
                        position = 7056, 8120
                    ]

                    junction Junction23 sp
                    [
                        position = 7888, 8320
                    ]

                    junction Junction25 sp
                    [
                        position = 7368, 7888
                    ]

                    connect Gen_On.in Junction22 as Connection673
                    connect Goto37 "Bus Split2.out2" as Connection584
                    connect Goto9 Junction14 as Connection599
                    connect Goto36 Junction26 as Connection721
                    connect read_OP_mode.GridFollowing Junction26 as Connection723
                    connect From61 Exciter.Q_meas as Connection634
                    connect GridForming.in Junction27 as Connection724
                    connect "pf Control.dV_out" Exciter.Delta_V_in as Connection710
                    connect From15 Freq_setpoint_control.w_ref as Connection647
                    connect Governor_and_Engine.w_meas_in Junction23 as Connection696
                    connect "Bus Split3.in" Inputs as Connection672
                    connect Goto38 check_steady_state_w.ss_speed as Connection602
                    connect Junction27 Goto34 as Connection725
                    connect From51 "Bus Join1.in2" as Connection610
                    connect Junction26 GridFollowing.in as Connection722
                    connect "pf Control.Q_control_mode" From11 as Connection549
                    connect From62 Freq_setpoint_control.P_mode as Connection653
                    connect Junction13 Exciter.Start as Connection596
                    connect Goto10 "Bus Split2.out" as Connection531
                    connect From16 "Bus Join1.in" as Connection576
                    connect read_OP_mode.GridForming Junction27 as Connection726
                    connect "Bus Split3.out" Junction22 as Connection675
                    connect Goto39 Junction15 as Connection606
                    connect Junction15 Junction13 as Connection605
                    connect From52 Exciter.dV as Connection585
                    connect From69 "pf Control.P_meas" as Connection709
                    connect read_OP_mode.enable Goto33 as Connection727
                    connect Exciter_on.in Junction15 as Connection604
                    connect From63 Freq_setpoint_control.Load_Share_on as Connection654
                    connect "pf Control.Q_meas_in" From1 as Connection552
                    connect From27 "pf Control.pf_meas" as Connection693
                    connect read_OP_mode.GCB_status "Unit Delay1.out" as Connection728
                    connect Goto12 "Bus Split3.out1" as Connection676
                    connect Goto42 "Bus Split3.out8" as Connection688
                    connect Junction22 Goto11 as Connection674
                    connect "pf Control.Pref" From12 as Connection551
                    connect From7 Start_Exciter.Gen_On as Connection589
                    connect Round1.out read_OP_mode.OP_mode as Connection729
                    connect From54 "Bus Join1.in4" as Connection612
                    connect From64 Freq_setpoint_control.Load_Share as Connection655
                    connect Junction23 Junction14 as Connection695
                    connect Freq_setpoint_control.P_ref From14 as Connection648
                    connect From3 Exciter.Vt_in as Connection179
                    connect Goto14 "Bus Split3.out3" as Connection678
                    connect Goto43 Define_control_mode.P_Control as Connection690
                    connect Meas_feedback "Bus Split1.in" as Connection712
                    connect "pf Control.enable" From47 as Connection550
                    connect From70 "pf Control.pf_ref" as Connection708
                    connect Start_Exciter.Start Junction13 as Connection595
                    connect From56 Freq_setpoint_control.w_meas as Connection650
                    connect From65 Read_Control_mode.Q_control_mode as Connection685
                    connect T_in Termination1.in as Connection166
                    connect Freq_setpoint_control.Pmeas_in From2 as Connection651
                    connect From45 Round1.in as Connection570
                    connect Goto16 "Bus Split3.out6" as Connection681
                    connect Goto44 Define_control_mode.Q_Control as Connection689
                    connect "Bus Join1.out" To_synch_check as Connection608
                    connect wmeas Junction23 as Connection694
                    connect From71 Output.Gen_On as Connection713
                    connect "Unit Delay2.out" Governor_and_Engine.GCB_status as Connection702
                    connect From58 Governor_and_Engine.P_meas as Connection697
                    connect From66 "pf Control.P_control_mode" as Connection686
                    connect "Bus Split2.in" From_synch_check as Connection205
                    connect Freq_setpoint_control.enable From4 as Connection649
                    connect From46 "Unit Delay1.in" as Connection581
                    connect "Unit Delay3.out" Exciter.GCB_status as Connection633
                    connect Goto2 "Bus Split1.out1" as Connection175
                    connect Goto45 "pf Control.Q_active" as Connection707
                    connect "Bus Split2.out1" Goto4 as Connection543
                    connect Goto35 Junction25 as Connection718
                    connect From72 Output.w_meas as Connection714
                    connect From59 "Unit Delay2.in" as Connection622
                    connect From67 Define_control_mode.Gen_Control_Mode as Connection691
                    connect "Bus Split3.out2" Goto13 as Connection677
                    connect Freq_setpoint_control.w_bias Governor_and_Engine.w_bias as Connection706
                    connect Goto46 "Bus Split1.out3" as Connection711
                    connect From49 "Bus Join1.in1" as Connection609
                    connect Goto3 "Bus Split1.out2" as Connection176
                    connect From8 Start_Exciter.w_meas as Connection590
                    connect Junction25 StandBy.in as Connection719
                    connect "Bus Split3.out4" Goto15 as Connection679
                    connect From6 Read_Control_mode.P_control_mode as Connection188
                    connect check_steady_state_w.w_meas Junction14 as Connection601
                    connect From68 Governor_and_Engine.w_ref as Connection701
                    connect From10 "Governor_and_Engine.Gen On" as Connection700
                    connect "Bus Split3.out7" Goto40 as Connection687
                    connect From5 Read_Control_mode.Enable_outer_loop as Connection187
                    connect Goto32 "Bus Split3.out5" as Connection680
                    connect From9 Governor_and_Engine.dw_synch as Connection698
                    connect read_OP_mode.StandBy Junction25 as Connection720
                    connect From50 "Bus Join1.in3" as Connection611
                    connect From60 "Unit Delay3.in" as Connection632
                    connect From13 Exciter.Vref as Connection226
                    connect Goto1 "Bus Split1.out" as Connection174
                    connect Governor_and_Engine.T_out T_out as Connection730
                    [
                        breakpoints = 8128, 8240
                    ]
                    connect Exciter.Vf_out Vf_out as Connection731
                    [
                        breakpoints = 8224, 7816
                    ]
                }
                [
                    position = 9088, 8056
                    scale = -1, 1
                    size = 208, 200
                ]

                component Subsystem Measurements {
                    layout = dynamic
                    component "core/Current Measurement" Ic {
                        addr = "26"
                        execution_rate = "Ts"
                        frequency = "10000.0"
                        sig_output = "True"
                    }
                    [
                        position = 7096, 7704
                        scale = -1, 1
                        size = 64, 32
                    ]

                    component gen_bus_join "Bus Join1" {
                        inputs = "4"
                    }
                    [
                        position = 7976, 7336
                        rotation = right
                        hide_name = True
                        scale = -1, -1
                    ]

                    component gen_probe pf {
                        addr = "17951"
                    }
                    [
                        position = 7856, 7712
                    ]

                    component Subsystem Snubber {
                        layout = dynamic
                        component pas_resistor R20 {
                            resistance = "(Vn**2/(Sb*load/100.0))*1e6/(Vn**2/(Sb*load/100.0)+1e6)"
                        }
                        [
                            position = 8304, 7944
                            rotation = right
                        ]

                        component pas_resistor R22 {
                            resistance = "(Vn**2/(Sb*load/100.0))*1e6/(Vn**2/(Sb*load/100.0)+1e6)"
                        }
                        [
                            position = 8376, 7944
                            rotation = right
                        ]

                        component pas_resistor R21 {
                            resistance = "(Vn**2/(Sb*load/100.0))*1e6/(Vn**2/(Sb*load/100.0)+1e6)"
                        }
                        [
                            position = 8232, 7944
                            rotation = right
                        ]

                        port G {
                            position = bottom:3
                            kind = pe
                        }
                        [
                            position = 8304, 8112
                            rotation = left
                        ]

                        port A {
                            position = top:4
                            kind = pe
                        }
                        [
                            position = 8232, 7848
                            rotation = right
                        ]

                        port B {
                            position = top:5
                            kind = pe
                        }
                        [
                            position = 8304, 7848
                            rotation = right
                        ]

                        port C {
                            position = top:6
                            kind = pe
                        }
                        [
                            position = 8376, 7848
                            rotation = right
                        ]

                        junction Junction1517 pe
                        [
                            position = 8304, 8032
                        ]

                        junction Junction1516 pe
                        [
                            position = 8304, 8032
                        ]

                        connect Junction1516 R21.n_node as Connection755
                        connect B R20.p_node as Connection759
                        connect G Junction1517 as Connection764
                        connect R22.p_node C as Connection760
                        connect R20.n_node Junction1516 as Connection698
                        connect A R21.p_node as Connection758
                        connect Junction1516 Junction1517 as Connection762
                        connect Junction1517 R22.n_node as Connection763
                    }
                    [
                        position = 6664, 7824
                        size = 88, 80
                    ]

                    component gen_probe P {
                        addr = "17965"
                    }
                    [
                        position = 7912, 7544
                    ]

                    component Subsystem Output {
                        layout = dynamic

                        port S {
                            position = left:10
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8440
                        ]

                        port Vt {
                            position = left:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8224
                        ]

                        port pf {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8112, 8480
                        ]

                        port Ia {
                            position = left:5
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8112, 8264
                        ]

                        port Ib {
                            position = left:6
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8296
                        ]

                        port Va {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8112, 8120
                        ]

                        port Ic {
                            position = left:7
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8112, 8336
                        ]

                        port P {
                            position = left:8
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8368
                        ]

                        port Vb {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8152
                        ]

                        port Q {
                            position = left:9
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8112, 8408
                        ]

                        port Vc {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8112, 8192
                        ]

                        tag Goto8 {
                            value = "Vb"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8152
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto16 {
                            value = "S"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8440
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto9 {
                            value = "Vc"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8192
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto17 {
                            value = "pf"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8480
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto10 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8224
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto7 {
                            value = "Va"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8120
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto11 {
                            value = "Ib"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8296
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto13 {
                            value = "Ic"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8336
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto12 {
                            value = "P"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8368
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto14 {
                            value = "Ia"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8264
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto15 {
                            value = "Q"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8408
                            hide_name = True
                            size = 0, 0
                        ]

                        connect Goto14 Ia as Connection5
                        connect Goto15 Q as Connection9
                        connect Goto17 pf as Connection11
                        connect Goto8 Vb as Connection2
                        connect Goto9 Vc as Connection3
                        connect Ib Goto11 as Connection6
                        connect P Goto12 as Connection8
                        connect S Goto16 as Connection10
                        connect Goto10 Vt as Connection4
                        connect Va Goto7 as Connection1
                        connect Goto13 Ic as Connection7
                    }
                    [
                        position = 7768, 7288
                        size = 96, 328
                    ]

                    component gen_gain Gain7 {
                        gain = "1.0/Sb"
                    }
                    [
                        position = 7792, 7648
                        hide_name = True
                    ]

                    component gen_bus_join "Bus Join3" {
                        inputs = "3"
                    }
                    [
                        position = 8080, 7792
                        rotation = right
                        hide_name = True
                        scale = -1, -1
                    ]

                    component "core/Current Measurement" Ia {
                        addr = "22"
                        execution_rate = "Ts"
                        frequency = "10000.0"
                        sig_output = "True"
                    }
                    [
                        position = 7096, 7512
                        scale = -1, 1
                        size = 64, 32
                    ]

                    component gen_probe Q {
                        addr = "17938"
                    }
                    [
                        position = 7856, 7584
                    ]

                    component gen_gain Gain9 {
                        gain = "1.0/Sb"
                    }
                    [
                        position = 7792, 7520
                        hide_name = True
                    ]

                    component gen_gain Gain8 {
                        gain = "1.0/Sb"
                    }
                    [
                        position = 7792, 7584
                        hide_name = True
                    ]

                    component "core/Voltage Measurement" Vc {
                        addr = "5"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 6944, 7776
                        rotation = right
                        size = 64, 32
                    ]

                    component "core/Voltage Measurement" Va {
                        addr = "3"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 6856, 7872
                        rotation = right
                        size = 64, 32
                    ]

                    component "core/Current Measurement" Ib {
                        addr = "24"
                        execution_rate = "Ts"
                        frequency = "10000.0"
                        sig_output = "True"
                    }
                    [
                        position = 7096, 7608
                        scale = -1, 1
                        size = 64, 32
                    ]

                    component "core/Voltage Measurement" Vb {
                        addr = "4"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 6904, 7824
                        rotation = right
                        size = 64, 32
                    ]

                    component Subsystem "PQ measure" {
                        layout = dynamic
                        component gen_PQ_transform "PQ Power Meter1" {
                        }
                        [
                            position = 8096, 8192
                        ]

                        component gen_terminator Termination2 {
                        }
                        [
                            position = 8264, 8232
                            rotation = left
                            hide_name = True
                            scale = -1, -1
                        ]

                        component gen_terminator Termination1 {
                        }
                        [
                            position = 8264, 8152
                            rotation = left
                            hide_name = True
                            scale = -1, 1
                        ]

                        port P {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8168, 8088
                            rotation = left
                            scale = -1, 1
                        ]

                        port Va {
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8016, 8088
                            rotation = right
                            scale = -1, 1
                        ]

                        port Vb {
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8120
                            rotation = right
                            scale = -1, 1
                        ]

                        port Vc {
                            position = right:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7912, 8152
                            rotation = right
                            scale = -1, 1
                        ]

                        port S {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8208, 8264
                            rotation = right
                            scale = -1, 1
                        ]

                        port Ia {
                            position = right:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7912, 8224
                            rotation = left
                            scale = -1, 1
                        ]

                        port pf {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8168, 8288
                            rotation = right
                            scale = -1, 1
                        ]

                        port Ib {
                            position = right:5
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8256
                            rotation = left
                            scale = -1, 1
                        ]

                        port Q {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8208, 8120
                            rotation = left
                            scale = -1, 1
                        ]

                        port Ic {
                            position = right:6
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8016, 8288
                            rotation = left
                            scale = -1, 1
                        ]

                        connect Va "PQ Power Meter1.va" as Connection13
                        connect Vb "PQ Power Meter1.vb" as Connection14
                        connect Vc "PQ Power Meter1.vc" as Connection15
                        connect pf "PQ Power Meter1.k_factor" as Connection12
                        connect "PQ Power Meter1.ia" Ia as Connection1
                        connect "PQ Power Meter1.ib" Ib as Connection2
                        connect "PQ Power Meter1.ic" Ic as Connection3
                        connect "PQ Power Meter1.Pdc" P as Connection4
                        connect "PQ Power Meter1.Qdc" Q as Connection5
                        connect S "PQ Power Meter1.apparent" as Connection9
                        connect Termination1.in "PQ Power Meter1.Pac" as Connection10
                        connect Termination2.in "PQ Power Meter1.Qac" as Connection11
                    }
                    [
                        position = 7568, 7616
                        scale = -1, 1
                        size = 128, 232
                    ]

                    component gen_probe S {
                        addr = "17951"
                    }
                    [
                        position = 7856, 7648
                    ]

                    component Subsystem 3ph_PLL_Gen {
                        layout = dynamic
                        component gen_terminator Term {
                        }
                        [
                            position = 8080, 8144
                            rotation = left
                            hide_name = True
                        ]

                        component Subsystem PLL {
                            layout = dynamic
                            component gen_z_domain_transfer LPF_q1 {
                                a_coeff = "[1,2*zeta*(2*np.pi*fc_w),(2*np.pi*fc_w)**2.0]"
                                b_coeff = "(2*np.pi*fc_w)**2.0"
                                domain = "S-domain"
                                init_states = "2*np.pi*f"
                                method = "Bilinear"
                            }
                            [
                                position = 8376, 7984
                                hide_name = True
                            ]

                            component Subsystem PI {
                                layout = dynamic
                                component gen_integrator Integrator1 {
                                    init_value = "2*np.pi*f"
                                    limit_lower = "-1"
                                    limit_upper = "1"
                                }
                                [
                                    position = 8200, 8400
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8328, 8488
                                    scale = -1, 1
                                ]

                                component gen_sum Sum5 {
                                    signs = "3"
                                }
                                [
                                    position = 8328, 8224
                                ]

                                component gen_gain Gain1 {
                                    gain = "2*np.pi*fc_Kd"
                                }
                                [
                                    position = 8152, 8224
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8200, 8488
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator2 {
                                    limit_lower = "-1"
                                    limit_upper = "1"
                                }
                                [
                                    position = 8112, 8304
                                    scale = -1, 1
                                ]

                                component gen_gain Ki {
                                    gain = "Ki"
                                }
                                [
                                    position = 7928, 8392
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "lowLim*2*np.pi*f/100.0"
                                    upper_limit = "upLim*2*np.pi*f/100.0"
                                }
                                [
                                    position = 8416, 8224
                                ]

                                component gen_gain Kp {
                                    gain = "Kp"
                                }
                                [
                                    position = 7928, 8136
                                ]

                                component gen_sum Sum8 {
                                    signs = "+-"
                                }
                                [
                                    position = 8032, 8224
                                ]

                                component gen_gain Kd {
                                    gain = "Kd"
                                }
                                [
                                    position = 7928, 8216
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8072, 8400
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8480, 8224
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7752, 8216
                                ]

                                junction Junction2 sp
                                [
                                    position = 8376, 8224
                                ]

                                junction Junction3 sp
                                [
                                    position = 8448, 8224
                                ]

                                junction Junction7 sp
                                [
                                    position = 8224, 8224
                                ]

                                junction Junction8 sp
                                [
                                    position = 7792, 8216
                                ]

                                junction Junction9 sp
                                [
                                    position = 7792, 8216
                                ]

                                connect Integrator1.out Sum5.in2 as Connection95
                                connect Sum5.in1 Junction7 as Connection87
                                connect Junction8 Kd.in as Connection90
                                connect Integrator2.out Sum8.in1 as Connection66
                                connect Ki.in Junction9 as Connection92
                                connect Sum6.in Junction2 as Connection46
                                connect Junction2 Limit1.in as Connection45
                                connect Sum7.in Ki.out as Connection69
                                connect Junction3 Out as Connection48
                                connect Kp.in Junction8 as Connection89
                                connect Junction7 Integrator2.in as Connection86
                                connect Sum6.in1 Junction3 as Connection49
                                connect Junction9 Junction8 as Connection93
                                connect Sum7.out Integrator1.in as Connection52
                                connect Gain1.out Junction7 as Connection85
                                connect Kb.in Sum6.out as Connection50
                                connect Kp.out Sum5.in as Connection68
                                connect Gain1.in Sum8.out as Connection61
                                connect In Junction9 as Connection94
                                connect Limit1.out Junction3 as Connection47
                                connect Kd.out Sum8.in as Connection80
                                connect Sum5.out Junction2 as Connection44
                                connect Sum7.in1 Kb.out as Connection53
                            }
                            [
                                position = 8200, 8136
                                size = 64, 48
                            ]

                            component tm_delay "Unit Delay1" {
                            }
                            [
                                position = 8432, 8224
                                rotation = right
                                hide_name = True
                            ]

                            component gen_terminator Term {
                            }
                            [
                                position = 7864, 8208
                                rotation = right
                                hide_name = True
                            ]

                            component gen_c_function integrator {
                                in_terminal_dimensions = "inherit"
                                in_terminal_dimensions_str = "in inherit"
                                in_terminal_labels = "False;"
                                init_fnc = "/*Begin code section*/
out = 0;
in = 0;
/*End code section*/"
                                no_feed_inputs = "[\'\']"
                                no_feed_outputs = "[\'\']"
                                out_terminal_dimensions = "inherit"
                                out_terminal_dimensions_str = "out inherit"
                                out_terminal_labels = "False;"
                                out_terminal_properties = "inherit out;"
                                output_fnc = "/*Begin code section*/
out += execution_rate*in;
if(in>=0.0){
    if(out >= 6.283185307179586)
    {
        out -= 6.283185307179586;
    }
}
else{
        if(out <= -6.283185307179586)
    {
        out += 6.283185307179586;
    }
}
/*End code section*/"
                            }
                            [
                                position = 8352, 8136
                                size = 0, 0
                            ]

                            component gen_z_domain_transfer LPF_q {
                                a_coeff = "[1.0/(2*np.pi*fc_q),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 7912, 8152
                                hide_name = True
                            ]

                            component gen_z_domain_transfer LPF_d {
                                a_coeff = "[1.0/(2*np.pi*fc_d),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 7856, 8120
                                hide_name = True
                            ]

                            component Subsystem ABC_dqz {
                                layout = dynamic
                                component gen_alpha_beta2d_q "alpha beta to dq" {
                                }
                                [
                                    position = 8248, 8192
                                ]

                                component gen_abc2alpha_beta "abc to alpha beta" {
                                }
                                [
                                    position = 8024, 8192
                                ]

                                port d {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8320, 8136
                                    rotation = left
                                ]

                                port A {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7952, 8104
                                    rotation = right
                                ]

                                port C {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7856, 8104
                                    rotation = right
                                ]

                                port wt {
                                    position = left:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8176, 8288
                                    rotation = left
                                ]

                                port q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8368, 8136
                                    rotation = left
                                ]

                                port z {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8288
                                    rotation = right
                                ]

                                port B {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7904, 8104
                                    rotation = right
                                ]

                                connect "alpha beta to dq.wt" wt as Connection2690
                                connect q "alpha beta to dq.q" as Connection2693
                                connect "abc to alpha beta.C" C as Connection2687
                                connect "abc to alpha beta.B" B as Connection2686
                                connect z "abc to alpha beta.gamma" as Connection2691
                                connect "abc to alpha beta.A" A as Connection2685
                                connect "abc to alpha beta.beta" "alpha beta to dq.beta" as Connection2689
                                connect d "alpha beta to dq.d" as Connection2692
                                connect "alpha beta to dq.alpha" "abc to alpha beta.alpha" as Connection2688
                            }
                            [
                                position = 7776, 8152
                                size = 48, 104
                            ]

                            component gen_rate_limiter "Rate Limiter1" {
                                falling_limit = "2*np.pi*w_fall"
                                rising_limit = "2*np.pi*w_rise"
                            }
                            [
                                position = 8304, 7984
                                hide_name = True
                            ]

                            component Subsystem Normalize {
                                layout = dynamic
                                component gen_c_function V_terminal {
                                    in_terminal_dimensions_str = "d inherit;q inherit;"
                                    in_terminal_labels = "False;False;"
                                    in_terminal_properties = "real d;inherit q;"
                                    init_fnc = "/*Begin code section*/
d = 0;
q = 0;
t = 0;
/*End code section*/"
                                    no_feed_inputs = "[u\'\']"
                                    no_feed_outputs = "[u\'\']"
                                    out_terminal_dimensions_str = "t inherit;q_pu inherit;"
                                    out_terminal_labels = "False;False;"
                                    out_terminal_properties = "real t;inherit q_pu;"
                                    output_fnc = "/*Begin code section*/
t = (powf(d,2.0)+powf(q,2.0));
t = sqrt(t);
if(t<0.1){
    q_pu = q/0.1;
}
else{
    q_pu = q/t;
}
/*End code section*/"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port Vt {
                                    position = top:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8104
                                    rotation = left
                                ]

                                port d {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8048, 8152
                                ]

                                port q {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8048, 8216
                                ]

                                port q_pu {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8352, 8200
                                ]

                                connect V_terminal.q q as Connection3
                                connect V_terminal.d d as Connection1
                                connect q_pu V_terminal.q_pu as Connection9
                                connect V_terminal.t Vt as Connection8
                            }
                            [
                                position = 8096, 8136
                                size = 64, 64
                            ]

                            port Vt {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8160, 8072
                            ]

                            port A {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7608, 8152
                                rotation = left
                            ]

                            port wt {
                                position = right:5
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8072
                            ]

                            port w {
                                position = right:4
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8448, 7984
                            ]

                            port B {
                                label = "B"
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7648, 8176
                                rotation = left
                            ]

                            port C {
                                label = "C"
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7688, 8200
                                rotation = left
                            ]

                            port d {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8032, 8024
                            ]

                            port q {
                                label = "q"
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8032, 8080
                            ]

                            junction Junction13 sp
                            [
                                position = 8264, 8136
                            ]

                            junction Junction14 sp
                            [
                                position = 7960, 8120
                            ]

                            junction Junction15 sp
                            [
                                position = 8000, 8152
                            ]

                            junction Junction6 sp
                            [
                                position = 8408, 8136
                            ]

                            connect Junction15 q as Connection261
                            connect Junction6 integrator.out as Connection195
                            connect Normalize.Vt Vt as Connection211
                            connect LPF_d.out Junction14 as Connection254
                            connect PI.Out Junction13 as Connection247
                            connect LPF_q.out Junction15 as Connection257
                            connect ABC_dqz.d LPF_d.in as Connection263
                            connect ABC_dqz.A A as Connection266
                            connect "Unit Delay1.in" Junction6 as Connection194
                            connect PI.In Normalize.q_pu as Connection244
                            connect ABC_dqz.q LPF_q.in as Connection264
                            connect ABC_dqz.B B as Connection267
                            connect w LPF_q1.out as Connection258
                            connect "Rate Limiter1.in" Junction13 as Connection260
                            connect ABC_dqz.z Term.in as Connection265
                            connect ABC_dqz.C C as Connection268
                            connect wt Junction6 as Connection196
                            connect "Unit Delay1.out" ABC_dqz.wt as Connection269
                            connect Junction13 integrator.in as Connection246
                            connect Junction14 Normalize.d as Connection253
                            connect LPF_q1.in "Rate Limiter1.out" as Connection259
                            connect Junction14 d as Connection262
                            connect Normalize.q Junction15 as Connection255

                            f = "f"
                            lowLim = "70"
                            upLim = "140"
                            w_fall = "-f/5"
                            w_rise = "f/5"

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Simple PLL with wrapped wt</span></p></body></html>"

                                Kp {
                                    label = "Proportional gain"
                                    widget = edit
                                    type = generic
                                    default_value = "100.0"
                                }

                                Ki {
                                    label = "Integral gain"
                                    widget = edit
                                    type = generic
                                    default_value = "3200.0"
                                }

                                Kd {
                                    label = "Differential gain"
                                    widget = edit
                                    type = generic
                                    default_value = "1.0"
                                }

                                fc_Kd {
                                    label = "Derivative control LPF cut-off freq."
                                    widget = edit
                                    type = generic
                                    default_value = "113.6821"
                                }

                                fc_d {
                                    label = "d channel LPF cut-off freq."
                                    widget = edit
                                    type = generic
                                    default_value = "10.0"
                                    unit = "Hz"
                                }

                                fc_q {
                                    label = "q channel LPF cut-off freq."
                                    widget = edit
                                    type = generic
                                    default_value = "10.0"
                                    unit = "Hz"
                                }

                                f {
                                    label = "Target frequency"
                                    widget = edit
                                    type = generic
                                    default_value = "60.0"
                                    unit = "Hz"
                                }

                                upLim {
                                    label = "Frequency deviation upper limit"
                                    widget = edit
                                    type = generic
                                    default_value = "10"
                                    unit = "%"
                                }

                                lowLim {
                                    label = "Frequency deviation lower limit"
                                    widget = edit
                                    type = generic
                                    default_value = "-10"
                                    unit = "%"
                                }

                                zeta {
                                    label = "w 2nd order LPF damping ratio"
                                    widget = edit
                                    type = generic
                                    default_value = "0.707"
                                }

                                fc_w {
                                    label = "w 2nd order LPF cut-off freq."
                                    widget = edit
                                    type = generic
                                    default_value = "25.0"
                                    unit = "Hz"
                                }

                                Ts {
                                    label = "Execution rate"
                                    widget = edit
                                    type = generic
                                    default_value = "Ts"
                                }

                                w_rise {
                                    label = "w Rising rate"
                                    widget = edit
                                    type = generic
                                    default_value = "0"
                                    unit = "Hz/s"
                                }

                                w_fall {
                                    label = "w Falling rate"
                                    widget = edit
                                    type = generic
                                    default_value = "0"
                                    unit = "Hz/s"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 7984, 8240
                            rotation = down
                            scale = -1, -1
                            size = 72, 152
                        ]

                        component gen_terminator Term1 {
                        }
                        [
                            position = 8112, 8184
                            rotation = left
                            hide_name = True
                        ]

                        port Vc {
                            label = "Vc"
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7896, 8296
                        ]

                        port Vt {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8136, 8240
                        ]

                        port Va {
                            label = "Va"
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7896, 8184
                        ]

                        port wt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8072, 8288
                        ]

                        port w {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8104, 8264
                        ]

                        port Vb {
                            label = "Vb"
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7896, 8240
                        ]

                        connect PLL.d Term.in as Connection4
                        connect Vb PLL.B as Connection2
                        connect PLL.C Vc as Connection3
                        connect PLL.wt wt as Connection8
                        connect PLL.Vt Vt as Connection6
                        connect Term1.in PLL.q as Connection5
                        connect PLL.A Va as Connection1
                        connect w PLL.w as Connection7
                    }
                    [
                        position = 7480, 7824
                        size = 72, 120
                    ]

                    component gen_gain Gain10 {
                        gain = "1.0*Sb*0.0625/1000"
                    }
                    [
                        position = 8096, 7392
                        hide_name = True
                    ]

                    component gen_probe "Fuel consumption" {
                        addr = "17965"
                    }
                    [
                        position = 8432, 7360
                    ]

                    component gen_sum Sum1 {
                    }
                    [
                        position = 8184, 7360
                    ]

                    component src_constant Constant1 {
                        execution_rate = "200e-6"
                        value = "7.1"
                    }
                    [
                        position = 8096, 7320
                    ]

                    component gen_gain Gain11 {
                        gain = "0.293*139"
                    }
                    [
                        position = 8320, 7432
                        hide_name = True
                    ]

                    component gen_product Product1 {
                        signs = "/*"
                    }
                    [
                        position = 8400, 7464
                    ]

                    component gen_gain Gain12 {
                        gain = "1.0*Sb/1000"
                    }
                    [
                        position = 8192, 7496
                        hide_name = True
                    ]

                    component gen_probe Efficiency {
                        addr = "17965"
                    }
                    [
                        position = 8488, 7464
                    ]

                    port a {
                        label = "a"
                        position = right:1
                        kind = pe
                    }
                    [
                        position = 7184, 7544
                        rotation = down
                    ]

                    port b {
                        label = "b"
                        position = right:2
                        kind = pe
                    }
                    [
                        position = 7184, 7632
                        rotation = down
                    ]

                    port c {
                        label = "c"
                        position = right:3
                        kind = pe
                    }
                    [
                        position = 7208, 7744
                        rotation = down
                    ]

                    port A {
                        label = "A"
                        position = left:1
                        kind = pe
                    }
                    [
                        position = 6520, 7512
                    ]

                    port B {
                        label = "B"
                        position = left:2
                        kind = pe
                    }
                    [
                        position = 6520, 7608
                    ]

                    port C {
                        label = "C"
                        position = left:3
                        kind = pe
                    }
                    [
                        position = 6520, 7704
                    ]

                    port Sync_fb {
                        position = top:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8080, 7728
                        rotation = left
                        scale = -1, 1
                    ]

                    port Control_fb {
                        position = top:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7976, 7264
                        rotation = left
                        scale = -1, 1
                    ]

                    tag From31 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7584, 7240
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto11 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7608, 7784
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto12 {
                        value = "M_Gen_Ia"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7208, 7440
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto13 {
                        value = "M_Gen_Ib"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7280, 7552
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto14 {
                        value = "M_Gen_Ic"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7224, 7672
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto15 {
                        value = "M_Gen_Vc"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7112, 7792
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto16 {
                        value = "M_Gen_Vb"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7096, 7840
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto17 {
                        value = "M_Gen_Va"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7024, 7944
                        hide_name = True
                        size = 0, 0
                    ]

                    junction Junction1497 pe
                    [
                        position = 6856, 7512
                    ]

                    junction Junction1525 pe
                    [
                        position = 6904, 7608
                    ]

                    junction Junction1528 pe
                    [
                        position = 6944, 7704
                    ]

                    junction Junction1534 pe
                    [
                        position = 6904, 7936
                    ]

                    junction Junction1535 pe
                    [
                        position = 6856, 7936
                    ]

                    junction Junction1536 pe
                    [
                        position = 6640, 7512
                    ]

                    junction Junction1537 pe
                    [
                        position = 6664, 7608
                    ]

                    junction Junction1538 pe
                    [
                        position = 6688, 7704
                    ]

                    junction Junction1539 sp
                    [
                        position = 7392, 7864
                    ]

                    junction Junction1542 sp
                    [
                        position = 7792, 7712
                    ]

                    junction Junction1543 sp
                    [
                        position = 7752, 7584
                    ]

                    junction Junction1544 sp
                    [
                        position = 7752, 7520
                    ]

                    junction Junction1545 sp
                    [
                        position = 7552, 7784
                    ]

                    junction Junction1546 sp
                    [
                        position = 7320, 7536
                    ]

                    junction Junction1547 sp
                    [
                        position = 7352, 7568
                    ]

                    junction Junction1548 sp
                    [
                        position = 7392, 7600
                    ]

                    junction Junction1551 sp
                    [
                        position = 7904, 7800
                    ]

                    junction Junction1552 sp
                    [
                        position = 7696, 7712
                    ]

                    junction Junction1553 sp
                    [
                        position = 7656, 7648
                    ]

                    junction Junction1554 sp
                    [
                        position = 7640, 7584
                    ]

                    junction Junction1555 sp
                    [
                        position = 7672, 7520
                    ]

                    junction Junction1556 sp
                    [
                        position = 7480, 7696
                    ]

                    junction Junction1557 sp
                    [
                        position = 7448, 7664
                    ]

                    junction Junction1558 sp
                    [
                        position = 7408, 7632
                    ]

                    junction Junction1559 sp
                    [
                        position = 7320, 7784
                    ]

                    junction Junction1560 sp
                    [
                        position = 7352, 7824
                    ]

                    junction Junction1561 sp
                    [
                        position = 7120, 7488
                    ]

                    junction Junction1562 sp
                    [
                        position = 7200, 7584
                    ]

                    junction Junction1563 sp
                    [
                        position = 7144, 7680
                    ]

                    junction Junction1564 sp
                    [
                        position = 6976, 7800
                    ]

                    junction Junction1565 sp
                    [
                        position = 7032, 7824
                    ]

                    junction Junction1566 sp
                    [
                        position = 6960, 7976
                    ]

                    junction Junction1567 sp
                    [
                        position = 7816, 7520
                    ]

                    junction Junction1568 sp
                    [
                        position = 8280, 7360
                    ]

                    junction Junction1569 sp
                    [
                        position = 8056, 7496
                    ]

                    connect Junction1497 Junction1536 as Connection885
                    connect B Junction1537 as Connection888
                    connect Junction1525 Ib.n_node as Connection870
                    connect Junction1528 Ic.n_node as Connection867
                    connect Q.in Gain8.out as Connection161
                    connect S.in Gain7.out as Connection192
                    connect Junction1534 Junction1535 as Connection882
                    connect Snubber.G Junction1535 as Connection884
                    connect Junction1534 Vc.n_node as Connection838
                    connect Junction1535 Va.n_node as Connection883
                    connect Snubber.A Junction1536 as Connection887
                    connect C Junction1538 as Connection891
                    connect Snubber.B Junction1537 as Connection890
                    connect Junction1536 A as Connection886
                    connect Control_fb "Bus Join1.out" as Connection912
                    connect Snubber.C Junction1538 as Connection893
                    connect Junction1537 Junction1525 as Connection889
                    connect Sync_fb "Bus Join3.out" as Connection781
                    connect Vc.p_node Junction1528 as Connection806
                    connect Junction1538 Junction1528 as Connection892
                    connect Va.p_node Junction1497 as Connection487
                    connect Vb.p_node Junction1525 as Connection833
                    connect Junction1497 Ia.n_node as Connection871
                    connect Vb.n_node Junction1534 as Connection839
                    connect Ia.p_node a as Connection218
                    connect Ib.p_node b as Connection212
                    connect From31 Output.Vt as Connection923
                    connect Ic.p_node c as Connection217
                    connect Junction1539 3ph_PLL_Gen.Vc as Connection929
                    connect pf.in Junction1542 as Connection937
                    connect "Bus Join1.in3" Junction1542 as Connection939
                    connect Junction1543 Gain8.in as Connection941
                    connect "Bus Join1.in1" Junction1543 as Connection942
                    connect Junction1544 Gain9.in as Connection944
                    connect "Bus Join1.in" Junction1544 as Connection945
                    connect 3ph_PLL_Gen.Vt Junction1545 as Connection946
                    connect Junction1545 Goto11 as Connection947
                    connect "PQ measure.Va" Junction1546 as Connection949
                    connect Output.Va Junction1546 as Connection951
                    connect "PQ measure.Vb" Junction1547 as Connection952
                    connect Output.Vb Junction1547 as Connection954
                    connect "PQ measure.Vc" Junction1548 as Connection955
                    connect Junction1548 Junction1539 as Connection956
                    connect Output.Vc Junction1548 as Connection957
                    connect "Bus Join1.in2" Junction1551 as Connection964
                    [
                        breakpoints = 7984, 7800
                    ]
                    connect Junction1551 Junction1545 as Connection965
                    [
                        breakpoints = 7552, 7800
                    ]
                    connect "Bus Join3.in2" Junction1551 as Connection966
                    [
                        breakpoints = 8096, 7928; 7904, 7928
                    ]
                    connect "PQ measure.pf" Junction1552 as Connection968
                    [
                        breakpoints = 7664, 7712
                    ]
                    connect Junction1552 Junction1542 as Connection969
                    connect Output.pf Junction1552 as Connection970
                    connect "PQ measure.S" Junction1553 as Connection971
                    connect Output.S Junction1553 as Connection973
                    connect Junction1553 Gain7.in as Connection974
                    [
                        breakpoints = 7656, 7648; 7664, 7648
                    ]
                    connect "PQ measure.Q" Junction1554 as Connection975
                    connect Output.Q Junction1554 as Connection977
                    connect Junction1543 Junction1554 as Connection978
                    [
                        breakpoints = 7752, 7584; 7664, 7584
                    ]
                    connect "PQ measure.P" Junction1555 as Connection980
                    connect Junction1555 Junction1544 as Connection981
                    [
                        breakpoints = 7664, 7520
                    ]
                    connect Output.P Junction1555 as Connection982
                    connect Junction1556 "PQ measure.Ic" as Connection984
                    connect Output.Ic Junction1556 as Connection985
                    connect Junction1557 "PQ measure.Ib" as Connection987
                    connect Output.Ib Junction1557 as Connection988
                    connect Junction1558 "PQ measure.Ia" as Connection990
                    connect Output.Ia Junction1558 as Connection991
                    connect Junction1546 Junction1559 as Connection992
                    connect Junction1547 Junction1560 as Connection995
                    connect 3ph_PLL_Gen.Vb Junction1560 as Connection998
                    [
                        breakpoints = 7352, 7824
                    ]
                    connect 3ph_PLL_Gen.Va Junction1559 as Connection999
                    [
                        breakpoints = 7320, 7784
                    ]
                    connect 3ph_PLL_Gen.w "Bus Join3.in" as Connection1016
                    [
                        breakpoints = 7648, 7824; 7680, 7824; 7680, 7856; 8064, 7856
                    ]
                    connect 3ph_PLL_Gen.wt "Bus Join3.in1" as Connection1017
                    [
                        breakpoints = 7552, 7864; 7552, 7896; 8080, 7896
                    ]
                    connect Junction1558 Junction1561 as Connection1018
                    [
                        breakpoints = 7408, 7632; 7296, 7632; 7240, 7632; 7240, 7488
                    ]
                    connect Junction1561 Ia.out as Connection1019
                    connect Goto12 Junction1561 as Connection1020
                    connect Ib.out Junction1562 as Connection1021
                    connect Junction1562 Junction1557 as Connection1022
                    [
                        breakpoints = 7328, 7664
                    ]
                    connect Goto13 Junction1562 as Connection1023
                    connect Junction1556 Junction1563 as Connection1024
                    [
                        breakpoints = 7480, 7696; 7336, 7696
                    ]
                    connect Junction1563 Ic.out as Connection1025
                    connect Goto14 Junction1563 as Connection1026
                    connect Junction1539 Junction1564 as Connection1027
                    [
                        breakpoints = 7392, 7864; 7288, 7864; 7288, 7864; 6976, 7864
                    ]
                    connect Junction1564 Vc.out as Connection1028
                    connect Goto15 Junction1564 as Connection1029
                    connect Vb.out Junction1565 as Connection1030
                    connect Junction1565 Junction1560 as Connection1031
                    connect Goto16 Junction1565 as Connection1032
                    connect Va.out Junction1566 as Connection1033
                    [
                        breakpoints = 6888, 7976
                    ]
                    connect Junction1566 Junction1559 as Connection1034
                    [
                        breakpoints = 7320, 7976
                    ]
                    connect Goto17 Junction1566 as Connection1035
                    connect P.in Junction1567 as Connection1036
                    connect Junction1567 Gain9.out as Connection1037
                    connect Sum1.out Junction1568 as Connection1043
                    connect Junction1568 "Fuel consumption.in" as Connection1044
                    connect Gain11.in Junction1568 as Connection1045
                    connect Gain11.out Product1.in as Connection1046
                    connect Constant1.out Sum1.in as Connection1047
                    connect Gain10.out Sum1.in1 as Connection1048
                    connect Gain12.out Product1.in1 as Connection1049
                    connect Gain10.in Junction1569 as Connection1050
                    connect Junction1569 Junction1567 as Connection1051
                    [
                        breakpoints = 8056, 7520; 8040, 7520
                    ]
                    connect Gain12.in Junction1569 as Connection1052
                    connect Efficiency.in Product1.out as Connection1053
                }
                [
                    position = 9248, 8320
                    scale = -1, 1
                    size = 112, 112
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 8864, 8192
                    hide_name = True
                    scale = -1, 1
                ]

                component Subsystem Sync_Check {
                    layout = dynamic
                    component gen_bus_join "Bus Join2" {
                        inputs = "3"
                    }
                    [
                        position = 8704, 8664
                        hide_name = True
                    ]

                    component gen_logic_op not {
                        operator = "NOT"
                    }
                    [
                        position = 9032, 8632
                        hide_name = True
                    ]

                    component gen_digital_probe dw_synch_ON {
                    }
                    [
                        position = 9248, 8536
                    ]

                    component gen_digital_probe Phase_match {
                    }
                    [
                        position = 8832, 8432
                        rotation = right
                    ]

                    component gen_digital_probe V_match {
                    }
                    [
                        position = 8728, 7968
                        rotation = left
                    ]

                    component gen_logic_op and2 {
                        inputs = "5"
                    }
                    [
                        position = 9120, 8576
                        rotation = left
                        hide_name = True
                    ]

                    component gen_bus_join "Bus Join" {
                        inputs = "3"
                    }
                    [
                        position = 9192, 8048
                        rotation = right
                        hide_name = True
                    ]

                    component gen_digital_probe f_match {
                    }
                    [
                        position = 8624, 8176
                        rotation = left
                    ]

                    component Subsystem Output {
                        layout = dynamic

                        port GCB_status {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8080, 8160
                        ]

                        tag Goto7 {
                            value = "GCB_status"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8200, 8160
                            hide_name = True
                            size = 0, 0
                        ]

                        connect Goto7 GCB_status as Connection630
                    }
                    [
                        position = 9392, 8624
                        size = 48, 48
                    ]

                    component gen_digital_probe Check_phase_ON {
                    }
                    [
                        position = 8592, 8440
                    ]

                    component Subsystem Calculate_dw_synch {
                        layout = dynamic
                        component sys_signal_switch "Signal switch1" {
                            threshold = "0.5"
                        }
                        [
                            position = 8456, 8120
                            hide_name = True
                        ]

                        component gen_sum Sum4 {
                        }
                        [
                            position = 8112, 8104
                            hide_name = True
                        ]

                        component gen_gain dw_K {
                            gain = "dw_K"
                        }
                        [
                            position = 8272, 8104
                        ]

                        component gen_z_domain_transfer LPF_dw {
                            a_coeff = "[1.0/(2*np.pi*1),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 8200, 8104
                        ]

                        component tm_delay "Unit Delay1" {
                        }
                        [
                            position = 8400, 8040
                            hide_name = True
                        ]

                        component src_constant zero {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8384, 8136
                        ]

                        port dw_phase {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8024, 8112
                        ]

                        port dw_synch {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8528, 8120
                        ]

                        port Activate {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8328, 8040
                        ]

                        port dw_f {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8024, 8048
                        ]

                        connect "Unit Delay1.in" Activate as Connection180
                        connect Sum4.in1 dw_phase as Connection231
                        connect dw_K.in LPF_dw.out as Connection241
                        connect zero.out "Signal switch1.in1" as Connection179
                        connect dw_synch "Signal switch1.out" as Connection177
                        connect "Unit Delay1.out" "Signal switch1.in2" as Connection181
                        connect dw_K.out "Signal switch1.in" as Connection242
                        connect Sum4.out LPF_dw.in as Connection240
                        connect dw_f Sum4.in as Connection239
                    }
                    [
                        position = 8952, 8216
                        size = 128, 208
                    ]

                    component gen_logic_op and1 {
                    }
                    [
                        position = 8464, 8440
                        hide_name = True
                    ]

                    component gen_digital_probe Speed_ss {
                    }
                    [
                        position = 9160, 8280
                        rotation = left
                    ]

                    component Subsystem Contactor_Control {
                        layout = dynamic
                        component gen_logic_op or {
                            operator = "OR"
                        }
                        [
                            position = 8072, 8400
                            hide_name = True
                        ]

                        component gen_digital_probe GCB_control {
                        }
                        [
                            position = 7872, 8136
                            rotation = left
                        ]

                        component gen_bus_split "Bus Split1" {
                            outputs = "3"
                        }
                        [
                            position = 7488, 8032
                            rotation = right
                            hide_name = True
                        ]

                        component gen_terminator Termination12 {
                        }
                        [
                            position = 8248, 8312
                            hide_name = True
                        ]

                        component gen_logic_op and {
                            inputs = "5"
                        }
                        [
                            position = 7792, 8296
                        ]

                        component gen_c_function wait_to_trip {
                            global_variables = "real time_acc;"
                            in_terminal_dimensions = "inherit;inherit"
                            in_terminal_dimensions_str = "boolean inherit;Reset inherit"
                            in_terminal_labels = "False;False;"
                            in_terminal_properties = "inherit boolean;inherit Reset;"
                            init_fnc = "/*Begin code section*/
time_acc = 0;
Trip = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "Trip inherit"
                            out_terminal_labels = "False;"
                            out_terminal_properties = "real Trip;"
                            output_fnc = "/*Begin code section*/
if(time_acc>=3.0){
    Trip = 1;
}
else{
    time_acc += execution_rate*boolean;
}
if(Reset ==1){
    time_acc = 0;
    Trip = 0;
}
/*End code section*/"
                        }
                        [
                            position = 7616, 8296
                            size = 48, 48
                        ]

                        component gen_digital_probe GCB_cmd {
                        }
                        [
                            position = 8256, 8224
                            rotation = left
                        ]

                        component src_constant Close {
                            execution_rate = "Ts"
                        }
                        [
                            position = 7992, 8248
                        ]

                        component "core/Edge Detection" "Edge Detection1" {
                        }
                        [
                            position = 7536, 8320
                            hide_name = True
                            size = 32, 32
                        ]

                        component gen_sr_ff "SR Flip Flop1" {
                        }
                        [
                            position = 8168, 8296
                            hide_name = True
                        ]

                        component gen_logic_op not {
                            operator = "NOT"
                        }
                        [
                            position = 7968, 8368
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch1" {
                            threshold = "0.5"
                        }
                        [
                            position = 8072, 8280
                            hide_name = True
                        ]

                        port ss_speed {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7728, 8200
                            rotation = right
                        ]

                        port phase_match {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 8232
                            rotation = right
                        ]

                        port Gen_on {
                            position = left:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7880, 8368
                        ]

                        port f_match {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7680, 8432
                            rotation = left
                        ]

                        port GCB {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8304, 8280
                        ]

                        port GCB_Control {
                            position = top:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7488, 7960
                            rotation = right
                        ]

                        port V_match {
                            position = left:5
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7712, 8408
                            rotation = left
                        ]

                        tag Goto31 {
                            value = "GridFollow"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7592, 8120
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto30 {
                            value = "GridForm"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7592, 8096
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From36 {
                            value = "GridFollow"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7432, 8288
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto29 {
                            value = "StandBy"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7592, 8072
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From35 {
                            value = "StandBy"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7888, 8432
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From34 {
                            value = "GridForm"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8000, 8184
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction32 sp
                        [
                            position = 8256, 8280
                        ]

                        junction Junction34 sp
                        [
                            position = 7848, 8296
                        ]

                        junction Junction35 sp
                        [
                            position = 7488, 8288
                        ]

                        connect "Signal switch1.out" "SR Flip Flop1.s_in" as Connection527
                        connect "Signal switch1.in1" Junction34 as Connection550
                        connect f_match and.in3 as Connection556
                        connect "Bus Split1.out" Goto29 as Connection542
                        connect ss_speed and.in as Connection553
                        connect GCB_cmd.in Junction32 as Connection528
                        connect Junction34 GCB_control.in as Connection551
                        connect Close.out "Signal switch1.in" as Connection129
                        connect Gen_on not.in as Connection517
                        connect Termination12.in "SR Flip Flop1.out_n" as Connection55
                        connect wait_to_trip.Reset "Edge Detection1.Out1" as Connection562
                        connect "Edge Detection1.In1" Junction35 as Connection559
                        connect V_match and.in4 as Connection557
                        connect or.out "SR Flip Flop1.r_in" as Connection501
                        connect Junction35 From36 as Connection560
                        connect Goto31 "Bus Split1.out2" as Connection544
                        connect or.in not.out as Connection499
                        connect From34 "Signal switch1.in2" as Connection534
                        connect wait_to_trip.boolean Junction35 as Connection561
                        connect and.out Junction34 as Connection552
                        connect phase_match and.in1 as Connection554
                        connect Goto30 "Bus Split1.out1" as Connection543
                        connect From35 or.in1 as Connection535
                        connect "SR Flip Flop1.out" Junction32 as Connection530
                        connect "Bus Split1.in" GCB_Control as Connection541
                        connect Junction32 GCB as Connection529
                        connect wait_to_trip.Trip and.in2 as Connection555
                    }
                    [
                        position = 9280, 8392
                        size = 176, 168
                    ]

                    component Subsystem check_f_diff {
                        layout = dynamic
                        component gen_sum Sum1 {
                            signs = "+-"
                        }
                        [
                            position = 8056, 8152
                            hide_name = True
                        ]

                        component gen_gain toPU {
                            gain = "[1.0/(2.0*f)]"
                        }
                        [
                            position = 8216, 8152
                        ]

                        component gen_probe f_diff {
                        }
                        [
                            position = 8168, 8104
                            rotation = left
                        ]

                        component gen_abs Abs3 {
                        }
                        [
                            position = 8208, 8216
                            hide_name = True
                        ]

                        component gen_gain Freq_diff {
                            gain = "delta_f/100.0"
                        }
                        [
                            position = 8208, 8256
                        ]

                        component gen_comparator Comparator1 {
                        }
                        [
                            position = 8280, 8224
                            hide_name = True
                            scale = 1, -1
                        ]

                        component src_constant Constant1 {
                            execution_rate = "Ts"
                            value = "f"
                        }
                        [
                            position = 8120, 8256
                        ]

                        component gen_z_domain_transfer LPF_dwf {
                            a_coeff = "[1.0/(2*np.pi*1),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 8128, 8152
                        ]

                        port dw_f {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8336, 8152
                        ]

                        port f_Grid {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7880, 8144
                        ]

                        port f_Gen {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7968, 8160
                        ]

                        port f_match {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8336, 8224
                        ]

                        junction Junction1 sp
                        [
                            position = 8168, 8152
                        ]

                        connect Sum1.in1 f_Gen as Connection60
                        connect Sum1.in f_Grid as Connection57
                        connect f_diff.in Junction1 as Connection56
                        connect toPU.in Junction1 as Connection40
                        connect toPU.out dw_f as Connection63
                        connect Abs3.in Junction1 as Connection7
                        connect Comparator1.in2 Abs3.out as Connection10
                        connect Comparator1.out f_match as Connection59
                        connect Constant1.out Freq_diff.in as Connection14
                        connect Freq_diff.out Comparator1.in1 as Connection17
                        connect Junction1 LPF_dwf.out as Connection61
                        connect LPF_dwf.in Sum1.out as Connection62
                    }
                    [
                        position = 8520, 8176
                        size = 144, 120
                    ]

                    component gen_bus_split "Bus Split1" {
                        outputs = "5"
                    }
                    [
                        position = 8632, 8560
                        rotation = right
                        hide_name = True
                    ]

                    component Subsystem check_phase_diff {
                        layout = dynamic
                        component src_constant One {
                            execution_rate = "Ts"
                        }
                        [
                            position = 8024, 8160
                        ]

                        component gen_product Product1 {
                        }
                        [
                            position = 8384, 7968
                            hide_name = True
                        ]

                        component gen_abs Abs2 {
                        }
                        [
                            position = 8064, 8096
                            rotation = right
                            hide_name = True
                        ]

                        component gen_c_function confine_phase {
                            in_terminal_dimensions = "inherit"
                            in_terminal_dimensions_str = "dtheta inherit"
                            in_terminal_labels = "False;"
                            in_terminal_properties = "real dtheta;"
                            init_fnc = "/*Begin code section*/
dtheta = 0;
dtheta_confined = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "dtheta_confined inherit"
                            out_terminal_labels = "False;"
                            out_terminal_properties = "real dtheta_confined;"
                            output_fnc = "/*Begin code section*/
if (dtheta > 3.14159265359) {//confine theta to +/- 2*pi;
    dtheta_confined = dtheta - 6.28318530718;
}
else{
    if (dtheta < -3.14159265359){
        dtheta_confined = dtheta + 6.28318530718;
    }
    else{
        dtheta_confined = dtheta;
    }
}
/*End code section*/"
                        }
                        [
                            position = 7744, 7976
                            size = 48, 48
                        ]

                        component gen_probe phase_diff {
                        }
                        [
                            position = 7992, 7928
                            rotation = left
                        ]

                        component gen_gain Phase_diff {
                            gain = "delta_phi*np.pi/180.0"
                        }
                        [
                            position = 8088, 8160
                        ]

                        component gen_z_domain_transfer LPF {
                            a_coeff = "[1.0/(2*np.pi*0.5),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 8032, 7976
                        ]

                        component gen_comparator Comparator2 {
                        }
                        [
                            position = 8160, 8152
                            hide_name = True
                            scale = 1, -1
                        ]

                        component Subsystem PI {
                            layout = dynamic
                            component gen_sum Sum7 {
                            }
                            [
                                position = 8088, 8224
                            ]

                            component gen_gain Kp {
                                gain = "phase_Kp"
                            }
                            [
                                position = 8032, 8168
                            ]

                            component gen_sum Sum5 {
                            }
                            [
                                position = 8320, 8224
                            ]

                            component gen_gain Kb {
                            }
                            [
                                position = 8216, 8312
                                scale = -1, 1
                            ]

                            component gen_gain Ki {
                                gain = "phase_Ki"
                            }
                            [
                                position = 7984, 8216
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "phase_lowLim"
                                upper_limit = "phase_upLim"
                            }
                            [
                                position = 8408, 8224
                            ]

                            component gen_integrator Integrator1 {
                                limit_lower = "phase_lowLim"
                                limit_upper = "phase_upLim"
                                show_reset = "either"
                            }
                            [
                                position = 8216, 8232
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8320, 8312
                                scale = -1, 1
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8224
                            ]

                            port Reset {
                                label = "Reset"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8144, 8264
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7912, 8168
                            ]

                            junction Junction2 sp
                            [
                                position = 8368, 8224
                            ]

                            junction Junction3 sp
                            [
                                position = 8440, 8224
                            ]

                            junction Junction4 sp
                            [
                                position = 7952, 8168
                            ]

                            connect Sum5.in1 Integrator1.out as Connection5
                            connect Sum5.out Junction2 as Connection44
                            connect Sum6.in Junction2 as Connection46
                            connect In Junction4 as Connection57
                            connect Sum6.in1 Junction3 as Connection49
                            connect Integrator1.reset Reset as Connection2
                            connect Sum7.out Integrator1.in as Connection52
                            connect Sum7.in1 Kb.out as Connection53
                            connect Junction2 Limit1.in as Connection45
                            connect Junction3 Out as Connection48
                            connect Junction4 Kp.in as Connection58
                            connect Kb.in Sum6.out as Connection50
                            connect Ki.in Junction4 as Connection59
                            connect Ki.out Sum7.in as Connection54
                            connect Kp.out Sum5.in as Connection55
                            connect Limit1.out Junction3 as Connection47
                        }
                        [
                            position = 8240, 7976
                            size = 64, 48
                        ]

                        component gen_probe phase_filter {
                        }
                        [
                            position = 8112, 8040
                        ]

                        component gen_gain to_pu {
                            gain = "1.0/(2*np.pi)"
                        }
                        [
                            position = 8128, 7976
                        ]

                        component gen_c_function offset_phase {
                            global_variables = "real off1;real off2;"
                            in_terminal_dimensions = "inherit"
                            in_terminal_dimensions_str = "phase inherit"
                            in_terminal_labels = "[(\'phase\', True)]"
                            in_terminal_properties = "inherit phase;"
                            init_fnc = "/*Begin code section*/
phase_out = 0;
off1 = execution_rate*6.2831853071*f;
off2 = phaseOff*3.141592653589793/180.0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "phase_out inherit"
                            out_terminal_labels = "[(\'phase_out\', True)]"
                            out_terminal_properties = "real phase_out;"
                            output_fnc = "/*Begin code section*/
phase_out = phase - off1 + off2;
/*End code section*/"
                            parameters = "real f;real phaseOff;"
                        }
                        [
                            position = 7888, 7976
                            size = 48, 48
                        ]

                        component Subsystem Counter {
                            layout = dynamic
                            component gen_c_function c_function {
                                in_terminal_dimensions = "inherit"
                                in_terminal_dimensions_str = "counter inherit"
                                in_terminal_labels = "False;"
                                in_terminal_properties = "real counter;"
                                no_feed_inputs = "[\'\']"
                                no_feed_outputs = "[\'\']"
                                out_terminal_dimensions = "inherit"
                                out_terminal_dimensions_str = "out inherit"
                                out_terminal_labels = "False;"
                                output_fnc = "/*Begin code section*/
if(counter>=0.1/execution_rate){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                            }
                            [
                                position = 8288, 8200
                                size = 48, 48
                            ]

                            component "core/Counter" Counter1 {
                            }
                            [
                                position = 8192, 8200
                                size = 48, 48
                            ]

                            component gen_logic_op not {
                                operator = "NOT"
                            }
                            [
                                position = 8104, 8248
                            ]

                            port In {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8008, 8192
                            ]

                            port Out {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8368, 8200
                            ]

                            junction Junction14 sp
                            [
                                position = 8056, 8192
                            ]

                            connect Counter1.en Junction14 as Connection559
                            connect c_function.counter Counter1.out as Connection563
                            connect c_function.out Out as Connection564
                            connect not.out Counter1.reset as Connection88
                            connect Junction14 In as Connection562
                            connect Junction14 not.in as Connection560
                        }
                        [
                            position = 8256, 8152
                            size = 48, 48
                        ]

                        port dw_phase {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8464, 7968
                        ]

                        port phase_Diff {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7592, 7968
                        ]

                        port phase_match {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8400, 8152
                        ]

                        port Activate {
                            position = bottom:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8240, 7864
                            rotation = left
                            scale = 1, -1
                        ]

                        junction Junction22 sp
                        [
                            position = 7992, 7976
                        ]

                        junction Junction15 sp
                        [
                            position = 8064, 7976
                        ]

                        junction Junction17 sp
                        [
                            position = 8064, 8040
                        ]

                        junction Junction21 sp
                        [
                            position = 8240, 7912
                        ]

                        connect Junction17 Junction15 as Connection591
                        connect Junction21 PI.Reset as Connection693
                        connect Junction21 Product1.in as Connection623
                        connect Junction22 LPF.in as Connection732
                        connect One.out Phase_diff.in as Connection15
                        connect Phase_diff.out Comparator2.in1 as Connection49
                        connect Activate Junction21 as Connection622
                        connect offset_phase.phase confine_phase.dtheta_confined as Connection734
                        connect Product1.in1 PI.Out as Connection692
                        connect Abs2.in Junction17 as Connection590
                        connect confine_phase.dtheta phase_Diff as Connection721
                        connect phase_filter.in Junction17 as Connection592
                        connect dw_phase Product1.out as Connection714
                        connect phase_diff.in Junction22 as Connection731
                        connect offset_phase.phase_out Junction22 as Connection733
                        connect Comparator2.in2 Abs2.out as Connection712
                        connect phase_match Counter.Out as Connection673
                        connect Comparator2.out Counter.In as Connection674
                        connect to_pu.in Junction15 as Connection581
                        connect Junction15 LPF.out as Connection582
                        connect to_pu.out PI.In as Connection713
                    }
                    [
                        position = 8528, 8320
                        size = 168, 112
                    ]

                    component Subsystem check_V_diff {
                        layout = dynamic
                        component gen_abs Abs4 {
                        }
                        [
                            position = 7816, 8176
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch1" {
                            threshold = "0.5"
                        }
                        [
                            position = 8432, 8160
                            hide_name = True
                        ]

                        component Subsystem PI {
                            layout = dynamic
                            component gen_integrator Integrator1 {
                                limit_lower = "-1"
                                limit_upper = "1"
                                show_reset = "either"
                            }
                            [
                                position = 8216, 8232
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 8088, 8224
                            ]

                            component gen_gain Kp {
                                gain = "V_Kp"
                            }
                            [
                                position = 8024, 8168
                            ]

                            component gen_gain Ki {
                                gain = "V_Ki"
                            }
                            [
                                position = 7976, 8216
                            ]

                            component gen_sum Sum5 {
                            }
                            [
                                position = 8320, 8224
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "V_lowLim"
                                upper_limit = "V_upLim"
                            }
                            [
                                position = 8408, 8224
                            ]

                            component gen_gain Kb {
                            }
                            [
                                position = 8216, 8312
                                scale = -1, 1
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8320, 8312
                                scale = -1, 1
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8224
                            ]

                            port Reset {
                                label = "Reset"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8144, 8264
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7888, 8168
                            ]

                            junction Junction2 sp
                            [
                                position = 8368, 8224
                            ]

                            junction Junction3 sp
                            [
                                position = 8440, 8224
                            ]

                            junction Junction4 sp
                            [
                                position = 7944, 8168
                            ]

                            connect Ki.in Junction4 as Connection60
                            connect Ki.out Sum7.in as Connection56
                            connect Kp.out Sum5.in as Connection55
                            connect Limit1.out Junction3 as Connection47
                            connect Sum5.in1 Integrator1.out as Connection5
                            connect In Junction4 as Connection58
                            connect Sum5.out Junction2 as Connection44
                            connect Sum6.in1 Junction3 as Connection49
                            connect Sum6.in Junction2 as Connection46
                            connect Sum7.out Integrator1.in as Connection52
                            connect Integrator1.reset Reset as Connection2
                            connect Kb.in Sum6.out as Connection50
                            connect Sum7.in1 Kb.out as Connection53
                            connect Junction2 Limit1.in as Connection45
                            connect Junction3 Out as Connection48
                            connect Junction4 Kp.in as Connection59
                        }
                        [
                            position = 8272, 8144
                            size = 64, 48
                        ]

                        component gen_gain pu {
                            gain = "1.0/(Vn/((3.0/2.0)**0.5))"
                        }
                        [
                            position = 8128, 8144
                        ]

                        component gen_comparator Comparator1 {
                        }
                        [
                            position = 8336, 8224
                            hide_name = True
                            scale = 1, -1
                        ]

                        component gen_abs Abs3 {
                        }
                        [
                            position = 8264, 8216
                            hide_name = True
                        ]

                        component gen_logic_op and {
                        }
                        [
                            position = 8048, 8248
                            hide_name = True
                        ]

                        component tm_delay "Unit Delay1" {
                        }
                        [
                            position = 8144, 8064
                            hide_name = True
                        ]

                        component gen_rel_op greater_equal {
                            relational_op = ">="
                        }
                        [
                            position = 7960, 8272
                            hide_name = True
                        ]

                        component src_constant one1 {
                            execution_rate = "Ts"
                        }
                        [
                            position = 7752, 8224
                        ]

                        component gen_rel_op less_equal {
                            relational_op = "<="
                        }
                        [
                            position = 7960, 8216
                            hide_name = True
                        ]

                        component gen_gain pu1 {
                            gain = "1.0/(Vn/((3.0/2.0)**0.5))"
                        }
                        [
                            position = 7880, 8176
                            hide_name = True
                        ]

                        component src_constant zero {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8360, 8176
                            hide_name = True
                        ]

                        component gen_gain Vgrid_upLim {
                            gain = "1.1"
                        }
                        [
                            position = 7864, 8224
                        ]

                        component gen_gain Volt_diff {
                            gain = "delta_V/100.0"
                        }
                        [
                            position = 8264, 8256
                        ]

                        component gen_sum Sum1 {
                            signs = "+-"
                        }
                        [
                            position = 8056, 8144
                            hide_name = True
                        ]

                        component gen_gain Vgrid_lowLim {
                            gain = "0.9"
                        }
                        [
                            position = 7864, 8280
                        ]

                        port Grid_On {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8128, 8248
                        ]

                        port Vgrid {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7712, 8136
                        ]

                        port Vgen {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7968, 8152
                        ]

                        port dV {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8496, 8160
                        ]

                        port Activate {
                            position = top:auto
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8064, 8064
                        ]

                        port V_match {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8400, 8224
                        ]

                        junction Junction5 sp
                        [
                            position = 7776, 8136
                        ]

                        junction Junction4 sp
                        [
                            position = 8272, 8064
                        ]

                        junction Junction6 sp
                        [
                            position = 7912, 8208
                        ]

                        junction Junction7 sp
                        [
                            position = 7816, 8224
                        ]

                        junction Junction2 sp
                        [
                            position = 8168, 8144
                        ]

                        junction Junction8 sp
                        [
                            position = 7800, 8224
                        ]

                        connect pu.in Sum1.out as Connection198
                        connect V_match Comparator1.out as Connection187
                        connect dV "Signal switch1.out" as Connection181
                        connect Grid_On and.out as Connection241
                        connect Sum1.in Junction5 as Connection225
                        connect less_equal.out and.in as Connection228
                        connect Junction5 Vgrid as Connection226
                        connect Vgrid_lowLim.in Junction7 as Connection240
                        connect Abs4.out pu1.in as Connection235
                        connect greater_equal.in Junction6 as Connection233
                        connect PI.Reset Junction4 as Connection220
                        connect pu1.out Junction6 as Connection236
                        connect Junction2 pu.out as Connection201
                        connect PI.Out "Signal switch1.in" as Connection214
                        connect Junction6 less_equal.in as Connection232
                        connect Vgrid_lowLim.out greater_equal.in1 as Connection237
                        connect Sum1.in1 Vgen as Connection60
                        connect Abs3.in Junction2 as Connection202
                        connect greater_equal.out and.in1 as Connection229
                        connect Activate "Unit Delay1.in" as Connection208
                        connect Vgrid_upLim.out less_equal.in1 as Connection234
                        connect Volt_diff.out Comparator1.in1 as Connection17
                        connect Junction7 Vgrid_upLim.in as Connection239
                        connect "Signal switch1.in2" Junction4 as Connection218
                        connect zero.out "Signal switch1.in1" as Connection179
                        connect Junction4 "Unit Delay1.out" as Connection219
                        connect Abs4.in Junction5 as Connection227
                        connect Comparator1.in2 Abs3.out as Connection10
                        connect PI.In Junction2 as Connection242
                        [
                            breakpoints = 8168, 8144
                        ]
                        connect one1.out Junction8 as Connection243
                        connect Junction8 Junction7 as Connection244
                        connect Volt_diff.in Junction8 as Connection245
                        [
                            breakpoints = 8232, 8344; 8088, 8344
                        ]
                    }
                    [
                        position = 8520, 8016
                        size = 144, 120
                    ]

                    component Subsystem PLLs {
                        layout = dynamic
                        component gen_gain Gain1 {
                            gain = "1.0/(2*np.pi)"
                        }
                        [
                            position = 8128, 8208
                            hide_name = True
                        ]

                        component gen_probe V_grid {
                        }
                        [
                            position = 8296, 8096
                        ]

                        component gen_bus_split split {
                            outputs = "3"
                        }
                        [
                            position = 8096, 7936
                            rotation = right
                            hide_name = True
                        ]

                        component Subsystem PLL_Grid {
                            layout = dynamic
                            component gen_z_domain_transfer LPF_f {
                                a_coeff = "[1.0/(2*np.pi*fc_f),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 8216, 8248
                            ]

                            component gen_terminator Term1 {
                            }
                            [
                                position = 8128, 8152
                                rotation = left
                                hide_name = True
                            ]

                            component gen_z_domain_transfer LPF_Vt {
                                a_coeff = "[1.0/(2*np.pi*fc_vt),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 8328, 8224
                            ]

                            component Subsystem PLL {
                                layout = dynamic
                                component gen_terminator Term {
                                }
                                [
                                    position = 8008, 8216
                                    rotation = right
                                ]

                                component gen_gain rads_to_Hz {
                                    gain = "1/(2*np.pi)"
                                }
                                [
                                    position = 8360, 8056
                                ]

                                component Subsystem ABC_dqz {
                                    layout = dynamic
                                    component gen_abc2alpha_beta "abc to alpha beta" {
                                    }
                                    [
                                        position = 8024, 8192
                                    ]

                                    component gen_alpha_beta2d_q "alpha beta to dq" {
                                    }
                                    [
                                        position = 8248, 8192
                                    ]

                                    port C {
                                        position = left:3
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7856, 8104
                                        rotation = right
                                    ]

                                    port z {
                                        position = right:3
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8096, 8288
                                        rotation = right
                                    ]

                                    port B {
                                        position = left:2
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7904, 8104
                                        rotation = right
                                    ]

                                    port d {
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8320, 8136
                                        rotation = left
                                    ]

                                    port wt {
                                        position = left:4
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8176, 8288
                                        rotation = left
                                    ]

                                    port A {
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7952, 8104
                                        rotation = right
                                    ]

                                    port q {
                                        position = right:2
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8368, 8136
                                        rotation = left
                                    ]

                                    connect z "abc to alpha beta.gamma" as Connection2691
                                    connect "abc to alpha beta.C" C as Connection2687
                                    connect "abc to alpha beta.A" A as Connection2685
                                    connect d "alpha beta to dq.d" as Connection2692
                                    connect "abc to alpha beta.B" B as Connection2686
                                    connect "alpha beta to dq.wt" wt as Connection2690
                                    connect "alpha beta to dq.alpha" "abc to alpha beta.alpha" as Connection2688
                                    connect q "alpha beta to dq.q" as Connection2693
                                    connect "abc to alpha beta.beta" "alpha beta to dq.beta" as Connection2689
                                }
                                [
                                    position = 7912, 8152
                                    size = 48, 104
                                ]

                                component gen_c_function integrator {
                                    global_variables = "real out;"
                                    in_terminal_dimensions_str = "in inherit;"
                                    in_terminal_labels = "False;"
                                    init_fnc = "/*Begin code section*/
out = 0;
in = 0;
/*End code section*/"
                                    no_feed_inputs = "[u\'\']"
                                    no_feed_outputs = "[u\'\']"
                                    out_terminal_dimensions_str = "output inherit;"
                                    out_terminal_labels = "False;"
                                    out_terminal_properties = "inherit output;"
                                    output_fnc = "/*Begin code section*/
output = out+0.0;
/*End code section*/"
                                    parameters = "real Ts;"
                                    update_fnc = "/*Begin code section*/
out += Ts*in;

if(in>=0.0){
    if(out >= 6.283185307179586)
    {
        out -= 6.283185307179586;
    }
}
else{
        if(out <= -6.283185307179586)
    {
        out += 6.283185307179586;
    }
}
/*End code section*/"
                                }
                                [
                                    position = 8424, 8136
                                    size = 0, 0
                                ]

                                component tm_delay "Unit Delay1" {
                                }
                                [
                                    position = 8480, 8272
                                    rotation = right
                                ]

                                component Subsystem PI {
                                    layout = dynamic
                                    component gen_gain Kb {
                                        gain = "1000"
                                    }
                                    [
                                        position = 8200, 8304
                                        scale = -1, 1
                                    ]

                                    component gen_sum Sum6 {
                                        signs = "-+"
                                    }
                                    [
                                        position = 8304, 8304
                                        hide_name = True
                                        scale = -1, 1
                                    ]

                                    component gen_sum Sum7 {
                                    }
                                    [
                                        position = 8072, 8216
                                        hide_name = True
                                    ]

                                    component gen_sum Sum8 {
                                    }
                                    [
                                        position = 8272, 8176
                                        hide_name = True
                                    ]

                                    component gen_limiter Limit1 {
                                        lower_limit = "0.7*2*np.pi*f"
                                        upper_limit = "1.4*2*np.pi*f"
                                    }
                                    [
                                        position = 8416, 8176
                                        hide_name = True
                                    ]

                                    component gen_integrator Integrator1 {
                                        init_value = "[2*np.pi*f]"
                                    }
                                    [
                                        position = 8176, 8216
                                        hide_name = True
                                    ]

                                    component gen_gain Ki {
                                        gain = "Ki"
                                    }
                                    [
                                        position = 7960, 8208
                                    ]

                                    component gen_gain Kp {
                                        gain = "Kp"
                                    }
                                    [
                                        position = 8088, 8144
                                    ]

                                    port In {
                                        position = right:auto
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7840, 8144
                                        rotation = down
                                        scale = -1, 1
                                    ]

                                    port Out {
                                        position = left:auto
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8544, 8176
                                        rotation = down
                                        scale = -1, 1
                                    ]

                                    junction Junction161 sp
                                    [
                                        position = 7904, 8144
                                    ]

                                    junction Junction162 sp
                                    [
                                        position = 8368, 8176
                                    ]

                                    junction Junction163 sp
                                    [
                                        position = 8456, 8176
                                    ]

                                    connect Sum8.out Junction162 as Connection368
                                    connect Junction161 Ki.in as Connection359
                                    connect Junction161 Kp.in as Connection358
                                    connect Junction163 Out as Connection372
                                    connect Junction162 Limit1.in as Connection369
                                    connect Kb.in Sum6.out as Connection50
                                    connect Kp.out Sum8.in as Connection350
                                    connect Limit1.out Junction163 as Connection371
                                    connect Sum6.in Junction162 as Connection370
                                    connect Sum6.in1 Junction163 as Connection373
                                    connect Junction161 In as Connection360
                                    connect Sum7.out Integrator1.in as Connection365
                                    connect Sum7.in1 Kb.out as Connection53
                                    connect Sum7.in Ki.out as Connection364
                                    connect Integrator1.out Sum8.in1 as Connection352
                                }
                                [
                                    position = 8256, 8136
                                    scale = -1, -1
                                    size = 48, 48
                                ]

                                component Subsystem Normalize {
                                    layout = dynamic
                                    component gen_c_function V_terminal {
                                        in_terminal_dimensions_str = "d inherit;q inherit;"
                                        in_terminal_labels = "False;False;"
                                        in_terminal_properties = "real d;inherit q;"
                                        init_fnc = "/*Begin code section*/
d = 0;
q = 0;
t = 0;
/*End code section*/"
                                        no_feed_inputs = "[u\'\']"
                                        no_feed_outputs = "[u\'\']"
                                        out_terminal_dimensions_str = "t inherit;q_pu inherit;"
                                        out_terminal_labels = "False;False;"
                                        out_terminal_properties = "real t;inherit q_pu;"
                                        output_fnc = "/*Begin code section*/
t = (powf(d,2.0)+powf(q,2.0));
t = sqrt(t);
if(t<0.1){
    q_pu = q/0.1;
}
else{
    q_pu = q/t;
}
/*End code section*/"
                                    }
                                    [
                                        position = 8192, 8192
                                        size = 0, 0
                                    ]

                                    port Vt {
                                        position = top:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8280, 8104
                                        rotation = left
                                    ]

                                    port d {
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8048, 8152
                                    ]

                                    port q {
                                        position = left:2
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8048, 8216
                                    ]

                                    port q_pu {
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8352, 8200
                                    ]

                                    connect q_pu V_terminal.q_pu as Connection9
                                    connect V_terminal.t Vt as Connection8
                                    connect V_terminal.d d as Connection1
                                    connect V_terminal.q q as Connection3
                                }
                                [
                                    position = 8128, 8136
                                    size = 64, 64
                                ]

                                port B {
                                    label = "B"
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7776, 8176
                                    rotation = left
                                ]

                                port C {
                                    label = "C"
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7816, 8200
                                    rotation = left
                                ]

                                port d {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8056, 8008
                                ]

                                port q {
                                    label = "q"
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8056, 8056
                                ]

                                port Vt {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8192, 8064
                                ]

                                port wt {
                                    position = right:5
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8528, 8136
                                ]

                                port A {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7736, 8152
                                    rotation = left
                                ]

                                port f {
                                    position = right:4
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8424, 8056
                                ]

                                junction Junction6 sp
                                [
                                    position = 8008, 8120
                                ]

                                junction Junction7 sp
                                [
                                    position = 8024, 8152
                                ]

                                junction Junction4 sp
                                [
                                    position = 8480, 8136
                                ]

                                junction Junction5 sp
                                [
                                    position = 8320, 8136
                                ]

                                connect Junction4 "Unit Delay1.in" as Connection213
                                connect Junction5 integrator.in as Connection218
                                connect Junction7 Normalize.q as Connection227
                                [
                                    position = 0, 0
                                ]
                                connect Junction6 d as Connection224
                                [
                                    position = 0, 0
                                ]
                                connect Normalize.d Junction6 as Connection223
                                connect PI.Out Junction5 as Connection219
                                connect PI.In Normalize.q_pu as Connection220
                                connect ABC_dqz.z Term.in as Connection229
                                connect "Unit Delay1.out" ABC_dqz.wt as Connection230
                                connect ABC_dqz.C C as Connection231
                                connect f rads_to_Hz.out as Connection199
                                connect Vt Normalize.Vt as Connection184
                                connect integrator.output Junction4 as Connection214
                                connect ABC_dqz.A A as Connection233
                                connect ABC_dqz.d Junction6 as Connection225
                                connect q Junction7 as Connection226
                                connect ABC_dqz.q Junction7 as Connection228
                                connect wt Junction4 as Connection212
                                connect rads_to_Hz.in Junction5 as Connection217
                                connect B ABC_dqz.B as Connection232

                                f = "f"

                                mask {
                                    description = "Simple PLL with wrapped wt"

                                    Kp {
                                        label = "Proportional gain"
                                        widget = edit
                                        type = generic
                                        default_value = "100"
                                    }

                                    Ki {
                                        label = "Integral gain"
                                        widget = edit
                                        type = generic
                                        default_value = "3200"
                                    }

                                    f {
                                        label = "Target frequency"
                                        widget = edit
                                        type = generic
                                        default_value = "60"
                                        unit = "Hz"
                                    }

                                    Ts {
                                        label = "Execution rate"
                                        widget = edit
                                        type = generic
                                        default_value = "Ts"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                        
                                    ENDCODE
                                }
                            }
                            [
                                position = 8048, 8224
                                rotation = down
                                scale = -1, -1
                                size = 64, 136
                            ]

                            component gen_terminator Term {
                            }
                            [
                                position = 8104, 8112
                                rotation = left
                                hide_name = True
                            ]

                            port Va {
                                label = "Va"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7928, 8176
                            ]

                            port Vb {
                                label = "Vb"
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7928, 8224
                            ]

                            port Vc {
                                label = "Vc"
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7928, 8272
                            ]

                            port Vt {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8392, 8224
                            ]

                            port f {
                                label = "f"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8248
                            ]

                            port wt {
                                label = "wt"
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8152, 8272
                            ]

                            connect f LPF_f.out as Connection9
                            connect wt PLL.wt as Connection6
                            connect LPF_Vt.in PLL.Vt as Connection12
                            connect LPF_f.in PLL.f as Connection10
                            connect PLL.A Va as Connection1
                            connect PLL.C Vc as Connection3
                            connect Term.in PLL.d as Connection7
                            connect Term1.in PLL.q as Connection8
                            connect Vb PLL.B as Connection2
                            connect Vt LPF_Vt.out as Connection11

                            fc_f = "10.0"
                            fc_vt = "10.0"

                            mask {
                                fc_vt {
                                    label = "Vt channel LPF cut-off freq."
                                    widget = edit
                                    type = generic
                                    default_value = "0"
                                }

                                fc_f {
                                    label = "f channel LPF cut-off freq."
                                    widget = edit
                                    type = generic
                                    default_value = "0"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 8184, 8024
                            size = 72, 120
                        ]

                        component gen_probe wt_gen {
                        }
                        [
                            position = 8464, 8280
                        ]

                        component gen_probe wt_grid {
                        }
                        [
                            position = 8464, 8144
                        ]

                        component gen_probe V_gen {
                        }
                        [
                            position = 8216, 8352
                        ]

                        component gen_bus_split split1 {
                            outputs = "3"
                        }
                        [
                            position = 8072, 8360
                            rotation = left
                            hide_name = True
                        ]

                        component gen_sum Sum1 {
                            signs = "+-"
                        }
                        [
                            position = 8464, 8216
                            hide_name = True
                        ]

                        port Vgen {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8216, 8288
                        ]

                        port V_Grid {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 7888
                        ]

                        port V_Gen {
                            label = "V_Gen"
                            position = left:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 8416
                        ]

                        port f_Gen {
                            label = "f_Gen"
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8216, 8208
                        ]

                        port "Phase diff" {
                            position = right:6
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8544, 8216
                        ]

                        port f_Grid {
                            label = "f_Grid"
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8360, 7984
                        ]

                        port Vgrid {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8360, 8064
                        ]

                        tag From2 {
                            value = "wt_grid"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8352, 8208
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto2 {
                            value = "wt_grid"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8288, 8024
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction15 sp
                        [
                            position = 8400, 8208
                        ]

                        junction Junction23 sp
                        [
                            position = 8264, 8064
                        ]

                        junction Junction27 sp
                        [
                            position = 8400, 8248
                        ]

                        junction Junction28 sp
                        [
                            position = 8160, 8288
                        ]

                        connect Gain1.in split1.out as Connection349
                        connect split1.in V_Gen as Connection348
                        connect Junction23 V_grid.in as Connection329
                        connect wt_grid.in Junction15 as Connection272
                        connect split1.out1 Junction27 as Connection353
                        connect Junction28 V_gen.in as Connection356
                        connect wt_gen.in Junction27 as Connection351
                        connect PLL_Grid.wt Goto2 as Connection294
                        connect Junction15 Sum1.in as Connection271
                        connect split1.out2 Junction28 as Connection357
                        connect PLL_Grid.Vt Junction23 as Connection328
                        connect PLL_Grid.Vb split.out1 as Connection324
                        connect "Phase diff" Sum1.out as Connection336
                        connect V_Grid split.in as Connection134
                        connect Vgen Junction28 as Connection355
                        connect Vgrid Junction23 as Connection330
                        connect f_Grid PLL_Grid.f as Connection327
                        connect From2 Junction15 as Connection270
                        connect split.out2 PLL_Grid.Vc as Connection322
                        connect Junction27 Sum1.in1 as Connection352
                        connect Gain1.out f_Gen as Connection342
                        connect split.out PLL_Grid.Va as Connection325
                    }
                    [
                        position = 8288, 8136
                        size = 104, 360
                    ]

                    port V_grid {
                        position = left:11
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8184, 7976
                    ]

                    port GCB {
                        position = bottom:auto
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 9464, 8392
                    ]

                    port To_Gen_Control {
                        position = right:11
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 9248, 8104
                    ]

                    port From_Gen_Control {
                        position = right:12
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8512, 8512
                    ]

                    port V_gen {
                        position = right:13
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8184, 8296
                    ]

                    tag Goto20 {
                        value = "GCB_status"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 9480, 8352
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto31 {
                        value = "Activate"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 9176, 8512
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto36 {
                        value = "Grid_On"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8656, 8056
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From45 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8920, 8672
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto25 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8736, 8608
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From41 {
                        value = "GCB_status"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9088, 7968
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto22 {
                        value = "f_match"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8680, 8216
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From30 {
                        value = "f_match"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8368, 8432
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto34 {
                        value = "ss_speed"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8736, 8744
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From44 {
                        value = "GCB_control"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9280, 8240
                        rotation = right
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From50 {
                        value = "V_match"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9104, 8456
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto29 {
                        value = "GCB_control"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8792, 8664
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From37 {
                        value = "f_match"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9104, 8392
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From56 {
                        value = "GCB_status"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9296, 8624
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From52 {
                        value = "ss_speed"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8920, 8720
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From53 {
                        value = "Activate"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8368, 8472
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From46 {
                        value = "GridFollow"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8920, 8696
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From40 {
                        value = "ss_speed"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9104, 8328
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From49 {
                        value = "dV"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9088, 7992
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto30 {
                        value = "GridFollow"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8736, 8720
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto32 {
                        value = "dV"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8736, 7920
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From55 {
                        value = "Grid_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8920, 8744
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From39 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9104, 8424
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto28 {
                        value = "dw_synch"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 9120, 8216
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From42 {
                        value = "dw_synch"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9088, 7944
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From47 {
                        value = "Activate"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8824, 8216
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From33 {
                        value = "GCB_status"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8920, 8632
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto33 {
                        value = "V_match"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8784, 8016
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From48 {
                        value = "Activate"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8456, 7936
                        hide_name = True
                        size = 0, 0
                    ]

                    junction Junction39 sp
                    [
                        position = 9120, 8536
                    ]

                    junction Junction40 sp
                    [
                        position = 8728, 8016
                    ]

                    junction Junction42 sp
                    [
                        position = 9160, 8328
                    ]

                    junction Junction43 sp
                    [
                        position = 8616, 8680
                    ]

                    junction Junction45 sp
                    [
                        position = 8720, 8360
                    ]

                    junction Junction46 sp
                    [
                        position = 8528, 8440
                    ]

                    junction Junction26 sp
                    [
                        position = 9424, 8392
                    ]

                    junction Junction35 sp
                    [
                        position = 8624, 8216
                    ]

                    connect From53 and1.in1 as Connection585
                    connect and1.in From30 as Connection273
                    connect From55 and2.in4 as Connection609
                    connect and2.in1 From45 as Connection553
                    connect From56 Output.GCB_status as Connection625
                    connect and2.in2 From46 as Connection554
                    connect GCB Junction26 as Connection141
                    connect and2.in not.out as Connection552
                    connect Goto20 Junction26 as Connection143
                    connect check_V_diff.Vgen PLLs.Vgen as Connection565
                    connect check_V_diff.Vgrid PLLs.Vgrid as Connection566
                    connect Goto29 "Bus Join2.out" as Connection540
                    connect Goto30 Junction43 as Connection605
                    connect "Bus Join2.in1" "Bus Split1.out2" as Connection601
                    connect Goto31 Junction39 as Connection561
                    connect check_f_diff.f_match Junction35 as Connection284
                    connect "Bus Join2.in" "Bus Split1.out1" as Connection600
                    connect Goto33 Junction40 as Connection571
                    connect check_f_diff.f_Grid PLLs.f_Grid as Connection278
                    connect Goto34 "Bus Split1.out4" as Connection606
                    connect "Bus Join2.in2" Junction43 as Connection603
                    connect Goto36 check_V_diff.Grid_On as Connection608
                    connect check_f_diff.f_Gen PLLs.f_Gen as Connection277
                    connect Junction26 Contactor_Control.GCB as Connection204
                    connect "Bus Split1.in" From_Gen_Control as Connection598
                    connect "Bus Split1.out" Goto25 as Connection546
                    connect check_phase_diff.phase_match Junction45 as Connection620
                    connect check_phase_diff.Activate Junction46 as Connection624
                    connect Check_phase_ON.in Junction46 as Connection622
                    connect check_phase_diff.phase_Diff "PLLs.Phase diff" as Connection621
                    connect Contactor_Control.ss_speed Junction42 as Connection594
                    connect Contactor_Control.phase_match Junction45 as Connection618
                    connect From37 Contactor_Control.f_match as Connection270
                    connect From39 Contactor_Control.Gen_on as Connection271
                    connect From40 Junction42 as Connection596
                    connect From41 "Bus Join.in1" as Connection528
                    connect From42 "Bus Join.in" as Connection527
                    connect Junction35 Goto22 as Connection283
                    connect dw_synch_ON.in Junction39 as Connection563
                    connect Junction39 and2.out as Connection562
                    connect f_match.in Junction35 as Connection282
                    connect Junction40 check_V_diff.V_match as Connection572
                    connect not.in From33 as Connection551
                    connect Junction42 Speed_ss.in as Connection595
                    connect Junction43 "Bus Split1.out3" as Connection604
                    connect From44 Contactor_Control.GCB_Control as Connection541
                    connect Junction45 Phase_match.in as Connection619
                    connect From47 Calculate_dw_synch.Activate as Connection556
                    connect Junction46 and1.out as Connection623
                    connect From48 check_V_diff.Activate as Connection586
                    connect To_Gen_Control "Bus Join.out" as Connection259
                    connect From49 "Bus Join.in2" as Connection569
                    connect V_gen PLLs.V_Gen as Connection587
                    connect From50 Contactor_Control.V_match as Connection574
                    connect V_grid PLLs.V_Grid as Connection588
                    connect From52 and2.in3 as Connection584
                    connect V_match.in Junction40 as Connection573
                    connect Goto32 check_V_diff.dV as Connection626
                    [
                        breakpoints = 8664, 7976; 8608, 7976
                    ]
                    connect Calculate_dw_synch.dw_f check_f_diff.dw_f as Connection627
                    [
                        breakpoints = 8744, 8136
                    ]
                    connect check_phase_diff.dw_phase Calculate_dw_synch.dw_phase as Connection628
                    [
                        breakpoints = 8744, 8296
                    ]
                    connect Goto28 Calculate_dw_synch.dw_synch as Connection629
                    [
                        breakpoints = 9120, 8216; 9056, 8216
                    ]
                }
                [
                    position = 9448, 8056
                    scale = -1, 1
                    size = 144, 200
                ]

                component "core/Synchronous Machine with Wound Rotor" Gen {
                    Jm = "J"
                    Llfd = "Llfd_prime"
                    Llkd = "Llkd"
                    Llkq = "Llkq"
                    Lls = "Lls"
                    Lmd = "Lmd"
                    Lmq = "Lmq"
                    Ns_div_Nfd = "Ns_Nfd"
                    Ns_div_Nkd = "Ns_Nkd"
                    Ns_div_Nkq = "Ns_Nkq"
                    Rf = "Rf_prime"
                    Rkd = "Rkd"
                    Rkq = "Rkq"
                    Rs = "Rs"
                    el_torque_out_addr = "8200"
                    enb_sig_out = "True"
                    execution_rate = "Ts"
                    friction_coeff = "F"
                    load_src = "Model"
                    me_speed_out_addr = "8202"
                    pms = "pms"
                    res_int_carr_f = "5000.0"
                }
                [
                    position = 8984, 8320
                    scale = -1, 1
                    size = 176, 160
                ]

                component Subsystem Ggrid_meas {
                    layout = dynamic
                    component "core/Voltage Measurement" Vb {
                        addr = "4"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 8296, 8216
                        rotation = right
                        size = 64, 32
                    ]

                    component Subsystem Snubber {
                        layout = dynamic
                        component pas_resistor R1 {
                            resistance = "1e5"
                        }
                        [
                            position = 8120, 8144
                            rotation = right
                        ]

                        component pas_resistor R2 {
                            resistance = "1e5"
                        }
                        [
                            position = 8192, 8144
                            rotation = right
                        ]

                        component pas_resistor R3 {
                            resistance = "1e5"
                        }
                        [
                            position = 8264, 8144
                            rotation = right
                        ]

                        port C {
                            position = top:3
                            kind = pe
                        }
                        [
                            position = 8264, 8064
                            rotation = right
                        ]

                        port A {
                            position = top:1
                            kind = pe
                        }
                        [
                            position = 8120, 8064
                            rotation = right
                        ]

                        port G {
                            position = bottom:1
                            kind = pe
                        }
                        [
                            position = 8192, 8296
                            rotation = left
                        ]

                        port B {
                            position = top:2
                            kind = pe
                        }
                        [
                            position = 8192, 8064
                            rotation = right
                        ]

                        junction Junction1491 pe
                        [
                            position = 8192, 8248
                        ]

                        junction Junction1490 pe
                        [
                            position = 8192, 8248
                        ]

                        connect Junction1490 R1.n_node as Connection395
                        connect G Junction1491 as Connection403
                        connect R3.p_node C as Connection398
                        connect R2.p_node B as Connection397
                        connect R1.p_node A as Connection399
                        connect Junction1491 Junction1490 as Connection402
                        connect R3.n_node Junction1491 as Connection401
                        connect R2.n_node Junction1490 as Connection385
                    }
                    [
                        position = 8104, 8248
                        size = 64, 48
                    ]

                    component gen_bus_join "Bus Join1" {
                        inputs = "3"
                    }
                    [
                        position = 8648, 8120
                        rotation = left
                    ]

                    component "core/Voltage Measurement" Vc {
                        addr = "5"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 8336, 8168
                        rotation = right
                        size = 64, 32
                    ]

                    component "core/Voltage Measurement" Va {
                        addr = "3"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 8248, 8264
                        rotation = right
                        size = 64, 32
                    ]

                    port b {
                        position = right:2
                        kind = pe
                    }
                    [
                        position = 8504, 8016
                        rotation = down
                    ]

                    port a {
                        position = right:1
                        kind = pe
                    }
                    [
                        position = 8504, 7912
                        rotation = down
                    ]

                    port c {
                        position = right:3
                        kind = pe
                    }
                    [
                        position = 8504, 8120
                        rotation = down
                    ]

                    port V {
                        position = top:auto
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8648, 8048
                        rotation = left
                    ]

                    port A {
                        position = left:1
                        kind = pe
                    }
                    [
                        position = 7952, 7912
                    ]

                    port B {
                        position = left:2
                        kind = pe
                    }
                    [
                        position = 7952, 8008
                    ]

                    port C {
                        position = left:3
                        kind = pe
                    }
                    [
                        position = 7960, 8112
                    ]

                    junction Junction1536 pe
                    [
                        position = 8296, 8016
                    ]

                    junction Junction1537 pe
                    [
                        position = 8248, 7912
                    ]

                    junction Junction1538 pe
                    [
                        position = 8248, 8336
                    ]

                    junction Junction1534 pe
                    [
                        position = 8296, 8336
                    ]

                    junction Junction1535 pe
                    [
                        position = 8336, 8120
                    ]

                    junction Junction1539 pe
                    [
                        position = 8088, 7912
                    ]

                    junction Junction1540 pe
                    [
                        position = 8104, 8016
                    ]

                    junction Junction1541 pe
                    [
                        position = 8120, 8120
                    ]

                    connect Snubber.G Junction1538 as Connection860
                    connect V "Bus Join1.out" as Connection366
                    connect Va.p_node Junction1537 as Connection857
                    connect Vb.n_node Junction1534 as Connection839
                    connect Vb.p_node Junction1536 as Connection854
                    connect c Junction1535 as Connection849
                    connect Junction1534 Junction1538 as Connection858
                    connect Vc.p_node Junction1535 as Connection851
                    connect Junction1534 Vc.n_node as Connection838
                    connect Junction1536 b as Connection853
                    connect Junction1537 a as Connection856
                    connect Junction1538 Va.n_node as Connection859
                    connect Junction1537 Junction1539 as Connection893
                    [
                        breakpoints = 8248, 7912
                    ]
                    connect Junction1539 Snubber.A as Connection894
                    [
                        breakpoints = 8088, 7912; 8088, 7912; 8088, 7912
                    ]
                    connect A Junction1539 as Connection895
                    connect Snubber.B Junction1540 as Connection896
                    connect Junction1540 Junction1536 as Connection897
                    [
                        breakpoints = 8104, 8016; 8104, 8016; 8104, 8016
                    ]
                    connect B Junction1540 as Connection898
                    connect Junction1535 Junction1541 as Connection899
                    [
                        breakpoints = 8336, 8120; 8336, 8120
                    ]
                    connect Junction1541 Snubber.C as Connection900
                    [
                        breakpoints = 8120, 8120; 8120, 8120; 8120, 8120
                    ]
                    connect C Junction1541 as Connection901
                    connect "Bus Join1.in" Va.out as Connection902
                    connect "Bus Join1.in1" Vb.out as Connection903
                    connect "Bus Join1.in2" Vc.out as Connection904
                }
                [
                    position = 9600, 8320
                    scale = -1, 1
                    size = 56, 232
                ]

                component "core/Signal Controlled Voltage Source" Vfd {
                }
                [
                    position = 8672, 8328
                    rotation = right
                    scale = -1, 1
                    size = 64, 32
                ]

                component "core/Triple Pole Single Throw Contactor" MCB {
                    ctrl_src = "Model"
                }
                [
                    position = 9448, 8320
                    scale = -1, 1
                    size = 64, 256
                ]

                component Subsystem Output {
                    layout = dynamic
                    component gen_bus_join "Bus Join1" {
                        inputs = "14"
                    }
                    [
                        position = 8040, 8216
                        rotation = down
                        hide_name = True
                        scale = -1, -1
                    ]

                    port Output {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8112, 8216
                    ]

                    tag From33 {
                        value = "w_meas"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7656, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From29 {
                        value = "Q"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7896, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From32 {
                        value = "GCB_status"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7680, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From31 {
                        value = "Vt"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7776, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From27 {
                        value = "pf"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7944, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From23 {
                        value = "Vb"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From34 {
                        value = "Gen_On"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7632, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From26 {
                        value = "Ic"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7848, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From22 {
                        value = "Vc"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7752, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From28 {
                        value = "S"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7920, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From30 {
                        value = "P"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7872, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From24 {
                        value = "Ia"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7800, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From25 {
                        value = "Va"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7704, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From21 {
                        value = "Ib"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7824, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto1 {
                        value = "Disel_gen_P"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8064, 8400
                    ]

                    junction Junction1 sp
                    [
                        position = 7968, 8272
                    ]

                    connect From32 "Bus Join1.in2" as Connection578
                    connect "Bus Join1.out" Output as Connection4
                    connect From21 "Bus Join1.in8" as Connection572
                    connect From22 "Bus Join1.in5" as Connection569
                    connect From27 "Bus Join1.in13" as Connection577
                    connect From29 "Bus Join1.in11" as Connection575
                    connect From34 "Bus Join1.in" as Connection579
                    connect From26 "Bus Join1.in9" as Connection573
                    connect From28 "Bus Join1.in12" as Connection576
                    connect From31 "Bus Join1.in6" as Connection570
                    connect From23 "Bus Join1.in4" as Connection568
                    connect From24 "Bus Join1.in7" as Connection571
                    connect From33 "Bus Join1.in1" as Connection580
                    connect From25 "Bus Join1.in3" as Connection567
                    connect From30 Junction1 as Connection581
                    connect Junction1 "Bus Join1.in10" as Connection582
                    connect Goto1 Junction1 as Connection583
                    [
                        breakpoints = 7968, 8400; 7968, 8272
                    ]
                }
                [
                    position = 9696, 7968
                    size = 104, 96
                ]

                port B {
                    position = 180.0, -0.1
                    kind = pe
                    direction =  out
                }
                [
                    position = 9728, 8320
                    scale = -1, 1
                ]

                port A {
                    position = 180.0, -96.0
                    kind = pe
                    direction =  out
                }
                [
                    position = 9728, 8224
                    scale = -1, 1
                ]

                port C {
                    position = 180.0, 96.0
                    kind = pe
                    direction =  out
                }
                [
                    position = 9728, 8416
                    scale = -1, 1
                ]

                port Inputs {
                    position = -152.0, -120.0
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 9088, 7896
                    rotation = right
                    scale = -1, 1
                ]

                port Outputs {
                    position = 152.0, -120.0
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9816, 7920
                    rotation = left
                ]

                connect Measurements.B MCB.b_out as Connection613
                connect Sync_Check.V_gen Measurements.Sync_fb as Connection636
                connect B Ggrid_meas.B as Connection670
                connect Gen.b_in Measurements.b as Connection318
                connect Measurements.C MCB.c_out as Connection614
                connect Termination1.in Gen.angle_out as Connection674
                connect C Ggrid_meas.C as Connection671
                connect Gen.a_in Measurements.a as Connection324
                connect Measurements.A MCB.a_out as Connection612
                connect Vfd.in Control.Vf_out as Connection649
                connect Control.T_in Gen.torque_out as Connection609
                connect Ggrid_meas.b MCB.b_in as Connection481
                connect Output.Output Outputs as Connection667
                connect Control.T_out Gen.load_in as Connection611
                connect Ggrid_meas.c MCB.c_in as Connection483
                connect Sync_Check.To_Gen_Control Control.From_synch_check as Connection672
                connect Control.To_synch_check Sync_Check.From_Gen_Control as Connection673
                connect Ggrid_meas.a MCB.a_in as Connection479
                connect Sync_Check.V_grid Ggrid_meas.V as Connection638
                connect Inputs Control.Inputs as Connection668
                connect Gen.speed_out Control.wmeas as Connection608
                connect Gen.c_in Measurements.c as Connection323
                connect Sync_Check.GCB MCB.ctrl_in as Connection637
                connect A Ggrid_meas.A as Connection669
                connect Measurements.Control_fb Control.Meas_feedback as Connection500
                connect Gen.r_2 Vfd.n_node as Connection676
                [
                    breakpoints = 8800, 8408
                ]
                connect Vfd.p_node Gen.r_1 as Connection677

                F = "F_gen1"
                J = "J_gen1"
                K = "10"
                Ka = "1"
                Llfd_prime = "0.0151"
                Llkd = "Llkd_gen1"
                Llkq = "Llkq_gen1"
                Lls = "Lls_gen1"
                Lmd = "Lmd_gen1"
                Lmq = "Lmq_gen1"
                Ns_Nfd = "1"
                Rf_prime = "0.0464"
                Rkd = "Rkd_gen1"
                Rkq = "Rkq_gen1"
                Rs = "Rs_gen1"
                Sb = "1.067e6"
                Ts = "Ts"
                Vn = "4160"
                delta_phi = "4.5"
                f = "60"
                phaseOff = "0.0"
                pms = "2"

                mask {
                    icon = "image(\'diesel_genset.svg\')"
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Diesel Genset with synchronous machine, DEGOV governor, DC4B exciter, frequency setpoint control for w and P, power factor control loop and synch check with grid to close GCB contactor.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">The number of variable inputs to this block is 9 and they must be sent through a Bus Join in the following order: 0 - Gen_On; 1 - Vref; 2 - wref; 3 - Pref; 4 - pf_ref; 5 - Gen_OP_mode; 6 - Gen_Control_Mode; 7 - Load_share_on; 8 - Load_share.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">                                                                                                                                                                                                                                                                                                                                                                                                                                    </span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">The number of outputs of this block is 14 and they are arranged in the following order: 0 - Gen_On; 1 - wmeas; 2 - GCB_status; 3 - Va; 4 - Vb; 5 - Vc; 6 - Vt; 7 - Ia; 8 - Ib; 9 - Ic; 10 - P; 11 - Q; 12 - S; 13 - pf.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">                                                                                                                                                                                    </span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Adjustment of the shunt snubber load is important for simulation stability in multiple time steps.</span></p></body></html>"
                    help_file = "diesel_genset.html"

                    Sb {
                        label = "Nominal Power"
                        widget = edit
                        type = generic
                        default_value = "2.2e6"
                        unit = "VA"
                        group = "1 - Basic"
                    }

                    Vn {
                        label = "Phase Nominal Voltage"
                        widget = edit
                        type = generic
                        default_value = "480.0"
                        unit = "V (line to line)"
                        group = "1 - Basic"
                    }

                    f {
                        label = "Nominal electrical frequency"
                        widget = edit
                        type = generic
                        default_value = "60.0"
                        unit = "Hz"
                        group = "1 - Basic"
                    }

                    load {
                        label = "Shunt snubber load percentage of nominal power"
                        widget = edit
                        type = generic
                        default_value = "5"
                        unit = "%"
                        group = "1 - Basic"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "200e-6"
                        unit = "s"
                        group = "1 - Basic"
                    }

                    Rs {
                        label = "Rs"
                        widget = edit
                        type = generic
                        default_value = "9.4035e-4"
                        unit = "Ω"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Lls {
                        label = "Lls"
                        widget = edit
                        type = generic
                        default_value = "1.389e-5"
                        unit = "H"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Lmd {
                        label = "Lmd"
                        widget = edit
                        type = generic
                        default_value = "6.5282e-4"
                        unit = "H"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Lmq {
                        label = "Lmq"
                        widget = edit
                        type = generic
                        default_value = "4.778e-4"
                        unit = "H"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Rf_prime {
                        label = "Rf"
                        widget = edit
                        type = generic
                        default_value = "2.1574e-4"
                        unit = "Ω"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Llfd_prime {
                        label = "Llfd"
                        widget = edit
                        type = generic
                        default_value = "1.4195e-4"
                        unit = "H"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Rkd {
                        label = "Rkd"
                        widget = edit
                        type = generic
                        default_value = "0.0443938909091"
                        unit = "Ω"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Rkq {
                        label = "Rkq"
                        widget = edit
                        type = generic
                        default_value = "0.00399796363636"
                        unit = "Ω"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Llkd {
                        label = "Llkd"
                        widget = edit
                        type = generic
                        default_value = "0.00155586168397"
                        unit = "H"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Llkq {
                        label = "Llkq"
                        widget = edit
                        type = generic
                        default_value = "9.96738215238e-05"
                        unit = "H"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Ns_Nfd {
                        label = "Ns/Nfd"
                        widget = edit
                        type = generic
                        default_value = "0.02512"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Ns_Nkd {
                        label = "Ns/Nkd"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Ns_Nkq {
                        label = "Ns/Nkq"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "2 - Synch. mach. - Elec."
                    }

                    pms {
                        label = "pms"
                        widget = edit
                        type = generic
                        default_value = "2.0"
                        group = "3- Synch. mach. - Mec."
                    }

                    J {
                        label = "Jm"
                        widget = edit
                        type = generic
                        default_value = "42.9467"
                        unit = "kg.m²"
                        group = "3- Synch. mach. - Mec."
                    }

                    F {
                        label = "Friction coefficient"
                        widget = edit
                        type = generic
                        default_value = "0.572003113298"
                        unit = "Nms"
                        group = "3- Synch. mach. - Mec."
                    }

                    T1 {
                        label = "Electric control box time constant 1"
                        widget = edit
                        type = generic
                        default_value = "1.0e-4"
                        unit = "s"
                        group = "4 - Gov. and Eng."
                    }

                    T2 {
                        label = "Electric control box time constant 2"
                        widget = edit
                        type = generic
                        default_value = "1e-6"
                        unit = "s"
                        group = "4 - Gov. and Eng."
                    }

                    T3 {
                        label = "Electric control box time constant 3"
                        widget = edit
                        type = generic
                        default_value = "0.5001"
                        unit = "s"
                        group = "4 - Gov. and Eng."
                    }

                    K {
                        label = "Actuator gain K"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "4 - Gov. and Eng."
                    }

                    T4 {
                        label = "Actuator time constant 4"
                        widget = edit
                        type = generic
                        default_value = "25.0e-3"
                        unit = "s"
                        group = "4 - Gov. and Eng."
                    }

                    T5 {
                        label = "Actuator time constant 5"
                        widget = edit
                        type = generic
                        default_value = "9.0e-4"
                        unit = "s"
                        group = "4 - Gov. and Eng."
                    }

                    T6 {
                        label = "Actuator time constant 6"
                        widget = edit
                        type = generic
                        default_value = "5.74e-3"
                        unit = "s"
                        group = "4 - Gov. and Eng."
                    }

                    Pm0 {
                        label = "Initial mechanical power"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        unit = "pu"
                        group = "4 - Gov. and Eng."
                    }

                    Tmax {
                        label = "Maximum torque limit"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "pu"
                        group = "4 - Gov. and Eng."
                    }

                    Tmin {
                        label = "Minimum torque limit"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        unit = "pu"
                        group = "4 - Gov. and Eng."
                    }

                    Td {
                        label = "Engine time delay"
                        widget = edit
                        type = generic
                        default_value = "24.0e-3"
                        unit = "s"
                        group = "4 - Gov. and Eng."
                    }

                    Tr {
                        label = "Time constant Tr"
                        widget = edit
                        type = generic
                        default_value = "2.0e-6"
                        unit = "s"
                        group = "5 - Exciter"
                    }

                    exc_Kp {
                        label = "Exciter PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "0.025"
                        group = "5 - Exciter"
                    }

                    exc_Ki {
                        label = "Exciter PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "0.007"
                        group = "5 - Exciter"
                    }

                    Ka {
                        label = "Major regulator gain Ka"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "5 - Exciter"
                    }

                    Ta {
                        label = "Major regulator time constant Ta"
                        widget = edit
                        type = generic
                        default_value = "2.0e-3"
                        unit = "s"
                        group = "5 - Exciter"
                    }

                    Vrmax {
                        label = "Saturation upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        unit = "pu"
                        group = "5 - Exciter"
                    }

                    Vrmin {
                        label = "Saturation lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        unit = "pu"
                        group = "5 - Exciter"
                    }

                    Te {
                        label = "Exciter time constant Te"
                        widget = edit
                        type = generic
                        default_value = "1.0e-8"
                        unit = "s"
                        group = "5 - Exciter"
                    }

                    Ke {
                        label = "Exciter gain Ke"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "5 - Exciter"
                    }

                    Kf {
                        label = "Stabilization feedback gain Kf"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "5 - Exciter"
                    }

                    Tf {
                        label = "Stabilization feedback time constant Tf"
                        widget = edit
                        type = generic
                        default_value = "2.0e-6"
                        unit = "s"
                        group = "5 - Exciter"
                    }

                    Vt0 {
                        label = "Initial terminal voltage"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        unit = "pu"
                        group = "5 - Exciter"
                    }

                    Vf0 {
                        label = "Initial field voltage"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        unit = "pu"
                        group = "5 - Exciter"
                    }

                    Efmax {
                        label = "Exciter saturation upper limit"
                        widget = edit
                        type = generic
                        default_value = "[\'inf\']"
                        unit = "pu"
                        group = "5 - Exciter"
                    }

                    Efmin {
                        label = "Exciter saturation lower limit"
                        widget = edit
                        type = generic
                        default_value = "[\'-inf\']"
                        unit = "pu"
                        group = "5 - Exciter"
                    }

                    delta_f {
                        label = "Synch Check - accepted frequency difference"
                        widget = edit
                        type = generic
                        default_value = "0.5"
                        unit = "%"
                        group = "6 - Adv. 1"
                    }

                    delta_phi {
                        label = "Synch Check - Accepted phase difference"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        unit = "°"
                        group = "6 - Adv. 1"
                    }

                    phase_Kp {
                        label = "Synck Check - Phase PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "6 - Adv. 1"
                    }

                    phase_Ki {
                        label = "Synch Check - Phase PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.00012"
                        group = "6 - Adv. 1"
                    }

                    phase_upLim {
                        label = "Synch Check - Phase PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "6 - Adv. 1"
                    }

                    phase_lowLim {
                        label = "Synch Check - Phase PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-0.1"
                        group = "6 - Adv. 1"
                    }

                    phaseOff {
                        label = "Synch Check - Phase calibration"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "°"
                        group = "6 - Adv. 1"
                    }

                    dw_K {
                        label = "Synch Check - delta w gain"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "6 - Adv. 1"
                    }

                    V_Kp {
                        label = "Synck Check - Voltage PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.0071"
                        group = "6 - Adv. 1"
                    }

                    V_Ki {
                        label = "Synck Check - Voltage PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.0354"
                        group = "6 - Adv. 1"
                    }

                    V_upLim {
                        label = "Synck Check - Voltage PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "1"
                        group = "6 - Adv. 1"
                    }

                    V_lowLim {
                        label = "Synck Check - Voltage PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1"
                        group = "6 - Adv. 1"
                    }

                    delta_V {
                        label = "Synck Check - Accepted voltage difference"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        unit = "%"
                        group = "6 - Adv. 1"
                    }

                    w_sp_Kp {
                        label = "Frequency setpoint loop - PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "7 - Adv. 2"
                    }

                    w_sp_Ki {
                        label = "Frequency setpoint loop - PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "7 - Adv. 2"
                    }

                    w_sp_upLim {
                        label = "Frequency setpoint loop - PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "pu"
                        group = "7 - Adv. 2"
                    }

                    w_sp_lowLim {
                        label = "Frequency setpoint loop - PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        unit = "pu"
                        group = "7 - Adv. 2"
                    }

                    P_droop {
                        label = "Frequency setpoint loop - P droop"
                        widget = edit
                        type = generic
                        default_value = "2.7"
                        group = "7 - Adv. 2"
                    }

                    P_rise {
                        label = "Frequency setpoint loop - P rising rate"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "pu/s"
                        group = "7 - Adv. 2"
                    }

                    P_fall {
                        label = "Frequency setpoint loop - P falling rate"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        unit = "pu/s"
                        group = "7 - Adv. 2"
                    }

                    w_droop {
                        label = "Frequency setpoint loop - w droop"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "7 - Adv. 2"
                    }

                    w_rise {
                        label = "Frequency setpoint loop - w rising rate"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "pu/s"
                        group = "7 - Adv. 2"
                    }

                    w_fall {
                        label = "Frequency setpoint loop - w falling rate"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        unit = "pu/s"
                        group = "7 - Adv. 2"
                    }

                    gov_Kp {
                        label = "Governor - Proportional gain Kp"
                        widget = edit
                        type = generic
                        default_value = "0.5"
                        group = "7 - Adv. 2"
                    }

                    delta_wn {
                        label = "Governor - Accepted nominal speed difference"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        unit = "%"
                        group = "7 - Adv. 2"
                    }

                    inner_w_droop {
                        label = "Governor - inner w droop"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "7 - Adv. 2"
                    }

                    inner_w_rise {
                        label = "Governor - inner w rise"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "pu/s"
                        group = "7 - Adv. 2"
                    }

                    inner_w_fall {
                        label = "Governor - inner w fall"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        unit = "pu/s"
                        group = "7 - Adv. 2"
                    }

                    pf_Kp {
                        label = "Power factor loop - PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.05"
                        group = "8 - Adv. 3"
                    }

                    pf_Ki {
                        label = "Power factor loop - PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.075"
                        group = "8 - Adv. 3"
                    }

                    pf_upLim {
                        label = "Power factor loop - PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "10"
                        group = "8 - Adv. 3"
                    }

                    pf_lowLim {
                        label = "Power factor loop - PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        group = "8 - Adv. 3"
                    }

                    pf_rise {
                        label = "Power factor loop - pf rising rate"
                        widget = edit
                        type = generic
                        default_value = "10"
                        group = "8 - Adv. 3"
                    }

                    pf_fall {
                        label = "Power factor loop - pf falling rate"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        group = "8 - Adv. 3"
                    }

                    exc_dwn {
                        label = "Exciter - start speed"
                        widget = edit
                        type = generic
                        default_value = "75"
                        unit = "%"
                        group = "8 - Adv. 3"
                    }

                    V_rise {
                        label = "Exciter - V rising rate"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "pu/s"
                        group = "8 - Adv. 3"
                    }

                    V_fall {
                        label = "Exciter - V falling rate"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        unit = "pu/s"
                        group = "8 - Adv. 3"
                    }

                    V_inner_droop {
                        label = "Exciter - V inner droop"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "8 - Adv. 3"
                    }

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'diesel_genset.svg')
                    ENDCODE

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 8240, 8496
                size = 354, 240
            ]

            port A {
                position = right:1
                kind = pe
                direction =  out
            }
            [
                position = 8520, 8400
                rotation = down
            ]

            port from_PCC {
                position = top:2
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7352, 7976
            ]

            port toPCC {
                position = top:3
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8592, 8320
            ]

            port B {
                position = right:2
                kind = pe
                direction =  out
            }
            [
                position = 8520, 8496
                rotation = down
            ]

            port C {
                position = right:3
                kind = pe
                direction =  out
            }
            [
                position = 8520, 8592
                rotation = down
            ]

            port from_PMS {
                position = top:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7352, 7912
            ]

            tag Goto3 {
                value = "wref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7672, 8072
                hide_name = True
            ]

            tag From2 {
                value = "pf_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7920, 8024
                hide_name = True
            ]

            tag Goto4 {
                value = "Pref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7672, 8152
                hide_name = True
            ]

            tag From3 {
                value = "Pref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7920, 7992
                hide_name = True
            ]

            tag From4 {
                value = "wref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7920, 7960
                hide_name = True
            ]

            tag From5 {
                value = "Vref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7920, 7928
                hide_name = True
            ]

            tag Goto1 {
                value = "opMode"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7672, 7912
                hide_name = True
            ]

            tag From1 {
                value = "opMode"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7920, 8056
                hide_name = True
            ]

            tag Goto2 {
                value = "Vref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7672, 7992
                hide_name = True
            ]

            tag Goto5 {
                value = "pf_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7672, 8232
                hide_name = True
            ]

            connect Goto3 Interface.w_ref as Connection908
            connect toPCC split.ON as Connection178
            connect Goto5 Interface.pf as Connection906
            connect From4 "Bus Join3.in2" as Connection913
            connect Goto4 Interface.P as Connection907
            connect wref.out Interface.wref as Connection903
            connect Pref.out Interface.Pref as Connection898
            connect From2 "Bus Join3.in4" as Connection911
            connect Load_share.out "Bus Join3.in8" as Connection826
            connect From3 "Bus Join3.in3" as Connection912
            connect "Bus Join3.in1" From5 as Connection914
            connect from_PMS Interface.fromPMS as Connection895
            connect Qref.out Interface.Qref as Connection899
            connect Termination1.in Gen_OP_mode.out as Connection918
            connect Goto2 Interface.V_ref as Connection909
            connect Goto1 Interface.opMode as Connection905
            connect Gen_Control_Mode.out "Bus Join3.in6" as Connection235
            connect Vref.out Interface.Vref as Connection904
            connect Gen_On.out "Bus Join3.in" as Connection230
            connect from_PCC Interface.fromPCC as Connection894
            connect Load_share_on.out "Bus Join3.in7" as Connection825
            connect From1 "Bus Join3.in5" as Connection910
            connect Diesel_Gen.Inputs "Bus Join3.out" as Connection928
            connect Diesel_Gen.A A as Connection932
            connect Diesel_Gen.B B as Connection933
            connect Diesel_Gen.C C as Connection934
            connect split.In Diesel_Gen.Outputs as Connection935
            [
                breakpoints = 8392, 8320; 8392, 8320; 8392, 8320
            ]

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Diesel Genset.</p></body></html>"

                CODE define_icon
                    mdl.set_component_icon_image(item_handle, 'diesel_genset.svg', rotate="no_rotate")
                ENDCODE

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 8088, 8656
            rotation = left
            size = 160, 160
        ]

        component Subsystem C_Fuel-Cell {
            layout = dynamic
            component "core/Three Phase Core Coupling" "Core Coupling 1" {
            }
            [
                position = 8160, 7896
                scale = -1, 1
                size = 12, 256
            ]

            component Subsystem "RC Snubber" {
                layout = dynamic
                component pas_capacitor C2 {
                    capacitance = "C"
                }
                [
                    position = 8192, 8240
                    rotation = right
                ]

                component pas_resistor R2 {
                    resistance = "R"
                }
                [
                    position = 8192, 8144
                    rotation = right
                ]

                component pas_resistor R1 {
                    resistance = "R"
                }
                [
                    position = 8120, 8144
                    rotation = right
                ]

                component pas_resistor R3 {
                    resistance = "R"
                }
                [
                    position = 8264, 8144
                    rotation = right
                ]

                component pas_capacitor C3 {
                    capacitance = "C"
                }
                [
                    position = 8264, 8240
                    rotation = right
                ]

                component pas_capacitor C1 {
                    capacitance = "C"
                }
                [
                    position = 8120, 8240
                    rotation = right
                ]

                port N {
                    position = bottom:2
                    kind = pe
                }
                [
                    position = 8192, 8320
                    rotation = left
                ]

                port A {
                    position = top:1
                    kind = pe
                }
                [
                    position = 8120, 8064
                    rotation = right
                ]

                port B {
                    position = top:2
                    kind = pe
                }
                [
                    position = 8192, 8064
                    rotation = right
                ]

                port C {
                    position = top:3
                    kind = pe
                }
                [
                    position = 8264, 8064
                    rotation = right
                ]

                junction Junction1 pe
                [
                    position = 8192, 8288
                ]

                junction Junction2 pe
                [
                    position = 8192, 8288
                ]

                connect C2.n_node Junction1 as Connection18
                connect C2.p_node R2.n_node as Connection24
                connect C3.n_node Junction2 as Connection23
                connect Junction1 N as Connection19
                connect Junction2 Junction1 as Connection22
                connect R1.p_node A as Connection13
                connect R2.p_node B as Connection15
                connect R3.p_node C as Connection16
                connect R3.n_node C3.p_node as Connection25
                connect C1.n_node Junction2 as Connection21
                connect C1.p_node R1.n_node as Connection10
                connect C1.p_node R1.n_node as Connection11
                connect C1.p_node R1.n_node as Connection9

                C = "50e-6"
                R = "0.2"

                mask {
                    R {
                        label = "R"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "ohms"
                        group = "General"
                    }

                    C {
                        label = "C"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "F"
                        group = "General"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 8280, 8040
                size = 64, 48
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 7760, 7800
                rotation = down
                scale = -1, 1
            ]

            port b {
                position = right:4
                kind = pe
            }
            [
                position = 8376, 7896
                scale = -1, 1
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 8376, 7800
                scale = -1, 1
            ]

            port C {
                position = left:3
                kind = pe
            }
            [
                position = 7760, 7992
                rotation = down
                scale = -1, 1
            ]

            port c {
                position = right:6
                kind = pe
            }
            [
                position = 8376, 7992
                scale = -1, 1
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 7760, 7896
                rotation = down
                scale = -1, 1
            ]

            junction Junction1 pe
            [
                position = 8264, 7800
            ]

            junction Junction2 pe
            [
                position = 8280, 7896
            ]

            junction Junction3 pe
            [
                position = 8296, 7992
            ]

            connect A "Core Coupling 1.a_out" as Connection44
            connect B "Core Coupling 1.b_out" as Connection45
            connect C "Core Coupling 1.c_out" as Connection46
            connect a Junction1 as Connection50
            connect Junction1 "Core Coupling 1.a_in" as Connection51
            [
                breakpoints = 8256, 7800
            ]
            connect "RC Snubber.A" Junction1 as Connection52
            connect b Junction2 as Connection53
            connect Junction2 "Core Coupling 1.b_in" as Connection54
            [
                breakpoints = 8272, 7896
            ]
            connect "RC Snubber.B" Junction2 as Connection55
            connect "Core Coupling 1.c_in" Junction3 as Connection56
            connect Junction3 c as Connection57
            [
                breakpoints = 8288, 7992
            ]
            connect "RC Snubber.C" Junction3 as Connection58
        }
        [
            position = 8224, 8928
            rotation = right
            scale = -1, 1
            size = 48, 160
        ]

        component Subsystem "Load 75 %" {
            layout = dynamic
            component pas_resistor R1 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8096, 8224
                rotation = right
            ]

            component "core/Current Measurement" Ia3 {
                execution_rate = "Ts_Var"
                sig_output = "True"
            }
            [
                position = 8288, 8128
                rotation = right
                size = 64, 32
            ]

            component pas_inductor L1 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8096, 8320
                rotation = right
            ]

            component pas_inductor L3 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8288, 8320
                rotation = right
            ]

            component pas_resistor R3 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8288, 8224
                rotation = right
            ]

            component pas_resistor R2 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8192, 8224
                rotation = right
            ]

            component "core/Current Measurement" Ia1 {
                execution_rate = "Ts_Var"
                sig_output = "True"
            }
            [
                position = 8096, 8080
                rotation = right
                size = 64, 32
            ]

            component "core/Current Measurement" Ia2 {
                execution_rate = "Ts_Var"
                sig_output = "True"
            }
            [
                position = 8192, 8096
                rotation = right
                size = 64, 32
            ]

            component "core/Triple Pole Single Throw Contactor" S1 {
            }
            [
                position = 8192, 8000
                rotation = right
                size = 64, 256
            ]

            component pas_inductor L2 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8192, 8320
                rotation = right
            ]

            component gen_terminator Termination1 {
            }
            [
                position = 8632, 7960
                rotation = left
                hide_name = True
                scale = -1, 1
            ]

            component gen_probe "72 KW" {
                addr = "17965"
            }
            [
                position = 8576, 7928
            ]

            component gen_terminator Termination2 {
            }
            [
                position = 8632, 8040
                rotation = left
                hide_name = True
                scale = -1, -1
            ]

            component gen_probe pf {
                addr = "17951"
            }
            [
                position = 8584, 8072
            ]

            component gen_PQ_transform "PQ Power Meter1" {
            }
            [
                position = 8480, 8008
            ]

            component gen_probe S {
                addr = "17951"
            }
            [
                position = 8584, 8024
            ]

            component gen_probe Q {
                addr = "17938"
            }
            [
                position = 8680, 7928
            ]

            port B {
                position = top:2
                kind = pe
            }
            [
                position = 8192, 7896
                rotation = right
            ]

            port C {
                position = top:3
                kind = pe
            }
            [
                position = 8288, 7896
                rotation = right
            ]

            port A {
                position = top:1
                kind = pe
            }
            [
                position = 8096, 7896
                rotation = right
            ]

            tag From6 {
                value = "Vb_Load"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8368, 7960
                hide_name = True
                size = 0, 0
            ]

            tag From5 {
                value = "Vc_Load"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8368, 7992
                hide_name = True
                size = 0, 0
            ]

            tag From4 {
                value = "Va_Load"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8368, 7928
                hide_name = True
                size = 0, 0
            ]

            junction Junction1 pe
            [
                position = 8192, 8368
            ]

            connect L1.n_node Junction1 as Connection5
            connect Ia2.n_node R2.p_node as Connection738
            connect B S1.b_in as Connection13
            connect Ia1.n_node R1.p_node as Connection736
            connect R2.n_node L2.p_node as Connection2
            connect S1.b_out Ia2.p_node as Connection737
            connect A S1.c_in as Connection11
            connect C S1.a_in as Connection12
            connect R1.n_node L1.p_node as Connection1
            connect Junction1 L3.n_node as Connection6
            connect Ia3.n_node R3.p_node as Connection740
            connect S1.a_out Ia3.p_node as Connection739
            connect S1.c_out Ia1.p_node as Connection735
            connect L2.n_node Junction1 as Connection7
            connect R3.n_node L3.p_node as Connection3
            connect pf.in "PQ Power Meter1.k_factor" as Connection769
            connect Termination1.in "PQ Power Meter1.Pac" as Connection10
            connect "72 KW.in" "PQ Power Meter1.Pdc" as Connection766
            connect S.in "PQ Power Meter1.apparent" as Connection768
            connect Termination2.in "PQ Power Meter1.Qac" as Connection757
            connect From6 "PQ Power Meter1.vb" as Connection773
            [
                breakpoints = 8416, 7976; 8432, 7976
            ]
            connect From5 "PQ Power Meter1.vc" as Connection772
            connect From4 "PQ Power Meter1.va" as Connection760
            connect Q.in "PQ Power Meter1.Qdc" as Connection770
            [
                breakpoints = 8600, 7928; 8600, 7976
            ]
            connect Ia1.out "PQ Power Meter1.ia" as Connection774
            [
                breakpoints = 8160, 8024; 8432, 8024
            ]
            connect Ia2.out "PQ Power Meter1.ib" as Connection775
            connect Ia3.out "PQ Power Meter1.ic" as Connection776

            Sb = "74e3"
            Vb = "208"
            pf = "0.95"

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">This block implements a RL load.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">None of the parameters of this block can be set to zero. The power factor range is 0 < pf < 1.0</span></p></body></html>"

                Sb {
                    label = "Nominal power"
                    widget = edit
                    type = generic
                    default_value = "30e3"
                    unit = "VA"
                }

                Vb {
                    label = "Nominal voltage"
                    widget = edit
                    type = generic
                    default_value = "480.0"
                    unit = "V"
                }

                fb {
                    label = "Nominal frequency"
                    widget = edit
                    type = generic
                    default_value = "60.0"
                    unit = "Hz"
                }

                pf {
                    label = "Power factor"
                    widget = edit
                    type = generic
                    default_value = "0.9"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 8936, 9144
            size = 160, 160
        ]

        component Subsystem "Load 100 %" {
            layout = dynamic
            component "core/Triple Pole Single Throw Contactor" S1 {
            }
            [
                position = 8192, 8000
                rotation = right
                size = 64, 256
            ]

            component "core/Current Measurement" Ia {
                execution_rate = "Ts_Var"
                sig_output = "True"
            }
            [
                position = 8104, 8096
                rotation = right
                size = 64, 32
            ]

            component pas_resistor R3 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8280, 8264
                rotation = right
            ]

            component pas_resistor R2 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8184, 8288
                rotation = right
            ]

            component pas_inductor L2 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8184, 8360
                rotation = right
            ]

            component pas_resistor R1 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8088, 8264
                rotation = right
            ]

            component "core/Current Measurement" Ib {
                execution_rate = "Ts_Var"
                sig_output = "True"
            }
            [
                position = 8192, 8144
                rotation = right
                size = 64, 32
            ]

            component pas_inductor L3 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8280, 8360
                rotation = right
            ]

            component "core/Current Measurement" Ic {
                execution_rate = "Ts_Var"
                sig_output = "True"
            }
            [
                position = 8280, 8184
                rotation = right
                size = 64, 32
            ]

            component pas_inductor L1 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8088, 8360
                rotation = right
            ]

            component gen_terminator Termination2 {
            }
            [
                position = 8672, 8072
                rotation = left
                hide_name = True
                scale = -1, -1
            ]

            component gen_probe "72 KW" {
                addr = "17965"
            }
            [
                position = 8616, 7960
            ]

            component gen_PQ_transform "PQ Power Meter1" {
            }
            [
                position = 8520, 8032
            ]

            component gen_probe Q {
                addr = "17938"
            }
            [
                position = 8720, 7960
            ]

            component gen_probe S {
                addr = "17951"
            }
            [
                position = 8624, 8056
            ]

            component gen_terminator Termination1 {
            }
            [
                position = 8672, 7992
                rotation = left
                hide_name = True
                scale = -1, 1
            ]

            component gen_probe pf {
                addr = "17951"
            }
            [
                position = 8624, 8104
            ]

            port A {
                position = top:1
                kind = pe
            }
            [
                position = 8096, 7896
                rotation = right
            ]

            port C {
                position = top:3
                kind = pe
            }
            [
                position = 8288, 7896
                rotation = right
            ]

            port B {
                position = top:2
                kind = pe
            }
            [
                position = 8192, 7896
                rotation = right
            ]

            tag From5 {
                value = "Vc_Load"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8408, 8024
                hide_name = True
                size = 0, 0
            ]

            tag From6 {
                value = "Vb_Load"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8408, 7992
                hide_name = True
                size = 0, 0
            ]

            tag From4 {
                value = "Va_Load"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8408, 7960
                hide_name = True
                size = 0, 0
            ]

            junction Junction1 pe
            [
                position = 8184, 8416
            ]

            connect L1.n_node Junction1 as Connection5
            connect B S1.b_in as Connection13
            connect C S1.a_in as Connection12
            connect Ib.n_node R2.p_node as Connection738
            connect R3.n_node L3.p_node as Connection3
            connect Ia.n_node R1.p_node as Connection736
            connect R2.n_node L2.p_node as Connection2
            connect Ic.n_node R3.p_node as Connection740
            connect L2.n_node Junction1 as Connection7
            connect S1.b_out Ib.p_node as Connection737
            connect Junction1 L3.n_node as Connection6
            connect R1.n_node L1.p_node as Connection1
            connect A S1.c_in as Connection11
            connect S1.a_out Ic.p_node as Connection739
            connect S1.c_out Ia.p_node as Connection735
            connect From5 "PQ Power Meter1.vc" as Connection772
            connect Termination1.in "PQ Power Meter1.Pac" as Connection10
            connect Termination2.in "PQ Power Meter1.Qac" as Connection757
            connect S.in "PQ Power Meter1.apparent" as Connection768
            connect From6 "PQ Power Meter1.vb" as Connection773
            [
                breakpoints = 8456, 8008; 8472, 8008
            ]
            connect pf.in "PQ Power Meter1.k_factor" as Connection769
            connect "72 KW.in" "PQ Power Meter1.Pdc" as Connection766
            connect Q.in "PQ Power Meter1.Qdc" as Connection770
            [
                breakpoints = 8640, 7960; 8640, 8008
            ]
            connect From4 "PQ Power Meter1.va" as Connection760
            connect Ia.out "PQ Power Meter1.ia" as Connection774
            [
                breakpoints = 8328, 8096; 8328, 8040
            ]
            connect Ib.out "PQ Power Meter1.ib" as Connection775
            [
                breakpoints = 8344, 8144; 8344, 8056
            ]
            connect Ic.out "PQ Power Meter1.ic" as Connection776
            [
                breakpoints = 8376, 8184; 8376, 8072
            ]

            Sb = "74e3"
            Vb = "208"
            pf = "0.95"

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">This block implements a RL load.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">None of the parameters of this block can be set to zero. The power factor range is 0 < pf < 1.0</span></p></body></html>"

                Sb {
                    label = "Nominal power"
                    widget = edit
                    type = generic
                    default_value = "30e3"
                    unit = "VA"
                }

                Vb {
                    label = "Nominal voltage"
                    widget = edit
                    type = generic
                    default_value = "480.0"
                    unit = "V"
                }

                fb {
                    label = "Nominal frequency"
                    widget = edit
                    type = generic
                    default_value = "60.0"
                    unit = "Hz"
                }

                pf {
                    label = "Power factor"
                    widget = edit
                    type = generic
                    default_value = "0.9"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 9112, 9144
            size = 160, 160
        ]

        component Subsystem Secondary {
            layout = dynamic
            component "core/Voltage Measurement" Vc {
                addr = "5"
                execution_rate = "Ts_Var"
                sig_output = "True"
            }
            [
                position = 8504, 8056
                rotation = right
                size = 64, 32
            ]

            component Subsystem Snubber {
                layout = dynamic
                component pas_resistor R3 {
                    resistance = "43264"
                }
                [
                    position = 8264, 8144
                    rotation = right
                ]

                component pas_resistor R1 {
                    resistance = "43264"
                }
                [
                    position = 8120, 8144
                    rotation = right
                ]

                component pas_resistor R2 {
                    resistance = "43264"
                }
                [
                    position = 8192, 8144
                    rotation = right
                ]

                port B {
                    position = top:2
                    kind = pe
                }
                [
                    position = 8192, 8064
                    rotation = right
                ]

                port G {
                    position = bottom:1
                    kind = pe
                }
                [
                    position = 8192, 8296
                    rotation = left
                ]

                port C {
                    position = top:3
                    kind = pe
                }
                [
                    position = 8264, 8064
                    rotation = right
                ]

                port A {
                    position = top:1
                    kind = pe
                }
                [
                    position = 8120, 8064
                    rotation = right
                ]

                junction Junction1490 pe
                [
                    position = 8192, 8248
                ]

                junction Junction1491 pe
                [
                    position = 8192, 8248
                ]

                connect R2.n_node Junction1490 as Connection385
                connect G Junction1491 as Connection403
                connect Junction1491 Junction1490 as Connection402
                connect R1.p_node A as Connection399
                connect R2.p_node B as Connection397
                connect R3.p_node C as Connection398
                connect R3.n_node Junction1491 as Connection401
                connect Junction1490 R1.n_node as Connection395
            }
            [
                position = 8240, 8112
                size = 64, 48
            ]

            component "core/Voltage Measurement" Vb {
                addr = "4"
                execution_rate = "Ts_Var"
                sig_output = "True"
            }
            [
                position = 8464, 8104
                rotation = right
                size = 64, 32
            ]

            component "core/Voltage Measurement" Va {
                addr = "3"
                execution_rate = "Ts_Var"
                sig_output = "True"
            }
            [
                position = 8416, 8152
                rotation = right
                size = 64, 32
            ]

            component "core/Current Measurement" Ia {
                sig_output = "True"
            }
            [
                position = 8312, 7800
                size = 64, 32
            ]

            component "core/Current Measurement" Ib {
                sig_output = "True"
            }
            [
                position = 8320, 7896
                size = 64, 32
            ]

            component "core/Current Measurement" Ic {
                sig_output = "True"
            }
            [
                position = 8328, 7992
                size = 64, 32
            ]

            component gen_probe Ib_sec {
                signal_type = "current"
            }
            [
                position = 8384, 7848
            ]

            component gen_probe Ic_sec {
                signal_type = "current"
            }
            [
                position = 8384, 7936
            ]

            component gen_probe Ia_sec {
                signal_type = "current"
            }
            [
                position = 8384, 7744
            ]

            port C {
                position = left:3
                kind = pe
            }
            [
                position = 7776, 7992
                rotation = down
                scale = -1, 1
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 7776, 7800
                rotation = down
                scale = -1, 1
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 8736, 7800
                scale = -1, 1
            ]

            port b {
                position = right:4
                kind = pe
            }
            [
                position = 8736, 7896
                scale = -1, 1
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 7776, 7896
                rotation = down
                scale = -1, 1
            ]

            port c {
                position = right:6
                kind = pe
            }
            [
                position = 8736, 7992
                scale = -1, 1
            ]

            tag Goto3 {
                value = "Vc_Load"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8608, 8032
            ]

            tag Goto2 {
                value = "Vb_Load"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8608, 8112
            ]

            tag Goto1 {
                value = "Va_Load"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8672, 8192
            ]

            tag Goto4 {
                value = "Sec Va"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8720, 8152
            ]

            tag Goto5 {
                value = "Sec Vb"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8720, 8080
            ]

            tag Goto6 {
                value = "Sec Vc"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8744, 8040
            ]

            tag Goto7 {
                value = "Sec Ia"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8368, 7712
                hide_name = True
            ]

            tag Goto8 {
                value = "Sec Ib"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8376, 7824
                hide_name = True
            ]

            tag Goto9 {
                value = "Sec Ic"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8376, 7912
                hide_name = True
            ]

            junction Junction2 pe
            [
                position = 8464, 7896
            ]

            junction Junction4 pe
            [
                position = 8224, 7800
            ]

            junction Junction5 pe
            [
                position = 8240, 7896
            ]

            junction Junction1 pe
            [
                position = 8504, 7992
            ]

            junction Junction3 pe
            [
                position = 8416, 7800
            ]

            junction Junction6 pe
            [
                position = 8256, 7992
            ]

            junction Junction7 pe
            [
                position = 8464, 8192
            ]

            junction Junction8 sp
            [
                position = 8560, 8032
            ]

            junction Junction9 sp
            [
                position = 8560, 8104
            ]

            junction Junction10 sp
            [
                position = 8576, 8152
            ]

            junction Junction11 sp
            [
                position = 8312, 7744
            ]

            junction Junction12 sp
            [
                position = 8320, 7848
            ]

            junction Junction13 sp
            [
                position = 8328, 7936
            ]

            connect Junction2 b as Connection741
            connect c Junction1 as Connection737
            connect A Junction4 as Connection746
            [
                breakpoints = 8048, 7800
            ]
            connect Snubber.G Va.n_node as Connection755
            connect Vb.p_node Junction2 as Connection742
            connect Junction3 a as Connection744
            connect Vb.n_node Junction7 as Connection757
            connect Snubber.B Junction5 as Connection751
            connect Vc.p_node Junction1 as Connection739
            connect B Junction5 as Connection749
            [
                breakpoints = 8072, 7896
            ]
            connect Snubber.A Junction4 as Connection748
            connect Junction6 C as Connection753
            [
                breakpoints = 8080, 7992
            ]
            connect Junction7 Va.n_node as Connection758
            connect Snubber.C Junction6 as Connection754
            connect Vc.n_node Junction7 as Connection759
            connect Va.p_node Junction3 as Connection745
            connect Junction4 Ia.p_node as Connection763
            connect Ia.n_node Junction3 as Connection764
            connect Junction5 Ib.p_node as Connection765
            connect Ib.n_node Junction2 as Connection766
            connect Junction1 Ic.n_node as Connection767
            connect Ic.p_node Junction6 as Connection768
            connect Vc.out Junction8 as Connection784
            [
                breakpoints = 8560, 8056
            ]
            connect Junction8 Goto3 as Connection785
            connect Goto6 Junction8 as Connection786
            connect Vb.out Junction9 as Connection787
            connect Junction9 Goto2 as Connection788
            [
                breakpoints = 8560, 8104
            ]
            connect Goto5 Junction9 as Connection789
            connect Goto1 Junction10 as Connection790
            [
                breakpoints = 8624, 8192; 8576, 8192
            ]
            connect Junction10 Va.out as Connection791
            connect Goto4 Junction10 as Connection792
            connect Ia_sec.in Junction11 as Connection793
            connect Junction11 Ia.out as Connection794
            connect Goto7 Junction11 as Connection795
            connect Ib_sec.in Junction12 as Connection796
            connect Junction12 Ib.out as Connection797
            connect Goto8 Junction12 as Connection798
            connect Ic_sec.in Junction13 as Connection799
            connect Junction13 Ic.out as Connection800
            [
                breakpoints = 8328, 7968
            ]
            connect Goto9 Junction13 as Connection801
        }
        [
            position = 8552, 8880
            rotation = right
            scale = -1, 1
            size = 48, 160
        ]

        component Subsystem "Load 50 %" {
            layout = dynamic
            component pas_resistor R1 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8096, 8224
                rotation = right
            ]

            component gen_probe S {
                addr = "17951"
            }
            [
                position = 8832, 8160
            ]

            component pas_resistor R2 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8192, 8224
                rotation = right
            ]

            component gen_probe pf {
                addr = "17951"
            }
            [
                position = 8832, 8208
            ]

            component pas_inductor L1 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8096, 8320
                rotation = right
            ]

            component gen_probe "72 KW" {
                addr = "17965"
            }
            [
                position = 8824, 8064
            ]

            component "core/Triple Pole Single Throw Contactor" S1 {
            }
            [
                position = 8192, 8000
                rotation = right
                size = 64, 256
            ]

            component pas_inductor L2 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8192, 8320
                rotation = right
            ]

            component "core/Current Measurement" Ia3 {
                execution_rate = "Ts_Var"
                sig_output = "True"
            }
            [
                position = 8288, 8144
                rotation = right
                size = 64, 32
            ]

            component "core/Current Measurement" Ia2 {
                execution_rate = "Ts_Var"
                sig_output = "True"
            }
            [
                position = 8192, 8120
                rotation = right
                size = 64, 32
            ]

            component "core/Current Measurement" Ia1 {
                execution_rate = "Ts_Var"
                sig_output = "True"
            }
            [
                position = 8096, 8080
                rotation = right
                size = 64, 32
            ]

            component gen_probe Q {
                addr = "17938"
            }
            [
                position = 8928, 8064
            ]

            component pas_resistor R3 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8288, 8224
                rotation = right
            ]

            component pas_inductor L3 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8288, 8320
                rotation = right
            ]

            component gen_terminator Termination1 {
            }
            [
                position = 8880, 8096
                rotation = left
                hide_name = True
                scale = -1, 1
            ]

            component gen_terminator Termination2 {
            }
            [
                position = 8880, 8176
                rotation = left
                hide_name = True
                scale = -1, -1
            ]

            component gen_PQ_transform "PQ Power Meter1" {
            }
            [
                position = 8728, 8136
            ]

            port B {
                position = top:2
                kind = pe
            }
            [
                position = 8192, 7896
                rotation = right
            ]

            port A {
                position = top:1
                kind = pe
            }
            [
                position = 8096, 7896
                rotation = right
            ]

            port C {
                position = top:3
                kind = pe
            }
            [
                position = 8288, 7896
                rotation = right
            ]

            tag From6 {
                value = "Vb_Load"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8616, 8096
                hide_name = True
                size = 0, 0
            ]

            tag From4 {
                value = "Va_Load"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8616, 8064
                hide_name = True
                size = 0, 0
            ]

            tag From5 {
                value = "Vc_Load"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8616, 8128
                hide_name = True
                size = 0, 0
            ]

            junction Junction1 pe
            [
                position = 8192, 8384
            ]

            connect Ia3.n_node R3.p_node as Connection749
            connect S1.a_out Ia3.p_node as Connection748
            connect S1.c_out Ia1.p_node as Connection744
            connect C S1.a_in as Connection12
            connect R3.n_node L3.p_node as Connection3
            connect R2.n_node L2.p_node as Connection2
            connect R1.n_node L1.p_node as Connection1
            connect L2.n_node Junction1 as Connection7
            connect S1.b_out Ia2.p_node as Connection746
            connect Junction1 L3.n_node as Connection6
            connect L1.n_node Junction1 as Connection5
            connect Ia2.n_node R2.p_node as Connection747
            connect Ia1.n_node R1.p_node as Connection745
            connect B S1.b_in as Connection13
            connect A S1.c_in as Connection11
            connect Termination2.in "PQ Power Meter1.Qac" as Connection757
            connect Termination1.in "PQ Power Meter1.Pac" as Connection10
            connect From4 "PQ Power Meter1.va" as Connection760
            connect Ia1.out "PQ Power Meter1.ia" as Connection763
            [
                breakpoints = 8424, 8080; 8424, 8144
            ]
            connect Ia2.out "PQ Power Meter1.ib" as Connection764
            [
                breakpoints = 8368, 8104; 8368, 8160
            ]
            connect Ia3.out "PQ Power Meter1.ic" as Connection765
            [
                breakpoints = 8360, 8144; 8360, 8176
            ]
            connect "72 KW.in" "PQ Power Meter1.Pdc" as Connection766
            connect S.in "PQ Power Meter1.apparent" as Connection768
            connect pf.in "PQ Power Meter1.k_factor" as Connection769
            connect Q.in "PQ Power Meter1.Qdc" as Connection770
            [
                breakpoints = 8848, 8064; 8848, 8112
            ]
            connect From5 "PQ Power Meter1.vc" as Connection772
            connect From6 "PQ Power Meter1.vb" as Connection773
            [
                breakpoints = 8664, 8112; 8680, 8112
            ]

            Sb = "74e3"
            Vb = "208"
            pf = "0.95"

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">This block implements a RL load.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">None of the parameters of this block can be set to zero. The power factor range is 0 < pf < 1.0</span></p></body></html>"

                Sb {
                    label = "Nominal power"
                    widget = edit
                    type = generic
                    default_value = "30e3"
                    unit = "VA"
                }

                Vb {
                    label = "Nominal voltage"
                    widget = edit
                    type = generic
                    default_value = "480.0"
                    unit = "V"
                }

                fb {
                    label = "Nominal frequency"
                    widget = edit
                    type = generic
                    default_value = "60.0"
                    unit = "Hz"
                }

                pf {
                    label = "Power factor"
                    widget = edit
                    type = generic
                    default_value = "0.9"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 8744, 9144
            size = 160, 160
        ]

        component Subsystem "Load 25 %" {
            layout = dynamic
            component pas_resistor R2 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8192, 8128
                rotation = right
            ]

            component pas_resistor R1 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8144, 8128
                rotation = right
            ]

            component gen_probe S {
                addr = "17951"
            }
            [
                position = 8832, 8064
            ]

            component gen_probe Q {
                addr = "17938"
            }
            [
                position = 8808, 8008
            ]

            component pas_inductor L1 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8144, 8224
                rotation = right
            ]

            component pas_inductor L3 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8240, 8224
                rotation = right
            ]

            component pas_inductor L2 {
                inductance = "((Vb**2.0)/Sb)*((1-pf**2.0)**0.5)/(2*np.pi*fb)"
            }
            [
                position = 8192, 8224
                rotation = right
            ]

            component "core/Current Measurement" Ia3 {
                execution_rate = "Ts_Var"
                sig_output = "True"
            }
            [
                position = 8240, 8064
                rotation = right
                size = 64, 32
            ]

            component "core/Current Measurement" Ia2 {
                execution_rate = "Ts_Var"
                sig_output = "True"
            }
            [
                position = 8192, 8008
                rotation = right
                size = 64, 32
            ]

            component "core/Current Measurement" Ia1 {
                execution_rate = "Ts_Var"
                sig_output = "True"
            }
            [
                position = 8144, 7960
                rotation = right
                size = 64, 32
            ]

            component gen_probe pf {
                addr = "17951"
            }
            [
                position = 8712, 8096
            ]

            component pas_resistor R3 {
                resistance = "pf*(Vb**2.0)/Sb"
            }
            [
                position = 8240, 8128
                rotation = right
            ]

            component gen_probe "72 KW" {
                addr = "17965"
            }
            [
                position = 8760, 7968
            ]

            component gen_terminator Termination2 {
            }
            [
                position = 8752, 8152
                rotation = left
                hide_name = True
                scale = -1, -1
            ]

            component gen_PQ_transform "PQ Power Meter1" {
            }
            [
                position = 8592, 8032
            ]

            component gen_terminator Termination3 {
            }
            [
                position = 8800, 8136
                rotation = left
                hide_name = True
                scale = -1, -1
            ]

            port B {
                position = top:2
                kind = pe
            }
            [
                position = 8192, 7896
                rotation = right
            ]

            port A {
                position = top:1
                kind = pe
            }
            [
                position = 8144, 7896
                rotation = right
            ]

            port C {
                position = top:3
                kind = pe
            }
            [
                position = 8240, 7896
                rotation = right
            ]

            tag From6 {
                value = "Vb_Load"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8424, 7936
                hide_name = True
                size = 0, 0
            ]

            tag From4 {
                value = "Va_Load"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8424, 7904
                hide_name = True
                size = 0, 0
            ]

            tag From5 {
                value = "Vc_Load"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8408, 7968
                hide_name = True
                size = 0, 0
            ]

            junction Junction1 pe
            [
                position = 8192, 8272
            ]

            connect R2.p_node Ia2.n_node as Connection739
            connect Junction1 L3.n_node as Connection6
            connect L1.n_node Junction1 as Connection5
            connect R3.n_node L3.p_node as Connection3
            connect R1.p_node Ia1.n_node as Connection737
            connect R2.n_node L2.p_node as Connection2
            connect R1.n_node L1.p_node as Connection1
            connect Ia2.p_node B as Connection740
            connect Ia3.p_node C as Connection742
            connect L2.n_node Junction1 as Connection7
            connect Ia1.p_node A as Connection738
            connect R3.p_node Ia3.n_node as Connection741
            connect Termination2.in "PQ Power Meter1.Qac" as Connection11
            [
                breakpoints = 8752, 8040; 8640, 8040
            ]
            connect From4 "PQ Power Meter1.va" as Connection747
            connect From5 "PQ Power Meter1.vc" as Connection749
            [
                breakpoints = 8464, 7968; 8464, 8024
            ]
            connect From6 "PQ Power Meter1.vb" as Connection750
            [
                breakpoints = 8504, 7936; 8504, 8008
            ]
            connect Ia1.out "PQ Power Meter1.ia" as Connection751
            [
                breakpoints = 8336, 7960; 8336, 8040
            ]
            connect Ia2.out "PQ Power Meter1.ib" as Connection752
            [
                breakpoints = 8320, 8008; 8320, 8056
            ]
            connect Ia3.out "PQ Power Meter1.ic" as Connection753
            connect "72 KW.in" "PQ Power Meter1.Pdc" as Connection754
            connect Q.in "PQ Power Meter1.Qdc" as Connection755
            connect S.in "PQ Power Meter1.apparent" as Connection756
            connect pf.in "PQ Power Meter1.k_factor" as Connection757
            connect Termination3.in "PQ Power Meter1.Pac" as Connection758

            Sb = "74e3"
            Vb = "208"
            pf = "0.95"

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">This block implements a RL load.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">None of the parameters of this block can be set to zero. The power factor range is 0 < pf < 1.0</span></p></body></html>"

                Sb {
                    label = "Nominal power"
                    widget = edit
                    type = generic
                    default_value = "30e3"
                    unit = "VA"
                }

                Vb {
                    label = "Nominal voltage"
                    widget = edit
                    type = generic
                    default_value = "480.0"
                    unit = "V"
                }

                fb {
                    label = "Nominal frequency"
                    widget = edit
                    type = generic
                    default_value = "60.0"
                    unit = "Hz"
                }

                pf {
                    label = "Power factor"
                    widget = edit
                    type = generic
                    default_value = "0.9"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 8552, 9136
            size = 160, 160
        ]

        component Subsystem C_Var_Speed {
            layout = dynamic
            component "core/Three Phase Core Coupling" "Core Coupling 1" {
            }
            [
                position = 8144, 7904
                scale = -1, 1
                size = 12, 256
            ]

            component Subsystem "RC Snubber" {
                layout = dynamic
                component pas_capacitor C2 {
                    capacitance = "C"
                }
                [
                    position = 8192, 8240
                    rotation = right
                ]

                component pas_capacitor C1 {
                    capacitance = "C"
                }
                [
                    position = 8120, 8240
                    rotation = right
                ]

                component pas_resistor R2 {
                    resistance = "R"
                }
                [
                    position = 8192, 8144
                    rotation = right
                ]

                component pas_resistor R3 {
                    resistance = "R"
                }
                [
                    position = 8264, 8144
                    rotation = right
                ]

                component pas_capacitor C3 {
                    capacitance = "C"
                }
                [
                    position = 8264, 8240
                    rotation = right
                ]

                component pas_resistor R1 {
                    resistance = "R"
                }
                [
                    position = 8120, 8144
                    rotation = right
                ]

                port N {
                    position = bottom:2
                    kind = pe
                }
                [
                    position = 8192, 8320
                    rotation = left
                ]

                port B {
                    position = top:2
                    kind = pe
                }
                [
                    position = 8192, 8064
                    rotation = right
                ]

                port A {
                    position = top:1
                    kind = pe
                }
                [
                    position = 8120, 8064
                    rotation = right
                ]

                port C {
                    position = top:3
                    kind = pe
                }
                [
                    position = 8264, 8064
                    rotation = right
                ]

                junction Junction1 pe
                [
                    position = 8192, 8288
                ]

                junction Junction2 pe
                [
                    position = 8192, 8288
                ]

                connect R2.p_node B as Connection15
                connect C3.n_node Junction2 as Connection23
                connect C2.p_node R2.n_node as Connection24
                connect C1.p_node R1.n_node as Connection9
                connect C1.p_node R1.n_node as Connection11
                connect C2.n_node Junction1 as Connection18
                connect R3.n_node C3.p_node as Connection25
                connect C1.n_node Junction2 as Connection21
                connect R1.p_node A as Connection13
                connect C1.p_node R1.n_node as Connection10
                connect Junction1 N as Connection19
                connect Junction2 Junction1 as Connection22
                connect R3.p_node C as Connection16

                C = "50e-6"
                R = "0.2"

                mask {
                    R {
                        label = "R"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "ohms"
                        group = "General"
                    }

                    C {
                        label = "C"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "F"
                        group = "General"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 8272, 8080
                size = 64, 48
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 7760, 7800
                rotation = down
                scale = -1, 1
            ]

            port C {
                position = left:3
                kind = pe
            }
            [
                position = 7760, 7992
                rotation = down
                scale = -1, 1
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 8376, 7800
                scale = -1, 1
            ]

            port c {
                position = right:6
                kind = pe
            }
            [
                position = 8376, 7992
                scale = -1, 1
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 7760, 7896
                rotation = down
                scale = -1, 1
            ]

            port b {
                position = right:4
                kind = pe
            }
            [
                position = 8376, 7896
                scale = -1, 1
            ]

            junction Junction2 pe
            [
                position = 8280, 7904
            ]

            junction Junction1 pe
            [
                position = 8248, 7808
            ]

            junction Junction3 pe
            [
                position = 8288, 8000
            ]

            connect "Core Coupling 1.b_out" B as Connection2
            connect "Core Coupling 1.a_out" A as Connection1
            connect "Core Coupling 1.c_out" C as Connection3
            connect "Core Coupling 1.a_in" Junction1 as Connection7
            connect "Core Coupling 1.b_in" Junction2 as Connection10
            connect "RC Snubber.A" Junction1 as Connection9
            connect "Core Coupling 1.c_in" Junction3 as Connection13
            connect "RC Snubber.B" Junction2 as Connection12
            connect "RC Snubber.C" Junction3 as Connection15
            connect Junction3 c as Connection14
            connect Junction1 a as Connection8
            connect Junction2 b as Connection11
        }
        [
            position = 7904, 8920
            rotation = right
            scale = -1, 1
            size = 48, 160
        ]

        component Subsystem Back-Up {
            layout = dynamic
            component Subsystem interface {
                layout = dynamic
                component gen_terminator Termination3 {
                }
                [
                    position = 8160, 8096
                    rotation = left
                    hide_name = True
                ]

                component "core/Rate Transition" "Rate Transition1" {
                    execution_rate = "Ts"
                }
                [
                    position = 8232, 8288
                    hide_name = True
                    size = 32, 32
                ]

                component gen_bus_split "Bus Split1" {
                    outputs = "5"
                }
                [
                    position = 8048, 8256
                    hide_name = True
                ]

                component gen_terminator Termination4 {
                }
                [
                    position = 8192, 8136
                    rotation = left
                    hide_name = True
                ]

                component gen_c_function SM {
                    in_terminal_dimensions = "inherit;inherit"
                    in_terminal_dimensions_str = "enable_in inherit;force_off inherit"
                    in_terminal_labels = "[(\'enable_in\', False), (\'force_off\', False)]"
                    in_terminal_properties = "real enable_in;inherit force_off;"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "enable inherit"
                    out_terminal_labels = "[(\'enable\', False)]"
                    out_terminal_properties = "real enable;"
                    output_fnc = "/*Begin code section*/
if(force_off){
    enable = 0;
}
else{
    enable = enable_in;
}
/*End code section*/"
                }
                [
                    position = 8336, 8280
                    size = 48, 48
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 8096, 8176
                    rotation = left
                    hide_name = True
                ]

                component gen_terminator Termination2 {
                }
                [
                    position = 8128, 8136
                    rotation = left
                    hide_name = True
                ]

                port fromPMS {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7976, 8256
                ]

                port Enable_in {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8296, 8192
                    rotation = right
                ]

                port Enable {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8408, 8280
                ]

                connect SM.enable Enable as Connection881
                connect "Rate Transition1.in" "Bus Split1.out4" as Connection873
                connect Termination4.in "Bus Split1.out3" as Connection877
                connect Termination1.in "Bus Split1.out" as Connection874
                connect SM.force_off "Rate Transition1.out" as Connection878
                connect Termination3.in "Bus Split1.out2" as Connection876
                connect SM.enable_in Enable_in as Connection879
                connect Termination2.in "Bus Split1.out1" as Connection875
                connect "Bus Split1.in" fromPMS as Connection880
            }
            [
                position = 7632, 7976
                size = 112, 96
            ]

            component src_scada_input Enable {
                addr = "1427111948"
                execution_rate = "Ts"
                max = "1"
                min = "0"
                unit = ""
            }
            [
                position = 7488, 7944
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "Ts"
            }
            [
                position = 7480, 8008
                size = 32, 32
            ]

            component Subsystem Diesel_Gen {
                layout = static
                component gen_terminator Termination1 {
                }
                [
                    position = 8864, 8192
                    hide_name = True
                    scale = -1, 1
                ]

                component "core/Signal Controlled Voltage Source" Vfd {
                }
                [
                    position = 8672, 8328
                    rotation = right
                    scale = -1, 1
                    size = 64, 32
                ]

                component "core/Current Measurement" If {
                }
                [
                    position = 8736, 8240
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vfield {
                }
                [
                    position = 8800, 8328
                    rotation = right
                    scale = -1, 1
                    size = 64, 32
                ]

                component "core/Triple Pole Single Throw Contactor" MCB {
                    ctrl_src = "Model"
                }
                [
                    position = 9448, 8320
                    scale = -1, 1
                    size = 64, 256
                ]

                component "core/Synchronous Machine with Wound Rotor" Gen {
                    Jm = "J"
                    Llfd = "Llfd_prime"
                    Llkd = "Llkd"
                    Llkq = "Llkq"
                    Lls = "Lls"
                    Lmd = "Lmd"
                    Lmq = "Lmq"
                    Ns_div_Nfd = "Ns_Nfd"
                    Ns_div_Nkd = "Ns_Nkd"
                    Ns_div_Nkq = "Ns_Nkq"
                    Rf = "Rf_prime"
                    Rkd = "Rkd"
                    Rkq = "Rkq"
                    Rs = "Rs"
                    el_torque_out_addr = "8200"
                    enb_sig_out = "True"
                    execution_rate = "Ts"
                    friction_coeff = "F"
                    load_src = "Model"
                    me_speed_out_addr = "8202"
                    pms = "pms"
                    res_int_carr_f = "5000.0"
                }
                [
                    position = 8984, 8320
                    scale = -1, 1
                    size = 176, 160
                ]

                component Subsystem Control {
                    layout = dynamic
                    component Subsystem check_steady_state_w {
                        layout = dynamic
                        component gen_gain speed_diff {
                            gain = "delta_wn/100.0"
                        }
                        [
                            position = 8232, 8208
                        ]

                        component gen_sum Sum3 {
                            signs = "+-"
                        }
                        [
                            position = 8208, 8160
                            hide_name = True
                        ]

                        component src_constant Constant3 {
                            execution_rate = "Ts"
                            value = "2.0*np.pi*f/pms"
                        }
                        [
                            position = 8128, 8208
                            hide_name = True
                        ]

                        component gen_abs Abs1 {
                        }
                        [
                            position = 8280, 8160
                            hide_name = True
                        ]

                        component gen_comparator Comparator3 {
                        }
                        [
                            position = 8360, 8200
                            hide_name = True
                            scale = 1, -1
                        ]

                        port w_meas {
                            position = left:auto
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8096, 8152
                        ]

                        port ss_speed {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8424, 8200
                        ]

                        junction Junction9 sp
                        [
                            position = 8168, 8208
                        ]

                        connect Sum3.in1 Junction9 as Connection54
                        connect Comparator3.in2 Abs1.out as Connection13
                        connect speed_diff.out Comparator3.in1 as Connection57
                        connect Comparator3.out ss_speed as Connection58
                        connect w_meas Sum3.in as Connection59
                        connect Constant3.out Junction9 as Connection16
                        connect Abs1.in Sum3.out as Connection5
                        connect Junction9 speed_diff.in as Connection39
                    }
                    [
                        position = 7968, 8440
                        size = 96, 48
                    ]

                    component gen_bus_split "Bus Split2" {
                        outputs = "3"
                    }
                    [
                        position = 6952, 7856
                        hide_name = True
                    ]

                    component gen_digital_probe GridFollowing {
                    }
                    [
                        position = 7504, 7928
                    ]

                    component Subsystem Governor_and_Engine {
                        layout = dynamic
                        component sys_signal_switch w_switch1 {
                            threshold = "0.5"
                        }
                        [
                            position = 7832, 8216
                            hide_name = True
                        ]

                        component gen_product Product1 {
                        }
                        [
                            position = 7672, 8200
                            hide_name = True
                        ]

                        component gen_gain to_pu {
                            execution_rate = "Ts"
                            gain = "1/Sb"
                        }
                        [
                            position = 7576, 8192
                            rotation = down
                            scale = -1, 1
                        ]

                        component sys_signal_switch w_switch {
                            threshold = "0.5"
                        }
                        [
                            position = 7496, 7944
                            hide_name = True
                        ]

                        component src_constant Inner_w_droop {
                            execution_rate = "Ts"
                            value = "inner_w_droop"
                        }
                        [
                            position = 7528, 8232
                        ]

                        component gen_probe wmeas {
                            addr = "8977"
                        }
                        [
                            position = 7832, 8080
                        ]

                        component gen_probe Inner_droop_dw {
                            addr = "8977"
                        }
                        [
                            position = 7936, 8080
                        ]

                        component Subsystem DEGOV {
                            layout = dynamic
                            component Subsystem Integrator {
                                layout = dynamic
                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8320, 8304
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator1 {
                                    init_value = "Pm0"
                                    limit_lower = "phase_lowLim"
                                    limit_upper = "phase_upLim"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8224
                                    hide_name = True
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "Tmin"
                                    upper_limit = "Tmax"
                                }
                                [
                                    position = 8408, 8224
                                    hide_name = True
                                ]

                                component gen_gain Kb {
                                    gain = "1000"
                                }
                                [
                                    position = 8216, 8304
                                    scale = -1, 1
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8088, 8216
                                    hide_name = True
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8144, 8256
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7968, 8208
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8472, 8224
                                ]

                                junction Junction3 sp
                                [
                                    position = 8440, 8224
                                ]

                                junction Junction4 sp
                                [
                                    position = 8368, 8224
                                ]

                                connect Sum7.in1 Kb.out as Connection53
                                connect In Sum7.in as Connection58
                                connect Integrator1.reset Reset as Connection2
                                connect Junction3 Out as Connection48
                                connect Junction4 Integrator1.out as Connection65
                                connect Junction4 Sum6.in as Connection56
                                connect Kb.in Sum6.out as Connection50
                                connect Limit1.out Junction3 as Connection66
                                connect Limit1.in Junction4 as Connection55
                                connect Sum6.in1 Junction3 as Connection49
                                connect Sum7.out Integrator1.in as Connection52
                            }
                            [
                                position = 8264, 8160
                                size = 64, 48
                            ]

                            component gen_z_domain_transfer TF2 {
                                a_coeff = "[T5*T6,T5+T6,1]"
                                b_coeff = "[T4,1]"
                                domain = "S-domain"
                                init_states = "[0]"
                                method = "Bilinear"
                            }
                            [
                                position = 8176, 8160
                            ]

                            component gen_transport_delay "Transport Delay1" {
                                init_value = "Pm0"
                                time_delay = "Td"
                            }
                            [
                                position = 8392, 8160
                                hide_name = True
                            ]

                            component gen_gain Kp {
                                gain = "gov_Kp"
                            }
                            [
                                position = 8040, 8160
                            ]

                            component gen_z_domain_transfer TF1 {
                                a_coeff = "[T1*T2,T1,1]"
                                b_coeff = "[T3,1]"
                                domain = "S-domain"
                                init_states = "[0]"
                                method = "Bilinear"
                            }
                            [
                                position = 7960, 8160
                            ]

                            component gen_gain K {
                                gain = "K"
                            }
                            [
                                position = 8112, 8160
                            ]

                            port reset {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8208, 8104
                            ]

                            port T {
                                label = "T"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8488, 8160
                            ]

                            port w_bias {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7832, 8160
                            ]

                            comment Comment4 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">Electric Control Box:</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">           (1 + sT3)</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">----------------------------------</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">  1 + sT1 + (s^2)T1T2</span></p></body></html> ENDCOMMENT 
                            [
                                position = 7872, 8208
                            ]

                            comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">Engine</span></p></body></html> ENDCOMMENT 
                            [
                                position = 8368, 8192
                            ]

                            comment Comment3 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">Actuator:</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">          K (1 + sT4)</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">----------------------------------</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">   s(1 + sT5)(1 + sT6)</span></p></body></html> ENDCOMMENT 
                            [
                                position = 8128, 8208
                            ]

                            connect "Transport Delay1.out" T as Connection28
                            connect TF1.out Kp.in as Connection36
                            connect Integrator.In TF2.out as Connection31
                            connect reset Integrator.Reset as Connection33
                            connect w_bias TF1.in as Connection34
                            connect Integrator.Out "Transport Delay1.in" as Connection32
                            connect TF2.in K.out as Connection27
                            connect Kp.out K.in as Connection35
                        }
                        [
                            position = 8072, 8000
                            size = 120, 64
                        ]

                        component gen_sum Sum5 {
                            signs = "3"
                        }
                        [
                            position = 7704, 7984
                            hide_name = True
                        ]

                        component gen_sum Sum4 {
                            signs = "+--"
                        }
                        [
                            position = 7920, 8000
                            hide_name = True
                        ]

                        component gen_gain "Tpu to T" {
                            execution_rate = "Ts"
                            gain = "-Sb*pms/(2*np.pi*f)"
                        }
                        [
                            position = 8200, 8000
                        ]

                        component gen_probe wref {
                            addr = "8977"
                        }
                        [
                            position = 7768, 7936
                            rotation = left
                        ]

                        component src_constant zero {
                            execution_rate = "Ts"
                            value = "0.0"
                        }
                        [
                            position = 7352, 7960
                            hide_name = True
                        ]

                        component gen_gain "w to wpu" {
                            execution_rate = "Ts"
                            gain = "1/(2*np.pi*f/pms)"
                        }
                        [
                            position = 7728, 8080
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_rate_limiter w_ramp {
                            falling_limit = "inner_w_fall"
                            rising_limit = "inner_w_rise"
                        }
                        [
                            position = 7568, 7944
                            hide_name = True
                        ]

                        port "Gen On" {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7448, 7872
                            rotation = down
                            scale = -1, 1
                        ]

                        port P_meas {
                            position = left:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7504, 8192
                            rotation = down
                            scale = -1, 1
                        ]

                        port w_bias {
                            position = left:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7592, 7984
                        ]

                        port GCB_status {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8160
                            rotation = down
                            scale = -1, 1
                        ]

                        port dw_synch {
                            position = left:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7632, 8000
                        ]

                        port w_meas_in {
                            position = left:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7656, 8080
                            rotation = down
                            scale = -1, 1
                        ]

                        port w_ref {
                            position = left:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7432, 7928
                            rotation = down
                            scale = -1, 1
                        ]

                        port T_out {
                            label = "T_out"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8264, 8000
                        ]

                        tag From1 {
                            value = "zero"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7752, 8232
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto1 {
                            value = "zero"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7440, 7984
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction9 sp
                        [
                            position = 7496, 7872
                        ]

                        junction Junction10 sp
                        [
                            position = 7768, 7984
                        ]

                        junction Junction12 sp
                        [
                            position = 7392, 7960
                        ]

                        junction Junction13 sp
                        [
                            position = 7784, 8080
                        ]

                        junction Junction14 sp
                        [
                            position = 7880, 8080
                        ]

                        connect dw_synch Sum5.in2 as Connection701
                        connect "w to wpu.out" Junction13 as Connection754
                        connect Inner_w_droop.out Product1.in1 as Connection764
                        connect "w to wpu.in" w_meas_in as Connection166
                        connect Junction10 Sum4.in as Connection684
                        connect w_bias Sum5.in1 as Connection700
                        connect Junction12 Goto1 as Connection699
                        connect w_ramp.out Sum5.in as Connection762
                        connect Junction12 w_switch.in1 as Connection693
                        connect to_pu.in P_meas as Connection619
                        connect Junction13 wmeas.in as Connection755
                        connect w_ramp.in w_switch.out as Connection761
                        connect w_ref w_switch.in as Connection763
                        connect Junction14 Inner_droop_dw.in as Connection758
                        connect Junction9 DEGOV.reset as Connection679
                        connect w_switch.in2 Junction9 as Connection680
                        connect Product1.in to_pu.out as Connection618
                        connect w_switch1.out Junction14 as Connection757
                        connect Product1.out w_switch1.in as Connection712
                        connect wref.in Junction10 as Connection685
                        connect Sum4.out DEGOV.w_bias as Connection742
                        connect zero.out Junction12 as Connection692
                        connect Sum4.in1 Junction13 as Connection756
                        connect Sum4.in2 Junction14 as Connection759
                        connect DEGOV.T "Tpu to T.in" as Connection720
                        connect Sum5.out Junction10 as Connection683
                        connect From1 w_switch1.in1 as Connection695
                        connect "Tpu to T.out" T_out as Connection30
                        connect GCB_status w_switch1.in2 as Connection691
                        connect "Gen On" Junction9 as Connection678
                    }
                    [
                        position = 8008, 8240
                        size = 184, 208
                    ]

                    component gen_bus_split "Bus Split3" {
                        outputs = "9"
                    }
                    [
                        position = 6952, 8048
                        rotation = right
                        hide_name = True
                    ]

                    component gen_probe T {
                    }
                    [
                        position = 8128, 8184
                        rotation = left
                    ]

                    component gen_digital_probe Gen_On {
                    }
                    [
                        position = 7120, 8064
                    ]

                    component gen_bus_split "Bus Split1" {
                        outputs = "4"
                    }
                    [
                        position = 7296, 8104
                        rotation = right
                        hide_name = True
                    ]

                    component gen_probe Vf {
                        addr = "8978"
                        execution_rate = "Ts"
                    }
                    [
                        position = 8224, 7768
                        rotation = left
                    ]

                    component Subsystem Start_Exciter {
                        layout = dynamic
                        component gen_gain Exciter_start_speed {
                            gain = "exc_dwn/100.0"
                        }
                        [
                            position = 8152, 8248
                        ]

                        component gen_comparator Comparator1 {
                        }
                        [
                            position = 8224, 8200
                            hide_name = True
                        ]

                        component gen_logic_op and {
                        }
                        [
                            position = 8312, 8144
                            hide_name = True
                        ]

                        component src_constant steadyState_w {
                            execution_rate = "Ts"
                        }
                        [
                            position = 8032, 8248
                        ]

                        component gen_gain "w to wpu" {
                            execution_rate = "Ts"
                            gain = "1.0/(2*np.pi*f/pms)"
                        }
                        [
                            position = 8152, 8192
                            rotation = down
                            scale = -1, 1
                        ]

                        port w_meas {
                            position = left:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8192
                        ]

                        port Start {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8432, 8144
                        ]

                        port Gen_On {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8136
                        ]

                        connect and.out Start as Connection76
                        connect Comparator1.in1 "w to wpu.out" as Connection2
                        connect Exciter_start_speed.out Comparator1.in2 as Connection5
                        connect steadyState_w.out Exciter_start_speed.in as Connection56
                        connect and.in Gen_On as Connection74
                        connect "w to wpu.in" w_meas as Connection75
                        connect Comparator1.out and.in1 as Connection73
                    }
                    [
                        position = 7704, 7704
                        size = 104, 64
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 7384, 8280
                        hide_name = True
                    ]

                    component gen_bus_join "Bus Join1" {
                        inputs = "5"
                    }
                    [
                        position = 8456, 8192
                        rotation = left
                        hide_name = True
                    ]

                    component gen_digital_probe StandBy {
                    }
                    [
                        position = 7416, 7888
                    ]

                    component tm_delay "Unit Delay2" {
                        execution_rate = "Ts"
                    }
                    [
                        position = 7920, 8104
                        hide_name = True
                    ]

                    component gen_c_function read_OP_mode {
                        in_terminal_dimensions_str = "OP_mode inherit;GCB_status inherit;"
                        in_terminal_labels = "False;False;"
                        in_terminal_properties = "real OP_mode;inherit GCB_status;"
                        init_fnc = "/*Begin code section*/
OP_mode =0;
enable = 0;
StandBy = 1;
GridFollowing = 0;
GridForming = 0;
/*End code section*/"
                        no_feed_inputs = "[u\'\']"
                        no_feed_outputs = "[u\'\']"
                        out_terminal_dimensions_str = "StandBy inherit;GridFollowing inherit;GridForming inherit;enable inherit;"
                        out_terminal_labels = "False;False;False;False;"
                        out_terminal_properties = "real StandBy;inherit GridFollowing;inherit GridForming;inherit enable;"
                        output_fnc = "/*Begin code section*/
if(OP_mode==0){
    StandBy= 1;
    GridFollowing = 0;
    GridForming = 0;
    enable = 0;
}
else{
    if(OP_mode == 1){
        StandBy = 0;
        GridFollowing = 1;
        GridForming = 0;
        if(GCB_status == 0){
            enable = 0;
        }
        else{
            enable = 1;
        }
    }
    else{
        StandBy = 0;
        GridFollowing = 0;
        GridForming = 1;
        enable = 0;
    }
}
/*End code section*/"
                    }
                    [
                        position = 7288, 7800
                        rotation = right
                        size = 128, 96
                    ]

                    component Subsystem Output {
                        layout = dynamic

                        port Gen_On {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8080, 8160
                        ]

                        port w_meas {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8080, 8216
                        ]

                        tag Goto8 {
                            value = "w_meas"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8200, 8216
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto7 {
                            value = "Gen_On"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8200, 8160
                            hide_name = True
                            size = 0, 0
                        ]

                        connect Goto8 w_meas as Connection631
                        connect Gen_On Goto7 as Connection632
                    }
                    [
                        position = 8448, 8416
                        size = 56, 72
                    ]

                    component gen_digital_probe GridForming {
                    }
                    [
                        position = 7416, 7952
                    ]

                    component Subsystem "pf Control" {
                        layout = dynamic
                        component gen_rel_op greater_equal {
                            relational_op = ">="
                        }
                        [
                            position = 7824, 7944
                            hide_name = True
                        ]

                        component gen_sum Sum6 {
                            execution_rate = "Ts"
                            signs = "+-"
                        }
                        [
                            position = 8032, 8200
                            hide_name = True
                        ]

                        component gen_c_function norm_pf_ref {
                            global_variables = "real u;"
                            in_terminal_dimensions_str = "pf inherit;P inherit;"
                            in_terminal_labels = "False;False;"
                            in_terminal_properties = "real pf;inherit P;"
                            init_fnc = "/*Begin code section*/
pf = 1.0;
pf_norm = 1.0;
/*End code section*/"
                            no_feed_inputs = "[u\'\']"
                            no_feed_outputs = "[u\'\']"
                            out_terminal_dimensions_str = "pf_norm inherit;"
                            out_terminal_labels = "False;"
                            out_terminal_properties = "real pf_norm;"
                            output_fnc = "/*Begin code section*/
if(P>=0){
    if(pf>=0){
        pf_norm = 2-pf; // normalized pf ranges from 1 to 2
    }
    else{
        pf_norm = -pf; // normalized pf ranges from 0 to 1
    }
}
else{
    if(pf>=0){
        pf_norm = 2-pf; // normalized pf ranges from 1 to 2
    }
    else{
        pf_norm = -pf; // normalized pf ranges from  0 to 1
    }
}
/*End code section*/"
                        }
                        [
                            position = 7712, 8176
                            size = 48, 48
                        ]

                        component gen_rate_limiter "Rate Limiter1" {
                            falling_limit = "pf_fall"
                            rising_limit = "pf_rise"
                        }
                        [
                            position = 7936, 8192
                            hide_name = True
                        ]

                        component gen_logic_op "Logical operator5" {
                            inputs = "4"
                        }
                        [
                            position = 7904, 8016
                            rotation = right
                            hide_name = True
                        ]

                        component src_constant zero1 {
                            execution_rate = "Ts"
                            value = "[0]"
                        }
                        [
                            position = 8240, 8232
                            hide_name = True
                        ]

                        component gen_probe delta_V {
                            addr = "8972"
                            execution_rate = "Ts"
                        }
                        [
                            position = 8392, 8160
                        ]

                        component sys_signal_switch "Signal switch4" {
                            criterion = "ctrl > threshold"
                            execution_rate = "Ts"
                        }
                        [
                            position = 8304, 8216
                            hide_name = True
                        ]

                        component gen_c_function norm_pf_meas {
                            in_terminal_dimensions_str = "pf inherit;Q inherit;"
                            in_terminal_labels = "False;False;"
                            in_terminal_properties = "real pf;inherit Q;"
                            init_fnc = "/*Begin code section*/
pf = 1.0;
pf_norm = 1.0;
Q = 0.0;
/*End code section*/"
                            no_feed_inputs = "[u\'\']"
                            no_feed_outputs = "[u\'\']"
                            out_terminal_dimensions_str = "pf_norm inherit;"
                            out_terminal_labels = "False;"
                            out_terminal_properties = "real pf_norm;"
                            output_fnc = "/*Begin code section*/
if(pf>=0){
    if(Q>=0){
        pf_norm = 2-pf; // normalized pf ranges from 1 to 2
    }
    else{
        pf_norm = pf; // normalized pf ranges from 0 to 1
    }
}
else{
    if(Q>=0){
        pf_norm = 2+pf; // normalized pf ranges from 1 to 2
    }
    else{
        pf_norm = -pf; // normalized pf ranges from  0 to 1
    }
}
/*End code section*/"
                        }
                        [
                            position = 7760, 8304
                            size = 48, 48
                        ]

                        component src_constant Constant1 {
                            execution_rate = "Ts"
                            value = "0.1/Sb"
                        }
                        [
                            position = 7720, 7992
                            hide_name = True
                        ]

                        component Subsystem PI {
                            layout = dynamic
                            component gen_sum Sum7 {
                            }
                            [
                                position = 8088, 8224
                                hide_name = True
                            ]

                            component gen_integrator Integrator1 {
                                limit_lower = "[\'-inf\']"
                                limit_upper = "[\'inf\']"
                                show_reset = "either"
                            }
                            [
                                position = 8216, 8232
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8320, 8312
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "pf_lowLim"
                                upper_limit = "pf_upLim"
                            }
                            [
                                position = 8408, 8224
                                hide_name = True
                            ]

                            component gen_gain Ki {
                                gain = "pf_Ki"
                            }
                            [
                                position = 7992, 8216
                            ]

                            component gen_gain Kb {
                            }
                            [
                                position = 8216, 8312
                                scale = -1, 1
                            ]

                            component gen_gain Kp {
                                gain = "pf_Kp"
                            }
                            [
                                position = 7992, 8136
                            ]

                            component gen_sum Sum5 {
                            }
                            [
                                position = 8320, 8224
                                hide_name = True
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7824, 8176
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8224
                            ]

                            port Reset {
                                label = "Reset"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8144, 8264
                            ]

                            junction Junction2 sp
                            [
                                position = 8368, 8224
                            ]

                            junction Junction3 sp
                            [
                                position = 8440, 8224
                            ]

                            junction Junction4 sp
                            [
                                position = 7920, 8176
                            ]

                            connect Ki.in Junction4 as Connection61
                            connect Kp.in Junction4 as Connection59
                            connect Kp.out Sum5.in as Connection57
                            connect Limit1.out Junction3 as Connection47
                            connect Sum5.in1 Integrator1.out as Connection5
                            connect Sum5.out Junction2 as Connection44
                            connect Sum6.in Junction2 as Connection46
                            connect Sum6.in1 Junction3 as Connection49
                            connect Sum7.out Integrator1.in as Connection52
                            connect Integrator1.reset Reset as Connection2
                            connect Sum7.in1 Kb.out as Connection53
                            connect Junction2 Limit1.in as Connection45
                            connect Sum7.in Ki.out as Connection54
                            connect Junction3 Out as Connection48
                            connect Junction4 In as Connection60
                            connect Kb.in Sum6.out as Connection50
                        }
                        [
                            position = 8144, 8200
                            size = 64, 48
                        ]

                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                            execution_rate = "Ts"
                            threshold = "0.5"
                        }
                        [
                            position = 7872, 8192
                            hide_name = True
                        ]

                        component gen_probe pf_r {
                        }
                        [
                            position = 7808, 8208
                        ]

                        component gen_probe pf_m {
                        }
                        [
                            position = 7912, 8304
                        ]

                        port pf_ref {
                            position = left:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7616, 8128
                        ]

                        port pf_meas {
                            position = left:17
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7640, 8280
                        ]

                        port Q_meas_in {
                            position = left:18
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7640, 8344
                        ]

                        port Pref {
                            position = left:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7720, 7936
                        ]

                        port Q_control_mode {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7792, 7840
                        ]

                        port P_meas {
                            position = left:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7616, 8184
                        ]

                        port enable {
                            position = left:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7832, 7800
                        ]

                        port Q_active {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8064, 8000
                        ]

                        port dV_out {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8392, 8216
                        ]

                        port P_control_mode {
                            position = left:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7720, 7880
                        ]

                        tag From2 {
                            value = "Q_mode"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7808, 8120
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto1 {
                            value = "Q_mode"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8072, 8064
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction75 sp
                        [
                            position = 8344, 8216
                        ]

                        junction Junction81 sp
                        [
                            position = 7872, 8120
                        ]

                        junction Junction84 sp
                        [
                            position = 8144, 8120
                        ]

                        junction Junction85 sp
                        [
                            position = 7840, 8248
                        ]

                        junction Junction86 sp
                        [
                            position = 7840, 8304
                        ]

                        junction Junction87 sp
                        [
                            position = 7768, 8176
                        ]

                        junction Junction88 sp
                        [
                            position = 7984, 8064
                        ]

                        connect Junction81 Junction84 as Connection79
                        connect "Signal switch4.out" Junction75 as Connection17
                        connect Sum6.in1 Junction85 as Connection98
                        connect Junction81 "Signal switch2.in2" as Connection53
                        connect Sum6.out PI.In as Connection123
                        connect Junction84 "Signal switch4.in2" as Connection80
                        connect Junction85 "Signal switch2.in1" as Connection99
                        connect delta_V.in Junction75 as Connection20
                        connect Junction86 Junction85 as Connection102
                        connect enable "Logical operator5.in" as Connection136
                        connect Junction87 "Signal switch2.in" as Connection108
                        connect Junction88 "Logical operator5.out" as Connection129
                        connect greater_equal.out "Logical operator5.in3" as Connection126
                        connect PI.Reset Junction84 as Connection81
                        connect greater_equal.in Pref as Connection124
                        connect PI.Out "Signal switch4.in" as Connection77
                        connect norm_pf_meas.pf_norm Junction86 as Connection101
                        connect norm_pf_ref.pf_norm Junction87 as Connection107
                        connect P_control_mode "Logical operator5.in2" as Connection84
                        connect norm_pf_ref.pf pf_ref as Connection132
                        connect P_meas norm_pf_ref.P as Connection127
                        connect Q_active Junction88 as Connection130
                        connect pf_m.in Junction86 as Connection103
                        connect Constant1.out greater_equal.in1 as Connection125
                        connect Q_control_mode "Logical operator5.in1" as Connection135
                        connect pf_meas norm_pf_meas.pf as Connection104
                        connect From2 Junction81 as Connection52
                        connect Q_meas_in norm_pf_meas.Q as Connection96
                        connect pf_r.in Junction87 as Connection109
                        connect "Rate Limiter1.out" Sum6.in as Connection134
                        connect Goto1 Junction88 as Connection128
                        connect zero1.out "Signal switch4.in1" as Connection75
                        connect "Signal switch2.out" "Rate Limiter1.in" as Connection133
                        connect Junction75 dV_out as Connection2
                    }
                    [
                        position = 7736, 7912
                        size = 144, 272
                    ]

                    component gen_digital_probe Exciter_on {
                    }
                    [
                        position = 7800, 7664
                        rotation = left
                    ]

                    component Subsystem Exciter {
                        layout = dynamic
                        component gen_gain Vt_to_Vtpu {
                            execution_rate = "Ts"
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8304, 8248
                        ]

                        component gen_sum Sum2 {
                            execution_rate = "Ts"
                            signs = "+-"
                        }
                        [
                            position = 8184, 8208
                            hide_name = True
                        ]

                        component gen_sum Sum1 {
                            execution_rate = "Ts"
                        }
                        [
                            position = 8264, 8104
                            hide_name = True
                        ]

                        component src_constant Zero {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 7680, 8168
                            hide_name = True
                        ]

                        component src_constant Const {
                            execution_rate = "Ts"
                            value = "Vf0/Ka"
                        }
                        [
                            position = 8176, 8072
                        ]

                        component Subsystem DC4B {
                            layout = dynamic
                            component gen_z_domain_transfer TF2 {
                                a_coeff = "[Ta,1]"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 8376, 8160
                            ]

                            component gen_z_domain_transfer TF3 {
                                a_coeff = "[Te,Ke]"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 8552, 8168
                            ]

                            component gen_probe Va {
                            }
                            [
                                position = 8288, 8096
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 8200, 8160
                                hide_name = True
                            ]

                            component gen_z_domain_transfer TF1 {
                                a_coeff = "[Tr,1]"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 7768, 8216
                            ]

                            component gen_gain Kf {
                                gain = "Kf"
                            }
                            [
                                position = 8424, 8032
                                scale = -1, 1
                            ]

                            component gen_gain KA {
                                gain = "Ka"
                            }
                            [
                                position = 8304, 8160
                            ]

                            component Subsystem PI {
                                layout = dynamic
                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8320, 8224
                                    hide_name = True
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8088, 8224
                                    hide_name = True
                                ]

                                component gen_gain Kp {
                                    gain = "exc_Kp"
                                }
                                [
                                    position = 7992, 8152
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "Vrmin/Ka"
                                    upper_limit = "Vrmax/Ka"
                                }
                                [
                                    position = 8408, 8224
                                    hide_name = True
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8320, 8312
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[\'-inf\']"
                                    limit_upper = "[\'inf\']"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8232
                                    hide_name = True
                                ]

                                component gen_gain Ki {
                                    gain = "exc_Ki"
                                }
                                [
                                    position = 7992, 8216
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8216, 8312
                                    scale = -1, 1
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8472, 8224
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8144, 8264
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7824, 8184
                                ]

                                junction Junction2 sp
                                [
                                    position = 8368, 8224
                                ]

                                junction Junction3 sp
                                [
                                    position = 8440, 8224
                                ]

                                junction Junction4 sp
                                [
                                    position = 7928, 8184
                                ]

                                connect Kp.in Junction4 as Connection58
                                connect Kp.out Sum5.in as Connection59
                                connect Limit1.out Junction3 as Connection47
                                connect Sum5.in1 Integrator1.out as Connection5
                                connect Sum5.out Junction2 as Connection44
                                connect Sum6.in Junction2 as Connection46
                                connect Integrator1.reset Reset as Connection2
                                connect Sum6.in1 Junction3 as Connection49
                                connect Sum7.out Integrator1.in as Connection52
                                connect Junction2 Limit1.in as Connection45
                                connect Sum7.in1 Kb.out as Connection53
                                connect Junction3 Out as Connection48
                                connect Junction4 In as Connection57
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction4 as Connection56
                                connect Ki.out Sum7.in as Connection54
                            }
                            [
                                position = 8104, 8152
                                size = 64, 48
                            ]

                            component gen_c_function "Variable Limit" {
                                in_terminal_dimensions_str = "in inherit;LimitChange inherit;"
                                in_terminal_labels = "True;True;"
                                in_terminal_properties = "inherit in;inherit LimitChange;"
                                init_fnc = "/*Begin code section*/
LimitChange = 0;
out = 0;
/*End code section*/"
                                no_feed_inputs = "[u\'\']"
                                no_feed_outputs = "[u\'\']"
                                out_terminal_dimensions_str = "out inherit;"
                                out_terminal_labels = "True;"
                                out_terminal_properties = "inherit out;"
                                output_fnc = "/*Begin code section*/
if(LimitChange == 0.0){
    LimitChange = 0.01;
}

if(in>=Vrmax*LimitChange){
    out = Vrmax*LimitChange;
}
else{
    if(in<=Vrmin*LimitChange){
        out = Vrmin*LimitChange;
    }
    else{
        out = in;
    }
}
/*End code section*/"
                                parameters = "real Vrmax;real Vrmin;"
                            }
                            [
                                position = 8464, 8168
                                size = 0, 0
                            ]

                            component sys_signal_switch switch {
                                criterion = "ctrl > threshold"
                            }
                            [
                                position = 8000, 8256
                                hide_name = True
                                scale = 1, -1
                            ]

                            component src_constant One {
                                execution_rate = "Ts"
                            }
                            [
                                position = 7872, 8272
                            ]

                            component gen_z_domain_transfer TF4 {
                                a_coeff = "[Tf,1]"
                                b_coeff = "[1,0]"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 8328, 8032
                                scale = -1, 1
                            ]

                            component gen_sum Sum1 {
                                signs = "++-"
                            }
                            [
                                position = 7896, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 8000, 8152
                                hide_name = True
                            ]

                            port Linearize {
                                position = top:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8320
                            ]

                            port Vfd {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8672, 8168
                            ]

                            port Vref {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8160
                            ]

                            port reset {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8088
                            ]

                            port Vpss {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8104
                            ]

                            port Vt {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8216
                            ]

                            junction Junction14 sp
                            [
                                position = 8608, 8168
                            ]

                            junction Junction6 sp
                            [
                                position = 8248, 8160
                            ]

                            junction Junction10 sp
                            [
                                position = 8160, 8256
                            ]

                            junction Junction13 sp
                            [
                                position = 7816, 8216
                            ]

                            connect TF3.out Junction14 as Connection125
                            connect switch.out Junction10 as Connection101
                            connect Junction10 Product1.in1 as Connection102
                            connect switch.in1 Junction13 as Connection115
                            connect TF3.in "Variable Limit.out" as Connection118
                            connect Junction13 Sum1.in2 as Connection114
                            connect Junction14 Vfd as Connection126
                            connect TF4.in Kf.out as Connection127
                            connect Junction6 KA.in as Connection77
                            connect TF4.out Sum2.in as Connection123
                            connect Kf.in Junction14 as Connection128
                            connect Va.in Junction6 as Connection78
                            connect Linearize switch.in2 as Connection74
                            connect One.out switch.in as Connection75
                            connect "Variable Limit.LimitChange" Junction10 as Connection103
                            connect "Variable Limit.in" TF2.out as Connection89
                            connect PI.In Sum2.out as Connection48
                            connect Vpss Sum1.in as Connection45
                            connect Product1.out Junction6 as Connection76
                            connect Product1.in PI.Out as Connection49
                            connect reset PI.Reset as Connection117
                            connect Vref Sum1.in1 as Connection46
                            connect Sum2.in1 Sum1.out as Connection5
                            connect TF1.out Junction13 as Connection113
                            connect Vt TF1.in as Connection112
                            connect TF2.in KA.out as Connection10

                            Ka = "Ka"
                            Ke = "Ke"
                            Kf = "Kf"
                            Ta = "Ta"
                            Te = "Te"
                            Tf = "Tf"
                            Tr = "Tr"
                            Vf0 = "Vf0"
                            Vfmax = "Efmax"
                            Vfmin = "Efmin"
                            Vrmax = "Vrmax"
                            Vrmin = "Vrmin"
                            exc_Ki = "exc_Ki"
                            exc_Kp = "exc_Kp"

                            mask {
                                description = "IEEE DC1A exciter model."

                                Tr {
                                    label = "Time constant Tr"
                                    widget = edit
                                    type = generic
                                    default_value = "2e-6"
                                    group = "General"
                                }

                                exc_Kp {
                                    label = "Exciter PI proportional gain"
                                    widget = edit
                                    type = generic
                                    default_value = "1"
                                    group = "General"
                                }

                                exc_Ki {
                                    label = "Exciter PI integral gain"
                                    widget = edit
                                    type = generic
                                    default_value = "0"
                                    group = "General"
                                }

                                Ka {
                                    label = "Major regulator gain Ka"
                                    widget = edit
                                    type = generic
                                    default_value = "200"
                                    group = "General"
                                }

                                Ta {
                                    label = "Major regulator time constant  Ta"
                                    widget = edit
                                    type = generic
                                    default_value = "2e-3"
                                    group = "General"
                                }

                                Vrmax {
                                    label = "Saturation upper limit"
                                    widget = edit
                                    type = generic
                                    default_value = "10"
                                    group = "General"
                                }

                                Vrmin {
                                    label = "Saturation lower limit"
                                    widget = edit
                                    type = generic
                                    default_value = "-10"
                                    group = "General"
                                }

                                Te {
                                    label = "Exciter time constant Te"
                                    widget = edit
                                    type = generic
                                    default_value = "1e-8"
                                    group = "General"
                                }

                                Ke {
                                    label = "Exciter gain Ke"
                                    widget = edit
                                    type = generic
                                    default_value = "1"
                                    group = "General"
                                }

                                Kf {
                                    label = "Stabilization feedback gain Kf"
                                    widget = edit
                                    type = generic
                                    default_value = "0.0"
                                    group = "General"
                                }

                                Tf {
                                    label = "Stabilization feedback time constant Tf"
                                    widget = edit
                                    type = generic
                                    default_value = "1.0e-12"
                                    group = "General"
                                }

                                Vf0 {
                                    label = "Initial field voltage"
                                    widget = edit
                                    type = generic
                                    default_value = "0"
                                    group = "General"
                                }

                                Vfmax {
                                    label = "Exciter saturation upper limit"
                                    widget = edit
                                    type = generic
                                    default_value = "[\'inf\']"
                                    group = "General"
                                }

                                Vfmin {
                                    label = "Exciter saturation lower limit"
                                    widget = edit
                                    type = generic
                                    default_value = "[\'-inf\']"
                                    group = "General"
                                }

                                Ts {
                                    label = "Execution rate"
                                    widget = edit
                                    type = generic
                                    default_value = "Ts"
                                    group = "General"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 8448, 8208
                            size = 112, 120
                        ]

                        component gen_probe Vt {
                            addr = "8978"
                            execution_rate = "Ts"
                        }
                        [
                            position = 8360, 8304
                            rotation = right
                        ]

                        component src_constant One {
                            execution_rate = "Ts"
                            value = "1.0"
                        }
                        [
                            position = 8448, 8104
                        ]

                        component gen_probe V_ref {
                            addr = "8978"
                            execution_rate = "Ts"
                        }
                        [
                            position = 8072, 8160
                            rotation = left
                        ]

                        component gen_product Product1 {
                        }
                        [
                            position = 8568, 8200
                            hide_name = True
                        ]

                        component src_constant Vpss {
                            execution_rate = "Ts"
                            value = "[0]"
                        }
                        [
                            position = 8176, 8128
                        ]

                        component src_constant V_inner_droop {
                            execution_rate = "Ts"
                            value = "V_inner_droop"
                        }
                        [
                            position = 7928, 8432
                        ]

                        component gen_gain to_pu {
                            execution_rate = "Ts"
                            gain = "1.0/Sb"
                        }
                        [
                            position = 8032, 8384
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_gain one_ov_sqrt_3 {
                            execution_rate = "Ts"
                            gain = "1.0/(3.0**0.5)"
                        }
                        [
                            position = 8032, 8432
                            hide_name = True
                            scale = 1, -1
                        ]

                        component gen_gain Vfpu_to_Vf {
                            execution_rate = "Ts"
                            gain = "Vn*((2.0/3.0)**0.5)/Ns_Nfd"
                        }
                        [
                            position = 8648, 8200
                        ]

                        component gen_rate_limiter "Rate Limit" {
                            falling_limit = "V_fall"
                            rising_limit = "V_rise"
                        }
                        [
                            position = 7816, 8184
                            hide_name = True
                        ]

                        component gen_product Product2 {
                            signs = "3"
                        }
                        [
                            position = 8112, 8272
                            rotation = left
                            hide_name = True
                        ]

                        component gen_sum Sum {
                            execution_rate = "Ts"
                            signs = "3"
                        }
                        [
                            position = 8016, 8200
                            hide_name = True
                        ]

                        component sys_signal_switch switch {
                            threshold = "0.5"
                        }
                        [
                            position = 7752, 8184
                            hide_name = True
                            scale = 1, -1
                        ]

                        port dV {
                            position = left:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7944, 8216
                        ]

                        port Start {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7696, 8256
                        ]

                        port Delta_V_in {
                            position = left:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7880, 8200
                        ]

                        port GCB_status {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7928, 8336
                            rotation = down
                            scale = -1, 1
                        ]

                        port Vf_out {
                            label = "Vf_out"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8712, 8200
                        ]

                        port Q_meas {
                            position = left:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7928, 8384
                            rotation = down
                            scale = -1, 1
                        ]

                        port Vt_in {
                            position = left:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8240, 8248
                        ]

                        port Vref {
                            position = left:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7680, 8200
                        ]

                        tag From1 {
                            value = "start"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8344, 8072
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto1 {
                            value = "start"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7816, 8256
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction112 sp
                        [
                            position = 7752, 8256
                        ]

                        junction Junction116 sp
                        [
                            position = 8072, 8200
                        ]

                        junction Junction117 sp
                        [
                            position = 8416, 8072
                        ]

                        junction Junction118 sp
                        [
                            position = 8360, 8248
                        ]

                        connect DC4B.Vfd Product1.in1 as Connection739
                        connect Sum.in1 Delta_V_in as Connection25
                        connect to_pu.in Q_meas as Connection619
                        connect DC4B.Vref Sum2.out as Connection745
                        connect GCB_status Product2.in as Connection709
                        connect Sum1.out DC4B.Vpss as Connection744
                        connect Goto1 Junction112 as Connection121
                        connect Sum2.in Junction116 as Connection721
                        connect Junction112 switch.in2 as Connection120
                        connect V_inner_droop.out one_ov_sqrt_3.in as Connection749
                        connect Junction116 Sum.out as Connection720
                        connect V_ref.in Junction116 as Connection719
                        connect Vf_out Vfpu_to_Vf.out as Connection126
                        connect Junction117 From1 as Connection742
                        connect Junction118 Vt.in as Connection747
                        connect Vfpu_to_Vf.in Product1.out as Connection125
                        connect Vpss.out Sum1.in1 as Connection32
                        connect One.out DC4B.Linearize as Connection740
                        connect Vref switch.in as Connection87
                        connect Product1.in Junction117 as Connection741
                        connect Vt_to_Vtpu.out Junction118 as Connection746
                        connect Product2.out Sum2.in1 as Connection717
                        connect Vt_to_Vtpu.in Vt_in as Connection36
                        connect Product2.in1 to_pu.out as Connection710
                        connect Const.out Sum1.in as Connection3
                        connect "Rate Limit.out" Sum.in as Connection59
                        connect Zero.out switch.in1 as Connection45
                        connect dV Sum.in2 as Connection88
                        connect DC4B.reset Junction117 as Connection743
                        connect "Rate Limit.in" switch.out as Connection58
                        connect DC4B.Vt Junction118 as Connection748
                        connect Start Junction112 as Connection119
                        connect one_ov_sqrt_3.out Product2.in2 as Connection724
                    }
                    [
                        position = 8088, 7816
                        size = 192, 200
                    ]

                    component tm_delay "Unit Delay3" {
                        execution_rate = "Ts"
                    }
                    [
                        position = 8024, 7664
                        hide_name = True
                    ]

                    component tm_delay "Unit Delay1" {
                    }
                    [
                        position = 7208, 7696
                        hide_name = True
                    ]

                    component Subsystem Define_control_mode {
                        layout = dynamic
                        component gen_c_function Control_mode {
                            in_terminal_dimensions = "inherit"
                            in_terminal_dimensions_str = "Control_mode inherit"
                            in_terminal_labels = "[(\'Control_mode\', True)]"
                            in_terminal_properties = "real Control_mode;"
                            init_fnc = "/*Begin code section*/
P_control = 0;
Q_control = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit;inherit"
                            out_terminal_dimensions_str = "P_control inherit;Q_control inherit"
                            out_terminal_labels = "[(\'P_control\', True), (\'Q_control\', True)]"
                            out_terminal_properties = "real P_control;inherit Q_control;"
                            output_fnc = "/*Begin code section*/
if(Control_mode == 1){
    //PV mode
    P_control = 1;
    Q_control = 0;
}
else{
    if(Control_mode == 2){
        //PQ mode
        P_control = 1;
        Q_control = 1;
    }
    else{
        P_control = 0;
        Q_control = 0;
    }
}
/*End code section*/"
                        }
                        [
                            position = 8224, 8184
                            size = 176, 96
                        ]

                        port Gen_Control_Mode {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8056, 8184
                        ]

                        port Q_Control {
                            position = right:12
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8432, 8216
                        ]

                        port P_Control {
                            position = right:11
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8432, 8152
                        ]

                        connect Control_mode.Control_mode Gen_Control_Mode as Connection3
                        connect Control_mode.P_control P_Control as Connection2
                        connect Control_mode.Q_control Q_Control as Connection1
                    }
                    [
                        position = 7328, 8432
                        size = 144, 64
                    ]

                    component Subsystem Read_Control_mode {
                        layout = dynamic
                        component gen_digital_probe PV_mode {
                        }
                        [
                            position = 8264, 8192
                        ]

                        component gen_digital_probe Vf_mode {
                        }
                        [
                            position = 8264, 8128
                        ]

                        component gen_c_function State {
                            in_terminal_dimensions = "inherit;inherit;inherit"
                            in_terminal_dimensions_str = "enable inherit;P inherit;Q inherit"
                            in_terminal_labels = "[(\'enable\', True), (\'P\', True), (\'Q\', True)]"
                            in_terminal_properties = "real enable;inherit P;inherit Q;"
                            init_fnc = "/*Begin code section*/
Vf = 0;
PV = 0;
PQ = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit;inherit;inherit"
                            out_terminal_dimensions_str = "Vf inherit;PV inherit;PQ inherit"
                            out_terminal_labels = "[(\'Vf\', True), (\'PV\', True), (\'PQ\', True)]"
                            out_terminal_properties = "real Vf;inherit PV;inherit PQ;"
                            output_fnc = "/*Begin code section*/
if(enable && P && Q){
    Vf = 0;
    PV = 0;
    PQ = 1;
}
else{
    if(enable && P){
        Vf = 0;
        PV = 1;
        PQ = 0;
    }
    else{
        Vf = 1;
        PV = 0;
        PQ = 0;
    }
}
/*End code section*/"
                        }
                        [
                            position = 8144, 8192
                            size = 56, 168
                        ]

                        component gen_digital_probe PQ_mode {
                        }
                        [
                            position = 8264, 8256
                        ]

                        port Enable_outer_loop {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7992, 8128
                        ]

                        port Q_control_mode {
                            position = left:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7992, 8256
                        ]

                        port P_control_mode {
                            position = left:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7992, 8192
                        ]

                        connect State.Q Q_control_mode as Connection3
                        connect Enable_outer_loop State.enable as Connection1
                        connect State.P P_control_mode as Connection2
                        connect PV_mode.in State.PV as Connection4
                        connect State.Vf Vf_mode.in as Connection5
                        connect State.PQ PQ_mode.in as Connection6
                    }
                    [
                        position = 7728, 8448
                        size = 96, 96
                    ]

                    component gen_round Round1 {
                        round_fn = "round"
                    }
                    [
                        position = 7208, 7656
                        hide_name = True
                    ]

                    component Subsystem Freq_setpoint_control {
                        layout = dynamic
                        component gen_probe delta_w {
                            addr = "8975"
                            execution_rate = "Ts"
                        }
                        [
                            position = 9056, 8288
                            rotation = left
                        ]

                        component gen_product Product2 {
                            signs = "3"
                        }
                        [
                            position = 8032, 7936
                            hide_name = True
                        ]

                        component gen_gain "w to wpu" {
                            execution_rate = "Ts"
                            gain = "1/(2*np.pi*f/pms)"
                        }
                        [
                            position = 7880, 8016
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_sum Sum7 {
                        }
                        [
                            position = 8976, 8344
                            hide_name = True
                        ]

                        component gen_sum Sum6 {
                            execution_rate = "Ts"
                            signs = "-+"
                        }
                        [
                            position = 8616, 7952
                            hide_name = True
                            scale = 1, -1
                        ]

                        component gen_probe w_sp {
                        }
                        [
                            position = 8712, 7992
                        ]

                        component gen_sum Sum5 {
                            execution_rate = "Ts"
                        }
                        [
                            position = 8168, 7944
                            hide_name = True
                            scale = 1, -1
                        ]

                        component gen_product Product3 {
                            signs = "3"
                        }
                        [
                            position = 8152, 8056
                            hide_name = True
                        ]

                        component sys_signal_switch w_switch {
                            threshold = "0.5"
                        }
                        [
                            position = 8400, 8512
                            hide_name = True
                        ]

                        component src_constant w_Droop {
                            execution_rate = "Ts"
                            value = "w_droop"
                        }
                        [
                            position = 8120, 8296
                        ]

                        component sys_signal_switch mode_switch {
                            criterion = "ctrl > threshold"
                            execution_rate = "Ts"
                            threshold = "0.5"
                        }
                        [
                            position = 8776, 8352
                            hide_name = True
                        ]

                        component gen_rate_limiter w_ramp {
                            falling_limit = "w_fall"
                            rising_limit = "w_rise"
                        }
                        [
                            position = 8472, 8512
                            hide_name = True
                        ]

                        component gen_sum Sum3 {
                            signs = "+-"
                        }
                        [
                            position = 9184, 8352
                        ]

                        component src_constant zero1 {
                            execution_rate = "Ts"
                            value = "0.0"
                        }
                        [
                            position = 8280, 8528
                            hide_name = True
                        ]

                        component gen_rate_limiter P_ramp {
                            falling_limit = "P_fall"
                            rising_limit = "P_rise"
                        }
                        [
                            position = 7936, 7936
                            hide_name = True
                        ]

                        component sys_signal_switch load_share_switch {
                            criterion = "ctrl > threshold"
                            execution_rate = "Ts"
                            threshold = "0.5"
                        }
                        [
                            position = 8888, 8232
                            hide_name = True
                        ]

                        component gen_limiter P_limit {
                            lower_limit = "0.0"
                            upper_limit = "1.0/1.25"
                        }
                        [
                            position = 7872, 7936
                            hide_name = True
                        ]

                        component gen_probe w_Pm {
                        }
                        [
                            position = 8360, 8016
                            rotation = left
                        ]

                        component gen_gain P_3ph_to_pu {
                            execution_rate = "Ts"
                            gain = "1.0/Sb"
                        }
                        [
                            position = 7960, 8352
                            rotation = down
                            scale = -1, 1
                        ]

                        component Subsystem PI {
                            layout = dynamic
                            component gen_gain Ki {
                                gain = "w_sp_Ki"
                            }
                            [
                                position = 8008, 8216
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8320, 8312
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_gain Kb {
                            }
                            [
                                position = 8216, 8312
                                scale = -1, 1
                            ]

                            component gen_integrator Integrator1 {
                                limit_lower = "[\'-inf\']"
                                limit_upper = "[\'inf\']"
                                show_reset = "either"
                            }
                            [
                                position = 8216, 8232
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                            }
                            [
                                position = 8320, 8224
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 8088, 8224
                                hide_name = True
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "w_sp_lowLim"
                                upper_limit = "w_sp_upLim"
                            }
                            [
                                position = 8408, 8224
                                hide_name = True
                            ]

                            component gen_gain Kp {
                                gain = "w_sp_Kp"
                            }
                            [
                                position = 8008, 8152
                            ]

                            port Reset {
                                label = "Reset"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8144, 8264
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7872, 8184
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8224
                            ]

                            junction Junction2 sp
                            [
                                position = 8368, 8224
                            ]

                            junction Junction3 sp
                            [
                                position = 8440, 8224
                            ]

                            junction Junction4 sp
                            [
                                position = 7928, 8184
                            ]

                            connect Kp.out Sum5.in as Connection55
                            connect Limit1.out Junction3 as Connection47
                            connect Sum5.in1 Integrator1.out as Connection5
                            connect Sum5.out Junction2 as Connection44
                            connect Kp.in Junction4 as Connection57
                            connect Sum6.in Junction2 as Connection46
                            connect Integrator1.reset Reset as Connection2
                            connect Sum6.in1 Junction3 as Connection49
                            connect Junction2 Limit1.in as Connection45
                            connect Sum7.out Integrator1.in as Connection52
                            connect Junction3 Out as Connection48
                            connect Sum7.in1 Kb.out as Connection53
                            connect Junction4 In as Connection58
                            connect Kb.in Sum6.out as Connection50
                            connect Ki.in Junction4 as Connection59
                            connect Ki.out Sum7.in as Connection54
                        }
                        [
                            position = 9296, 8352
                            size = 64, 48
                        ]

                        component gen_sum Sum8 {
                            execution_rate = "Ts"
                            signs = "-+"
                        }
                        [
                            position = 8608, 8368
                            hide_name = True
                        ]

                        component gen_product Product1 {
                        }
                        [
                            position = 8208, 8344
                            hide_name = True
                        ]

                        component sys_signal_switch mode_switch1 {
                            criterion = "ctrl > threshold"
                            execution_rate = "Ts"
                            threshold = "0.5"
                        }
                        [
                            position = 9408, 8368
                            hide_name = True
                        ]

                        component src_constant P_Droop {
                            execution_rate = "Ts"
                            value = "P_droop"
                        }
                        [
                            position = 7864, 7864
                        ]

                        component sys_signal_switch f_droop_switch {
                            criterion = "ctrl > threshold"
                            execution_rate = "Ts"
                            threshold = "0.5"
                        }
                        [
                            position = 8360, 8360
                            hide_name = True
                        ]

                        component gen_probe w_Psp {
                        }
                        [
                            position = 8360, 7904
                            rotation = left
                        ]

                        port Pmeas_in {
                            position = left:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7864, 8352
                            rotation = down
                            scale = -1, 1
                        ]

                        port P_ref {
                            position = left:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7808, 7936
                        ]

                        port enable {
                            position = left:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8312, 8280
                        ]

                        port w_meas {
                            position = left:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7808, 8016
                            rotation = down
                            scale = -1, 1
                        ]

                        port w_ref {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8320, 8496
                            rotation = down
                            scale = -1, 1
                        ]

                        port Load_Share {
                            position = left:18
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8800, 8200
                        ]

                        port w_bias {
                            position = auto:auto
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9480, 8368
                        ]

                        port Load_Share_on {
                            position = left:17
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8824, 8136
                        ]

                        port P_mode {
                            position = left:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8712, 8288
                        ]

                        tag From3 {
                            value = "zero"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8800, 8248
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto2 {
                            value = "zero"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8416, 8568
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From5 {
                            value = "enable"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9216, 8272
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From2 {
                            value = "zero"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8280, 8376
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From4 {
                            value = "w_meas"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9096, 8360
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto4 {
                            value = "enable"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8440, 8280
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto1 {
                            value = "P_droop"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8064, 7864
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto3 {
                            value = "w_meas"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7968, 8040
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From7 {
                            value = "zero"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9320, 8416
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From1 {
                            value = "P_droop"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8064, 8056
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From6 {
                            value = "enable"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8344, 8440
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction4 sp
                        [
                            position = 8072, 8016
                        ]

                        junction Junction6 sp
                        [
                            position = 8056, 8352
                        ]

                        junction Junction7 sp
                        [
                            position = 8344, 8528
                        ]

                        junction Junction8 sp
                        [
                            position = 7992, 8016
                        ]

                        junction Junction9 sp
                        [
                            position = 8360, 7944
                        ]

                        junction Junction10 sp
                        [
                            position = 8360, 8056
                        ]

                        junction Junction11 sp
                        [
                            position = 8656, 7992
                        ]

                        junction Junction12 sp
                        [
                            position = 9056, 8344
                        ]

                        junction Junction13 sp
                        [
                            position = 7920, 8016
                        ]

                        junction Junction14 sp
                        [
                            position = 8360, 8280
                        ]

                        junction Junction15 sp
                        [
                            position = 9296, 8272
                        ]

                        junction Junction16 sp
                        [
                            position = 7992, 7864
                        ]

                        comment Comment2 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">w'_sp</span></p></body></html> ENDCOMMENT 
                        [
                            position = 8384, 8328
                        ]

                        comment Comment4 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">w_P_sp</span></p></body></html> ENDCOMMENT 
                        [
                            position = 8208, 7912
                        ]

                        comment Comment7 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">w''_sp</span></p></body></html> ENDCOMMENT 
                        [
                            position = 8640, 8376
                        ]

                        comment Comment3 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">w_sp</span></p></body></html> ENDCOMMENT 
                        [
                            position = 8512, 8384
                        ]

                        comment Comment5 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">Power setpoint loop</span></p></body></html> ENDCOMMENT 
                        [
                            position = 7904, 7816
                        ]

                        comment Comment6 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">w''_sp</span></p></body></html> ENDCOMMENT 
                        [
                            position = 8656, 8056
                            rotation = right
                        ]

                        comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">Frequency setpoint loop</span></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:10pt;"><br /></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">w'_sp = f_rated*Droop*Ppu</span></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:10pt;"><br /></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">Ppu = Pmeas/Prated</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:10pt;">f_rated = 1pu</span></p></body></html> ENDCOMMENT 
                        [
                            position = 8008, 8392
                        ]

                        connect Goto2 Junction7 as Connection654
                        connect Goto3 Junction13 as Connection698
                        connect Goto4 Junction14 as Connection710
                        connect Junction10 Sum6.in as Connection682
                        connect Junction11 Sum6.out as Connection685
                        connect Junction12 Sum7.out as Connection693
                        connect Junction13 Junction8 as Connection697
                        connect Junction14 f_droop_switch.in2 as Connection709
                        connect Junction15 PI.Reset as Connection715
                        connect Junction16 Goto1 as Connection725
                        connect Junction4 Junction8 as Connection674
                        connect Junction6 Product1.in1 as Connection648
                        connect Junction7 w_switch.in1 as Connection653
                        connect Junction8 Product2.in2 as Connection675
                        connect Junction9 Sum5.out as Connection679
                        connect Load_Share load_share_switch.in as Connection659
                        connect Load_Share_on load_share_switch.in2 as Connection718
                        connect P_3ph_to_pu.out Junction6 as Connection647
                        connect P_Droop.out Junction16 as Connection726
                        connect P_limit.in P_ref as Connection721
                        connect P_mode mode_switch.in2 as Connection719
                        connect P_ramp.in P_limit.out as Connection720
                        connect Pmeas_in P_3ph_to_pu.in as Connection58
                        connect Product2.in Junction16 as Connection724
                        connect From1 Product3.in1 as Connection631
                        connect Product2.in1 P_ramp.out as Connection645
                        connect From2 f_droop_switch.in1 as Connection655
                        connect Product3.out Junction10 as Connection681
                        connect Product3.in Junction4 as Connection626
                        connect From3 load_share_switch.in1 as Connection656
                        connect Product3.in2 Junction6 as Connection649
                        connect From5 Junction15 as Connection714
                        connect Sum3.in1 From4 as Connection707
                        connect From6 w_switch.in2 as Connection711
                        connect Sum3.in Junction12 as Connection694
                        connect From7 mode_switch1.in1 as Connection717
                        connect Sum3.out PI.In as Connection687
                        connect Sum5.in Junction4 as Connection624
                        connect Sum5.in1 Product2.out as Connection611
                        connect Sum6.in1 Junction9 as Connection678
                        connect Sum8.in f_droop_switch.out as Connection637
                        connect Sum8.in1 w_ramp.out as Connection638
                        connect delta_w.in Junction12 as Connection692
                        connect enable Junction14 as Connection708
                        connect f_droop_switch.in Product1.out as Connection634
                        connect load_share_switch.out Sum7.in as Connection650
                        connect mode_switch.in Junction11 as Connection684
                        connect mode_switch.out Sum7.in1 as Connection644
                        connect mode_switch.in1 Sum8.out as Connection643
                        connect mode_switch1.in2 Junction15 as Connection716
                        connect mode_switch1.in PI.Out as Connection712
                        connect "w to wpu.out" Junction13 as Connection696
                        connect w_Droop.out Product1.in as Connection722
                        connect w_Pm.in Junction10 as Connection683
                        connect w_Psp.in Junction9 as Connection680
                        connect w_bias mode_switch1.out as Connection713
                        connect w_meas "w to wpu.in" as Connection677
                        connect w_ramp.in w_switch.out as Connection103
                        connect w_ref w_switch.in as Connection180
                        connect w_sp.in Junction11 as Connection686
                        connect zero1.out Junction7 as Connection652
                    }
                    [
                        position = 7696, 8224
                        size = 120, 264
                    ]

                    port wmeas {
                        position = right:13
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7840, 8320
                    ]

                    port T_in {
                        position = right:12
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7272, 8280
                    ]

                    port Meas_feedback {
                        position = left:13
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7208, 8024
                    ]

                    port From_synch_check {
                        position = left:11
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6864, 7856
                    ]

                    port To_synch_check {
                        position = left:12
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8456, 8112
                        rotation = left
                    ]

                    port T_out {
                        position = right:14
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8176, 8240
                    ]

                    port Inputs {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6864, 7960
                    ]

                    port Vf_out {
                        position = right:11
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8272, 7816
                    ]

                    tag From12 {
                        value = "P_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 7896
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From47 {
                        value = "enable_outer_loop"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 7832
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From54 {
                        value = "ss_speed"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8336, 8336
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto42 {
                        value = "Load_Share"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8312
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto13 {
                        value = "w_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8168
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From69 {
                        value = "P_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 7960
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From59 {
                        value = "enable_outer_loop"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7840, 8104
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto12 {
                        value = "V_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8144
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto14 {
                        value = "P_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8192
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto35 {
                        value = "StandBy"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7416, 7856
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From49 {
                        value = "StandBy"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8336, 8264
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From16 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8336, 8240
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From9 {
                        value = "dw_Synch"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7840, 8256
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From56 {
                        value = "w_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8208
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto39 {
                        value = "Exciter_on"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7864, 7728
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto46 {
                        value = "pf_meas"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7392, 8224
                        hide_name = True
                        size = 58, 20
                    ]

                    tag From15 {
                        value = "w_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8112
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From4 {
                        value = "enable_outer_loop"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8176
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From62 {
                        value = "P_control_mode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8272
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From72 {
                        value = "w_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8336, 8432
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From66 {
                        value = "P_control_mode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 7864
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From58 {
                        value = "P_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7840, 8288
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto44 {
                        value = "Q_control_mode"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7464, 8448
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto9 {
                        value = "w_meas"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7952, 8392
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From5 {
                        value = "enable_outer_loop"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8424
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From52 {
                        value = "dV"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7912, 7832
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto10 {
                        value = "dw_Synch"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7048, 7832
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From70 {
                        value = "pf_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 7928
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto37 {
                        value = "dV"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7048, 7880
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto36 {
                        value = "GridFollow"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7504, 7896
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto3 {
                        value = "Vt_meas"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7392, 8200
                        hide_name = True
                        size = 58, 20
                    ]

                    tag From13 {
                        value = "V_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7912, 7768
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto43 {
                        value = "P_control_mode"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7464, 8416
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto45 {
                        value = "Q_active"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7872, 8024
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto32 {
                        value = "Gen_OP_mode"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8240
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From27 {
                        value = "pf_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 7992
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From65 {
                        value = "Q_active"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8472
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From67 {
                        value = "Gen_control_mode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7192, 8432
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From7 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7576, 7688
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From8 {
                        value = "w_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7576, 7720
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto2 {
                        value = "Q_meas"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7392, 8176
                        hide_name = True
                        size = 58, 20
                    ]

                    tag From68 {
                        value = "w_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7840, 8192
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto11 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8120
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto16 {
                        value = "Gen_control_mode"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8264
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto4 {
                        value = "GCB_status"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7048, 7856
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From46 {
                        value = "GCB_status"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7128, 7696
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From51 {
                        value = "GridForm"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8336, 8288
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto33 {
                        value = "enable_outer_loop"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7320, 7976
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From6 {
                        value = "P_control_mode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8448
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From63 {
                        value = "Load_Share_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8304
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From45 {
                        value = "Gen_OP_mode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7128, 7656
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From11 {
                        value = "Q_control_mode"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 7800
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto34 {
                        value = "GridForm"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7416, 8008
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto40 {
                        value = "Load_Share_On"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8288
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From10 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7840, 8160
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto1 {
                        value = "P_meas"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7392, 8152
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From71 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8336, 8400
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From2 {
                        value = "P_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8240
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto38 {
                        value = "ss_speed"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8088, 8440
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From60 {
                        value = "enable_outer_loop"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7944, 7664
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From50 {
                        value = "GridFollow"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8336, 8312
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From3 {
                        value = "Vt_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7912, 7864
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From1 {
                        value = "Q_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8024
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto15 {
                        value = "pf_ref"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7120, 8216
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From14 {
                        value = "P_ref"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8144
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From64 {
                        value = "Load_Share"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7552, 8336
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From61 {
                        value = "Q_meas"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7912, 7896
                        hide_name = True
                        size = 0, 0
                    ]

                    junction Junction13 sp
                    [
                        position = 7800, 7704
                    ]

                    junction Junction14 sp
                    [
                        position = 7888, 8392
                    ]

                    junction Junction15 sp
                    [
                        position = 7800, 7704
                    ]

                    junction Junction18 sp
                    [
                        position = 8224, 7816
                    ]

                    junction Junction22 sp
                    [
                        position = 7056, 8120
                    ]

                    junction Junction23 sp
                    [
                        position = 7888, 8320
                    ]

                    junction Junction24 sp
                    [
                        position = 8128, 8240
                    ]

                    junction Junction25 sp
                    [
                        position = 7368, 7888
                    ]

                    junction Junction26 sp
                    [
                        position = 7456, 7928
                    ]

                    junction Junction27 sp
                    [
                        position = 7368, 7952
                    ]

                    connect Goto9 Junction14 as Connection599
                    connect From16 "Bus Join1.in" as Connection576
                    connect From69 "pf Control.P_meas" as Connection709
                    connect Governor_and_Engine.w_meas_in Junction23 as Connection696
                    connect From27 "pf Control.pf_meas" as Connection693
                    connect From7 Start_Exciter.Gen_On as Connection589
                    connect Governor_and_Engine.T_out Junction24 as Connection705
                    connect From3 Exciter.Vt_in as Connection179
                    connect From70 "pf Control.pf_ref" as Connection708
                    connect Junction13 Exciter.Start as Connection596
                    connect Junction15 Junction13 as Connection605
                    connect From45 Round1.in as Connection570
                    connect From71 Output.Gen_On as Connection713
                    connect Junction18 Exciter.Vf_out as Connection645
                    connect From46 "Unit Delay1.in" as Connection581
                    connect From72 Output.w_meas as Connection714
                    connect Junction22 Goto11 as Connection674
                    connect From49 "Bus Join1.in1" as Connection609
                    connect From8 Start_Exciter.w_meas as Connection590
                    connect Junction23 Junction14 as Connection695
                    connect Junction24 T.in as Connection704
                    connect From5 Read_Control_mode.Enable_outer_loop as Connection187
                    connect From9 Governor_and_Engine.dw_synch as Connection698
                    connect Meas_feedback "Bus Split1.in" as Connection712
                    connect From50 "Bus Join1.in3" as Connection611
                    connect Gen_On.in Junction22 as Connection673
                    connect Start_Exciter.Start Junction13 as Connection595
                    connect Goto1 "Bus Split1.out" as Connection174
                    connect From51 "Bus Join1.in2" as Connection610
                    connect T_in Termination1.in as Connection166
                    connect Goto10 "Bus Split2.out" as Connection531
                    connect From52 Exciter.dV as Connection585
                    connect T_out Junction24 as Connection703
                    connect Goto12 "Bus Split3.out1" as Connection676
                    connect From54 "Bus Join1.in4" as Connection612
                    connect "Unit Delay2.out" Governor_and_Engine.GCB_status as Connection702
                    connect Goto14 "Bus Split3.out3" as Connection678
                    connect "Unit Delay3.out" Exciter.GCB_status as Connection633
                    connect From56 Freq_setpoint_control.w_meas as Connection650
                    connect Vf.in Junction18 as Connection644
                    connect Goto16 "Bus Split3.out6" as Connection681
                    connect From58 Governor_and_Engine.P_meas as Connection697
                    connect Vf_out Junction18 as Connection646
                    connect Goto2 "Bus Split1.out1" as Connection175
                    connect From59 "Unit Delay2.in" as Connection622
                    connect check_steady_state_w.w_meas Junction14 as Connection601
                    connect Goto3 "Bus Split1.out2" as Connection176
                    connect From6 Read_Control_mode.P_control_mode as Connection188
                    connect "pf Control.dV_out" Exciter.Delta_V_in as Connection710
                    connect Goto32 "Bus Split3.out5" as Connection680
                    connect "pf Control.Q_meas_in" From1 as Connection552
                    connect From60 "Unit Delay3.in" as Connection632
                    connect Goto37 "Bus Split2.out2" as Connection584
                    connect "pf Control.Q_control_mode" From11 as Connection549
                    connect From61 Exciter.Q_meas as Connection634
                    connect Goto38 check_steady_state_w.ss_speed as Connection602
                    connect "pf Control.Pref" From12 as Connection551
                    connect From62 Freq_setpoint_control.P_mode as Connection653
                    connect Goto39 Junction15 as Connection606
                    connect "pf Control.enable" From47 as Connection550
                    connect From63 Freq_setpoint_control.Load_Share_on as Connection654
                    connect Goto42 "Bus Split3.out8" as Connection688
                    connect wmeas Junction23 as Connection694
                    connect From64 Freq_setpoint_control.Load_Share as Connection655
                    connect Goto43 Define_control_mode.P_Control as Connection690
                    connect Goto35 Junction25 as Connection718
                    connect From65 Read_Control_mode.Q_control_mode as Connection685
                    connect Goto44 Define_control_mode.Q_Control as Connection689
                    connect Junction25 StandBy.in as Connection719
                    connect From66 "pf Control.P_control_mode" as Connection686
                    connect read_OP_mode.StandBy Junction25 as Connection720
                    connect Goto45 "pf Control.Q_active" as Connection707
                    connect From67 Define_control_mode.Gen_Control_Mode as Connection691
                    connect Goto36 Junction26 as Connection721
                    connect Goto46 "Bus Split1.out3" as Connection711
                    connect From68 Governor_and_Engine.w_ref as Connection701
                    connect Junction26 GridFollowing.in as Connection722
                    connect read_OP_mode.GridFollowing Junction26 as Connection723
                    connect GridForming.in Junction27 as Connection724
                    connect Junction27 Goto34 as Connection725
                    connect read_OP_mode.GridForming Junction27 as Connection726
                    connect read_OP_mode.enable Goto33 as Connection727
                    connect read_OP_mode.GCB_status "Unit Delay1.out" as Connection728
                    connect Round1.out read_OP_mode.OP_mode as Connection729
                    connect "Bus Join1.out" To_synch_check as Connection608
                    connect "Bus Split2.in" From_synch_check as Connection205
                    connect "Bus Split2.out1" Goto4 as Connection543
                    connect "Bus Split3.out2" Goto13 as Connection677
                    connect "Bus Split3.out4" Goto15 as Connection679
                    connect "Bus Split3.out7" Goto40 as Connection687
                    connect "Bus Split3.in" Inputs as Connection672
                    connect "Bus Split3.out" Junction22 as Connection675
                    connect Exciter_on.in Junction15 as Connection604
                    connect Freq_setpoint_control.P_ref From14 as Connection648
                    connect Freq_setpoint_control.Pmeas_in From2 as Connection651
                    connect Freq_setpoint_control.enable From4 as Connection649
                    connect Freq_setpoint_control.w_bias Governor_and_Engine.w_bias as Connection706
                    connect From10 "Governor_and_Engine.Gen On" as Connection700
                    connect From15 Freq_setpoint_control.w_ref as Connection647
                    connect From13 Exciter.Vref as Connection226
                }
                [
                    position = 9088, 8056
                    scale = -1, 1
                    size = 208, 200
                ]

                component Subsystem Sync_Check {
                    layout = dynamic
                    component Subsystem Calculate_dw_synch {
                        layout = dynamic
                        component src_constant zero {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8384, 8136
                        ]

                        component tm_delay "Unit Delay1" {
                        }
                        [
                            position = 8400, 8040
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_dw {
                            a_coeff = "[1.0/(2*np.pi*1),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 8200, 8104
                        ]

                        component gen_sum Sum4 {
                        }
                        [
                            position = 8112, 8104
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch1" {
                            threshold = "0.5"
                        }
                        [
                            position = 8456, 8120
                            hide_name = True
                        ]

                        component gen_gain dw_K {
                            gain = "dw_K"
                        }
                        [
                            position = 8272, 8104
                        ]

                        port dw_phase {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8024, 8112
                        ]

                        port dw_f {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8024, 8048
                        ]

                        port dw_synch {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8528, 8120
                        ]

                        port Activate {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8328, 8040
                        ]

                        connect "Unit Delay1.out" "Signal switch1.in2" as Connection181
                        connect dw_K.in LPF_dw.out as Connection241
                        connect dw_synch "Signal switch1.out" as Connection177
                        connect Sum4.out LPF_dw.in as Connection240
                        connect zero.out "Signal switch1.in1" as Connection179
                        connect Sum4.in1 dw_phase as Connection231
                        connect dw_K.out "Signal switch1.in" as Connection242
                        connect dw_f Sum4.in as Connection239
                        connect "Unit Delay1.in" Activate as Connection180
                    }
                    [
                        position = 8952, 8216
                        size = 128, 208
                    ]

                    component gen_probe dV {
                    }
                    [
                        position = 8608, 7928
                        rotation = left
                    ]

                    component gen_bus_join "Bus Join2" {
                        inputs = "3"
                    }
                    [
                        position = 8704, 8664
                        hide_name = True
                    ]

                    component gen_probe dw_synch {
                    }
                    [
                        position = 9056, 8168
                        rotation = left
                    ]

                    component gen_digital_probe V_match {
                    }
                    [
                        position = 8728, 7968
                        rotation = left
                    ]

                    component Subsystem Contactor_Control {
                        layout = dynamic
                        component gen_logic_op and {
                            inputs = "5"
                        }
                        [
                            position = 7792, 8296
                        ]

                        component gen_logic_op or {
                            operator = "OR"
                        }
                        [
                            position = 8072, 8400
                            hide_name = True
                        ]

                        component gen_logic_op not {
                            operator = "NOT"
                        }
                        [
                            position = 7968, 8368
                            hide_name = True
                        ]

                        component gen_terminator Termination12 {
                        }
                        [
                            position = 8248, 8312
                            hide_name = True
                        ]

                        component gen_digital_probe GCB_cmd {
                        }
                        [
                            position = 8256, 8224
                            rotation = left
                        ]

                        component gen_sr_ff "SR Flip Flop1" {
                        }
                        [
                            position = 8168, 8296
                            hide_name = True
                        ]

                        component gen_digital_probe GCB_control {
                        }
                        [
                            position = 7848, 8248
                            rotation = left
                        ]

                        component sys_signal_switch "Signal switch1" {
                            threshold = "0.5"
                        }
                        [
                            position = 8072, 8280
                            hide_name = True
                        ]

                        component gen_bus_split "Bus Split1" {
                            outputs = "3"
                        }
                        [
                            position = 7488, 8032
                            rotation = right
                            hide_name = True
                        ]

                        component "core/Edge Detection" "Edge Detection1" {
                        }
                        [
                            position = 7536, 8320
                            hide_name = True
                            size = 32, 32
                        ]

                        component gen_c_function wait_to_trip {
                            global_variables = "real time_acc;"
                            in_terminal_dimensions = "inherit;inherit"
                            in_terminal_dimensions_str = "boolean inherit;Reset inherit"
                            in_terminal_labels = "False;False;"
                            in_terminal_properties = "inherit boolean;inherit Reset;"
                            init_fnc = "/*Begin code section*/
time_acc = 0;
Trip = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "Trip inherit"
                            out_terminal_labels = "False;"
                            out_terminal_properties = "real Trip;"
                            output_fnc = "/*Begin code section*/
if(time_acc>=3.0){
    Trip = 1;
}
else{
    time_acc += execution_rate*boolean;
}
if(Reset ==1){
    time_acc = 0;
    Trip = 0;
}
/*End code section*/"
                        }
                        [
                            position = 7616, 8296
                            size = 48, 48
                        ]

                        component src_constant Close {
                            execution_rate = "Ts"
                        }
                        [
                            position = 7992, 8248
                        ]

                        port GCB {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8304, 8280
                        ]

                        port GCB_Control {
                            position = top:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7488, 7960
                            rotation = right
                        ]

                        port V_match {
                            position = left:5
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7712, 8408
                            rotation = left
                        ]

                        port ss_speed {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7728, 8200
                            rotation = right
                        ]

                        port phase_match {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 8232
                            rotation = right
                        ]

                        port Gen_on {
                            position = left:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7880, 8368
                        ]

                        port f_match {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7680, 8432
                            rotation = left
                        ]

                        tag Goto31 {
                            value = "GridFollow"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7592, 8120
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto30 {
                            value = "GridForm"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7592, 8096
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From36 {
                            value = "GridFollow"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7432, 8288
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto29 {
                            value = "StandBy"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7592, 8072
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From35 {
                            value = "StandBy"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7888, 8432
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From34 {
                            value = "GridForm"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8000, 8184
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction32 sp
                        [
                            position = 8256, 8280
                        ]

                        junction Junction34 sp
                        [
                            position = 7848, 8296
                        ]

                        junction Junction35 sp
                        [
                            position = 7488, 8288
                        ]

                        connect Goto31 "Bus Split1.out2" as Connection544
                        connect phase_match and.in1 as Connection554
                        connect Junction32 GCB as Connection529
                        connect ss_speed and.in as Connection553
                        connect Junction34 GCB_control.in as Connection551
                        connect wait_to_trip.Reset "Edge Detection1.Out1" as Connection562
                        connect Junction35 From36 as Connection560
                        connect wait_to_trip.boolean Junction35 as Connection561
                        connect "SR Flip Flop1.out" Junction32 as Connection530
                        connect "Bus Split1.in" GCB_Control as Connection541
                        connect wait_to_trip.Trip and.in2 as Connection555
                        connect "Signal switch1.in1" Junction34 as Connection550
                        connect "Bus Split1.out" Goto29 as Connection542
                        connect "Signal switch1.out" "SR Flip Flop1.s_in" as Connection527
                        connect Close.out "Signal switch1.in" as Connection129
                        connect Termination12.in "SR Flip Flop1.out_n" as Connection55
                        connect "Edge Detection1.In1" Junction35 as Connection559
                        connect V_match and.in4 as Connection557
                        connect From34 "Signal switch1.in2" as Connection534
                        connect and.out Junction34 as Connection552
                        connect From35 or.in1 as Connection535
                        connect f_match and.in3 as Connection556
                        connect GCB_cmd.in Junction32 as Connection528
                        connect Gen_on not.in as Connection517
                        connect or.out "SR Flip Flop1.r_in" as Connection501
                        connect or.in not.out as Connection499
                        connect Goto30 "Bus Split1.out1" as Connection543
                    }
                    [
                        position = 9280, 8392
                        size = 176, 168
                    ]

                    component gen_bus_join "Bus Join" {
                        inputs = "3"
                    }
                    [
                        position = 9192, 8048
                        rotation = right
                        hide_name = True
                    ]

                    component Subsystem Output {
                        layout = dynamic

                        port GCB_status {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8080, 8160
                        ]

                        tag Goto7 {
                            value = "GCB_status"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8200, 8160
                            hide_name = True
                            size = 0, 0
                        ]

                        connect Goto7 GCB_status as Connection630
                    }
                    [
                        position = 9392, 8624
                        size = 48, 48
                    ]

                    component gen_logic_op and2 {
                        inputs = "5"
                    }
                    [
                        position = 9120, 8576
                        rotation = left
                        hide_name = True
                    ]

                    component Subsystem PLLs {
                        layout = dynamic
                        component gen_probe V_grid {
                        }
                        [
                            position = 8296, 8096
                        ]

                        component gen_probe wt_gen {
                        }
                        [
                            position = 8464, 8280
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/(2*np.pi)"
                        }
                        [
                            position = 8128, 8208
                            hide_name = True
                        ]

                        component gen_probe wt_grid {
                        }
                        [
                            position = 8464, 8144
                        ]

                        component gen_bus_split split {
                            outputs = "3"
                        }
                        [
                            position = 8096, 7936
                            rotation = right
                            hide_name = True
                        ]

                        component Subsystem PLL_Grid {
                            layout = dynamic
                            component gen_terminator Term1 {
                            }
                            [
                                position = 8128, 8152
                                rotation = left
                                hide_name = True
                            ]

                            component gen_z_domain_transfer LPF_Vt {
                                a_coeff = "[1.0/(2*np.pi*fc_vt),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 8328, 8224
                            ]

                            component gen_terminator Term {
                            }
                            [
                                position = 8104, 8112
                                rotation = left
                                hide_name = True
                            ]

                            component Subsystem PLL {
                                layout = dynamic
                                component tm_delay "Unit Delay1" {
                                }
                                [
                                    position = 8480, 8272
                                    rotation = right
                                ]

                                component Subsystem Normalize {
                                    layout = dynamic
                                    component gen_c_function V_terminal {
                                        in_terminal_dimensions_str = "d inherit;q inherit;"
                                        in_terminal_labels = "False;False;"
                                        in_terminal_properties = "real d;inherit q;"
                                        init_fnc = "/*Begin code section*/
d = 0;
q = 0;
t = 0;
/*End code section*/"
                                        no_feed_inputs = "[u\'\']"
                                        no_feed_outputs = "[u\'\']"
                                        out_terminal_dimensions_str = "t inherit;q_pu inherit;"
                                        out_terminal_labels = "False;False;"
                                        out_terminal_properties = "real t;inherit q_pu;"
                                        output_fnc = "/*Begin code section*/
t = (powf(d,2.0)+powf(q,2.0));
t = sqrt(t);
if(t<0.1){
    q_pu = q/0.1;
}
else{
    q_pu = q/t;
}
/*End code section*/"
                                    }
                                    [
                                        position = 8192, 8192
                                        size = 0, 0
                                    ]

                                    port d {
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8048, 8152
                                    ]

                                    port q_pu {
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8352, 8200
                                    ]

                                    port q {
                                        position = left:2
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8048, 8216
                                    ]

                                    port Vt {
                                        position = top:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8280, 8104
                                        rotation = left
                                    ]

                                    connect V_terminal.t Vt as Connection8
                                    connect V_terminal.d d as Connection1
                                    connect V_terminal.q q as Connection3
                                    connect q_pu V_terminal.q_pu as Connection9
                                }
                                [
                                    position = 8128, 8136
                                    size = 64, 64
                                ]

                                component Subsystem ABC_dqz {
                                    layout = dynamic
                                    component gen_alpha_beta2d_q "alpha beta to dq" {
                                    }
                                    [
                                        position = 8248, 8192
                                    ]

                                    component gen_abc2alpha_beta "abc to alpha beta" {
                                    }
                                    [
                                        position = 8024, 8192
                                    ]

                                    port z {
                                        position = right:3
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8096, 8288
                                        rotation = right
                                    ]

                                    port B {
                                        position = left:2
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7904, 8104
                                        rotation = right
                                    ]

                                    port wt {
                                        position = left:4
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8176, 8288
                                        rotation = left
                                    ]

                                    port A {
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7952, 8104
                                        rotation = right
                                    ]

                                    port q {
                                        position = right:2
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8368, 8136
                                        rotation = left
                                    ]

                                    port C {
                                        position = left:3
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7856, 8104
                                        rotation = right
                                    ]

                                    port d {
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8320, 8136
                                        rotation = left
                                    ]

                                    connect d "alpha beta to dq.d" as Connection2692
                                    connect "abc to alpha beta.beta" "alpha beta to dq.beta" as Connection2689
                                    connect q "alpha beta to dq.q" as Connection2693
                                    connect "abc to alpha beta.A" A as Connection2685
                                    connect "alpha beta to dq.alpha" "abc to alpha beta.alpha" as Connection2688
                                    connect z "abc to alpha beta.gamma" as Connection2691
                                    connect "abc to alpha beta.B" B as Connection2686
                                    connect "alpha beta to dq.wt" wt as Connection2690
                                    connect "abc to alpha beta.C" C as Connection2687
                                }
                                [
                                    position = 7912, 8152
                                    size = 48, 104
                                ]

                                component gen_c_function integrator {
                                    global_variables = "real out;"
                                    in_terminal_dimensions_str = "in inherit;"
                                    in_terminal_labels = "False;"
                                    init_fnc = "/*Begin code section*/
out = 0;
in = 0;
/*End code section*/"
                                    no_feed_inputs = "[u\'\']"
                                    no_feed_outputs = "[u\'\']"
                                    out_terminal_dimensions_str = "output inherit;"
                                    out_terminal_labels = "False;"
                                    out_terminal_properties = "inherit output;"
                                    output_fnc = "/*Begin code section*/
output = out+0.0;
/*End code section*/"
                                    parameters = "real Ts;"
                                    update_fnc = "/*Begin code section*/
out += Ts*in;

if(in>=0.0){
    if(out >= 6.283185307179586)
    {
        out -= 6.283185307179586;
    }
}
else{
        if(out <= -6.283185307179586)
    {
        out += 6.283185307179586;
    }
}
/*End code section*/"
                                }
                                [
                                    position = 8424, 8136
                                    size = 0, 0
                                ]

                                component gen_gain rads_to_Hz {
                                    gain = "1/(2*np.pi)"
                                }
                                [
                                    position = 8360, 8056
                                ]

                                component Subsystem PI {
                                    layout = dynamic
                                    component gen_gain Kb {
                                        gain = "1000"
                                    }
                                    [
                                        position = 8200, 8304
                                        scale = -1, 1
                                    ]

                                    component gen_sum Sum6 {
                                        signs = "-+"
                                    }
                                    [
                                        position = 8304, 8304
                                        hide_name = True
                                        scale = -1, 1
                                    ]

                                    component gen_sum Sum8 {
                                    }
                                    [
                                        position = 8272, 8176
                                        hide_name = True
                                    ]

                                    component gen_gain Ki {
                                        gain = "Ki"
                                    }
                                    [
                                        position = 7960, 8208
                                    ]

                                    component gen_sum Sum7 {
                                    }
                                    [
                                        position = 8072, 8216
                                        hide_name = True
                                    ]

                                    component gen_integrator Integrator1 {
                                        init_value = "[2*np.pi*f]"
                                    }
                                    [
                                        position = 8176, 8216
                                        hide_name = True
                                    ]

                                    component gen_gain Kp {
                                        gain = "Kp"
                                    }
                                    [
                                        position = 8088, 8144
                                    ]

                                    component gen_limiter Limit1 {
                                        lower_limit = "0.7*2*np.pi*f"
                                        upper_limit = "1.4*2*np.pi*f"
                                    }
                                    [
                                        position = 8416, 8176
                                        hide_name = True
                                    ]

                                    port Out {
                                        position = left:auto
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8544, 8176
                                        rotation = down
                                        scale = -1, 1
                                    ]

                                    port In {
                                        position = right:auto
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7840, 8144
                                        rotation = down
                                        scale = -1, 1
                                    ]

                                    junction Junction161 sp
                                    [
                                        position = 7904, 8144
                                    ]

                                    junction Junction162 sp
                                    [
                                        position = 8368, 8176
                                    ]

                                    junction Junction163 sp
                                    [
                                        position = 8456, 8176
                                    ]

                                    connect Sum6.in Junction162 as Connection370
                                    connect Sum6.in1 Junction163 as Connection373
                                    connect Sum7.out Integrator1.in as Connection365
                                    connect Sum7.in1 Kb.out as Connection53
                                    connect Sum7.in Ki.out as Connection364
                                    connect Integrator1.out Sum8.in1 as Connection352
                                    connect Junction161 In as Connection360
                                    connect Sum8.out Junction162 as Connection368
                                    connect Junction161 Ki.in as Connection359
                                    connect Junction161 Kp.in as Connection358
                                    connect Junction162 Limit1.in as Connection369
                                    connect Junction163 Out as Connection372
                                    connect Kb.in Sum6.out as Connection50
                                    connect Kp.out Sum8.in as Connection350
                                    connect Limit1.out Junction163 as Connection371
                                }
                                [
                                    position = 8256, 8136
                                    scale = -1, -1
                                    size = 48, 48
                                ]

                                component gen_terminator Term {
                                }
                                [
                                    position = 8008, 8216
                                    rotation = right
                                ]

                                port B {
                                    label = "B"
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7776, 8176
                                    rotation = left
                                ]

                                port C {
                                    label = "C"
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7816, 8200
                                    rotation = left
                                ]

                                port d {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8056, 8008
                                ]

                                port q {
                                    label = "q"
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8056, 8056
                                ]

                                port Vt {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8192, 8064
                                ]

                                port wt {
                                    position = right:5
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8528, 8136
                                ]

                                port A {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7736, 8152
                                    rotation = left
                                ]

                                port f {
                                    position = right:4
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8424, 8056
                                ]

                                junction Junction4 sp
                                [
                                    position = 8480, 8136
                                ]

                                junction Junction5 sp
                                [
                                    position = 8320, 8136
                                ]

                                junction Junction6 sp
                                [
                                    position = 8008, 8120
                                ]

                                junction Junction7 sp
                                [
                                    position = 8024, 8152
                                ]

                                connect wt Junction4 as Connection212
                                connect B ABC_dqz.B as Connection232
                                connect Junction4 "Unit Delay1.in" as Connection213
                                connect Junction5 integrator.in as Connection218
                                connect Junction6 d as Connection224
                                [
                                    position = 0, 0
                                ]
                                connect Junction7 Normalize.q as Connection227
                                [
                                    position = 0, 0
                                ]
                                connect Normalize.d Junction6 as Connection223
                                connect PI.Out Junction5 as Connection219
                                connect PI.In Normalize.q_pu as Connection220
                                connect "Unit Delay1.out" ABC_dqz.wt as Connection230
                                connect Vt Normalize.Vt as Connection184
                                connect ABC_dqz.A A as Connection233
                                connect f rads_to_Hz.out as Connection199
                                connect ABC_dqz.C C as Connection231
                                connect integrator.output Junction4 as Connection214
                                connect ABC_dqz.d Junction6 as Connection225
                                connect q Junction7 as Connection226
                                connect ABC_dqz.q Junction7 as Connection228
                                connect rads_to_Hz.in Junction5 as Connection217
                                connect ABC_dqz.z Term.in as Connection229

                                f = "f"

                                mask {
                                    description = "Simple PLL with wrapped wt"

                                    Kp {
                                        label = "Proportional gain"
                                        widget = edit
                                        type = generic
                                        default_value = "100"
                                    }

                                    Ki {
                                        label = "Integral gain"
                                        widget = edit
                                        type = generic
                                        default_value = "3200"
                                    }

                                    f {
                                        label = "Target frequency"
                                        widget = edit
                                        type = generic
                                        default_value = "60"
                                        unit = "Hz"
                                    }

                                    Ts {
                                        label = "Execution rate"
                                        widget = edit
                                        type = generic
                                        default_value = "Ts"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                        
                                    ENDCODE
                                }
                            }
                            [
                                position = 8048, 8224
                                rotation = down
                                scale = -1, -1
                                size = 64, 136
                            ]

                            component gen_z_domain_transfer LPF_f {
                                a_coeff = "[1.0/(2*np.pi*fc_f),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 8216, 8248
                            ]

                            port Va {
                                label = "Va"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7928, 8176
                            ]

                            port Vb {
                                label = "Vb"
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7928, 8224
                            ]

                            port Vc {
                                label = "Vc"
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7928, 8272
                            ]

                            port Vt {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8392, 8224
                            ]

                            port f {
                                label = "f"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8248
                            ]

                            port wt {
                                label = "wt"
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8152, 8272
                            ]

                            connect LPF_Vt.in PLL.Vt as Connection12
                            connect LPF_f.in PLL.f as Connection10
                            connect PLL.A Va as Connection1
                            connect wt PLL.wt as Connection6
                            connect PLL.C Vc as Connection3
                            connect Term.in PLL.d as Connection7
                            connect Term1.in PLL.q as Connection8
                            connect Vb PLL.B as Connection2
                            connect Vt LPF_Vt.out as Connection11
                            connect f LPF_f.out as Connection9

                            fc_f = "10.0"
                            fc_vt = "10.0"

                            mask {
                                fc_vt {
                                    label = "Vt channel LPF cut-off freq."
                                    widget = edit
                                    type = generic
                                    default_value = "0"
                                }

                                fc_f {
                                    label = "f channel LPF cut-off freq."
                                    widget = edit
                                    type = generic
                                    default_value = "0"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 8184, 8024
                            size = 72, 120
                        ]

                        component gen_sum Sum1 {
                            signs = "+-"
                        }
                        [
                            position = 8464, 8216
                            hide_name = True
                        ]

                        component gen_probe V_gen {
                        }
                        [
                            position = 8216, 8352
                        ]

                        component gen_bus_split split1 {
                            outputs = "3"
                        }
                        [
                            position = 8072, 8360
                            rotation = left
                            hide_name = True
                        ]

                        port Vgrid {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8360, 8064
                        ]

                        port Vgen {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8216, 8288
                        ]

                        port V_Grid {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 7888
                        ]

                        port V_Gen {
                            label = "V_Gen"
                            position = left:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 8416
                        ]

                        port f_Gen {
                            label = "f_Gen"
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8216, 8208
                        ]

                        port "Phase diff" {
                            position = right:6
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8544, 8216
                        ]

                        port f_Grid {
                            label = "f_Grid"
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8360, 7984
                        ]

                        tag From2 {
                            value = "wt_grid"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8352, 8208
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto2 {
                            value = "wt_grid"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8288, 8024
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction15 sp
                        [
                            position = 8400, 8208
                        ]

                        junction Junction23 sp
                        [
                            position = 8264, 8064
                        ]

                        junction Junction27 sp
                        [
                            position = 8400, 8248
                        ]

                        junction Junction28 sp
                        [
                            position = 8160, 8288
                        ]

                        connect Junction23 V_grid.in as Connection329
                        connect wt_gen.in Junction27 as Connection351
                        connect Junction27 Sum1.in1 as Connection352
                        connect wt_grid.in Junction15 as Connection272
                        connect Junction28 V_gen.in as Connection356
                        connect PLL_Grid.wt Goto2 as Connection294
                        connect PLL_Grid.Vt Junction23 as Connection328
                        connect PLL_Grid.Vb split.out1 as Connection324
                        connect "Phase diff" Sum1.out as Connection336
                        connect V_Grid split.in as Connection134
                        connect Vgen Junction28 as Connection355
                        connect Vgrid Junction23 as Connection330
                        connect f_Grid PLL_Grid.f as Connection327
                        connect From2 Junction15 as Connection270
                        connect split.out2 PLL_Grid.Vc as Connection322
                        connect Gain1.out f_Gen as Connection342
                        connect split.out PLL_Grid.Va as Connection325
                        connect Gain1.in split1.out as Connection349
                        connect split1.out1 Junction27 as Connection353
                        connect Junction15 Sum1.in as Connection271
                        connect split1.out2 Junction28 as Connection357
                        connect split1.in V_Gen as Connection348
                    }
                    [
                        position = 8288, 8136
                        size = 104, 360
                    ]

                    component gen_probe dw_phase {
                    }
                    [
                        position = 8744, 8256
                        rotation = left
                    ]

                    component gen_digital_probe Speed_ss {
                    }
                    [
                        position = 9160, 8280
                        rotation = left
                    ]

                    component Subsystem check_V_diff {
                        layout = dynamic
                        component gen_rel_op greater_equal {
                            relational_op = ">="
                        }
                        [
                            position = 7960, 8272
                            hide_name = True
                        ]

                        component src_constant one1 {
                            execution_rate = "Ts"
                        }
                        [
                            position = 7776, 8224
                        ]

                        component gen_sum Sum1 {
                            signs = "+-"
                        }
                        [
                            position = 8056, 8144
                            hide_name = True
                        ]

                        component gen_gain pu1 {
                            gain = "1.0/(Vn/((3.0/2.0)**0.5))"
                        }
                        [
                            position = 7880, 8176
                            hide_name = True
                        ]

                        component gen_rel_op less_equal {
                            relational_op = "<="
                        }
                        [
                            position = 7960, 8216
                            hide_name = True
                        ]

                        component gen_logic_op and {
                        }
                        [
                            position = 8048, 8248
                            hide_name = True
                        ]

                        component gen_probe V_diff {
                        }
                        [
                            position = 8168, 8104
                            rotation = left
                        ]

                        component gen_abs Abs3 {
                        }
                        [
                            position = 8264, 8216
                            hide_name = True
                        ]

                        component src_constant one {
                            execution_rate = "Ts"
                        }
                        [
                            position = 8200, 8256
                        ]

                        component Subsystem PI {
                            layout = dynamic
                            component gen_integrator Integrator1 {
                                limit_lower = "-1"
                                limit_upper = "1"
                                show_reset = "either"
                            }
                            [
                                position = 8216, 8232
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 8088, 8224
                            ]

                            component gen_gain Kb {
                            }
                            [
                                position = 8216, 8312
                                scale = -1, 1
                            ]

                            component gen_gain Kp {
                                gain = "V_Kp"
                            }
                            [
                                position = 8024, 8168
                            ]

                            component gen_sum Sum5 {
                            }
                            [
                                position = 8320, 8224
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8320, 8312
                                scale = -1, 1
                            ]

                            component gen_gain Ki {
                                gain = "V_Ki"
                            }
                            [
                                position = 7976, 8216
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "V_lowLim"
                                upper_limit = "V_upLim"
                            }
                            [
                                position = 8408, 8224
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8224
                            ]

                            port Reset {
                                label = "Reset"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8144, 8264
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7888, 8168
                            ]

                            junction Junction2 sp
                            [
                                position = 8368, 8224
                            ]

                            junction Junction3 sp
                            [
                                position = 8440, 8224
                            ]

                            junction Junction4 sp
                            [
                                position = 7944, 8168
                            ]

                            connect Kp.out Sum5.in as Connection55
                            connect Limit1.out Junction3 as Connection47
                            connect Sum5.in1 Integrator1.out as Connection5
                            connect Sum5.out Junction2 as Connection44
                            connect Sum6.in Junction2 as Connection46
                            connect In Junction4 as Connection58
                            connect Sum6.in1 Junction3 as Connection49
                            connect Sum7.out Integrator1.in as Connection52
                            connect Integrator1.reset Reset as Connection2
                            connect Sum7.in1 Kb.out as Connection53
                            connect Junction2 Limit1.in as Connection45
                            connect Junction3 Out as Connection48
                            connect Junction4 Kp.in as Connection59
                            connect Kb.in Sum6.out as Connection50
                            connect Ki.in Junction4 as Connection60
                            connect Ki.out Sum7.in as Connection56
                        }
                        [
                            position = 8272, 8144
                            size = 64, 48
                        ]

                        component src_constant zero {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8360, 8176
                            hide_name = True
                        ]

                        component gen_gain Volt_diff {
                            gain = "delta_V/100.0"
                        }
                        [
                            position = 8264, 8256
                        ]

                        component gen_comparator Comparator1 {
                        }
                        [
                            position = 8336, 8224
                            hide_name = True
                            scale = 1, -1
                        ]

                        component sys_signal_switch "Signal switch1" {
                            threshold = "0.5"
                        }
                        [
                            position = 8432, 8160
                            hide_name = True
                        ]

                        component gen_gain Vgrid_upLim {
                            gain = "1.1"
                        }
                        [
                            position = 7864, 8224
                        ]

                        component gen_gain pu {
                            gain = "1.0/(Vn/((3.0/2.0)**0.5))"
                        }
                        [
                            position = 8128, 8144
                        ]

                        component gen_abs Abs4 {
                        }
                        [
                            position = 7816, 8176
                            hide_name = True
                        ]

                        component tm_delay "Unit Delay1" {
                        }
                        [
                            position = 8144, 8064
                            hide_name = True
                        ]

                        component gen_gain Vgrid_lowLim {
                            gain = "0.9"
                        }
                        [
                            position = 7864, 8280
                        ]

                        port Vgen {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7968, 8152
                        ]

                        port dV {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8496, 8160
                        ]

                        port Activate {
                            position = top:auto
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8064, 8064
                        ]

                        port V_match {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8400, 8224
                        ]

                        port Grid_On {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8128, 8248
                        ]

                        port Vgrid {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7712, 8136
                        ]

                        junction Junction6 sp
                        [
                            position = 7912, 8208
                        ]

                        junction Junction7 sp
                        [
                            position = 7816, 8224
                        ]

                        junction Junction2 sp
                        [
                            position = 8168, 8144
                        ]

                        junction Junction3 sp
                        [
                            position = 8168, 8144
                        ]

                        junction Junction4 sp
                        [
                            position = 8272, 8064
                        ]

                        junction Junction5 sp
                        [
                            position = 7776, 8136
                        ]

                        connect PI.In Junction3 as Connection217
                        connect less_equal.out and.in as Connection228
                        connect PI.Reset Junction4 as Connection220
                        connect PI.Out "Signal switch1.in" as Connection214
                        connect Abs3.in Junction2 as Connection202
                        connect one.out Volt_diff.in as Connection14
                        connect one1.out Junction7 as Connection238
                        connect "Signal switch1.in2" Junction4 as Connection218
                        connect Abs4.in Junction5 as Connection227
                        connect pu.in Sum1.out as Connection198
                        connect Sum1.in Junction5 as Connection225
                        connect Abs4.out pu1.in as Connection235
                        connect pu1.out Junction6 as Connection236
                        connect Sum1.in1 Vgen as Connection60
                        connect Activate "Unit Delay1.in" as Connection208
                        connect zero.out "Signal switch1.in1" as Connection179
                        connect V_diff.in Junction3 as Connection215
                        connect Comparator1.in2 Abs3.out as Connection10
                        connect V_match Comparator1.out as Connection187
                        connect Grid_On and.out as Connection241
                        connect Vgrid_lowLim.in Junction7 as Connection240
                        connect Junction2 pu.out as Connection201
                        connect Vgrid_lowLim.out greater_equal.in1 as Connection237
                        connect Vgrid_upLim.out less_equal.in1 as Connection234
                        connect Junction3 Junction2 as Connection216
                        connect Junction4 "Unit Delay1.out" as Connection219
                        connect Volt_diff.out Comparator1.in1 as Connection17
                        connect dV "Signal switch1.out" as Connection181
                        connect Junction5 Vgrid as Connection226
                        connect greater_equal.in Junction6 as Connection233
                        connect Junction6 less_equal.in as Connection232
                        connect greater_equal.out and.in1 as Connection229
                        connect Junction7 Vgrid_upLim.in as Connection239
                    }
                    [
                        position = 8520, 8016
                        size = 144, 120
                    ]

                    component Subsystem check_f_diff {
                        layout = dynamic
                        component src_constant Constant1 {
                            execution_rate = "Ts"
                            value = "f"
                        }
                        [
                            position = 8120, 8256
                        ]

                        component gen_gain toPU {
                            gain = "[1.0/(2.0*f)]"
                        }
                        [
                            position = 8216, 8152
                        ]

                        component gen_probe f_diff {
                        }
                        [
                            position = 8168, 8104
                            rotation = left
                        ]

                        component gen_comparator Comparator1 {
                        }
                        [
                            position = 8280, 8224
                            hide_name = True
                            scale = 1, -1
                        ]

                        component gen_sum Sum1 {
                            signs = "+-"
                        }
                        [
                            position = 8056, 8152
                            hide_name = True
                        ]

                        component gen_abs Abs3 {
                        }
                        [
                            position = 8208, 8216
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_dwf {
                            a_coeff = "[1.0/(2*np.pi*1),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 8128, 8152
                        ]

                        component gen_gain Freq_diff {
                            gain = "delta_f/100.0"
                        }
                        [
                            position = 8208, 8256
                        ]

                        port dw_f {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8336, 8152
                        ]

                        port f_Grid {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7880, 8144
                        ]

                        port f_Gen {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7968, 8160
                        ]

                        port f_match {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8336, 8224
                        ]

                        junction Junction1 sp
                        [
                            position = 8168, 8152
                        ]

                        connect Freq_diff.out Comparator1.in1 as Connection17
                        connect Junction1 LPF_dwf.out as Connection61
                        connect LPF_dwf.in Sum1.out as Connection62
                        connect Sum1.in1 f_Gen as Connection60
                        connect Sum1.in f_Grid as Connection57
                        connect f_diff.in Junction1 as Connection56
                        connect toPU.in Junction1 as Connection40
                        connect toPU.out dw_f as Connection63
                        connect Abs3.in Junction1 as Connection7
                        connect Comparator1.in2 Abs3.out as Connection10
                        connect Comparator1.out f_match as Connection59
                        connect Constant1.out Freq_diff.in as Connection14
                    }
                    [
                        position = 8520, 8176
                        size = 144, 120
                    ]

                    component gen_digital_probe Phase_match {
                    }
                    [
                        position = 8720, 8400
                        rotation = right
                    ]

                    component gen_digital_probe f_match {
                    }
                    [
                        position = 8624, 8176
                        rotation = left
                    ]

                    component gen_logic_op not {
                        operator = "NOT"
                    }
                    [
                        position = 9032, 8632
                        hide_name = True
                    ]

                    component gen_digital_probe dw_synch_ON {
                    }
                    [
                        position = 9248, 8536
                    ]

                    component gen_digital_probe Check_phase_ON {
                    }
                    [
                        position = 8592, 8440
                    ]

                    component gen_probe dw_f {
                    }
                    [
                        position = 8744, 8096
                        rotation = left
                    ]

                    component Subsystem check_phase_diff {
                        layout = dynamic
                        component gen_probe phase_diff {
                        }
                        [
                            position = 7992, 7928
                            rotation = left
                        ]

                        component gen_abs Abs2 {
                        }
                        [
                            position = 8064, 8096
                            rotation = right
                            hide_name = True
                        ]

                        component gen_gain Phase_diff {
                            gain = "delta_phi*np.pi/180.0"
                        }
                        [
                            position = 8088, 8160
                        ]

                        component gen_c_function offset_phase {
                            global_variables = "real off1;real off2;"
                            in_terminal_dimensions = "inherit"
                            in_terminal_dimensions_str = "phase inherit"
                            in_terminal_labels = "[(\'phase\', True)]"
                            in_terminal_properties = "inherit phase;"
                            init_fnc = "/*Begin code section*/
phase_out = 0;
off1 = execution_rate*6.2831853071*f;
off2 = phaseOff*3.141592653589793/180.0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "phase_out inherit"
                            out_terminal_labels = "[(\'phase_out\', True)]"
                            out_terminal_properties = "real phase_out;"
                            output_fnc = "/*Begin code section*/
phase_out = phase - off1 + off2;
/*End code section*/"
                            parameters = "real f;real phaseOff;"
                        }
                        [
                            position = 7888, 7976
                            size = 0, 0
                        ]

                        component gen_z_domain_transfer LPF {
                            a_coeff = "[1.0/(2*np.pi*0.5),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 8032, 7976
                        ]

                        component gen_comparator Comparator2 {
                        }
                        [
                            position = 8160, 8152
                            hide_name = True
                            scale = 1, -1
                        ]

                        component Subsystem PI {
                            layout = dynamic
                            component gen_gain Kp {
                                gain = "phase_Kp"
                            }
                            [
                                position = 8032, 8168
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "phase_lowLim"
                                upper_limit = "phase_upLim"
                            }
                            [
                                position = 8408, 8224
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 8088, 8224
                            ]

                            component gen_sum Sum5 {
                            }
                            [
                                position = 8320, 8224
                            ]

                            component gen_integrator Integrator1 {
                                limit_lower = "phase_lowLim"
                                limit_upper = "phase_upLim"
                                show_reset = "either"
                            }
                            [
                                position = 8216, 8232
                            ]

                            component gen_gain Kb {
                            }
                            [
                                position = 8216, 8312
                                scale = -1, 1
                            ]

                            component gen_gain Ki {
                                gain = "phase_Ki"
                            }
                            [
                                position = 7984, 8216
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8320, 8312
                                scale = -1, 1
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8224
                            ]

                            port Reset {
                                label = "Reset"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8144, 8264
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7912, 8168
                            ]

                            junction Junction2 sp
                            [
                                position = 8368, 8224
                            ]

                            junction Junction3 sp
                            [
                                position = 8440, 8224
                            ]

                            junction Junction4 sp
                            [
                                position = 7952, 8168
                            ]

                            connect Kp.out Sum5.in as Connection55
                            connect Limit1.out Junction3 as Connection47
                            connect Sum5.in1 Integrator1.out as Connection5
                            connect Sum5.out Junction2 as Connection44
                            connect Sum6.in Junction2 as Connection46
                            connect In Junction4 as Connection57
                            connect Sum6.in1 Junction3 as Connection49
                            connect Integrator1.reset Reset as Connection2
                            connect Sum7.out Integrator1.in as Connection52
                            connect Sum7.in1 Kb.out as Connection53
                            connect Junction2 Limit1.in as Connection45
                            connect Junction3 Out as Connection48
                            connect Junction4 Kp.in as Connection58
                            connect Kb.in Sum6.out as Connection50
                            connect Ki.in Junction4 as Connection59
                            connect Ki.out Sum7.in as Connection54
                        }
                        [
                            position = 8240, 7976
                            size = 64, 48
                        ]

                        component gen_probe phase_filter {
                        }
                        [
                            position = 8112, 8040
                        ]

                        component gen_product Product1 {
                        }
                        [
                            position = 8384, 7968
                            hide_name = True
                        ]

                        component gen_c_function confine_phase {
                            in_terminal_dimensions = "inherit"
                            in_terminal_dimensions_str = "dtheta inherit"
                            in_terminal_labels = "False;"
                            in_terminal_properties = "real dtheta;"
                            init_fnc = "/*Begin code section*/
dtheta = 0;
dtheta_confined = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "dtheta_confined inherit"
                            out_terminal_labels = "False;"
                            out_terminal_properties = "real dtheta_confined;"
                            output_fnc = "/*Begin code section*/
if (dtheta > 3.14159265359) {//confine theta to +/- 2*pi;
    dtheta_confined = dtheta - 6.28318530718;
}
else{
    if (dtheta < -3.14159265359){
        dtheta_confined = dtheta + 6.28318530718;
    }
    else{
        dtheta_confined = dtheta;
    }
}
/*End code section*/"
                        }
                        [
                            position = 7776, 7976
                            size = 0, 0
                        ]

                        component src_constant One {
                            execution_rate = "Ts"
                        }
                        [
                            position = 8024, 8160
                        ]

                        component gen_gain to_pu {
                            gain = "1.0/(2*np.pi)"
                        }
                        [
                            position = 8128, 7976
                        ]

                        component Subsystem Counter {
                            layout = dynamic
                            component gen_logic_op not {
                                operator = "NOT"
                            }
                            [
                                position = 8104, 8248
                            ]

                            component "core/Counter" Counter1 {
                            }
                            [
                                position = 8192, 8200
                                size = 48, 48
                            ]

                            component gen_c_function c_function {
                                in_terminal_dimensions = "inherit"
                                in_terminal_dimensions_str = "counter inherit"
                                in_terminal_labels = "False;"
                                in_terminal_properties = "real counter;"
                                no_feed_inputs = "[\'\']"
                                no_feed_outputs = "[\'\']"
                                out_terminal_dimensions = "inherit"
                                out_terminal_dimensions_str = "out inherit"
                                out_terminal_labels = "False;"
                                output_fnc = "/*Begin code section*/
if(counter>=0.1/execution_rate){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                            }
                            [
                                position = 8288, 8200
                                size = 0, 0
                            ]

                            port Out {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8368, 8200
                            ]

                            port In {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8008, 8192
                            ]

                            junction Junction14 sp
                            [
                                position = 8056, 8192
                            ]

                            connect c_function.counter Counter1.out as Connection563
                            connect Counter1.en Junction14 as Connection559
                            connect c_function.out Out as Connection564
                            connect Junction14 In as Connection562
                            connect not.out Counter1.reset as Connection88
                            connect Junction14 not.in as Connection560
                        }
                        [
                            position = 8256, 8152
                            size = 48, 48
                        ]

                        port dw_phase {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8464, 7968
                        ]

                        port phase_Diff {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7688, 7976
                        ]

                        port phase_match {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8360, 8152
                        ]

                        port Activate {
                            position = bottom:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8240, 7864
                            rotation = left
                            scale = 1, -1
                        ]

                        junction Junction15 sp
                        [
                            position = 8064, 7976
                        ]

                        junction Junction17 sp
                        [
                            position = 8064, 8040
                        ]

                        junction Junction21 sp
                        [
                            position = 8240, 7912
                        ]

                        junction Junction22 sp
                        [
                            position = 7992, 7976
                        ]

                        connect Activate Junction21 as Connection622
                        connect phase_filter.in Junction17 as Connection592
                        connect Comparator2.in2 Abs2.out as Connection712
                        connect phase_match Counter.Out as Connection673
                        connect Comparator2.out Counter.In as Connection674
                        connect to_pu.in Junction15 as Connection581
                        connect Junction15 LPF.out as Connection582
                        connect to_pu.out PI.In as Connection713
                        connect Junction17 Junction15 as Connection591
                        connect Junction21 PI.Reset as Connection693
                        connect Junction21 Product1.in as Connection623
                        connect Junction22 LPF.in as Connection732
                        connect One.out Phase_diff.in as Connection15
                        connect Phase_diff.out Comparator2.in1 as Connection49
                        connect Product1.in1 PI.Out as Connection692
                        connect confine_phase.dtheta phase_Diff as Connection721
                        connect dw_phase Product1.out as Connection714
                        connect offset_phase.phase_out Junction22 as Connection733
                        connect offset_phase.phase confine_phase.dtheta_confined as Connection734
                        connect Abs2.in Junction17 as Connection590
                        connect phase_diff.in Junction22 as Connection731
                    }
                    [
                        position = 8528, 8328
                        size = 168, 112
                    ]

                    component gen_bus_split "Bus Split1" {
                        outputs = "5"
                    }
                    [
                        position = 8632, 8560
                        rotation = right
                        hide_name = True
                    ]

                    component gen_logic_op and1 {
                    }
                    [
                        position = 8464, 8440
                        hide_name = True
                    ]

                    port V_grid {
                        position = left:11
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8184, 7976
                    ]

                    port GCB {
                        position = bottom:auto
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 9464, 8392
                    ]

                    port To_Gen_Control {
                        position = right:11
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 9248, 8104
                    ]

                    port From_Gen_Control {
                        position = right:12
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8512, 8512
                    ]

                    port V_gen {
                        position = right:13
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8184, 8296
                    ]

                    tag From47 {
                        value = "Activate"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8824, 8216
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From33 {
                        value = "GCB_status"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8920, 8632
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From48 {
                        value = "Activate"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8456, 7936
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto20 {
                        value = "GCB_status"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 9480, 8352
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto31 {
                        value = "Activate"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 9176, 8512
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto22 {
                        value = "f_match"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8680, 8216
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From44 {
                        value = "GCB_control"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9280, 8240
                        rotation = right
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto29 {
                        value = "GCB_control"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8792, 8664
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From53 {
                        value = "Activate"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8368, 8472
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From49 {
                        value = "dV"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9088, 7992
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From55 {
                        value = "Grid_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8920, 8744
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From42 {
                        value = "dw_synch"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9088, 7944
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto33 {
                        value = "V_match"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8784, 8016
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto36 {
                        value = "Grid_On"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8656, 8056
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From45 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8920, 8672
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto25 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8736, 8608
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From41 {
                        value = "GCB_status"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9088, 7968
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto34 {
                        value = "ss_speed"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8736, 8744
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From37 {
                        value = "f_match"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9104, 8392
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From52 {
                        value = "ss_speed"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8920, 8720
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From46 {
                        value = "GridFollow"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8920, 8696
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From40 {
                        value = "ss_speed"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9104, 8328
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto30 {
                        value = "GridFollow"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8736, 8720
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto32 {
                        value = "dV"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8664, 7976
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From39 {
                        value = "Gen_On"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9104, 8424
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto28 {
                        value = "dw_synch"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 9120, 8216
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From30 {
                        value = "f_match"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8368, 8432
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From50 {
                        value = "V_match"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9104, 8456
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From56 {
                        value = "GCB_status"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9296, 8624
                        hide_name = True
                        size = 0, 0
                    ]

                    junction Junction26 sp
                    [
                        position = 9424, 8392
                    ]

                    junction Junction32 sp
                    [
                        position = 9056, 8216
                    ]

                    junction Junction34 sp
                    [
                        position = 8744, 8136
                    ]

                    junction Junction35 sp
                    [
                        position = 8624, 8216
                    ]

                    junction Junction39 sp
                    [
                        position = 9120, 8536
                    ]

                    junction Junction40 sp
                    [
                        position = 8728, 8016
                    ]

                    junction Junction41 sp
                    [
                        position = 8608, 7976
                    ]

                    junction Junction42 sp
                    [
                        position = 9160, 8328
                    ]

                    junction Junction43 sp
                    [
                        position = 8616, 8680
                    ]

                    junction Junction44 sp
                    [
                        position = 8744, 8296
                    ]

                    junction Junction45 sp
                    [
                        position = 8720, 8360
                    ]

                    junction Junction46 sp
                    [
                        position = 8528, 8440
                    ]

                    connect From39 Contactor_Control.Gen_on as Connection271
                    connect From40 Junction42 as Connection596
                    connect From41 "Bus Join.in1" as Connection528
                    connect From42 "Bus Join.in" as Connection527
                    connect From44 Contactor_Control.GCB_Control as Connection541
                    connect From47 Calculate_dw_synch.Activate as Connection556
                    connect From48 check_V_diff.Activate as Connection586
                    connect From49 "Bus Join.in2" as Connection569
                    connect From50 Contactor_Control.V_match as Connection574
                    connect From52 and2.in3 as Connection584
                    connect From53 and1.in1 as Connection585
                    connect From55 and2.in4 as Connection609
                    connect From56 Output.GCB_status as Connection625
                    connect GCB Junction26 as Connection141
                    connect Goto20 Junction26 as Connection143
                    connect Goto28 Junction32 as Connection250
                    connect Goto29 "Bus Join2.out" as Connection540
                    connect Goto30 Junction43 as Connection605
                    connect Goto31 Junction39 as Connection561
                    connect Goto32 Junction41 as Connection575
                    connect Goto33 Junction40 as Connection571
                    connect Goto34 "Bus Split1.out4" as Connection606
                    connect Goto36 check_V_diff.Grid_On as Connection608
                    connect Junction26 Contactor_Control.GCB as Connection204
                    connect Junction32 Calculate_dw_synch.dw_synch as Connection249
                    connect dw_phase.in Junction44 as Connection615
                    connect Junction34 Calculate_dw_synch.dw_f as Connection280
                    connect dw_synch.in Junction32 as Connection248
                    connect Junction35 Goto22 as Connection283
                    connect dw_synch_ON.in Junction39 as Connection563
                    connect Junction39 and2.out as Connection562
                    connect f_match.in Junction35 as Connection282
                    connect Junction40 check_V_diff.V_match as Connection572
                    connect not.in From33 as Connection551
                    connect Junction41 check_V_diff.dV as Connection576
                    connect Junction42 Speed_ss.in as Connection595
                    connect Junction43 "Bus Split1.out3" as Connection604
                    connect Junction44 Calculate_dw_synch.dw_phase as Connection616
                    connect Junction45 Phase_match.in as Connection619
                    connect Junction46 and1.out as Connection623
                    connect To_Gen_Control "Bus Join.out" as Connection259
                    connect V_gen PLLs.V_Gen as Connection587
                    connect V_grid PLLs.V_Grid as Connection588
                    connect V_match.in Junction40 as Connection573
                    connect and1.in From30 as Connection273
                    connect and2.in1 From45 as Connection553
                    connect and2.in2 From46 as Connection554
                    connect and2.in not.out as Connection552
                    connect check_V_diff.Vgen PLLs.Vgen as Connection565
                    connect check_V_diff.Vgrid PLLs.Vgrid as Connection566
                    connect check_f_diff.dw_f Junction34 as Connection281
                    connect "Bus Join2.in1" "Bus Split1.out2" as Connection601
                    connect check_f_diff.f_match Junction35 as Connection284
                    connect "Bus Join2.in" "Bus Split1.out1" as Connection600
                    connect check_f_diff.f_Grid PLLs.f_Grid as Connection278
                    connect "Bus Join2.in2" Junction43 as Connection603
                    connect check_f_diff.f_Gen PLLs.f_Gen as Connection277
                    connect "Bus Split1.in" From_Gen_Control as Connection598
                    connect check_phase_diff.dw_phase Junction44 as Connection617
                    connect "Bus Split1.out" Goto25 as Connection546
                    connect check_phase_diff.phase_match Junction45 as Connection620
                    connect check_phase_diff.Activate Junction46 as Connection624
                    connect Check_phase_ON.in Junction46 as Connection622
                    connect check_phase_diff.phase_Diff "PLLs.Phase diff" as Connection621
                    connect Contactor_Control.ss_speed Junction42 as Connection594
                    connect dV.in Junction41 as Connection577
                    connect Contactor_Control.phase_match Junction45 as Connection618
                    connect From37 Contactor_Control.f_match as Connection270
                    connect dw_f.in Junction34 as Connection279
                }
                [
                    position = 9448, 8056
                    scale = -1, 1
                    size = 144, 200
                ]

                component Subsystem Output {
                    layout = dynamic
                    component gen_bus_join "Bus Join1" {
                        inputs = "14"
                    }
                    [
                        position = 8008, 8216
                        rotation = down
                        hide_name = True
                        scale = -1, -1
                    ]

                    port Output {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8112, 8216
                    ]

                    tag From27 {
                        value = "pf"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7944, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From34 {
                        value = "Gen_On"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7632, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From22 {
                        value = "Vc"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7752, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From30 {
                        value = "P"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7872, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From25 {
                        value = "Va"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7704, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From31 {
                        value = "Vt"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7776, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From29 {
                        value = "Q"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7896, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From21 {
                        value = "Ib"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7824, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From24 {
                        value = "Ia"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7800, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From28 {
                        value = "S"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7920, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From26 {
                        value = "Ic"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7848, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From32 {
                        value = "GCB_status"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7680, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From23 {
                        value = "Vb"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From33 {
                        value = "w_meas"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7656, 8384
                        rotation = left
                        hide_name = True
                        size = 60, 20
                    ]

                    connect From24 "Bus Join1.in7" as Connection571
                    connect From25 "Bus Join1.in3" as Connection567
                    connect From26 "Bus Join1.in9" as Connection573
                    connect From27 "Bus Join1.in13" as Connection577
                    connect From28 "Bus Join1.in12" as Connection576
                    connect From29 "Bus Join1.in11" as Connection575
                    connect From30 "Bus Join1.in10" as Connection574
                    connect From31 "Bus Join1.in6" as Connection570
                    connect From32 "Bus Join1.in2" as Connection578
                    connect "Bus Join1.out" Output as Connection4
                    connect From33 "Bus Join1.in1" as Connection580
                    connect From21 "Bus Join1.in8" as Connection572
                    connect From34 "Bus Join1.in" as Connection579
                    connect From22 "Bus Join1.in5" as Connection569
                    connect From23 "Bus Join1.in4" as Connection568
                }
                [
                    position = 9696, 7968
                    size = 104, 96
                ]

                component Subsystem Measurements {
                    layout = dynamic
                    component gen_probe S {
                        addr = "17951"
                    }
                    [
                        position = 7704, 7632
                    ]

                    component Subsystem 3ph_PLL_Gen {
                        layout = dynamic
                        component Subsystem PLL {
                            layout = dynamic
                            component Subsystem ABC_dqz {
                                layout = dynamic
                                component gen_alpha_beta2d_q "alpha beta to dq" {
                                }
                                [
                                    position = 8248, 8192
                                ]

                                component gen_abc2alpha_beta "abc to alpha beta" {
                                }
                                [
                                    position = 8024, 8192
                                ]

                                port z {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8288
                                    rotation = right
                                ]

                                port B {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7904, 8104
                                    rotation = right
                                ]

                                port wt {
                                    position = left:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8176, 8288
                                    rotation = left
                                ]

                                port q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8368, 8136
                                    rotation = left
                                ]

                                port A {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7952, 8104
                                    rotation = right
                                ]

                                port C {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7856, 8104
                                    rotation = right
                                ]

                                port d {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8320, 8136
                                    rotation = left
                                ]

                                connect "abc to alpha beta.beta" "alpha beta to dq.beta" as Connection2689
                                connect d "alpha beta to dq.d" as Connection2692
                                connect "abc to alpha beta.B" B as Connection2686
                                connect q "alpha beta to dq.q" as Connection2693
                                connect z "abc to alpha beta.gamma" as Connection2691
                                connect "alpha beta to dq.alpha" "abc to alpha beta.alpha" as Connection2688
                                connect "abc to alpha beta.A" A as Connection2685
                                connect "alpha beta to dq.wt" wt as Connection2690
                                connect "abc to alpha beta.C" C as Connection2687
                            }
                            [
                                position = 7776, 8152
                                size = 48, 104
                            ]

                            component gen_z_domain_transfer LPF_q {
                                a_coeff = "[1.0/(2*np.pi*fc_q),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 7912, 8152
                                hide_name = True
                            ]

                            component Subsystem Normalize {
                                layout = dynamic
                                component gen_c_function V_terminal {
                                    in_terminal_dimensions_str = "d inherit;q inherit;"
                                    in_terminal_labels = "False;False;"
                                    in_terminal_properties = "real d;inherit q;"
                                    init_fnc = "/*Begin code section*/
d = 0;
q = 0;
t = 0;
/*End code section*/"
                                    no_feed_inputs = "[u\'\']"
                                    no_feed_outputs = "[u\'\']"
                                    out_terminal_dimensions_str = "t inherit;q_pu inherit;"
                                    out_terminal_labels = "False;False;"
                                    out_terminal_properties = "real t;inherit q_pu;"
                                    output_fnc = "/*Begin code section*/
t = (powf(d,2.0)+powf(q,2.0));
t = sqrt(t);
if(t<0.1){
    q_pu = q/0.1;
}
else{
    q_pu = q/t;
}
/*End code section*/"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port Vt {
                                    position = top:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8104
                                    rotation = left
                                ]

                                port d {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8048, 8152
                                ]

                                port q_pu {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8352, 8200
                                ]

                                port q {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8048, 8216
                                ]

                                connect V_terminal.t Vt as Connection8
                                connect V_terminal.d d as Connection1
                                connect V_terminal.q q as Connection3
                                connect q_pu V_terminal.q_pu as Connection9
                            }
                            [
                                position = 8096, 8136
                                size = 64, 64
                            ]

                            component gen_z_domain_transfer LPF_q1 {
                                a_coeff = "[1,2*zeta*(2*np.pi*fc_w),(2*np.pi*fc_w)**2.0]"
                                b_coeff = "(2*np.pi*fc_w)**2.0"
                                domain = "S-domain"
                                init_states = "2*np.pi*f"
                                method = "Bilinear"
                            }
                            [
                                position = 8376, 7984
                                hide_name = True
                            ]

                            component gen_terminator Term {
                            }
                            [
                                position = 7864, 8208
                                rotation = right
                                hide_name = True
                            ]

                            component gen_z_domain_transfer LPF_d {
                                a_coeff = "[1.0/(2*np.pi*fc_d),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 7856, 8120
                                hide_name = True
                            ]

                            component tm_delay "Unit Delay1" {
                            }
                            [
                                position = 8432, 8224
                                rotation = right
                                hide_name = True
                            ]

                            component gen_c_function integrator {
                                in_terminal_dimensions = "inherit"
                                in_terminal_dimensions_str = "in inherit"
                                in_terminal_labels = "False;"
                                init_fnc = "/*Begin code section*/
out = 0;
in = 0;
/*End code section*/"
                                no_feed_inputs = "[\'\']"
                                no_feed_outputs = "[\'\']"
                                out_terminal_dimensions = "inherit"
                                out_terminal_dimensions_str = "out inherit"
                                out_terminal_labels = "False;"
                                out_terminal_properties = "inherit out;"
                                output_fnc = "/*Begin code section*/
out += execution_rate*in;
if(in>=0.0){
    if(out >= 6.283185307179586)
    {
        out -= 6.283185307179586;
    }
}
else{
        if(out <= -6.283185307179586)
    {
        out += 6.283185307179586;
    }
}
/*End code section*/"
                            }
                            [
                                position = 8352, 8136
                                size = 0, 0
                            ]

                            component Subsystem PI {
                                layout = dynamic
                                component gen_integrator Integrator1 {
                                    init_value = "2*np.pi*f"
                                    limit_lower = "-1"
                                    limit_upper = "1"
                                }
                                [
                                    position = 8200, 8400
                                ]

                                component gen_gain Kd {
                                    gain = "Kd"
                                }
                                [
                                    position = 7928, 8216
                                ]

                                component gen_gain Gain1 {
                                    gain = "2*np.pi*fc_Kd"
                                }
                                [
                                    position = 8152, 8224
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8072, 8400
                                ]

                                component gen_integrator Integrator2 {
                                    limit_lower = "-1"
                                    limit_upper = "1"
                                }
                                [
                                    position = 8112, 8304
                                    scale = -1, 1
                                ]

                                component gen_sum Sum8 {
                                    signs = "+-"
                                }
                                [
                                    position = 8032, 8224
                                ]

                                component gen_sum Sum5 {
                                    signs = "3"
                                }
                                [
                                    position = 8328, 8224
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "lowLim*2*np.pi*f/100.0"
                                    upper_limit = "upLim*2*np.pi*f/100.0"
                                }
                                [
                                    position = 8416, 8224
                                ]

                                component gen_gain Ki {
                                    gain = "Ki"
                                }
                                [
                                    position = 7928, 8392
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8200, 8488
                                    scale = -1, 1
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8328, 8488
                                    scale = -1, 1
                                ]

                                component gen_gain Kp {
                                    gain = "Kp"
                                }
                                [
                                    position = 7928, 8136
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8480, 8224
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7752, 8216
                                ]

                                junction Junction3 sp
                                [
                                    position = 8448, 8224
                                ]

                                junction Junction7 sp
                                [
                                    position = 8224, 8224
                                ]

                                junction Junction8 sp
                                [
                                    position = 7792, 8216
                                ]

                                junction Junction9 sp
                                [
                                    position = 7792, 8216
                                ]

                                junction Junction2 sp
                                [
                                    position = 8376, 8224
                                ]

                                connect Kd.out Sum8.in as Connection80
                                connect Ki.in Junction9 as Connection92
                                connect Kp.in Junction8 as Connection89
                                connect Gain1.out Junction7 as Connection85
                                connect Kp.out Sum5.in as Connection68
                                connect Gain1.in Sum8.out as Connection61
                                connect In Junction9 as Connection94
                                connect Limit1.out Junction3 as Connection47
                                connect Sum5.out Junction2 as Connection44
                                connect Integrator1.out Sum5.in2 as Connection95
                                connect Sum5.in1 Junction7 as Connection87
                                connect Integrator2.out Sum8.in1 as Connection66
                                connect Sum6.in Junction2 as Connection46
                                connect Junction2 Limit1.in as Connection45
                                connect Junction3 Out as Connection48
                                connect Sum6.in1 Junction3 as Connection49
                                connect Sum7.out Integrator1.in as Connection52
                                connect Junction7 Integrator2.in as Connection86
                                connect Sum7.in1 Kb.out as Connection53
                                connect Junction8 Kd.in as Connection90
                                connect Sum7.in Ki.out as Connection69
                                connect Junction9 Junction8 as Connection93
                                connect Kb.in Sum6.out as Connection50
                            }
                            [
                                position = 8200, 8136
                                size = 64, 48
                            ]

                            component gen_rate_limiter "Rate Limiter1" {
                                falling_limit = "2*np.pi*w_fall"
                                rising_limit = "2*np.pi*w_rise"
                            }
                            [
                                position = 8304, 7984
                                hide_name = True
                            ]

                            port w {
                                position = right:4
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8448, 7984
                            ]

                            port B {
                                label = "B"
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7648, 8176
                                rotation = left
                            ]

                            port C {
                                label = "C"
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7688, 8200
                                rotation = left
                            ]

                            port d {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8032, 8024
                            ]

                            port q {
                                label = "q"
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8032, 8080
                            ]

                            port Vt {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8160, 8072
                            ]

                            port wt {
                                position = right:5
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8472, 8072
                            ]

                            port A {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7608, 8152
                                rotation = left
                            ]

                            junction Junction13 sp
                            [
                                position = 8264, 8136
                            ]

                            junction Junction14 sp
                            [
                                position = 7960, 8120
                            ]

                            junction Junction15 sp
                            [
                                position = 8000, 8152
                            ]

                            junction Junction6 sp
                            [
                                position = 8408, 8136
                            ]

                            connect LPF_q1.in "Rate Limiter1.out" as Connection259
                            connect Normalize.q Junction15 as Connection255
                            connect Normalize.Vt Vt as Connection211
                            connect PI.Out Junction13 as Connection247
                            connect ABC_dqz.A A as Connection266
                            connect PI.In Normalize.q_pu as Connection244
                            connect ABC_dqz.B B as Connection267
                            connect "Rate Limiter1.in" Junction13 as Connection260
                            connect ABC_dqz.C C as Connection268
                            connect "Unit Delay1.out" ABC_dqz.wt as Connection269
                            connect ABC_dqz.d LPF_d.in as Connection263
                            connect "Unit Delay1.in" Junction6 as Connection194
                            connect ABC_dqz.q LPF_q.in as Connection264
                            connect w LPF_q1.out as Connection258
                            connect ABC_dqz.z Term.in as Connection265
                            connect wt Junction6 as Connection196
                            connect Junction13 integrator.in as Connection246
                            connect Junction14 Normalize.d as Connection253
                            connect Junction14 d as Connection262
                            connect Junction15 q as Connection261
                            connect Junction6 integrator.out as Connection195
                            connect LPF_d.out Junction14 as Connection254
                            connect LPF_q.out Junction15 as Connection257

                            f = "f"
                            lowLim = "70"
                            upLim = "140"
                            w_fall = "-f/5"
                            w_rise = "f/5"

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Simple PLL with wrapped wt</span></p></body></html>"

                                Kp {
                                    label = "Proportional gain"
                                    widget = edit
                                    type = generic
                                    default_value = "100.0"
                                }

                                Ki {
                                    label = "Integral gain"
                                    widget = edit
                                    type = generic
                                    default_value = "3200.0"
                                }

                                Kd {
                                    label = "Differential gain"
                                    widget = edit
                                    type = generic
                                    default_value = "1.0"
                                }

                                fc_Kd {
                                    label = "Derivative control LPF cut-off freq."
                                    widget = edit
                                    type = generic
                                    default_value = "113.6821"
                                }

                                fc_d {
                                    label = "d channel LPF cut-off freq."
                                    widget = edit
                                    type = generic
                                    default_value = "10.0"
                                    unit = "Hz"
                                }

                                fc_q {
                                    label = "q channel LPF cut-off freq."
                                    widget = edit
                                    type = generic
                                    default_value = "10.0"
                                    unit = "Hz"
                                }

                                f {
                                    label = "Target frequency"
                                    widget = edit
                                    type = generic
                                    default_value = "60.0"
                                    unit = "Hz"
                                }

                                upLim {
                                    label = "Frequency deviation upper limit"
                                    widget = edit
                                    type = generic
                                    default_value = "10"
                                    unit = "%"
                                }

                                lowLim {
                                    label = "Frequency deviation lower limit"
                                    widget = edit
                                    type = generic
                                    default_value = "-10"
                                    unit = "%"
                                }

                                zeta {
                                    label = "w 2nd order LPF damping ratio"
                                    widget = edit
                                    type = generic
                                    default_value = "0.707"
                                }

                                fc_w {
                                    label = "w 2nd order LPF cut-off freq."
                                    widget = edit
                                    type = generic
                                    default_value = "25.0"
                                    unit = "Hz"
                                }

                                Ts {
                                    label = "Execution rate"
                                    widget = edit
                                    type = generic
                                    default_value = "Ts"
                                }

                                w_rise {
                                    label = "w Rising rate"
                                    widget = edit
                                    type = generic
                                    default_value = "0"
                                    unit = "Hz/s"
                                }

                                w_fall {
                                    label = "w Falling rate"
                                    widget = edit
                                    type = generic
                                    default_value = "0"
                                    unit = "Hz/s"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 7984, 8240
                            rotation = down
                            scale = -1, -1
                            size = 72, 152
                        ]

                        component gen_terminator Term {
                        }
                        [
                            position = 8080, 8144
                            rotation = left
                            hide_name = True
                        ]

                        component gen_terminator Term1 {
                        }
                        [
                            position = 8112, 8184
                            rotation = left
                            hide_name = True
                        ]

                        port wt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8072, 8288
                        ]

                        port Vc {
                            label = "Vc"
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7896, 8296
                        ]

                        port Vb {
                            label = "Vb"
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7896, 8240
                        ]

                        port w {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8104, 8264
                        ]

                        port Va {
                            label = "Va"
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7896, 8184
                        ]

                        port Vt {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8136, 8240
                        ]

                        connect Term1.in PLL.q as Connection5
                        connect PLL.A Va as Connection1
                        connect PLL.Vt Vt as Connection6
                        connect Vb PLL.B as Connection2
                        connect PLL.C Vc as Connection3
                        connect PLL.wt wt as Connection8
                        connect PLL.d Term.in as Connection4
                        connect w PLL.w as Connection7
                    }
                    [
                        position = 7480, 7824
                        size = 72, 120
                    ]

                    component gen_gain Gain10 {
                        gain = "1.0/(2*np.pi*f)"
                    }
                    [
                        position = 7696, 7776
                        hide_name = True
                    ]

                    component Subsystem Snubber {
                        layout = dynamic
                        component pas_resistor R20 {
                            resistance = "(Vn**2/(Sb*load/100.0))*1e6/(Vn**2/(Sb*load/100.0)+1e6)"
                        }
                        [
                            position = 8304, 7944
                            rotation = right
                        ]

                        component pas_resistor R22 {
                            resistance = "(Vn**2/(Sb*load/100.0))*1e6/(Vn**2/(Sb*load/100.0)+1e6)"
                        }
                        [
                            position = 8376, 7944
                            rotation = right
                        ]

                        component pas_resistor R21 {
                            resistance = "(Vn**2/(Sb*load/100.0))*1e6/(Vn**2/(Sb*load/100.0)+1e6)"
                        }
                        [
                            position = 8232, 7944
                            rotation = right
                        ]

                        port A {
                            position = top:4
                            kind = pe
                        }
                        [
                            position = 8232, 7848
                            rotation = right
                        ]

                        port C {
                            position = top:6
                            kind = pe
                        }
                        [
                            position = 8376, 7848
                            rotation = right
                        ]

                        port G {
                            position = bottom:3
                            kind = pe
                        }
                        [
                            position = 8304, 8112
                            rotation = left
                        ]

                        port B {
                            position = top:5
                            kind = pe
                        }
                        [
                            position = 8304, 7848
                            rotation = right
                        ]

                        junction Junction1516 pe
                        [
                            position = 8304, 8032
                        ]

                        junction Junction1517 pe
                        [
                            position = 8304, 8032
                        ]

                        connect G Junction1517 as Connection764
                        connect Junction1517 R22.n_node as Connection763
                        connect R22.p_node C as Connection760
                        connect Junction1516 Junction1517 as Connection762
                        connect Junction1516 R21.n_node as Connection755
                        connect A R21.p_node as Connection758
                        connect B R20.p_node as Connection759
                        connect R20.n_node Junction1516 as Connection698
                    }
                    [
                        position = 7664, 8384
                        size = 88, 80
                    ]

                    component gen_gain Gain9 {
                        gain = "1.0/Sb"
                    }
                    [
                        position = 7640, 7504
                        hide_name = True
                    ]

                    component gen_gain Gain8 {
                        gain = "1.0/Sb"
                    }
                    [
                        position = 7640, 7568
                        hide_name = True
                    ]

                    component "core/Current Measurement" Ib {
                        addr = "24"
                        execution_rate = "Ts"
                        frequency = "10000.0"
                        sig_output = "True"
                    }
                    [
                        position = 8096, 8176
                        scale = -1, 1
                        size = 64, 32
                    ]

                    component "core/Current Measurement" Ic {
                        addr = "26"
                        execution_rate = "Ts"
                        frequency = "10000.0"
                        sig_output = "True"
                    }
                    [
                        position = 8096, 8272
                        scale = -1, 1
                        size = 64, 32
                    ]

                    component "core/Current Measurement" Ia {
                        addr = "22"
                        execution_rate = "Ts"
                        frequency = "10000.0"
                        sig_output = "True"
                    }
                    [
                        position = 8096, 8080
                        scale = -1, 1
                        size = 64, 32
                    ]

                    component gen_probe e_f {
                    }
                    [
                        position = 7760, 7776
                    ]

                    component gen_gain Gain7 {
                        gain = "1.0/Sb"
                    }
                    [
                        position = 7640, 7632
                        hide_name = True
                    ]

                    component Subsystem "PQ measure" {
                        layout = dynamic
                        component gen_terminator Termination1 {
                        }
                        [
                            position = 8264, 8152
                            rotation = left
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_PQ_transform "PQ Power Meter1" {
                        }
                        [
                            position = 8096, 8192
                        ]

                        component gen_terminator Termination2 {
                        }
                        [
                            position = 8264, 8232
                            rotation = left
                            hide_name = True
                            scale = -1, -1
                        ]

                        port Vc {
                            position = right:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7912, 8152
                            rotation = right
                            scale = -1, 1
                        ]

                        port S {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8208, 8264
                            rotation = right
                            scale = -1, 1
                        ]

                        port Ia {
                            position = right:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7912, 8224
                            rotation = left
                            scale = -1, 1
                        ]

                        port pf {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8168, 8288
                            rotation = right
                            scale = -1, 1
                        ]

                        port Ib {
                            position = right:5
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8256
                            rotation = left
                            scale = -1, 1
                        ]

                        port Q {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8208, 8120
                            rotation = left
                            scale = -1, 1
                        ]

                        port Ic {
                            position = right:6
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8016, 8288
                            rotation = left
                            scale = -1, 1
                        ]

                        port P {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8168, 8088
                            rotation = left
                            scale = -1, 1
                        ]

                        port Va {
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8016, 8088
                            rotation = right
                            scale = -1, 1
                        ]

                        port Vb {
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8120
                            rotation = right
                            scale = -1, 1
                        ]

                        connect Vc "PQ Power Meter1.vc" as Connection15
                        connect pf "PQ Power Meter1.k_factor" as Connection12
                        connect "PQ Power Meter1.ia" Ia as Connection1
                        connect "PQ Power Meter1.ib" Ib as Connection2
                        connect "PQ Power Meter1.ic" Ic as Connection3
                        connect "PQ Power Meter1.Pdc" P as Connection4
                        connect "PQ Power Meter1.Qdc" Q as Connection5
                        connect S "PQ Power Meter1.apparent" as Connection9
                        connect Termination1.in "PQ Power Meter1.Pac" as Connection10
                        connect Termination2.in "PQ Power Meter1.Qac" as Connection11
                        connect Va "PQ Power Meter1.va" as Connection13
                        connect Vb "PQ Power Meter1.vb" as Connection14
                    }
                    [
                        position = 7424, 7600
                        scale = -1, 1
                        size = 128, 232
                    ]

                    component gen_bus_join "Bus Join3" {
                        inputs = "3"
                    }
                    [
                        position = 8080, 7792
                        rotation = right
                        hide_name = True
                        scale = -1, -1
                    ]

                    component gen_bus_join "Bus Join1" {
                        inputs = "4"
                    }
                    [
                        position = 8016, 7544
                        rotation = right
                        hide_name = True
                        scale = -1, -1
                    ]

                    component gen_probe pf {
                        addr = "17951"
                    }
                    [
                        position = 7704, 7696
                    ]

                    component gen_probe P {
                        addr = "17965"
                    }
                    [
                        position = 7704, 7504
                    ]

                    component "core/Voltage Measurement" Vc {
                        addr = "5"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 7944, 8336
                        rotation = right
                        size = 64, 32
                    ]

                    component "core/Voltage Measurement" Va {
                        addr = "3"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 7856, 8432
                        rotation = right
                        size = 64, 32
                    ]

                    component "core/Voltage Measurement" Vb {
                        addr = "4"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 7904, 8384
                        rotation = right
                        size = 64, 32
                    ]

                    component Subsystem Output {
                        layout = dynamic

                        port Q {
                            position = left:9
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8112, 8408
                        ]

                        port Vc {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8112, 8192
                        ]

                        port S {
                            position = left:10
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8440
                        ]

                        port Vt {
                            position = left:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8224
                        ]

                        port pf {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8112, 8480
                        ]

                        port Ia {
                            position = left:5
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8112, 8264
                        ]

                        port Ib {
                            position = left:6
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8296
                        ]

                        port Va {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8112, 8120
                        ]

                        port Ic {
                            position = left:7
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8112, 8336
                        ]

                        port P {
                            position = left:8
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8368
                        ]

                        port Vb {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8160, 8152
                        ]

                        tag Goto13 {
                            value = "Ic"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8336
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto14 {
                            value = "Ia"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8264
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto15 {
                            value = "Q"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8408
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto8 {
                            value = "Vb"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8152
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto16 {
                            value = "S"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8440
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto9 {
                            value = "Vc"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8192
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto17 {
                            value = "pf"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8480
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto10 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8224
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto7 {
                            value = "Va"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8120
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto11 {
                            value = "Ib"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8296
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto12 {
                            value = "P"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8256, 8368
                            hide_name = True
                            size = 0, 0
                        ]

                        connect Goto14 Ia as Connection5
                        connect Goto15 Q as Connection9
                        connect Goto17 pf as Connection11
                        connect Goto8 Vb as Connection2
                        connect Goto9 Vc as Connection3
                        connect Ib Goto11 as Connection6
                        connect P Goto12 as Connection8
                        connect S Goto16 as Connection10
                        connect Goto10 Vt as Connection4
                        connect Va Goto7 as Connection1
                        connect Goto13 Ic as Connection7
                    }
                    [
                        position = 8416, 7720
                        size = 96, 328
                    ]

                    component gen_probe Q {
                        addr = "17938"
                    }
                    [
                        position = 7704, 7568
                    ]

                    port a {
                        label = "a"
                        position = right:1
                        kind = pe
                    }
                    [
                        position = 8208, 8080
                        rotation = down
                    ]

                    port b {
                        label = "b"
                        position = right:2
                        kind = pe
                    }
                    [
                        position = 8208, 8176
                        rotation = down
                    ]

                    port c {
                        label = "c"
                        position = right:3
                        kind = pe
                    }
                    [
                        position = 8208, 8272
                        rotation = down
                    ]

                    port A {
                        label = "A"
                        position = left:1
                        kind = pe
                    }
                    [
                        position = 7520, 8080
                    ]

                    port B {
                        label = "B"
                        position = left:2
                        kind = pe
                    }
                    [
                        position = 7520, 8176
                    ]

                    port C {
                        label = "C"
                        position = left:3
                        kind = pe
                    }
                    [
                        position = 7520, 8272
                    ]

                    port Sync_fb {
                        position = top:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8080, 7728
                        rotation = left
                        scale = -1, 1
                    ]

                    port Control_fb {
                        position = top:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8016, 7472
                        rotation = left
                        scale = -1, 1
                    ]

                    tag From28 {
                        value = "S"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8232, 7816
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From7 {
                        value = "Ia"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7296, 7616
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto8 {
                        value = "Q"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7568, 7552
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto10 {
                        value = "pf"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7568, 7680
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From41 {
                        value = "Vb"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7280, 7824
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From23 {
                        value = "Vb"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8232, 7624
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From4 {
                        value = "Va"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7296, 7520
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From5 {
                        value = "Vc"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7296, 7584
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From35 {
                        value = "w"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7992, 7848
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto3 {
                        value = "Vc"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8032, 8336
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto11 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7608, 7784
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From27 {
                        value = "pf"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8296, 7840
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From43 {
                        value = "pf"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7936, 7656
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto7 {
                        value = "P"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7568, 7488
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From32 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7936, 7632
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From42 {
                        value = "Va"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7280, 7784
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From30 {
                        value = "P"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8232, 7768
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto9 {
                        value = "S"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7568, 7616
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From8 {
                        value = "Ib"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7296, 7648
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From26 {
                        value = "Ic"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8296, 7744
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From6 {
                        value = "Vb"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7296, 7552
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From21 {
                        value = "Ib"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8232, 7720
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto12 {
                        value = "w"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7704, 7824
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From9 {
                        value = "Ic"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7296, 7680
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From33 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7992, 7880
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From29 {
                        value = "Q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8296, 7792
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto5 {
                        value = "Ib"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8152, 8136
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto6 {
                        value = "Ic"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8208, 8232
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto1 {
                        value = "Va"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8032, 8432
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto13 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7608, 7864
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From34 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7992, 7912
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From22 {
                        value = "Vc"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8296, 7648
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto4 {
                        value = "Ia"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8152, 8032
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From40 {
                        value = "Vc"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7280, 7864
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From11 {
                        value = "Q"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7936, 7608
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From10 {
                        value = "P"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7936, 7584
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From24 {
                        value = "Ia"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8296, 7696
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto2 {
                        value = "Vb"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8032, 8384
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From25 {
                        value = "Va"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8296, 7600
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From31 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8232, 7672
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto14 {
                        value = "B_Gen_Vc"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8168, 8360
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto15 {
                        value = "B_Gen_Va"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8168, 8448
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto16 {
                        value = "B_Gen_Vb"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8160, 8408
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto17 {
                        value = "B_Gen_Ic"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8232, 8208
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto18 {
                        value = "B_Gen_Ia"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8224, 8016
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto19 {
                        value = "B_Gen_Ib"
                        scope = global
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8248, 8120
                        hide_name = True
                        size = 0, 0
                    ]

                    junction Junction1497 pe
                    [
                        position = 7856, 8080
                    ]

                    junction Junction1518 sp
                    [
                        position = 7520, 7504
                    ]

                    junction Junction1519 sp
                    [
                        position = 7520, 7568
                    ]

                    junction Junction1520 sp
                    [
                        position = 7520, 7632
                    ]

                    junction Junction1521 sp
                    [
                        position = 7520, 7696
                    ]

                    junction Junction1525 pe
                    [
                        position = 7904, 8176
                    ]

                    junction Junction1528 pe
                    [
                        position = 7944, 8272
                    ]

                    junction Junction1534 pe
                    [
                        position = 7904, 8504
                    ]

                    junction Junction1535 pe
                    [
                        position = 7856, 8504
                    ]

                    junction Junction1536 pe
                    [
                        position = 7640, 8080
                    ]

                    junction Junction1537 pe
                    [
                        position = 7664, 8176
                    ]

                    junction Junction1538 pe
                    [
                        position = 7688, 8272
                    ]

                    junction Junction1540 sp
                    [
                        position = 7648, 7824
                    ]

                    junction Junction1541 sp
                    [
                        position = 7984, 8336
                    ]

                    junction Junction1542 sp
                    [
                        position = 7968, 8384
                    ]

                    junction Junction1543 sp
                    [
                        position = 7976, 8432
                    ]

                    junction Junction1544 sp
                    [
                        position = 8152, 8232
                    ]

                    junction Junction1545 sp
                    [
                        position = 8112, 8136
                    ]

                    junction Junction1546 sp
                    [
                        position = 8112, 8032
                    ]

                    connect Goto12 Junction1540 as Connection906
                    connect "PQ measure.P" Junction1518 as Connection723
                    connect "PQ measure.Q" Junction1519 as Connection726
                    connect Goto13 3ph_PLL_Gen.wt as Connection907
                    connect "PQ measure.S" Junction1520 as Connection729
                    connect Q.in Gain8.out as Connection161
                    connect S.in Gain7.out as Connection192
                    connect Snubber.G Junction1535 as Connection884
                    connect Snubber.A Junction1536 as Connection887
                    connect Snubber.B Junction1537 as Connection890
                    connect Snubber.C Junction1538 as Connection893
                    connect Sync_fb "Bus Join3.out" as Connection781
                    connect Va.p_node Junction1497 as Connection487
                    connect Vb.p_node Junction1525 as Connection833
                    connect Goto7 Junction1518 as Connection725
                    connect Vb.n_node Junction1534 as Connection839
                    connect Goto8 Junction1519 as Connection728
                    connect Vc.p_node Junction1528 as Connection806
                    connect e_f.in Gain10.out as Connection824
                    connect Goto9 Junction1520 as Connection731
                    connect pf.in Junction1521 as Connection732
                    connect Ia.p_node a as Connection218
                    connect Ib.p_node b as Connection212
                    connect Ic.p_node c as Connection217
                    connect Junction1497 Ia.n_node as Connection871
                    connect 3ph_PLL_Gen.Va From42 as Connection925
                    connect Junction1497 Junction1536 as Connection885
                    connect Junction1518 Gain9.in as Connection724
                    connect 3ph_PLL_Gen.Vt Goto11 as Connection924
                    connect Junction1519 Gain8.in as Connection727
                    connect 3ph_PLL_Gen.w Junction1540 as Connection926
                    connect Junction1520 Gain7.in as Connection730
                    connect B Junction1537 as Connection888
                    connect Junction1521 "PQ measure.pf" as Connection733
                    connect "Bus Join1.in" From10 as Connection911
                    connect Junction1525 Ib.n_node as Connection870
                    connect Junction1528 Ic.n_node as Connection867
                    connect "Bus Join1.in1" From11 as Connection908
                    connect Junction1534 Junction1535 as Connection882
                    connect "Bus Join1.in2" From32 as Connection910
                    connect Junction1534 Vc.n_node as Connection838
                    connect Junction1535 Va.n_node as Connection883
                    connect C Junction1538 as Connection891
                    connect Junction1536 A as Connection886
                    connect Control_fb "Bus Join1.out" as Connection912
                    connect Junction1537 Junction1525 as Connection889
                    connect From21 Output.Ib as Connection914
                    connect Junction1538 Junction1528 as Connection892
                    connect From22 Output.Vc as Connection921
                    connect P.in Gain9.out as Connection158
                    connect From23 Output.Vb as Connection913
                    connect From24 Output.Ia as Connection916
                    connect From25 Output.Va as Connection918
                    connect From26 Output.Ic as Connection920
                    connect From27 Output.pf as Connection917
                    connect From28 Output.S as Connection919
                    connect From29 Output.Q as Connection922
                    connect From30 Output.P as Connection915
                    connect From31 Output.Vt as Connection923
                    connect From33 "Bus Join3.in1" as Connection783
                    connect From34 "Bus Join3.in2" as Connection784
                    connect From35 "Bus Join3.in" as Connection782
                    connect From4 "PQ measure.Va" as Connection714
                    connect From40 3ph_PLL_Gen.Vc as Connection899
                    connect From41 3ph_PLL_Gen.Vb as Connection898
                    connect From43 "Bus Join1.in3" as Connection909
                    connect From5 "PQ measure.Vc" as Connection716
                    connect From6 "PQ measure.Vb" as Connection715
                    connect From7 "PQ measure.Ia" as Connection717
                    connect From8 "PQ measure.Ib" as Connection718
                    connect From9 "PQ measure.Ic" as Connection719
                    connect Gain10.in Junction1540 as Connection904
                    connect Goto10 Junction1521 as Connection734
                    connect Goto3 Junction1541 as Connection927
                    connect Junction1541 Vc.out as Connection928
                    connect Goto14 Junction1541 as Connection929
                    connect Goto2 Junction1542 as Connection930
                    connect Junction1542 Vb.out as Connection931
                    connect Goto16 Junction1542 as Connection932
                    connect Goto1 Junction1543 as Connection933
                    connect Junction1543 Va.out as Connection934
                    connect Goto15 Junction1543 as Connection935
                    connect Goto6 Junction1544 as Connection940
                    connect Junction1544 Ic.out as Connection941
                    [
                        breakpoints = 8152, 8232; 8112, 8232
                    ]
                    connect Goto17 Junction1544 as Connection942
                    connect Goto5 Junction1545 as Connection943
                    connect Junction1545 Ib.out as Connection944
                    connect Goto19 Junction1545 as Connection945
                    connect Goto4 Junction1546 as Connection946
                    connect Junction1546 Ia.out as Connection947
                    connect Goto18 Junction1546 as Connection948
                }
                [
                    position = 9256, 8320
                    scale = -1, 1
                    size = 112, 112
                ]

                component Subsystem Ggrid_meas {
                    layout = dynamic
                    component gen_bus_join "Bus Join1" {
                        inputs = "3"
                    }
                    [
                        position = 8744, 7984
                        rotation = left
                    ]

                    component "core/Voltage Measurement" Vc {
                        addr = "5"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 8336, 8168
                        rotation = right
                        size = 64, 32
                    ]

                    component "core/Voltage Measurement" Va {
                        addr = "3"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 8248, 8264
                        rotation = right
                        size = 64, 32
                    ]

                    component "core/Voltage Measurement" Vb {
                        addr = "4"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 8296, 8216
                        rotation = right
                        size = 64, 32
                    ]

                    component Subsystem Snubber {
                        layout = dynamic
                        component pas_resistor R3 {
                            resistance = "1e5"
                        }
                        [
                            position = 8264, 8144
                            rotation = right
                        ]

                        component pas_resistor R1 {
                            resistance = "1e5"
                        }
                        [
                            position = 8120, 8144
                            rotation = right
                        ]

                        component pas_resistor R2 {
                            resistance = "1e5"
                        }
                        [
                            position = 8192, 8144
                            rotation = right
                        ]

                        port G {
                            position = bottom:1
                            kind = pe
                        }
                        [
                            position = 8192, 8296
                            rotation = left
                        ]

                        port B {
                            position = top:2
                            kind = pe
                        }
                        [
                            position = 8192, 8064
                            rotation = right
                        ]

                        port A {
                            position = top:1
                            kind = pe
                        }
                        [
                            position = 8120, 8064
                            rotation = right
                        ]

                        port C {
                            position = top:3
                            kind = pe
                        }
                        [
                            position = 8264, 8064
                            rotation = right
                        ]

                        junction Junction1491 pe
                        [
                            position = 8192, 8248
                        ]

                        junction Junction1490 pe
                        [
                            position = 8192, 8248
                        ]

                        connect R1.p_node A as Connection399
                        connect R2.p_node B as Connection397
                        connect G Junction1491 as Connection403
                        connect R2.n_node Junction1490 as Connection385
                        connect Junction1490 R1.n_node as Connection395
                        connect R3.p_node C as Connection398
                        connect Junction1491 Junction1490 as Connection402
                        connect R3.n_node Junction1491 as Connection401
                    }
                    [
                        position = 8104, 8248
                        size = 64, 48
                    ]

                    port c {
                        position = right:3
                        kind = pe
                    }
                    [
                        position = 8504, 8120
                        rotation = down
                    ]

                    port V {
                        position = top:auto
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8744, 7912
                        rotation = left
                    ]

                    port A {
                        position = left:1
                        kind = pe
                    }
                    [
                        position = 7992, 7912
                    ]

                    port B {
                        position = left:2
                        kind = pe
                    }
                    [
                        position = 7992, 8016
                    ]

                    port C {
                        position = left:3
                        kind = pe
                    }
                    [
                        position = 7992, 8120
                    ]

                    port a {
                        position = right:1
                        kind = pe
                    }
                    [
                        position = 8504, 7912
                        rotation = down
                    ]

                    port b {
                        position = right:2
                        kind = pe
                    }
                    [
                        position = 8504, 8016
                        rotation = down
                    ]

                    tag Goto6 {
                        value = "Vb"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8424, 8216
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto4 {
                        value = "Va"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8424, 8264
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From3 {
                        value = "Vc"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8648, 8120
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto5 {
                        value = "Vc"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8424, 8168
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From1 {
                        value = "Va"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8648, 8040
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From2 {
                        value = "Vb"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8648, 8080
                        hide_name = True
                        size = 0, 0
                    ]

                    junction Junction1536 pe
                    [
                        position = 8296, 8016
                    ]

                    junction Junction1537 pe
                    [
                        position = 8248, 7912
                    ]

                    junction Junction1538 pe
                    [
                        position = 8248, 8336
                    ]

                    junction Junction1492 pe
                    [
                        position = 8088, 7912
                    ]

                    junction Junction1493 pe
                    [
                        position = 8104, 8016
                    ]

                    junction Junction1494 pe
                    [
                        position = 8120, 8120
                    ]

                    junction Junction1534 pe
                    [
                        position = 8296, 8336
                    ]

                    junction Junction1535 pe
                    [
                        position = 8336, 8120
                    ]

                    connect c Junction1535 as Connection849
                    connect Junction1492 Junction1537 as Connection855
                    connect Junction1492 Snubber.A as Connection412
                    connect Junction1493 Junction1536 as Connection852
                    connect Junction1493 Snubber.B as Connection410
                    connect Junction1494 Snubber.C as Connection411
                    connect A Junction1492 as Connection402
                    connect Junction1534 Junction1538 as Connection858
                    connect B Junction1493 as Connection405
                    connect Junction1534 Vc.n_node as Connection838
                    connect "Bus Join1.in1" From2 as Connection431
                    connect Junction1535 Junction1494 as Connection850
                    connect Junction1536 b as Connection853
                    connect "Bus Join1.in2" From3 as Connection432
                    connect Junction1537 a as Connection856
                    connect C Junction1494 as Connection408
                    connect Junction1538 Va.n_node as Connection859
                    connect From1 "Bus Join1.in" as Connection430
                    connect Snubber.G Junction1538 as Connection860
                    connect Goto6 Vb.out as Connection705
                    connect Goto4 Va.out as Connection703
                    connect V "Bus Join1.out" as Connection366
                    connect Va.p_node Junction1537 as Connection857
                    connect Vb.n_node Junction1534 as Connection839
                    connect Goto5 Vc.out as Connection707
                    connect Vb.p_node Junction1536 as Connection854
                    connect Vc.p_node Junction1535 as Connection851
                }
                [
                    position = 9608, 8320
                    scale = -1, 1
                    size = 56, 232
                ]

                port A {
                    position = 180.0, -96.0
                    kind = pe
                    direction =  out
                }
                [
                    position = 9728, 8224
                    scale = -1, 1
                ]

                port B {
                    position = 180.0, -0.1
                    kind = pe
                    direction =  out
                }
                [
                    position = 9728, 8320
                    scale = -1, 1
                ]

                port C {
                    position = 180.0, 96.0
                    kind = pe
                    direction =  out
                }
                [
                    position = 9728, 8416
                    scale = -1, 1
                ]

                port Inputs {
                    position = -152.0, -120.0
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 9088, 7896
                    rotation = right
                    scale = -1, 1
                ]

                port Outputs {
                    position = 152.0, -120.0
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9816, 7920
                    rotation = left
                ]

                junction Junction118 pe
                [
                    position = 8800, 8240
                ]

                junction Junction122 pe
                [
                    position = 8800, 8408
                ]

                connect A Ggrid_meas.A as Connection669
                connect B Ggrid_meas.B as Connection670
                connect C Ggrid_meas.C as Connection671
                connect Control.T_in Gen.torque_out as Connection609
                connect Control.T_out Gen.load_in as Connection611
                connect Control.To_synch_check Sync_Check.From_Gen_Control as Connection673
                connect Gen.speed_out Control.wmeas as Connection608
                connect Gen.r_2 Junction122 as Connection664
                connect Gen.c_in Measurements.c as Connection323
                connect Gen.b_in Measurements.b as Connection318
                connect Gen.a_in Measurements.a as Connection324
                connect Ggrid_meas.b MCB.b_in as Connection481
                connect Ggrid_meas.c MCB.c_in as Connection483
                connect Ggrid_meas.a MCB.a_in as Connection479
                connect If.n_node Junction118 as Connection601
                connect Inputs Control.Inputs as Connection668
                connect Junction118 Gen.r_1 as Connection600
                connect Junction122 Vfield.n_node as Connection665
                connect Measurements.Control_fb Control.Meas_feedback as Connection500
                connect Measurements.B MCB.b_out as Connection613
                connect Measurements.C MCB.c_out as Connection614
                connect Measurements.A MCB.a_out as Connection612
                connect Output.Output Outputs as Connection667
                connect Sync_Check.To_Gen_Control Control.From_synch_check as Connection672
                connect Sync_Check.V_grid Ggrid_meas.V as Connection638
                connect Sync_Check.GCB MCB.ctrl_in as Connection637
                connect Sync_Check.V_gen Measurements.Sync_fb as Connection636
                connect Termination1.in Gen.angle_out as Connection674
                connect Vfd.in Control.Vf_out as Connection649
                connect Vfd.p_node If.p_node as Connection663
                connect Vfd.n_node Junction122 as Connection666
                connect Vfield.p_node Junction118 as Connection599

                F = "0.0182"
                J = "3.1522"
                K = "10"
                Llfd_prime = "5.8036e-04"
                Llkd = "0.0044"
                Llkq = "3.9478e-04"
                Lls = "1.389e-4"
                Lmd = "0.0046"
                Lmq = "0.0027"
                Ns_Nfd = "1"
                Rkd = "0.1448"
                Rkq = "0.0208"
                Rs = "0.0094"
                Sb = "0.07e6"
                Ts = "Ts"
                Vn = "208.0"
                delta_phi = "4.5"
                inner_w_fall = "0"
                phaseOff = "0.0"

                mask {
                    icon = "image(\'diesel_genset.svg\')"
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Diesel Genset with synchronous machine, DEGOV governor, DC4B exciter, frequency setpoint control for w and P, power factor control loop and synch check with grid to close GCB contactor.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">The number of variable inputs to this block is 9 and they must be sent through a Bus Join in the following order: 0 - Gen_On; 1 - Vref; 2 - wref; 3 - Pref; 4 - pf_ref; 5 - Gen_OP_mode; 6 - Gen_Control_Mode; 7 - Load_share_on; 8 - Load_share.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">                                                                                                                                                                                                                                                                                                                                                                                                                                    </span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">The number of outputs of this block is 14 and they are arranged in the following order: 0 - Gen_On; 1 - wmeas; 2 - GCB_status; 3 - Va; 4 - Vb; 5 - Vc; 6 - Vt; 7 - Ia; 8 - Ib; 9 - Ic; 10 - P; 11 - Q; 12 - S; 13 - pf.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">                                                                                                                                                                                    </span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Adjustment of the shunt snubber load is important for simulation stability in multiple time steps.</span></p></body></html>"
                    help_file = "diesel_genset.html"

                    Sb {
                        label = "Nominal Power"
                        widget = edit
                        type = generic
                        default_value = "2.2e6"
                        unit = "VA"
                        group = "1 - Basic"
                    }

                    Vn {
                        label = "Phase Nominal Voltage"
                        widget = edit
                        type = generic
                        default_value = "480.0"
                        unit = "V (line to line)"
                        group = "1 - Basic"
                    }

                    f {
                        label = "Nominal electrical frequency"
                        widget = edit
                        type = generic
                        default_value = "60.0"
                        unit = "Hz"
                        group = "1 - Basic"
                    }

                    load {
                        label = "Shunt snubber load percentage of nominal power"
                        widget = edit
                        type = generic
                        default_value = "5"
                        unit = "%"
                        group = "1 - Basic"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "200e-6"
                        unit = "s"
                        group = "1 - Basic"
                    }

                    Rs {
                        label = "Rs"
                        widget = edit
                        type = generic
                        default_value = "9.4035e-4"
                        unit = "Ω"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Lls {
                        label = "Lls"
                        widget = edit
                        type = generic
                        default_value = "1.389e-5"
                        unit = "H"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Lmd {
                        label = "Lmd"
                        widget = edit
                        type = generic
                        default_value = "6.5282e-4"
                        unit = "H"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Lmq {
                        label = "Lmq"
                        widget = edit
                        type = generic
                        default_value = "4.778e-4"
                        unit = "H"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Rf_prime {
                        label = "Rf"
                        widget = edit
                        type = generic
                        default_value = "2.1574e-4"
                        unit = "Ω"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Llfd_prime {
                        label = "Llfd"
                        widget = edit
                        type = generic
                        default_value = "1.4195e-4"
                        unit = "H"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Rkd {
                        label = "Rkd"
                        widget = edit
                        type = generic
                        default_value = "0.0443938909091"
                        unit = "Ω"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Rkq {
                        label = "Rkq"
                        widget = edit
                        type = generic
                        default_value = "0.00399796363636"
                        unit = "Ω"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Llkd {
                        label = "Llkd"
                        widget = edit
                        type = generic
                        default_value = "0.00155586168397"
                        unit = "H"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Llkq {
                        label = "Llkq"
                        widget = edit
                        type = generic
                        default_value = "9.96738215238e-05"
                        unit = "H"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Ns_Nfd {
                        label = "Ns/Nfd"
                        widget = edit
                        type = generic
                        default_value = "0.02512"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Ns_Nkd {
                        label = "Ns/Nkd"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "2 - Synch. mach. - Elec."
                    }

                    Ns_Nkq {
                        label = "Ns/Nkq"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "2 - Synch. mach. - Elec."
                    }

                    pms {
                        label = "pms"
                        widget = edit
                        type = generic
                        default_value = "2.0"
                        group = "3- Synch. mach. - Mec."
                    }

                    J {
                        label = "Jm"
                        widget = edit
                        type = generic
                        default_value = "42.9467"
                        unit = "kg.m²"
                        group = "3- Synch. mach. - Mec."
                    }

                    F {
                        label = "Friction coefficient"
                        widget = edit
                        type = generic
                        default_value = "0.572003113298"
                        unit = "Nms"
                        group = "3- Synch. mach. - Mec."
                    }

                    T1 {
                        label = "Electric control box time constant 1"
                        widget = edit
                        type = generic
                        default_value = "1.0e-4"
                        unit = "s"
                        group = "4 - Gov. and Eng."
                    }

                    T2 {
                        label = "Electric control box time constant 2"
                        widget = edit
                        type = generic
                        default_value = "1e-6"
                        unit = "s"
                        group = "4 - Gov. and Eng."
                    }

                    T3 {
                        label = "Electric control box time constant 3"
                        widget = edit
                        type = generic
                        default_value = "0.5001"
                        unit = "s"
                        group = "4 - Gov. and Eng."
                    }

                    K {
                        label = "Actuator gain K"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "4 - Gov. and Eng."
                    }

                    T4 {
                        label = "Actuator time constant 4"
                        widget = edit
                        type = generic
                        default_value = "25.0e-3"
                        unit = "s"
                        group = "4 - Gov. and Eng."
                    }

                    T5 {
                        label = "Actuator time constant 5"
                        widget = edit
                        type = generic
                        default_value = "9.0e-4"
                        unit = "s"
                        group = "4 - Gov. and Eng."
                    }

                    T6 {
                        label = "Actuator time constant 6"
                        widget = edit
                        type = generic
                        default_value = "5.74e-3"
                        unit = "s"
                        group = "4 - Gov. and Eng."
                    }

                    Pm0 {
                        label = "Initial mechanical power"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        unit = "pu"
                        group = "4 - Gov. and Eng."
                    }

                    Tmax {
                        label = "Maximum torque limit"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "pu"
                        group = "4 - Gov. and Eng."
                    }

                    Tmin {
                        label = "Minimum torque limit"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        unit = "pu"
                        group = "4 - Gov. and Eng."
                    }

                    Td {
                        label = "Engine time delay"
                        widget = edit
                        type = generic
                        default_value = "24.0e-3"
                        unit = "s"
                        group = "4 - Gov. and Eng."
                    }

                    Tr {
                        label = "Time constant Tr"
                        widget = edit
                        type = generic
                        default_value = "2.0e-6"
                        unit = "s"
                        group = "5 - Exciter"
                    }

                    exc_Kp {
                        label = "Exciter PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "0.025"
                        group = "5 - Exciter"
                    }

                    exc_Ki {
                        label = "Exciter PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "0.007"
                        group = "5 - Exciter"
                    }

                    Ka {
                        label = "Major regulator gain Ka"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "5 - Exciter"
                    }

                    Ta {
                        label = "Major regulator time constant Ta"
                        widget = edit
                        type = generic
                        default_value = "2.0e-3"
                        unit = "s"
                        group = "5 - Exciter"
                    }

                    Vrmax {
                        label = "Saturation upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        unit = "pu"
                        group = "5 - Exciter"
                    }

                    Vrmin {
                        label = "Saturation lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        unit = "pu"
                        group = "5 - Exciter"
                    }

                    Te {
                        label = "Exciter time constant Te"
                        widget = edit
                        type = generic
                        default_value = "1.0e-8"
                        unit = "s"
                        group = "5 - Exciter"
                    }

                    Ke {
                        label = "Exciter gain Ke"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "5 - Exciter"
                    }

                    Kf {
                        label = "Stabilization feedback gain Kf"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "5 - Exciter"
                    }

                    Tf {
                        label = "Stabilization feedback time constant Tf"
                        widget = edit
                        type = generic
                        default_value = "2.0e-6"
                        unit = "s"
                        group = "5 - Exciter"
                    }

                    Vt0 {
                        label = "Initial terminal voltage"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        unit = "pu"
                        group = "5 - Exciter"
                    }

                    Vf0 {
                        label = "Initial field voltage"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        unit = "pu"
                        group = "5 - Exciter"
                    }

                    Efmax {
                        label = "Exciter saturation upper limit"
                        widget = edit
                        type = generic
                        default_value = "[\'inf\']"
                        unit = "pu"
                        group = "5 - Exciter"
                    }

                    Efmin {
                        label = "Exciter saturation lower limit"
                        widget = edit
                        type = generic
                        default_value = "[\'-inf\']"
                        unit = "pu"
                        group = "5 - Exciter"
                    }

                    delta_f {
                        label = "Synch Check - accepted frequency difference"
                        widget = edit
                        type = generic
                        default_value = "0.5"
                        unit = "%"
                        group = "6 - Adv. 1"
                    }

                    delta_phi {
                        label = "Synch Check - Accepted phase difference"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        unit = "°"
                        group = "6 - Adv. 1"
                    }

                    phase_Kp {
                        label = "Synck Check - Phase PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "6 - Adv. 1"
                    }

                    phase_Ki {
                        label = "Synch Check - Phase PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.00012"
                        group = "6 - Adv. 1"
                    }

                    phase_upLim {
                        label = "Synch Check - Phase PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "6 - Adv. 1"
                    }

                    phase_lowLim {
                        label = "Synch Check - Phase PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-0.1"
                        group = "6 - Adv. 1"
                    }

                    phaseOff {
                        label = "Synch Check - Phase calibration"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "°"
                        group = "6 - Adv. 1"
                    }

                    dw_K {
                        label = "Synch Check - delta w gain"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        group = "6 - Adv. 1"
                    }

                    V_Kp {
                        label = "Synck Check - Voltage PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.0071"
                        group = "6 - Adv. 1"
                    }

                    V_Ki {
                        label = "Synck Check - Voltage PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.0354"
                        group = "6 - Adv. 1"
                    }

                    V_upLim {
                        label = "Synck Check - Voltage PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "1"
                        group = "6 - Adv. 1"
                    }

                    V_lowLim {
                        label = "Synck Check - Voltage PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1"
                        group = "6 - Adv. 1"
                    }

                    delta_V {
                        label = "Synck Check - Accepted voltage difference"
                        widget = edit
                        type = generic
                        default_value = "1.0"
                        unit = "%"
                        group = "6 - Adv. 1"
                    }

                    w_sp_Kp {
                        label = "Frequency setpoint loop - PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "7 - Adv. 2"
                    }

                    w_sp_Ki {
                        label = "Frequency setpoint loop - PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "7 - Adv. 2"
                    }

                    w_sp_upLim {
                        label = "Frequency setpoint loop - PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "pu"
                        group = "7 - Adv. 2"
                    }

                    w_sp_lowLim {
                        label = "Frequency setpoint loop - PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        unit = "pu"
                        group = "7 - Adv. 2"
                    }

                    P_droop {
                        label = "Frequency setpoint loop - P droop"
                        widget = edit
                        type = generic
                        default_value = "2.7"
                        group = "7 - Adv. 2"
                    }

                    P_rise {
                        label = "Frequency setpoint loop - P rising rate"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "pu/s"
                        group = "7 - Adv. 2"
                    }

                    P_fall {
                        label = "Frequency setpoint loop - P falling rate"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        unit = "pu/s"
                        group = "7 - Adv. 2"
                    }

                    w_droop {
                        label = "Frequency setpoint loop - w droop"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "7 - Adv. 2"
                    }

                    w_rise {
                        label = "Frequency setpoint loop - w rising rate"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "pu/s"
                        group = "7 - Adv. 2"
                    }

                    w_fall {
                        label = "Frequency setpoint loop - w falling rate"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        unit = "pu/s"
                        group = "7 - Adv. 2"
                    }

                    gov_Kp {
                        label = "Governor - Proportional gain Kp"
                        widget = edit
                        type = generic
                        default_value = "0.5"
                        group = "7 - Adv. 2"
                    }

                    delta_wn {
                        label = "Governor - Accepted nominal speed difference"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        unit = "%"
                        group = "7 - Adv. 2"
                    }

                    inner_w_droop {
                        label = "Governor - inner w droop"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "7 - Adv. 2"
                    }

                    inner_w_rise {
                        label = "Governor - inner w rise"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "pu/s"
                        group = "7 - Adv. 2"
                    }

                    inner_w_fall {
                        label = "Governor - inner w fall"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        unit = "pu/s"
                        group = "7 - Adv. 2"
                    }

                    pf_Kp {
                        label = "Power factor loop - PI - Kp"
                        widget = edit
                        type = generic
                        default_value = "0.05"
                        group = "8 - Adv. 3"
                    }

                    pf_Ki {
                        label = "Power factor loop - PI - Ki"
                        widget = edit
                        type = generic
                        default_value = "0.075"
                        group = "8 - Adv. 3"
                    }

                    pf_upLim {
                        label = "Power factor loop - PI - Upper limit"
                        widget = edit
                        type = generic
                        default_value = "10"
                        group = "8 - Adv. 3"
                    }

                    pf_lowLim {
                        label = "Power factor loop - PI - Lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        group = "8 - Adv. 3"
                    }

                    pf_rise {
                        label = "Power factor loop - pf rising rate"
                        widget = edit
                        type = generic
                        default_value = "10"
                        group = "8 - Adv. 3"
                    }

                    pf_fall {
                        label = "Power factor loop - pf falling rate"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        group = "8 - Adv. 3"
                    }

                    exc_dwn {
                        label = "Exciter - start speed"
                        widget = edit
                        type = generic
                        default_value = "75"
                        unit = "%"
                        group = "8 - Adv. 3"
                    }

                    V_rise {
                        label = "Exciter - V rising rate"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "pu/s"
                        group = "8 - Adv. 3"
                    }

                    V_fall {
                        label = "Exciter - V falling rate"
                        widget = edit
                        type = generic
                        default_value = "-10"
                        unit = "pu/s"
                        group = "8 - Adv. 3"
                    }

                    V_inner_droop {
                        label = "Exciter - V inner droop"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        group = "8 - Adv. 3"
                    }

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'diesel_genset.svg')
                    ENDCODE

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7664, 8512
                size = 354, 240
            ]

            component Subsystem DG_out {
                layout = dynamic
                component gen_probe Out {
                }
                [
                    position = 8192, 8192
                    rotation = left
                    scale = -1, 1
                ]

                port outputs {
                    position = right:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8192, 8256
                    rotation = left
                    hide_name = True
                ]

                connect Out.in outputs as Connection1
            }
            [
                position = 7816, 8288
                rotation = right
                size = 48, 48
            ]

            component Subsystem DG_in {
                layout = dynamic
                component src_scada_input pf_ref {
                    execution_rate = "Ts"
                    unit = ""
                }
                [
                    position = 8096, 8112
                ]

                component src_scada_input Gen_OP_mode {
                    def_value = "1"
                    execution_rate = "Ts"
                    max = "2"
                    min = "0"
                    unit = ""
                }
                [
                    position = 8160, 8144
                ]

                component src_scada_input Gen_On {
                    addr = "1427111952"
                    execution_rate = "Ts"
                    max = "1"
                    min = "0"
                    unit = ""
                }
                [
                    position = 8024, 7936
                ]

                component src_scada_input Load_share {
                    execution_rate = "Ts"
                    max = "1"
                    min = "0"
                    unit = ""
                }
                [
                    position = 8112, 8312
                ]

                component src_scada_input wref {
                    addr = "1427111952"
                    def_value = "1"
                    execution_rate = "Ts"
                    max = "1000000.0"
                    min = "-1000000.0"
                    unit = ""
                }
                [
                    position = 8120, 8048
                ]

                component gen_bus_join "Bus Join2" {
                    inputs = "9"
                }
                [
                    position = 8272, 8392
                    rotation = right
                    hide_name = True
                ]

                component src_scada_input Vref {
                    addr = "1427111940"
                    def_value = "1"
                    execution_rate = "Ts"
                    max = "1000000.0"
                    min = "-1000000.0"
                    unit = "pu"
                }
                [
                    position = 8160, 8008
                ]

                component src_scada_input Gen_Control_Mode {
                    addr = "1427111944"
                    execution_rate = "Ts"
                    max = "2"
                    min = "0"
                    unit = ""
                }
                [
                    position = 8120, 8200
                ]

                component src_scada_input Pref {
                    addr = "1427111936"
                    def_value = "1"
                    execution_rate = "Ts"
                    max = "1000000.0"
                    min = "-1000000.0"
                    unit = ""
                }
                [
                    position = 8160, 8080
                ]

                component src_scada_input Load_share_on {
                    execution_rate = "Ts"
                    max = "1"
                    min = "0"
                    unit = ""
                }
                [
                    position = 8160, 8256
                ]

                component gen_logic_op "Logical operator1" {
                }
                [
                    position = 8248, 7888
                    hide_name = True
                ]

                component gen_digital_probe enable {
                }
                [
                    position = 8136, 7840
                    rotation = left
                ]

                component gen_c_function delay {
                    global_variables = "real counter;"
                    in_terminal_dimensions = "inherit"
                    in_terminal_dimensions_str = "in inherit"
                    in_terminal_labels = "False;"
                    init_fnc = "/*Begin code section*/
out = 0;
counter = 0;
/*End code section*/"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "out inherit"
                    out_terminal_labels = "False;"
                    output_fnc = "/*Begin code section*/
if(out == 0){
    if(in > 0.5){
        counter += execution_rate;
        if(counter>Delay){
            out = 1;
        }
    }
    else{
        counter -= counter;
        out = 0;
    }
}
else{
    counter = 0;
    if(in <= 0.5){
        out = 0;
    }
}
/*End code section*/"
                    parameters = "real Delay;"
                }
                [
                    position = 8152, 7928
                    size = 48, 48
                ]

                port inputs {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8272, 8464
                    rotation = right
                    hide_name = True
                ]

                tag "From PMS" {
                    value = "enable"
                    scope = global
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 7872
                ]

                junction Junction1 sp
                [
                    position = 8136, 7872
                ]

                connect "Bus Join2.out" inputs as Connection828
                connect Gen_Control_Mode.out "Bus Join2.in6" as Connection235
                connect Gen_OP_mode.out "Bus Join2.in5" as Connection565
                connect Load_share.out "Bus Join2.in8" as Connection826
                connect Load_share_on.out "Bus Join2.in7" as Connection825
                connect Pref.out "Bus Join2.in3" as Connection233
                connect Vref.out "Bus Join2.in1" as Connection231
                connect pf_ref.out "Bus Join2.in4" as Connection827
                connect wref.out "Bus Join2.in2" as Connection232
                connect delay.out "Logical operator1.in1" as Connection735
                connect enable.in Junction1 as Connection832
                connect Junction1 "Logical operator1.in" as Connection833
                [
                    breakpoints = 8136, 7880
                ]
                connect "From PMS" Junction1 as Connection834
                connect Gen_On.out delay.in as Connection835
                connect "Logical operator1.out" "Bus Join2.in" as Connection836

                Delay = "0.125"

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Scada inputs for the Diesel Genset from the Microgrid Library.</p></body></html>"

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "Ts"
                    }

                    Delay {
                        label = "Time to turn on and off"
                        widget = edit
                        type = generic
                        default_value = "0"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7512, 8288
                rotation = right
                scale = -1, 1
                size = 48, 48
            ]

            port B {
                position = right:2
                kind = pe
            }
            [
                position = 8024, 8512
                rotation = down
            ]

            port from_PMS {
                position = top:1
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7392, 8008
            ]

            port A {
                position = right:1
                kind = pe
            }
            [
                position = 8024, 8416
                rotation = down
            ]

            port C {
                position = right:3
                kind = pe
            }
            [
                position = 8024, 8608
                rotation = down
            ]

            tag Goto2 {
                value = "enable"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 7776, 7976
                hide_name = True
            ]

            connect Goto2 interface.Enable as Connection874
            connect Enable.out interface.Enable_in as Connection876
            connect from_PMS "Rate Transition1.in" as Connection891
            connect DG_in.inputs Diesel_Gen.Inputs as Connection859
            connect DG_out.outputs Diesel_Gen.Outputs as Connection860
            connect B Diesel_Gen.B as Connection893
            connect A Diesel_Gen.A as Connection894
            connect C Diesel_Gen.C as Connection895
            connect "Rate Transition1.out" interface.fromPMS as Connection896
            [
                breakpoints = 7544, 8008
            ]

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">PV plant.</p></body></html>"

                CODE define_icon
                    mdl.set_component_icon_image(item_handle, 'diesel_genset.svg', rotate="no_rotate")
                ENDCODE

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 7904, 9096
            rotation = left
            size = 160, 160
        ]

        tag Goto18 {
            value = "PCC_control"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7408, 8440
            hide_name = True
        ]

        tag Goto20 {
            value = "toPCCess"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7208, 9040
            hide_name = True
            scale = -1, 1
        ]

        tag From12 {
            value = "DER_control_800"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7208, 9152
            hide_name = True
        ]

        tag From13 {
            value = "synch_ref"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7208, 9096
            hide_name = True
        ]

        tag From14 {
            value = "toPCCess"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7104, 8568
            hide_name = True
        ]

        tag Goto19 {
            value = "DER_control"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7424, 8536
            hide_name = True
        ]

        tag From15 {
            value = "toPCCdg"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7104, 8600
            hide_name = True
        ]

        tag From9 {
            value = "CB_status"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7104, 8536
            hide_name = True
        ]

        tag From8 {
            value = "power_meas"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7104, 8504
            hide_name = True
        ]

        tag From18 {
            value = "DER_control_800"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 8072, 9144
            hide_name = True
        ]

        tag From19 {
            value = "PCC_control"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7400, 8248
            hide_name = True
        ]

        tag Goto22 {
            value = "CB_status"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7400, 8312
            hide_name = True
            scale = -1, 1
        ]

        tag Goto23 {
            value = "power_meas"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7400, 8280
            hide_name = True
            scale = -1, 1
        ]

        tag Goto24 {
            value = "synch_ref"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7400, 8344
            hide_name = True
            scale = -1, 1
        ]

        tag From20 {
            value = "DER_control_800"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7936, 8712
            hide_name = True
        ]

        tag From21 {
            value = "synch_ref"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7936, 8656
            hide_name = True
        ]

        tag Goto25 {
            value = "toPCCdg_800kW"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7936, 8600
            hide_name = True
            scale = -1, 1
        ]

        tag From22 {
            value = "toPCCdg_800kW"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7104, 8640
            hide_name = True
        ]

        tag Goto26 {
            value = "DER_control_800"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7408, 8632
            hide_name = True
        ]

        tag Goto21 {
            value = "toPCCdg"
            scope = local
            kind = sp
            direction = in
        }
        [
            position = 7912, 8552
            hide_name = True
            scale = -1, 1
        ]

        tag From23 {
            value = "DER_control_800"
            scope = local
            kind = sp
            direction = out
        }
        [
            position = 7728, 9096
            rotation = down
            hide_name = True
            scale = -1, 1
        ]

        junction Junction38 pe
        [
            position = 7512, 8488
        ]

        junction Junction47 pe
        [
            position = 8800, 9032
        ]

        junction Junction43 pe
        [
            position = 8552, 8976
        ]

        junction Junction45 pe
        [
            position = 8688, 8944
        ]

        junction Junction48 pe
        [
            position = 8880, 8944
        ]

        junction Junction44 pe
        [
            position = 8608, 9032
        ]

        junction Junction50 pe
        [
            position = 8992, 9032
        ]

        junction Junction49 pe
        [
            position = 8936, 8976
        ]

        junction Junction42 pe
        [
            position = 8496, 8944
        ]

        junction Junction46 pe
        [
            position = 8744, 8976
        ]

        junction Junction51 pe
        [
            position = 8168, 8800
        ]

        junction Junction52 pe
        [
            position = 8224, 8824
        ]

        junction Junction53 pe
        [
            position = 8280, 8848
        ]

        junction Junction54 sp
        [
            position = 7984, 8600
        ]

        junction Junction55 pe
        [
            position = 7840, 8800
        ]

        junction Junction56 pe
        [
            position = 7896, 8824
        ]

        junction Junction57 pe
        [
            position = 7952, 8848
        ]

        junction Junction58 pe
        [
            position = 7616, 8416
        ]

        junction Junction59 pe
        [
            position = 7560, 8456
        ]

        junction Junction204 pe
        [
            position = 7616, 8848
        ]

        junction Junction205 pe
        [
            position = 7560, 8824
        ]

        junction Junction206 pe
        [
            position = 7504, 8800
        ]

        connect Goto19 Microgrid_controller.DER_control as Connection197
        connect ESS.from_PCC From13 as Connection256
        connect ESS.toPCC Goto20 as Connection258
        connect ESS.A CESS.a as Connection259
        connect Goto18 Microgrid_controller.PCC_control as Connection145
        connect c_option.out Microgrid_controller.control_option as Connection142
        connect op_mode.out Microgrid_controller.operation_mode as Connection141
        connect From12 ESS.from_PMS as Connection257
        connect From14 Microgrid_controller.fromESS as Connection195
        connect From15 Microgrid_controller.fromDG as Connection196
        connect From8 Microgrid_controller.power_meas as Connection147
        connect From9 Microgrid_controller.CB_status as Connection148
        connect CESS.b ESS.B as Connection260
        connect CESS.c ESS.C as Connection261
        connect From18 Fuel_Cell.from_PMS as Connection292
        connect PCC_monitor.synch_ref Goto24 as Connection885
        connect Goto22 PCC_monitor.CB_fb as Connection886
        connect PCC_monitor.Inputs From19 as Connection887
        connect PCC_monitor.power_meas Goto23 as Connection888
        connect Grid.A PCC_monitor.A as Connection892
        connect Grid.B PCC_monitor.B as Connection893
        connect From20 DG_800kW.from_PMS as Connection924
        connect From21 DG_800kW.from_PCC as Connection926
        connect From22 Microgrid_controller.fromDG800kW as Connection939
        connect PDC.A Junction38 as Connection949
        connect Junction38 DG_800kW.A as Connection950
        [
            breakpoints = 7512, 8488; 8032, 8488
        ]
        connect Grid.C PCC_monitor.C as Connection952
        connect Goto26 Microgrid_controller.DER_control_800 as Connection953
        connect Fuel_Cell.A C_Fuel-Cell.a as Connection293
        connect C_Fuel-Cell.c Fuel_Cell.C as Connection295
        connect Fuel_Cell.B C_Fuel-Cell.b as Connection296
        connect PCC_monitor.a Junction38 as Connection991
        [
            breakpoints = 7504, 8368; 7504, 8368; 7504, 8368
        ]
        connect Junction47 Junction44 as Connection1010
        connect "Load 50 %.B" Junction46 as Connection1006
        connect Junction50 Junction47 as Connection1019
        connect Secondary.a Junction42 as Connection1020
        connect Junction44 "Load 25 %.C" as Connection1001
        connect "Load 25 %.B" Junction43 as Connection997
        connect "Load 100 %.B" Junction49 as Connection1017
        connect Junction42 "Load 25 %.A" as Connection1021
        [
            breakpoints = 8496, 8952
        ]
        connect Junction46 Junction43 as Connection1007
        connect "Load 75 %.C" Junction50 as Connection1018
        connect "Load 50 %.C" Junction47 as Connection1009
        connect "Load 100 %.C" Junction50 as Connection1022
        connect "Load 75 %.B" Junction49 as Connection1015
        connect Junction45 Junction42 as Connection1004
        connect Junction48 Junction45 as Connection1013
        connect "Load 75 %.A" Junction48 as Connection1012
        connect Junction43 Secondary.b as Connection998
        [
            breakpoints = 8552, 8984
        ]
        connect "Load 100 %.A" Junction48 as Connection1014
        connect "Load 50 %.A" Junction45 as Connection1003
        connect Secondary.c Junction44 as Connection1000
        [
            breakpoints = 8608, 9016
        ]
        connect Junction49 Junction46 as Connection1016
        connect Junction51 C_Fuel-Cell.A as Connection1024
        [
            breakpoints = 8168, 8800; 8168, 8800
        ]
        connect Secondary.A Junction51 as Connection1025
        connect C_Fuel-Cell.B Junction52 as Connection1026
        connect Secondary.B Junction52 as Connection1028
        connect C_Fuel-Cell.C Junction53 as Connection1029
        connect Secondary.C Junction53 as Connection1031
        connect Goto25 Junction54 as Connection1032
        connect Junction54 DG_800kW.toPCC as Connection1033
        connect Goto21 Junction54 as Connection1034
        connect Back-Up.A C_Var_Speed.a as Connection1051
        connect Back-Up.B C_Var_Speed.b as Connection1052
        connect From23 Back-Up.from_PMS as Connection1050
        connect Back-Up.C C_Var_Speed.c as Connection1053
        connect Junction51 Junction55 as Connection1054
        [
            breakpoints = 8168, 8800
        ]
        connect C_Var_Speed.A Junction55 as Connection1056
        connect Junction52 Junction56 as Connection1057
        [
            breakpoints = 8224, 8824; 8224, 8824
        ]
        connect C_Var_Speed.B Junction56 as Connection1059
        connect Junction57 Junction53 as Connection1061
        [
            breakpoints = 7968, 8848; 8280, 8848; 8280, 8848
        ]
        connect C_Var_Speed.C Junction57 as Connection1062
        connect PCC_monitor.c Junction58 as Connection1071
        connect Junction58 PDC.C as Connection1072
        connect DG_800kW.C Junction58 as Connection1073
        connect PCC_monitor.b Junction59 as Connection1075
        connect Junction59 PDC.B as Connection1076
        connect DG_800kW.B Junction59 as Connection1077
        [
            breakpoints = 8088, 8456; 7568, 8456
        ]
        connect PDC.c Junction204 as Connection2889
        connect Junction204 Junction57 as Connection2890
        [
            breakpoints = 7624, 8848; 7624, 8848; 7624, 8848; 7840, 8848
        ]
        connect CESS.C Junction204 as Connection2891
        connect PDC.b Junction205 as Connection2893
        connect Junction205 Junction56 as Connection2894
        [
            breakpoints = 7560, 8824; 7560, 8824; 7568, 8824; 7784, 8824; 7912, 8824
        ]
        connect CESS.B Junction205 as Connection2895
        connect PDC.a Junction206 as Connection2897
        connect Junction206 Junction55 as Connection2898
        [
            breakpoints = 7504, 8800; 7504, 8800; 7512, 8800; 7568, 8800; 7624, 8800; 7728, 8800; 7728, 8800; 7856, 8800; 7856, 8800
        ]
        connect CESS.A Junction206 as Connection2899
    }

    default {
        gen_PQ_transform {
            filter_order = "first order"
            filter_cutoff_Hz = "30"
            initial_filter_input = "0"
            initial_filter_output = "0"
            enable_inst_ports = "True"
            enable_zero_ports = "False"
            execution_rate = "inherit"
        }

        gen_abc2alpha_beta {
            power_form = "variant - Clarke\'s original"
            execution_rate = "inherit"
        }

        gen_abs {
            execution_rate = "inherit"
        }

        gen_alpha_beta2d_q {
            alignment = "-pi/2"
            execution_rate = "inherit"
        }

        gen_bus_join {
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_bus_split {
            outputs = "2"
            execution_rate = "inherit"
        }

        gen_c_function {
            in_terminal_properties = "real in;"
            in_terminal_labels = ""
            out_terminal_properties = "real out;"
            out_terminal_labels = ""
            no_feed_inputs = ""
            no_feed_outputs = ""
            in_terminal_dimensions = ""
            in_terminal_dimensions_str = ""
            out_terminal_dimensions = ""
            out_terminal_dimensions_str = ""
            output_fnc = ""
            update_fnc = ""
            init_fnc = ""
            global_variables = ""
            parameters = ""
            execution_rate = "inherit"
        }

        gen_comparator {
            execution_rate = "inherit"
        }

        gen_delay {
            delay_type = "Fixed delay"
            del_length = "2"
            max_delay_length = "20"
            init_value = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        gen_digital_probe {
            override_signal_name = "False"
            signal_name = ""
            streaming_en = "False"
            addr = "0"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_gain {
            gain = "1"
            multiplication = "Element-wise(K.*u)"
            execution_rate = "inherit"
        }

        gen_integrator {
            show_reset = "none"
            reset_type = "asynchronous"
            show_init_condition = "internal"
            init_value = "0"
            limit_output = "False"
            limit_upper = "inf"
            limit_lower = "-inf"
            show_state = "False"
            state_port_type = "inherit"
            execution_rate = "inherit"
        }

        gen_limiter {
            upper_limit = "[\'inf\']"
            lower_limit = "[\'-inf\']"
            execution_rate = "inherit"
        }

        gen_logic_op {
            operator = "AND"
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_math_fnc {
            mathematical_fn = "exponential"
            execution_rate = "inherit"
        }

        gen_minmax {
            operation = "min"
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_probe {
            addr = "0"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "generic"
            streaming_en = "False"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_product {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_rate_limiter {
            rising_limit = "1"
            falling_limit = "-1"
            execution_rate = "inherit"
        }

        gen_rel_op {
            relational_op = "=="
            execution_rate = "inherit"
        }

        gen_round {
            round_fn = "floor"
            execution_rate = "inherit"
        }

        gen_sr_ff {
            init_value = "0"
            execution_rate = "inherit"
        }

        gen_sum {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_terminator {
            execution_rate = "inherit"
        }

        gen_transport_delay {
            time_delay = "0.1"
            init_value = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        gen_z_domain_transfer {
            domain = "Z-domain"
            method = "Zero-order hold"
            b_coeff = "[1]"
            a_coeff = "[1,-1]"
            init_states = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        pas_capacitor {
            capacitance = "1e-6"
            initial_voltage = "0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        pas_inductor {
            inductance = "1e-3"
            initial_current = "0.0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        pas_resistor {
            resistance = "1"
        }

        src_constant {
            value = "1"
            signal_type = "real"
            execution_rate = "100e-6"
        }

        src_scada_input {
            addr = "0"
            format = "real"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "real"
            min = "-1e6"
            max = "1e6"
            def_value = "0"
            unit = " "
            execution_rate = "100e-6"
        }

        src_voltage {
            sig_input = "False"
            type = "signal generator"
            param_set = "1phase"
            parent_label = ""
            addr = "0"
            spc_nb = "0"
            execution_rate = "100e-6"
            cpd_visible = "True"
            enable_snb = "False"
            snb_type = "R2"
            R2 = "0.0"
            L1 = "0.1"
            override_signal_name = "False"
            signal_name = ""
            init_source_nature = "Constant"
            init_const_value = "0.0"
            init_rms_value = "0.0"
            init_frequency = "50.0"
            init_phase = "0.0"
        }

        sys_signal_switch {
            criterion = "ctrl >= threshold"
            threshold = "0"
            execution_rate = "inherit"
        }

        tm_delay {
            init_value = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        "core/Battery" {
            sig_output = "False"
            lut = "False"
            battery_type = "Lead-Acid"
            nominal_voltage = "12.0"
            capacity = "1.2"
            initial_soc = "100.0"
            execution_rate = "100e-6"
            Ke_full = "108.0"
            Kdisc_I = "5.0"
            R_series = "0.25"
            Kq_nom = "50.0"
            Kq_exp = "0.9"
            Ke_exp = "102.5"
            preview = "Preview SOC Curve"
        }

        "core/Counter" {
            ext_reset = "level"
            init_val = "0"
            state_type = "real"
            execution_rate = "inherit"
        }

        "core/Current Measurement" {
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/Edge Detection" {
            edge = "both"
            execution_rate = "inherit"
        }

        "core/RL Section" {
            model_def = "R-L"
            unit_sys = "imperial"
            num_of_phases = "3"
            resistance_per_l = "1"
            resistance_per_l_mile = "1"
            inductance_per_l = "1e-3"
            inductance_per_l_mile = "1e-3"
            length = "1.0"
            length_mile = "1.0"
            power = "500.0"
            voltage = "11.0"
            frequency = "50.0"
            R_value = "21.55"
            L_value = "0.00842"
        }

        "core/Rate Transition" {
            init_value = "0.0"
            execution_rate = "100e-6"
        }

        "core/Signal Controlled Voltage Source" {
            execution_rate = "inherit"
        }

        "core/Synchronous Machine with Wound Rotor" {
            model_type = "linear"
            rated_speed = "1.0"
            Rs = "1.62"
            Lls = "0.004527"
            Lmd = "0.1086"
            Lmq = "0.1086"
            curve_type = "no load curve"
            if_vector = "[0.0, 0.0]"
            vs_vector = "[0.0, 0.0]"
            imd_vector = "[0.0, 0.0]"
            imq_vector = "[0.0, 0.0]"
            psimd_table = "[[0.0, 0.0], [0.0, 0.0]]"
            psimq_table = "[[0.0, 0.0], [0.0, 0.0]]"
            Rf = "1.208"
            Llfd = "0.01132"
            Rkd = "3.142"
            Rkq = "4.772"
            Llkd = "0.007334"
            Llkq = "0.01015"
            Ns_div_Nfd = "1.0"
            Ns_div_Nkd = "1.0"
            Ns_div_Nkq = "1.0"
            pms = "2"
            star_delta = "star"
            Jm = "0.0923"
            friction_coeff = "0"
            unconstrained_angle = "disabled"
            load_src = "SCADA / external"
            ext_mdl_load_type = "torque"
            load_ai_pin_addr = "1"
            load_ai_offset = "0"
            load_ai_gain = "1"
            enc_ppr = "1024"
            res_pole_pairs = "1"
            res_carr_source = "internal"
            res_int_carr_f = "5e+3"
            res_ai_pin_addr = "1"
            res_ai_offset = "0"
            res_ai_gain = "1"
            absenc_type = "None"
            endat_clock_di_addr = "1"
            endat_clock_di_logic = "active high"
            endat_data_di_addr = "2"
            endat_data_di_logic = "active high"
            biss_clock_di_addr = "1"
            biss_clock_di_logic = "active high"
            biss_data_di_addr = "2"
            ssi_clock_di_addr = "1"
            ssi_clock_di_logic = "active high"
            ssi_data_di_addr = "2"
            theta_ab = "-pi/2"
            field_input = "voltage"
            Rsnb_rotor = "inf"
            Rsnb_stator = "inf"
            enb_sig_out = "False"
            execution_rate = "100e-6"
            machine_id = "0"
            me_speed_out_addr = "0"
            el_torque_out_addr = "0"
            me_angle_out_addr = "0"
        }

        "core/THD Measurement" {
            frequency = "50.0"
            exec_1 = "100e-6"
            exec_2 = "0.05"
        }

        "core/Three Phase Core Coupling" {
            snb_type_i = "none"
            R1 = "100e3"
            C1 = "1e-06"
            C2 = "1e-06"
            fixed_snb_i = "false"
            snb_type_u = "none"
            R2 = "0.1"
            L1 = "0.1"
            L2 = "0.1"
            fixed_snb_u = "false"
            cpl_connection = "star"
        }

        "core/Three Phase Inverter" {
            ctrl_src = "Digital input per switch"
            op_mode = "Fixed carrier frequency"
            carrier_freq = "10000.0"
            carr_ph_offset = "0.0"
            d_time = "5e-6"
            ref_sig_min_max = "[-1.0, 1.0]"
            load_mode = "on min"
            execution_rate = "inherit"
            Sa_top = "1"
            Sa_top_logic = "active high"
            Sa_bot = "2"
            Sa_bot_logic = "active high"
            Sb_top = "3"
            Sb_top_logic = "active high"
            Sb_bot = "4"
            Sb_bot_logic = "active high"
            Sc_top = "5"
            Sc_top_logic = "active high"
            Sc_bot = "6"
            Sc_bot_logic = "active high"
            delay_enabled = "False"
            fixed_delay = "1e-6"
            var_delay_lut = "[-10.0, 1e-6, 10.0, 1e-6]"
            preview_var_delay = "Preview"
            Sa_top_I = "False"
            Sa_bot_I = "False"
            Sb_top_I = "False"
            Sb_bot_I = "False"
            Sc_top_I = "False"
            Sc_bot_I = "False"
            losses_estimation = "False"
            Import_igbt_xml = "not selected"
            Import_diode_xml = "not selected"
            Vce = "1.3"
            Rce = "0"
            Vd = "1.2"
            Rd = "0"
            i_sw = "[0.0, 6.0, 12.0, 18.0, 24.0]"
            v_sw = "[0.0, 600.0]"
            temp_sw = "[25.0, 50.0, 75.0, 100.0, 125.0]"
            et_on_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*3.8e-3, 0.4*3.8e-3, 0.8*3.8e-3, 0.68*3.8e-3, 0.9*3.8e-3], [0.65*3.8e-3, 0.9*3.8e-3, 1.2*3.8e-3, 1.5*3.8e-3, 1.7*3.8e-3], [0.9*3.8e-3, 1.3*3.8e-3, 1.7*3.8e-3, 1.9*3.8e-3, 2.25*3.8e-3], [1.1*3.8e-3, 1.7*3.8e-3, 2.1*3.8e-3, 2.3*3.8e-3, 2.5*3.8e-3]]"
            et_off_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.1e-3, 0.4*2.1e-3, 0.8*2.1e-3, 0.68*2.1e-3, 0.9*2.1e-3], [0.65*2.1e-3, 0.9*2.1e-3, 1.2*2.1e-3, 1.5*2.1e-3, 1.7*2.1e-3], [0.9*2.1e-3, 1.3*2.1e-3, 1.7*2.1e-3, 1.9*2.1e-3, 2.25*2.1e-3], [1.1*2.1e-3, 1.7*2.1e-3, 2.1*2.1e-3, 2.3*2.1e-3, 2.5*2.1e-3]]"
            ed_off_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.2e-3, 0.4*2.2e-3, 0.8*2.2e-3, 0.68*2.2e-3, 0.9*2.2e-3], [0.65*2.2e-3, 0.9*2.2e-3, 1.2*2.2e-3, 1.5*2.2e-3, 1.7*2.2e-3], [0.9*2.2e-3, 1.3*2.2e-3, 1.7*2.2e-3, 1.9*2.2e-3, 2.25*2.2e-3], [1.1*2.2e-3, 1.7*2.2e-3, 2.1*2.2e-3, 2.3*2.2e-3, 2.5*2.2e-3]]"
            temp_estimation = "False"
            thermal_networks_type = "Foster"
            switch_Rth = "[0.159, 0.133, 0.120, 0.038]"
            switch_Tth = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            switch_Cth = "[0.0029, 0.0097, 0.1068, 0.8500]"
            diode_Rth = "[0.159, 0.133, 0.120, 0.038]"
            diode_Tth = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            diode_Cth = "[0.0029, 0.0097, 0.1068, 0.8500]"
            loss_exec_rate = "100e-6"
            vout_cmp_pullup_mode = "False"
            show_cnt_out = "False"
            show_monitoring = "false"
            _control_property = "all high"
            dtv_flag_en = "True"
            pwm_enabling = "False"
            pwm_enable_di = "13"
            pwm_enable_inv = "active high"
        }

        "core/Three Phase Two Winding Transformer" {
            input = "SC and OC tests"
            core_sat = "False"
            Sn = "160000.0"
            f = "50.0"
            V1 = "10000.0"
            V2 = "400.0"
            usc1 = "4.0"
            Psc1 = "2350.0"
            ioc1 = "0.7"
            Poc1 = "460.0"
            R1 = "4.58984375"
            L1 = ".0370093710364"
            R2 = ".00734375"
            L2 = "5.92149936583e-05"
            Rm = "217391.304348"
            Lm = "311.709196788"
            flux_vals_SI = "[1910.3, 2419.7]"
            current_vals_SI = "[0.66653, 277.72]"
            r1 = ".00734375"
            l1 = ".0186029389059"
            r2 = ".00734375"
            l2 = ".0186029389059"
            rm = "347.826086957"
            lm = "156.68213163"
            flux_vals_pu = "[1.2, 1.52]"
            current_vals_pu = "[0.0024, 1]"
            flux_vals_SCOC = "[1.2, 1.52]"
            current_vals_SCOC = "[0.0024, 1]"
            import_from_SI2SCOC = "Import from SI"
            import_from_pu2SCOC = "Import from PU"
            import_from_SCOC2SI = "Import from SC OC"
            import_from_pu2SI = "Import from PU"
            import_from_SCOC2pu = "Import from SC OC"
            import_from_SI2pu = "Import from SI"
            winding_1_connection = "Y"
            winding_2_connection = "Y"
            clock_number = "0"
            embedded_cpl = "false"
            coupling_type = "core"
            Rshunt = "inf"
        }

        "core/Three Phase Voltage Source" {
            init_rms_value = "0.0"
            init_frequency = "50.0"
            init_phase = "0.0"
        }

        "core/Three phase PLL" {
            initial_filter_output = "60"
            wn = "157.0796"
            zeta = "0.707"
            rate_high = "12"
            rate_low = "-12"
            freq_unit = "Hz"
            kp = "100"
            ki = "3200"
            kd = "1"
            N = "714.2857"
            initial_pid_output = "376.99111843"
            up_lim = "1e4"
            low_lim = "-1e4"
            kb = "1"
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            disable_filter = "False"
            wn_LPFdq = "62.83185307"
            execution_rate = "inherit"
            enable_pk = "False"
            enable_zero = "True"
            enable_sin = "True"
        }

        "core/Triple Pole Single Throw Contactor" {
            ctrl_src = "Digital input"
            Sa = "1"
            Sa_logic = "active high"
            enable_fb_out = "False"
            fb_out_type = "real"
            execution_rate = "inherit"
            initial_state = "off"
            on_delay = "0"
            off_delay = "0"
        }

        "core/Voltage Measurement" {
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/abc to dq" {
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            disable_filter = "True"
            initial_filter_output = "0"
            wn_LPFdq = "1000"
            execution_rate = "inherit"
        }

        "core/dq to abc" {
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            execution_rate = "0"
        }
    }

    CODE model_init
        # Numpy module is imported as 'np'
        # Scipy module is imported as 'sp'
        
        Ts = 200e-6
        Ts2 = Ts
        
        #########################################################################
        ##########################################################################
        ####################  FUEL CELL###########################################
        # Numpy module is imported as 'np'
        # Scipy module is imported as 'sp'
        
        #Ts = 200e-6
        # Numpy module is imported as 'np'
        # Scipy module is imported as 'sp'
        
        
        T =1273
        I_FC_0 = 100
        F = 96.487e6
        R = 8314
        E0 = 1.18
        N0 = 450
        U = [0.9, 0.8, 0.85]
        K = [8.43e-4, 2.81e-4, 2.52e-3]
        taus = [26.1, 78.3, 2.91]
        r_ohm = 3.2813e-004
        tau_e = 0.8
        tau_f = 5
        r_HO = 1.145
        
        U_max=U[0]
        U_min=U[1]
        U_opt=U[2]
        
        K_H2=K[0]
        K_H2O=K[1]
        K_O2=K[2]
        
        K_r=N0/4/F
        
        q_H2_0=2*K_r/U_opt*I_FC_0
        
        p_H2_0=1/K_H2*(q_H2_0-2*K_r*I_FC_0)
        
        p_H2O_0=1/K_H2O*2*K_r*I_FC_0
        
        p_O2_0=1/K_O2*(1/r_HO*q_H2_0-K_r*I_FC_0)
        
        tau_H2=taus[0]
        tau_H2O=taus[1]
        tau_O2=taus[2]
        
        V_Nernst_0=N0*R*T/2/F*np.log(p_H2_0*np.sqrt(p_O2_0)/p_H2O_0)
        
        
        
        
        ########################################################################
        ####################################################################
        ####################################################################
        ####################################################################
        # Numpy module is imported as 'np'
        # Scipy module is imported as 'sp'
        
        # Numpy module is imported as 'np'
        # Scipy module is imported as 'sp'
        
        # Ts for ARM
        #Ts = 20e-6
        
        # Ts for uBlaze
        Ts = 200e-6
        
        # Governor specs
        
        K = 10  # gain K
        T1 = 1.0E-4 # Time constant T1 of Electric Control Box
        T2 = 0.0 # Time constant T2 of Electric Control Box
        T3 = 0.5001 # Time constant T3 of Electric Control Box
        T4 = 0.025  # Time constant T4 of Actuator
        T5 = 0.0009  # Time constant T5 of Actuator
        T6 = 0.00574  # Time constant T6 of Actuator
        Pm0 = 0.0 #0.0005  # Initial value of Mechanic Power
        Tmax = 10 #1.1  # Max torque limit
        Tmin = -0.1  # Min torque limit
        Td = 0.024  # Engine time delay
        ##################################################################
        
        ###################################################################
        dummy = 1.0 + 2.0*T5/Ts
        coeff1 = (1.0 + 2.0*T4/Ts)/dummy
        coeff2 = (1.0 - 2.0*T4/Ts)/dummy
        coeff3 = 1.0
        coeff4 = (1.0 - 2.0*T5/Ts)/dummy
        numTF4d = [coeff1, coeff2]
        denTF4d = [coeff3, coeff4]
        
        dummy = 1.0 + 2.0*T6/Ts
        coeff1 = (1.0)/dummy
        coeff2 = (1.0)/dummy
        coeff3 = 1.0
        coeff4 = (1.0 - 2.0*T6/Ts)/dummy
        numTF3d = [coeff1, coeff2]
        denTF3d = [coeff3, coeff4]
        
        numTF1d = [(1.0+2.0*T3/Ts),2.0,(1.0-2.0*T3/Ts)]
        denTF1d = [(1.0+2.0*T1/Ts+4.0*T1*T2/(Ts**2)),(2.0-8.0*T1*T2/(Ts**2)),(4.0*T1*T2/(Ts**2)-2.0*T1/Ts+1)]
        
        # Synchronous machine specs from Simulink's 4 MVA machine in PU
        
        f = 60.0  # Synchronous speed
        pms = 2.0  # Number of mechanical pole pairs
        Sb_gen1 = 1.067e6  # Nominal/base power of machine in VA
        Vn_gen1 = 4160.0  # Machine terminal line to line rms voltage
        Rs_pu_gen1 = 0.01524  # Stator resistance per phase in pu
        Lls_pu_gen1 = 0.08  # Stator leakage inductance in pu
        Lmd_pu_gen1 = 2.81  # Direct-axis magnetizing inductance in pu
        Lmq_pu_gen1 = 1.64  # Quadrature-axis magnetizing inductance in pu
        Rf_pu_gen1 = 0.004319  # Field resistance in pu
        Llfd_pu_gen1 = 0.531  # Field leakage inductance in pu
        Rkd_pu_gen1 = 0.2343  # D-axis resistance in pu
        Rkq_pu_gen1 = 0.03365  # Q-axis resistance in pu
        Llkd_pu_gen1 = 2.655  # D-axis leakage inductance in pu
        Llkq_pu_gen1 = 0.2408  # Q-axis leakage inductance in pu
        Ns_fd_gen1 = 1.0  # Turn ratio between the stator and the field windings
        Ns_kd_gen1 = 1.0  # Turn ratio between stator and d-axis damper windings
        Ns_kq_gen1 = 1.0  # Turn ratio between stator and q-axis damper windings
        H_gen1 = 0.8#0.3222  # Inertia coefficient in seconds
        Fpu_gen1 = 0.00923#0.01322  # Friction factor in pu
        
        # Base calculation
        
        Vb_gen1 = Vn_gen1*((2.0/3.0)**0.5)  # Nominal/base voltage of machine terminal in V (Peak line to neutral voltage)
        wb_gen1 = 2.0*np.pi*f  # Electrical angular speed base
        wmb_gen1 = wb_gen1/pms  # Mechanical angular speed base
        Zb_gen1 = (Vn_gen1*Vn_gen1)/Sb_gen1  # Impedance base
        Trq_b_gen1 = Sb_gen1/wmb_gen1  # Torque base
        Fb_gen1 = Trq_b_gen1/wmb_gen1  # Friction Factor base
        Lb_gen1 = Zb_gen1/wb_gen1  # Inductance base
        
        # Stator data in SI
        
        Rs_gen1 = Rs_pu_gen1*Zb_gen1
        Lls_gen1 = Lls_pu_gen1*Lb_gen1
        Lmd_gen1 = Lmd_pu_gen1*Lb_gen1
        Lmq_gen1 = Lmq_pu_gen1*Lb_gen1
        Rkd_gen1 = Rkd_pu_gen1*Zb_gen1
        Rkq_gen1 = Rkq_pu_gen1*Zb_gen1
        Llkd_gen1 = Llkd_pu_gen1*Lb_gen1
        Llkq_gen1 = Llkq_pu_gen1*Lb_gen1
        
        # Mechanical data in SI
        
        F_gen1 = Fpu_gen1*Fb_gen1  # Friction Factor in Nm.s
        J_gen1 = 2*H_gen1*Sb_gen1/(wmb_gen1*wmb_gen1)  # Inertia in kg.m2
        
        # Field base calculation
        
        Lsfd_gen1 = (2.0/3.0)*Lmd_gen1*(1.0/Ns_fd_gen1)  # Mutual inductance between stator and field
        ifn_gen1 = Vb_gen1/(Lsfd_gen1*wb_gen1)  # Nominal field current
        ifb_gen1 = ifn_gen1*Lmd_pu_gen1  # Field current base
        Vfb_gen1 = Sb_gen1/ifb_gen1  # Field voltage base
        Zfb_gen1 = Vfb_gen1/ifb_gen1  # Field impedance base
        Lfb_gen1 = Zfb_gen1/wb_gen1  # Field inductance base
        
        # Field data in SI
        
        Rf_gen1 = Rf_pu_gen1*Zfb_gen1  # Field resistance (Field side)
        Llfd_gen1 = Llfd_pu_gen1*Lfb_gen1  # Field inductance (Field side)
        Rf_prime_gen1 = Rf_gen1*(3.0/2.0)*(Ns_fd_gen1*Ns_fd_gen1)  # Field resistance referred to the stator side
        Llfd_prime_gen1 = Llfd_gen1*(3.0/2.0)*(Ns_fd_gen1*Ns_fd_gen1)  # Field inductance referred to the stator side
        
        # Exciter initialization
        
        Tr_gen1 = 20e-4  # Low pass filter time constant
        Ka_gen1 = 200.0  # Regulator gain
        Ta_gen1 = 2e-3  # Regulator time constant
        Ke_gen1 = 1.0  # Exciter constant
        Te_gen1 = 1e-8 #Exciter time constant
        Tb_gen1 = 1e-12  # Transient gain reduction time constant b
        Tc_gen1 = 1e-12  # Transient gain reduction time constant c
        Kf_gen1 = 0  # Damping filter gain
        Tf_gen1 = 1e-12  # Damping filter time constant
        Efmin_gen1 = -0.1 # Regulator output lower limit
        Efmax_gen1 = 5.0 #5.0  # Regulator output upper limit
        Vt0_gen1 = 0.0  # Initial terminal voltage
        Vf0_gen1 = 0.0  # Initial field voltage
        Const_gen1 = Vf0_gen1/Ka_gen1
        
        
        ########################################################################################
        
        Ts_Var = 100e-6
        
        
        dummy = 1.0 + 2.0*T5/Ts_Var
        coeff1 = (1.0 + 2.0*T4/Ts_Var)/dummy
        coeff2 = (1.0 - 2.0*T4/Ts_Var)/dummy
        coeff3 = 1.0
        coeff4 = (1.0 - 2.0*T5/Ts_Var)/dummy
        numTF4d = [coeff1, coeff2]
        denTF4d = [coeff3, coeff4]
        
        dummy = 1.0 + 2.0*T6/Ts_Var
        coeff1 = (1.0)/dummy
        coeff2 = (1.0)/dummy
        coeff3 = 1.0
        coeff4 = (1.0 - 2.0*T6/Ts_Var)/dummy
        numTF3d = [coeff1, coeff2]
        denTF3d = [coeff3, coeff4]
        
        numTF1d = [(1.0+2.0*T3/Ts_Var),2.0,(1.0-2.0*T3/Ts_Var)]
        denTF1d = [(1.0+2.0*T1/Ts_Var+4.0*T1*T2/(Ts_Var**2)),(2.0-8.0*T1*T2/(Ts_Var**2)),(4.0*T1*T2/(Ts_Var**2)-2.0*T1/Ts_Var+1)]
        
        # Synchronous machine specs from Simulink's 4 MVA machine in PU
        
        f = 60.0  # Synchronous speed
        pms = 2.0  # Number of mechanical pole pairs
        Sb_gen1_Var = 0.085e6  # Nominal/base power of machine in VA
        Vn_gen1_Var = 208.0  # Machine terminal line to line rms voltage
        Rs_pu_gen1_Var = 8.979e-3 #2.85e-3  # Stator resistance per phase in pu
        Lls_pu_gen1_Var = 0.05 #0.114  # Stator leakage inductance in pu
        Lmd_pu_gen1_Var = 2.35 #1.19  # Direct-axis magnetizing inductance in pu
        Lmq_pu_gen1_Var = 1.72 #0.36  # Quadrature-axis magnetizing inductance in pu
        Rf_pu_gen1_Var = 2.06e-3 #5.79e-4  # Field resistance in pu
        Llfd_pu_gen1_Var = 0.511 #0.114  # Field leakage inductance in pu
        Rkd_pu_gen1_Var = 0.2826 #1.17e-2  # D-axis resistance in pu
        Rkq_pu_gen1_Var = 0.02545 #1.97e-2  # Q-axis resistance in pu
        Llkd_pu_gen1_Var = 3.7338 #0.182  # D-axis leakage inductance in pu
        Llkq_pu_gen1_Var = 0.2392 #0.384  # Q-axis leakage inductance in pu
        Ns_fd_gen1_Var = 1.0  # Turn ratio between the stator and the field windings
        Ns_kd_gen1_Var = 1.0  # Turn ratio between stator and d-axis damper windings
        Ns_kq_gen1_Var = 1.0  # Turn ratio between stator and q-axis damper windings
        H_gen1_Var = 0.3468 #3.7  # Inertia coefficient in seconds
        Fpu_gen1_Var = 0.009238 #0.01322  # Friction factor in pu
        Ifn_gen1_Var = 60 #nominal field current
        
        
        # Base calculation
        
        Vb_gen1_Var = Vn_gen1*((2.0/3.0)**0.5)  # Nominal/base voltage of machine terminal in V (Peak line to neutral voltage)
        wb_gen1_Var = 2.0*np.pi*f  # Electrical angular speed base
        wmb_gen1_Var = wb_gen1_Var/pms  # Mechanical angular speed base
        Zb_gen1_Var = (Vn_gen1*Vn_gen1)/Sb_gen1  # Impedance base
        Trq_b_gen1_Var = Sb_gen1/wmb_gen1_Var  # Torque base
        Fb_gen1_Var = Trq_b_gen1_Var/wmb_gen1_Var  # Friction Factor base
        Lb_gen1_Var = Zb_gen1_Var/wb_gen1_Var  # Inductance base
        
        # Stator data in SI
        
        Rs_gen1_Var = Rs_pu_gen1_Var*Zb_gen1_Var
        Lls_gen1_Var = Lls_pu_gen1_Var*Lb_gen1_Var
        Lmd_gen1_Var = Lmd_pu_gen1_Var*Lb_gen1_Var
        Lmq_gen1_Var = Lmq_pu_gen1_Var*Lb_gen1_Var
        Rkd_gen1_Var = Rkd_pu_gen1_Var*Zb_gen1_Var
        Rkq_gen1_Var = Rkq_pu_gen1_Var*Zb_gen1_Var
        Llkd_gen1_Var = Llkd_pu_gen1_Var*Lb_gen1_Var
        Llkq_gen1_Var = Llkq_pu_gen1_Var*Lb_gen1_Var
        
        # Mechanical data in SI
        
        F_gen1_Var = Fpu_gen1_Var*Fb_gen1_Var  # Friction Factor in Nm.s
        J_gen1_Var = 2*H_gen1_Var*Sb_gen1/(wmb_gen1_Var*wmb_gen1_Var)  # Inertia in kg.m2
        
        # Field base calculation
        
        Lsfd_gen1_Var = (2.0/3.0)*Lmd_gen1_Var*(1.0/Ns_fd_gen1_Var)  # Mutual inductance between stator and field
        ifn_gen1_Var = Vb_gen1_Var/(Lsfd_gen1_Var*wb_gen1_Var)  # Nominal field current
        ifb_gen1_Var = ifn_gen1_Var*Lmd_pu_gen1_Var  # Field current base
        Vfb_gen1_Var = Sb_gen1/ifb_gen1_Var  # Field voltage base
        Zfb_gen1_Var = Vfb_gen1_Var/ifb_gen1_Var  # Field impedance base
        Lfb_gen1_Var = Zfb_gen1_Var/wb_gen1_Var  # Field inductance base
        
        # Field data in SI
        
        Rf_gen1_Var = Rf_pu_gen1_Var*Zfb_gen1_Var  # Field resistance (Field side)
        Llfd_gen1_Var = Llfd_pu_gen1_Var*Lfb_gen1_Var  # Field inductance (Field side)
        Rf_prime_gen1_Var = Rf_gen1_Var*(3.0/2.0)*(Ns_fd_gen1_Var*Ns_fd_gen1_Var)  # Field resistance referred to the stator side
        Llfd_prime_gen1_Var = Llfd_gen1_Var*(3.0/2.0)*(Ns_fd_gen1_Var*Ns_fd_gen1_Var)  # Field inductance referred to the stator side
        
        # Exciter initialization
    ENDCODE
}
